"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Api = void 0;
const constructs_1 = require("constructs");
const cdk = __importStar(require("aws-cdk-lib"));
const cognito = __importStar(require("aws-cdk-lib/aws-cognito"));
const apig = __importStar(require("@aws-cdk/aws-apigatewayv2-alpha"));
const apigAuthorizers = __importStar(require("@aws-cdk/aws-apigatewayv2-authorizers-alpha"));
const apigIntegrations = __importStar(require("@aws-cdk/aws-apigatewayv2-integrations-alpha"));
const Stack_1 = require("./Stack");
const Construct_1 = require("./Construct");
const Function_1 = require("./Function");
const duration_1 = require("./util/duration");
const apigV2Cors = __importStar(require("./util/apiGatewayV2Cors"));
const apigV2Domain = __importStar(require("./util/apiGatewayV2Domain"));
const apigV2AccessLog = __importStar(require("./util/apiGatewayV2AccessLog"));
const PayloadFormatVersions = ["1.0", "2.0"];
/////////////////////
// Construct
/////////////////////
/**
 * The Api construct is a higher level CDK construct that makes it easy to create an API. It provides a simple way to define the routes in your API. And allows you to configure the specific Lambda functions if necessary. It also allows you to configure authorization and custom domains.
 *
 * @example
 * The `Api` construct is designed to make it easy to get started with, while allowing for a way to fully configure it as well. Let's look at how, through a couple of examples.
 *
 * ### Using the minimal config
 *
 * ```ts
 * import { Api } from "@serverless-stack/resources";
 *
 * new Api(stack, "Api", {
 *   routes: {
 *     "GET    /notes": "src/list.main",
 *     "POST   /notes": "src/create.main",
 *     "GET    /notes/{id}": "src/get.main",
 *     "PUT    /notes/{id}": "src/update.main",
 *     "DELETE /notes/{id}": "src/delete.main",
 *   },
 * });
 * ```
 */
class Api extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        this.props = props || {};
        this.cdk = {};
        this.routesData = {};
        this.authorizersData = {};
        this.permissionsAttachedForAllRoutes = [];
        this.createHttpApi();
        this.addAuthorizers(this.props.authorizers || {});
        this.addRoutes(this, this.props.routes || {});
    }
    /**
     * The AWS generated URL of the Api.
     */
    get url() {
        return this.cdk.httpApi.apiEndpoint;
    }
    /**
     * If custom domain is enabled, this is the custom domain URL of the Api.
     *
     * :::note
     * If you are setting the base mapping for the custom domain, you need to include the trailing slash while using the custom domain URL. For example, if the [`domainName`](#domainname) is set to `api.domain.com` and the [`path`](#path) is `v1`, the custom domain URL of the API will be `https://api.domain.com/v1/`.
     * :::
     */
    get customDomainUrl() {
        return this._customDomainUrl;
    }
    /**
     * The routes for the Api
     */
    get routes() {
        return Object.keys(this.routesData);
    }
    /**
     * The ARN of the internally created API Gateway HTTP API
     */
    get httpApiArn() {
        const stack = Stack_1.Stack.of(this);
        return `arn:${stack.partition}:apigateway:${stack.region}::/apis/${this.cdk.httpApi.apiId}`;
    }
    /**
     * The id of the internally created API Gateway HTTP API
     */
    get httpApiId() {
        return this.cdk.httpApi.apiId;
    }
    /**
     * Adds routes to the Api after it has been created.
     *
     * @example
     * ```js
     * api.addRoutes(stack, {
     *   "GET    /notes/{id}": "src/get.main",
     *   "PUT    /notes/{id}": "src/update.main",
     *   "DELETE /notes/{id}": "src/delete.main",
     * });
     * ```
     */
    addRoutes(scope, routes) {
        Object.keys(routes).forEach((routeKey) => {
            this.addRoute(scope, routeKey, routes[routeKey]);
        });
    }
    /**
     * Get the instance of the internally created Function, for a given route key where the `routeKey` is the key used to define a route. For example, `GET /notes`.
     *
     * @example
     * ```js
     * const api = new Api(stack, "Api", {
     *   routes: {
     *     "GET /notes": "src/list.main",
     *   },
     * });
     *
     * const listFunction = api.getFunction("GET /notes");
     * ```
     */
    getFunction(routeKey) {
        const route = this.routesData[this.normalizeRouteKey(routeKey)];
        return route instanceof Function_1.Function ? route : undefined;
    }
    /**
     * Attaches the given list of permissions to all the routes. This allows the functions to access other AWS resources.
     *
     * @example
     *
     * ```js
     * api.attachPermissions(["s3"]);
     * ```
     */
    attachPermissions(permissions) {
        Object.values(this.routesData)
            .filter((route) => route instanceof Function_1.Function)
            .forEach((route) => route.attachPermissions(permissions));
        this.permissionsAttachedForAllRoutes.push(permissions);
    }
    /**
     * Attaches the given list of permissions to a specific route. This allows that function to access other AWS resources.
     *
     * @example
     * ```js
     * const api = new Api(stack, "Api", {
     *   routes: {
     *     "GET    /notes": "src/list.main",
     *   },
     * });
     *
     * api.attachPermissionsToRoute("GET /notes", ["s3"]);
     * ```
     *
     */
    attachPermissionsToRoute(routeKey, permissions) {
        const fn = this.getFunction(routeKey);
        if (!fn) {
            throw new Error(`Failed to attach permissions. Route "${routeKey}" does not exist.`);
        }
        fn.attachPermissions(permissions);
    }
    getConstructMetadata() {
        return {
            type: "Api",
            data: {
                graphql: false,
                url: this.cdk.httpApi.url,
                httpApiId: this.cdk.httpApi.apiId,
                customDomainUrl: this._customDomainUrl,
                routes: Object.entries(this.routesData).map(([key, data]) => {
                    return {
                        route: key,
                        fn: (0, Construct_1.getFunctionRef)(data),
                    };
                }),
            },
        };
    }
    createHttpApi() {
        var _a, _b;
        const { cdk, cors, defaults, accessLog, customDomain } = this.props;
        const id = this.node.id;
        const app = this.node.root;
        if ((0, Construct_1.isCDKConstruct)(cdk === null || cdk === void 0 ? void 0 : cdk.httpApi)) {
            if (cors !== undefined) {
                throw new Error(`Cannot configure the "cors" when "cdk.httpApi" is a construct`);
            }
            if (accessLog !== undefined) {
                throw new Error(`Cannot configure the "accessLog" when "cdk.httpApi" is a construct`);
            }
            if (customDomain !== undefined) {
                throw new Error(`Cannot configure the "customDomain" when "cdk.httpApi" is a construct`);
            }
            if ((cdk === null || cdk === void 0 ? void 0 : cdk.httpStages) !== undefined) {
                throw new Error(`Cannot configure the "stages" when "cdk.httpApi" is a construct`);
            }
            this.cdk.httpApi = cdk === null || cdk === void 0 ? void 0 : cdk.httpApi;
        }
        else {
            const httpApiProps = ((cdk === null || cdk === void 0 ? void 0 : cdk.httpApi) || {});
            // Validate input
            if (httpApiProps.corsPreflight !== undefined) {
                throw new Error(`Cannot configure the "httpApi.corsPreflight" in the Api`);
            }
            if (httpApiProps.defaultDomainMapping !== undefined) {
                throw new Error(`Cannot configure the "httpApi.defaultDomainMapping" in the Api`);
            }
            // Handle Custom Domain
            const customDomainData = apigV2Domain.buildCustomDomainData(this, customDomain);
            let defaultDomainMapping;
            if (customDomainData) {
                if (customDomainData.isApigDomainCreated) {
                    this.cdk.domainName = customDomainData.apigDomain;
                }
                if (customDomainData.isCertificatedCreated) {
                    this.cdk.certificate =
                        customDomainData.certificate;
                }
                defaultDomainMapping = {
                    domainName: customDomainData.apigDomain,
                    mappingKey: customDomainData.mappingKey,
                };
                this._customDomainUrl = `https://${customDomainData.url}`;
            }
            this.cdk.httpApi = new apig.HttpApi(this, "Api", Object.assign({ apiName: app.logicalPrefixedName(id), corsPreflight: apigV2Cors.buildCorsConfig(cors), defaultDomainMapping }, httpApiProps));
            const httpStage = this.cdk.httpApi.defaultStage;
            // Configure throttling
            if (((_a = defaults === null || defaults === void 0 ? void 0 : defaults.throttle) === null || _a === void 0 ? void 0 : _a.burst) && ((_b = defaults === null || defaults === void 0 ? void 0 : defaults.throttle) === null || _b === void 0 ? void 0 : _b.rate)) {
                const cfnStage = httpStage.node.defaultChild;
                cfnStage.defaultRouteSettings = Object.assign(Object.assign({}, (cfnStage.routeSettings || {})), { throttlingBurstLimit: defaults.throttle.burst, throttlingRateLimit: defaults.throttle.rate });
            }
            // Configure access log
            for (const def of (cdk === null || cdk === void 0 ? void 0 : cdk.httpStages) || []) {
                const stage = new apig.HttpStage(this, "Stage" + def.stageName, Object.assign(Object.assign({}, def), { httpApi: this.cdk.httpApi }));
                apigV2AccessLog.buildAccessLogData(this, accessLog, stage, false);
            }
            if (this.cdk.httpApi.defaultStage)
                this.cdk.accessLogGroup = apigV2AccessLog.buildAccessLogData(this, accessLog, this.cdk.httpApi.defaultStage, true);
        }
    }
    addAuthorizers(authorizers) {
        Object.entries(authorizers).forEach(([key, value]) => {
            var _a, _b, _c;
            if (key === "none") {
                throw new Error(`Cannot name an authorizer "none"`);
            }
            else if (key === "iam") {
                throw new Error(`Cannot name an authorizer "iam"`);
            }
            else if (value.type === "user_pool") {
                if ((_a = value.cdk) === null || _a === void 0 ? void 0 : _a.authorizer) {
                    this.authorizersData[key] = value.cdk.authorizer;
                }
                else {
                    if (!value.userPool) {
                        throw new Error(`Missing "userPool" for "${key}" authorizer`);
                    }
                    const userPool = cognito.UserPool.fromUserPoolId(this, `Api-${this.node.id}-Authorizer-${key}-UserPool`, value.userPool.id);
                    const userPoolClients = value.userPool.clientIds &&
                        value.userPool.clientIds.map((clientId, i) => cognito.UserPoolClient.fromUserPoolClientId(this, `Api-${this.node.id}-Authorizer-${key}-UserPoolClient-${i}`, clientId));
                    this.authorizersData[key] =
                        new apigAuthorizers.HttpUserPoolAuthorizer(key, userPool, {
                            authorizerName: value.name,
                            identitySource: value.identitySource,
                            userPoolClients,
                            userPoolRegion: value.userPool.region,
                        });
                }
            }
            else if (value.type === "jwt") {
                if ((_b = value.cdk) === null || _b === void 0 ? void 0 : _b.authorizer) {
                    this.authorizersData[key] = value.cdk.authorizer;
                }
                else {
                    if (!value.jwt) {
                        throw new Error(`Missing "jwt" for "${key}" authorizer`);
                    }
                    this.authorizersData[key] = new apigAuthorizers.HttpJwtAuthorizer(key, value.jwt.issuer, {
                        authorizerName: value.name,
                        identitySource: value.identitySource,
                        jwtAudience: value.jwt.audience,
                    });
                }
            }
            else if (value.type === "lambda") {
                if ((_c = value.cdk) === null || _c === void 0 ? void 0 : _c.authorizer) {
                    this.authorizersData[key] = value.cdk.authorizer;
                }
                else {
                    if (!value.function) {
                        throw new Error(`Missing "function" for "${key}" authorizer`);
                    }
                    this.authorizersData[key] = new apigAuthorizers.HttpLambdaAuthorizer(key, value.function, {
                        authorizerName: value.name,
                        identitySource: value.identitySource,
                        responseTypes: value.responseTypes &&
                            value.responseTypes.map((type) => apigAuthorizers.HttpLambdaResponseType[type.toUpperCase()]),
                        resultsCacheTtl: value.resultsCacheTtl
                            ? (0, duration_1.toCdkDuration)(value.resultsCacheTtl)
                            : cdk.Duration.seconds(0),
                    });
                }
            }
        });
    }
    addRoute(scope, routeKey, routeValue) {
        ///////////////////
        // Normalize routeKey
        ///////////////////
        routeKey = this.normalizeRouteKey(routeKey);
        if (this.routesData[routeKey]) {
            throw new Error(`A route already exists for "${routeKey}"`);
        }
        ///////////////////
        // Get path and method
        ///////////////////
        let postfixName;
        let httpRouteKey;
        let method;
        let path;
        if (routeKey === "$default") {
            postfixName = "default";
            httpRouteKey = apig.HttpRouteKey.DEFAULT;
            method = "ANY";
            path = routeKey;
        }
        else {
            const routeKeyParts = routeKey.split(" ");
            if (routeKeyParts.length !== 2) {
                throw new Error(`Invalid route ${routeKey}`);
            }
            method = routeKeyParts[0].toUpperCase();
            if (!apig.HttpMethod[method]) {
                throw new Error(`Invalid method defined for "${routeKey}"`);
            }
            path = routeKeyParts[1];
            if (path.length === 0) {
                throw new Error(`Invalid path defined for "${routeKey}"`);
            }
            postfixName = `${method}_${path}`;
            httpRouteKey = apig.HttpRouteKey.with(path, apig.HttpMethod[method]);
        }
        ///////////////////
        // Create route
        ///////////////////
        const [routeProps, integration] = (() => {
            if (Function_1.Function.isInlineDefinition(routeValue)) {
                const routeProps = { function: routeValue };
                return [
                    routeProps,
                    this.createFunctionIntegration(scope, routeKey, routeProps, postfixName),
                ];
            }
            if (routeValue.type === "alb") {
                return [
                    routeValue,
                    this.createAlbIntegration(scope, routeKey, routeValue, postfixName),
                ];
            }
            if (routeValue.type === "url") {
                return [
                    routeValue,
                    this.createHttpIntegration(scope, routeKey, routeValue, postfixName),
                ];
            }
            if ("function" in routeValue) {
                return [
                    routeValue,
                    this.createFunctionIntegration(scope, routeKey, routeValue, postfixName),
                ];
            }
            if ("handler" in routeValue)
                throw new Error(`Function definition must be nested under the "function" key in the route props for "${routeKey}". ie. { function: { handler: "myfunc.handler" } }`);
            throw new Error(`Invalid route type for "${routeKey}". Must be one of: alb, url, function`);
        })();
        const { authorizationType, authorizer, authorizationScopes } = this.buildRouteAuth(routeProps);
        const route = new apig.HttpRoute(scope, `Route_${postfixName}`, {
            httpApi: this.cdk.httpApi,
            routeKey: httpRouteKey,
            integration,
            authorizer,
            authorizationScopes,
        });
        ////////////////////
        // Configure route authorization type
        ////////////////////
        // Note: we need to explicitly set `cfnRoute.authorizationType` to `NONE`
        //       because if it were set to `AWS_IAM`, and then it is removed from
        //       the CloudFormation template (ie. set to undefined), CloudFormation
        //       doesn't updates the route. The route's authorizationType would still
        //       be `AWS_IAM`.
        const cfnRoute = route.node.defaultChild;
        if (authorizationType === "iam") {
            cfnRoute.authorizationType = "AWS_IAM";
        }
        else if (authorizationType === "none") {
            cfnRoute.authorizationType = "NONE";
        }
    }
    createHttpIntegration(scope, routeKey, routeProps, postfixName) {
        var _a;
        ///////////////////
        // Create integration
        ///////////////////
        const integration = new apigIntegrations.HttpUrlIntegration(`Integration_${postfixName}`, routeProps.url, (_a = routeProps.cdk) === null || _a === void 0 ? void 0 : _a.integration);
        // Store route
        this.routesData[routeKey] = routeProps.url;
        return integration;
    }
    createAlbIntegration(scope, routeKey, routeProps, postfixName) {
        var _a, _b, _c;
        ///////////////////
        // Create integration
        ///////////////////
        const integration = new apigIntegrations.HttpAlbIntegration(`Integration_${postfixName}`, (_a = routeProps.cdk) === null || _a === void 0 ? void 0 : _a.albListener, (_b = routeProps.cdk) === null || _b === void 0 ? void 0 : _b.integration);
        // Store route
        this.routesData[routeKey] = (_c = routeProps.cdk) === null || _c === void 0 ? void 0 : _c.albListener;
        return integration;
    }
    createFunctionIntegration(scope, routeKey, routeProps, postfixName) {
        var _a, _b;
        ///////////////////
        // Get payload format
        ///////////////////
        const payloadFormatVersion = routeProps.payloadFormatVersion ||
            ((_a = this.props.defaults) === null || _a === void 0 ? void 0 : _a.payloadFormatVersion) ||
            "2.0";
        if (!PayloadFormatVersions.includes(payloadFormatVersion)) {
            throw new Error(`PayloadFormatVersion: sst.Api does not currently support ${payloadFormatVersion} payload format version. Only "V1" and "V2" are currently supported.`);
        }
        const integrationPayloadFormatVersion = payloadFormatVersion === "1.0"
            ? apig.PayloadFormatVersion.VERSION_1_0
            : apig.PayloadFormatVersion.VERSION_2_0;
        ///////////////////
        // Create Function
        ///////////////////
        const lambda = Function_1.Function.fromDefinition(scope, `Lambda_${postfixName}`, routeProps.function, (_b = this.props.defaults) === null || _b === void 0 ? void 0 : _b.function, `The "defaults.function" cannot be applied if an instance of a Function construct is passed in. Make sure to define all the routes using FunctionProps, so the Api construct can apply the "defaults.function" to them.`);
        // Add an environment variable to determine if the function is an Api route.
        // If it is, when "sst start" is not connected, we want to return an 500
        // status code and a descriptive error message.
        const root = scope.node.root;
        if (root.local) {
            lambda.addEnvironment("SST_DEBUG_IS_API_ROUTE", "1", {
                removeInEdge: true,
            });
        }
        ///////////////////
        // Create integration
        ///////////////////
        const integration = new apigIntegrations.HttpLambdaIntegration(`Integration_${postfixName}`, lambda, {
            payloadFormatVersion: integrationPayloadFormatVersion,
        });
        // Store route
        this.routesData[routeKey] = lambda;
        // Attached existing permissions
        this.permissionsAttachedForAllRoutes.forEach((permissions) => lambda.attachPermissions(permissions));
        return integration;
    }
    buildRouteAuth(routeProps) {
        var _a, _b;
        const authorizerKey = routeProps.authorizer || ((_a = this.props.defaults) === null || _a === void 0 ? void 0 : _a.authorizer) || "none";
        if (authorizerKey === "none") {
            return {
                authorizationType: "none",
                authorizer: new apig.HttpNoneAuthorizer(),
            };
        }
        else if (authorizerKey === "iam") {
            return {
                authorizationType: "iam",
                authorizer: new apigAuthorizers.HttpIamAuthorizer(),
            };
        }
        if (!this.props.authorizers ||
            !this.props.authorizers[authorizerKey]) {
            throw new Error(`Cannot find authorizer "${authorizerKey}"`);
        }
        const authorizer = this.authorizersData[authorizerKey];
        const authorizationType = this.props.authorizers[authorizerKey].type;
        const authorizationScopes = authorizationType === "jwt" || authorizationType === "user_pool"
            ? routeProps.authorizationScopes ||
                ((_b = this.props.defaults) === null || _b === void 0 ? void 0 : _b.authorizationScopes)
            : undefined;
        return { authorizationType, authorizer, authorizationScopes };
    }
    normalizeRouteKey(routeKey) {
        return routeKey.split(/\s+/).join(" ");
    }
}
exports.Api = Api;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXBpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL0FwaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUF1QztBQUN2QyxpREFBbUM7QUFDbkMsaUVBQW1EO0FBR25ELHNFQUF3RDtBQUN4RCw2RkFBK0U7QUFDL0UsK0ZBQWlGO0FBS2pGLG1DQUFnQztBQUNoQywyQ0FBMkU7QUFDM0UseUNBS29CO0FBQ3BCLDhDQUEwRDtBQUUxRCxvRUFBc0Q7QUFDdEQsd0VBQTBEO0FBQzFELDhFQUFnRTtBQUVoRSxNQUFNLHFCQUFxQixHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBVSxDQUFDO0FBd2Z0RCxxQkFBcUI7QUFDckIsWUFBWTtBQUNaLHFCQUFxQjtBQUVyQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBcUJHO0FBQ0gsTUFBYSxHQU1YLFNBQVEsc0JBQVM7SUE2QmpCLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBNkI7UUFDckUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssSUFBSSxFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFTLENBQUM7UUFDckIsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7UUFDMUIsSUFBSSxDQUFDLCtCQUErQixHQUFHLEVBQUUsQ0FBQztRQUUxQyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsSUFBSyxFQUFrQixDQUFDLENBQUM7UUFDbkUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLENBQUM7SUFDaEQs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LENBQUM7SUFFTyxpQkFBaUIsQ0FBQyxRQUFnQjtRQUN4QyxPQUFPLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7Q0FDRjtBQWxvQkQsa0JBa29CQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSBcImF3cy1jZGstbGliXCI7XG5pbXBvcnQgKiBhcyBjb2duaXRvIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtY29nbml0b1wiO1xuaW1wb3J0ICogYXMgYWNtIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtY2VydGlmaWNhdGVtYW5hZ2VyXCI7XG5pbXBvcnQgKiBhcyBjZm5BcGlnIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtYXBpZ2F0ZXdheXYyXCI7XG5pbXBvcnQgKiBhcyBhcGlnIGZyb20gXCJAYXdzLWNkay9hd3MtYXBpZ2F0ZXdheXYyLWFscGhhXCI7XG5pbXBvcnQgKiBhcyBhcGlnQXV0aG9yaXplcnMgZnJvbSBcIkBhd3MtY2RrL2F3cy1hcGlnYXRld2F5djItYXV0aG9yaXplcnMtYWxwaGFcIjtcbmltcG9ydCAqIGFzIGFwaWdJbnRlZ3JhdGlvbnMgZnJvbSBcIkBhd3MtY2RrL2F3cy1hcGlnYXRld2F5djItaW50ZWdyYXRpb25zLWFscGhhXCI7XG5pbXBvcnQgKiBhcyBlbGIgZnJvbSBcImF3cy1jZGstbGliL2F3cy1lbGFzdGljbG9hZGJhbGFuY2luZ3YyXCI7XG5pbXBvcnQgKiBhcyBsb2dzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtbG9nc1wiO1xuXG5pbXBvcnQgeyBBcHAgfSBmcm9tIFwiLi9BcHBcIjtcbmltcG9ydCB7IFN0YWNrIH0gZnJvbSBcIi4vU3RhY2tcIjtcbmltcG9ydCB7IGdldEZ1bmN0aW9uUmVmLCBTU1RDb25zdHJ1Y3QsIGlzQ0RLQ29uc3RydWN0IH0gZnJvbSBcIi4vQ29uc3RydWN0XCI7XG5pbXBvcnQge1xuICBGdW5jdGlvbiBhcyBGbixcbiAgRnVuY3Rpb25Qcm9wcyxcbiAgRnVuY3Rpb25JbmxpbmVEZWZpbml0aW9uLFxuICBGdW5jdGlvbkRlZmluaXRpb24sXG59IGZyb20gXCIuL0Z1bmN0aW9uXCI7XG5pbXBvcnQgeyBEdXJhdGlvbiwgdG9DZGtEdXJhdGlvbiB9IGZyb20gXCIuL3V0aWwvZHVyYXRpb25cIjtcbmltcG9ydCB7IFBlcm1pc3Npb25zIH0gZnJvbSBcIi4vdXRpbC9wZXJtaXNzaW9uXCI7XG5pbXBvcnQgKiBhcyBhcGlnVjJDb3JzIGZyb20gXCIuL3V0aWwvYXBpR2F0ZXdheVYyQ29yc1wiO1xuaW1wb3J0ICogYXMgYXBpZ1YyRG9tYWluIGZyb20gXCIuL3V0aWwvYXBpR2F0ZXdheVYyRG9tYWluXCI7XG5pbXBvcnQgKiBhcyBhcGlnVjJBY2Nlc3NMb2cgZnJvbSBcIi4vdXRpbC9hcGlHYXRld2F5VjJBY2Nlc3NMb2dcIjtcblxuY29uc3QgUGF5bG9hZEZvcm1hdFZlcnNpb25zID0gW1wiMS4wXCIsIFwiMi4wXCJdIGFzIGNvbnN0O1xuZXhwb3J0IHR5cGUgQXBpUGF5bG9hZEZvcm1hdFZlcnNpb24gPSB0eXBlb2YgUGF5bG9hZEZvcm1hdFZlcnNpb25zW251bWJlcl07XG50eXBlIEFwaUh0dHBNZXRob2QgPSBrZXlvZiB0eXBlb2YgYXBpZy5IdHRwTWV0aG9kO1xuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIEludGVyZmFjZXNcbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5leHBvcnQgdHlwZSBBcGlBdXRob3JpemVyID1cbiAgfCBBcGlVc2VyUG9vbEF1dGhvcml6ZXJcbiAgfCBBcGlKd3RBdXRob3JpemVyXG4gIHwgQXBpTGFtYmRhQXV0aG9yaXplcjtcblxuaW50ZXJmYWNlIEFwaUJhc2VBdXRob3JpemVyIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBhdXRob3JpemVyLlxuICAgKi9cbiAgbmFtZT86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBpZGVudGl0eSBzb3VyY2UgZm9yIHdoaWNoIGF1dGhvcml6YXRpb24gaXMgcmVxdWVzdGVkLlxuICAgKiBAZGVmYXVsdCBgW1wiJHJlcXVlc3QuaGVhZGVyLkF1dGhvcml6YXRpb25cIl1gXG4gICAqL1xuICBpZGVudGl0eVNvdXJjZT86IHN0cmluZ1tdO1xufVxuXG4vKipcbiAqIFNwZWNpZnkgYSB1c2VyIHBvb2wgYXV0aG9yaXplciBhbmQgY29uZmlndXJlIGFkZGl0aW9uYWwgb3B0aW9ucy5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBganNcbiAqIG5ldyBBcGkoc3RhY2ssIFwiQXBpXCIsIHtcbiAqICAgYXV0aG9yaXplcnM6IHtcbiAqICAgICBBdXRob3JpemVyOiB7XG4gKiAgICAgICB0eXBlOiBcInVzZXJfcG9vbFwiLFxuICogICAgICAgdXNlclBvb2w6IHtcbiAqICAgICAgICAgaWQ6IHVzZXJQb29sLnVzZXJQb29sSWQsXG4gKiAgICAgICAgIGNsaWVudElkczogW3VzZXJQb29sQ2xpZW50LnVzZXJQb29sQ2xpZW50SWRdLFxuICogICAgICAgfSxcbiAqICAgICB9LFxuICogICB9LFxuICogfSk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBcGlVc2VyUG9vbEF1dGhvcml6ZXIgZXh0ZW5kcyBBcGlCYXNlQXV0aG9yaXplciB7XG4gIC8qKlxuICAgKiBTdHJpbmcgbGkgYW55IHNob3QgYW5kIGhhdmluZyBldmVuIGEgbWluaXNjdWxlIHNob3R0ZXJhbCB0byBzaWduaWZ5IHRoYXQgdGhlIGF1dGhvcml6ZXIgaXMgdXNlciBwb29sIGF1dGhvcml6ZXIuXG4gICAqL1xuICB0eXBlOiBcInVzZXJfcG9vbFwiO1xuICB1c2VyUG9vbD86IHtcbiAgICAvKipcbiAgICAgKiBUaGUgaWQgb2YgdGhlIHVzZXIgcG9vbCB0byB1c2UgZm9yIGF1dGhvcml6YXRpb24uXG4gICAgICovXG4gICAgaWQ6IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBUaGUgaWRzIG9mIHRoZSB1c2VyIHBvb2wgY2xpZW50cyB0byB1c2UgZm9yIGF1dGhvcml6YXRpb24uXG4gICAgICovXG4gICAgY2xpZW50SWRzPzogc3RyaW5nW107XG4gICAgLyoqXG4gICAgICogVGhlIEFXUyByZWdpb24gb2YgdGhlIHVzZXIgcG9vbC5cbiAgICAgKi9cbiAgICByZWdpb24/OiBzdHJpbmc7XG4gIH07XG4gIGNkaz86IHtcbiAgICAvKipcbiAgICAgKiBUaGlzIGFsbG93cyB5b3UgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHQgc2V0dGluZ3MgdGhpcyBjb25zdHJ1Y3QgdXNlcyBpbnRlcm5hbGx5IHRvIGNyZWF0ZSB0aGUgYXV0aG9yaXplci5cbiAgICAgKi9cbiAgICBhdXRob3JpemVyOiBhcGlnQXV0aG9yaXplcnMuSHR0cFVzZXJQb29sQXV0aG9yaXplcjtcbiAgfTtcbn1cblxuLyoqXG4gKiBTcGVjaWZ5IGEgSldUIGF1dGhvcml6ZXIgYW5kIGNvbmZpZ3VyZSBhZGRpdGlvbmFsIG9wdGlvbnMuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGpzXG4gKiBuZXcgQXBpKHN0YWNrLCBcIkFwaVwiLCB7XG4gKiAgIGF1dGhvcml6ZXJzOiB7XG4gKiAgICAgQXV0aG9yaXplcjoge1xuICogICAgICAgdHlwZTogXCJqd3RcIixcbiAqICAgICAgIHVzZXJQb29sOiB7XG4gKiAgICAgICAgIGlzc3VlcjogXCJodHRwczovL2FiYy51cy5hdXRoMC5jb21cIixcbiAqICAgICAgICAgYXVkaWVuY2U6IFtcIjEyM1wiXSxcbiAqICAgICAgIH0sXG4gKiAgICAgfSxcbiAqICAgfSxcbiAqIH0pO1xuICogYGBgXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQXBpSnd0QXV0aG9yaXplciBleHRlbmRzIEFwaUJhc2VBdXRob3JpemVyIHtcbiAgLyoqXG4gICAqIFN0cmluZyBsaXRlcmFsIHRvIHNpZ25pZnkgdGhhdCB0aGUgYXV0aG9yaXplciBpcyBKV1QgYXV0aG9yaXplci5cbiAgICovXG4gIHR5cGU6IFwiand0XCI7XG4gIGp3dD86IHtcbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZSBkb21haW4gb2YgdGhlIGlkZW50aXR5IHByb3ZpZGVyIHRoYXQgaXNzdWVzIEpXVC5cbiAgICAgKi9cbiAgICBpc3N1ZXI6IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBBIGxpc3Qgb2YgdGhlIGludGVuZGVkIHJlY2lwaWVudHMgb2YgdGhlIEpXVC5cbiAgICAgKi9cbiAgICBhdWRpZW5jZTogc3RyaW5nW107XG4gIH07XG4gIGNkaz86IHtcbiAgICAvKipcbiAgICAgKiBUaGlzIGFsbG93cyB5b3UgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHQgc2V0dGluZ3MgdGhpcyBjb25zdHJ1Y3QgdXNlcyBpbnRlcm5hbGx5IHRvIGNyZWF0ZSB0aGUgYXV0aG9yaXplci5cbiAgICAgKi9cbiAgICBhdXRob3JpemVyOiBhcGlnQXV0aG9yaXplcnMuSHR0cEp3dEF1dGhvcml6ZXI7XG4gIH07XG59XG5cbi8qKlxuICogU3BlY2lmeSBhIExhbWJkYSBhdXRob3JpemVyIGFuZCBjb25maWd1cmUgYWRkaXRpb25hbCBvcHRpb25zLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqc1xuICogbmV3IEFwaShzdGFjaywgXCJBcGlcIiwge1xuICogICBhdXRob3JpemVyczoge1xuICogICAgIEF1dGhvcml6ZXI6IHtcbiAqICAgICAgIHR5cGU6IFwibGFtYmRhXCIsXG4gKiAgICAgICBmdW5jdGlvbjogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkF1dGhvcml6ZXJcIiwge1xuICogICAgICAgICBoYW5kbGVyOiBcInRlc3QvbGFtYmRhLmhhbmRsZXJcIixcbiAqICAgICAgIH0pLFxuICogICAgIH0sXG4gKiAgIH0sXG4gKiB9KTtcbiAqIGBgYFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFwaUxhbWJkYUF1dGhvcml6ZXIgZXh0ZW5kcyBBcGlCYXNlQXV0aG9yaXplciB7XG4gIC8qKlxuICAgKiBTdHJpbmcgbGl0ZXJhbCB0byBzaWduaWZ5IHRoYXQgdGhlIGF1dGhvcml6ZXIgaXMgTGFtYmRhIGF1dGhvcml6ZXIuXG4gICAqL1xuICB0eXBlOiBcImxhbWJkYVwiO1xuICAvKipcbiAgICogVXNlZCB0byBjcmVhdGUgdGhlIGF1dGhvcml6ZXIgZnVuY3Rpb25cbiAgICovXG4gIGZ1bmN0aW9uPzogRm47XG4gIC8qKlxuICAgKiBUaGUgdHlwZXMgb2YgcmVzcG9uc2VzIHRoZSBsYW1iZGEgY2FuIHJldHVybi5cbiAgICpcbiAgICogSWYgYHNpbXBsZWAgaXMgaW5jbHVkZWQgdGhlbiByZXNwb25zZSBmb3JtYXQgMi4wIHdpbGwgYmUgdXNlZC5cbiAgICovXG4gIHJlc3BvbnNlVHlwZXM/OiBMb3dlcmNhc2U8XG4gICAga2V5b2YgdHlwZW9mIGFwaWdBdXRob3JpemVycy5IdHRwTGFtYmRhUmVzcG9uc2VUeXBlXG4gID5bXTtcbiAgLyoqXG4gICAqIFRoZSBhbW91bnQgb2YgdGltZSB0aGUgcmVzdWx0cyBhcmUgY2FjaGVkLlxuICAgKiBAZGVmYXVsdCBOb3QgY2FjaGVkXG4gICAqL1xuICByZXN1bHRzQ2FjaGVUdGw/OiBEdXJhdGlvbjtcbiAgY2RrPzoge1xuICAgIC8qKlxuICAgICAqIFRoaXMgYWxsb3dzIHlvdSB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBzZXR0aW5ncyB0aGlzIGNvbnN0cnVjdCB1c2VzIGludGVybmFsbHkgdG8gY3JlYXRlIHRoZSBhdXRob3JpemVyLlxuICAgICAqL1xuICAgIGF1dGhvcml6ZXI6IGFwaWdBdXRob3JpemVycy5IdHRwTGFtYmRhQXV0aG9yaXplcjtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcGlDb3JzUHJvcHMgZXh0ZW5kcyBhcGlnVjJDb3JzLkNvcnNQcm9wcyB7fVxuZXhwb3J0IGludGVyZmFjZSBBcGlEb21haW5Qcm9wcyBleHRlbmRzIGFwaWdWMkRvbWFpbi5DdXN0b21Eb21haW5Qcm9wcyB7fVxuZXhwb3J0IGludGVyZmFjZSBBcGlBY2Nlc3NMb2dQcm9wcyBleHRlbmRzIGFwaWdWMkFjY2Vzc0xvZy5BY2Nlc3NMb2dQcm9wcyB7fVxuXG5leHBvcnQgaW50ZXJmYWNlIEFwaVByb3BzPFxuICBBdXRob3JpemVycyBleHRlbmRzIFJlY29yZDxzdHJpbmcsIEFwaUF1dGhvcml6ZXI+ID0gUmVjb3JkPFxuICAgIHN0cmluZyxcbiAgICBBcGlBdXRob3JpemVyXG4gID4sXG4gIEF1dGhvcml6ZXJLZXlzID0ga2V5b2YgQXV0aG9yaXplcnNcbj4ge1xuICAvKipcbiAgICogRGVmaW5lIHRoZSByb3V0ZXMgZm9yIHRoZSBBUEkuIENhbiBiZSBhIGZ1bmN0aW9uLCBwcm94eSB0byBhbm90aGVyIEFQSSwgb3IgcG9pbnQgdG8gYW4gQUxCXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIGBgYGpzXG4gICAqIG5ldyBBcGkoc3RhY2ssIFwiYXBpXCIsIHtcbiAgICogICByb3V0ZXM6IHtcbiAgICogICAgIFwiR0VUIC9ub3Rlc1wiICAgICAgOiBcInNyYy9saXN0Lm1haW5cIixcbiAgICogICAgIFwiR0VUIC9ub3Rlcy97aWR9XCIgOiBcInNyYy9nZXQubWFpblwiLFxuICAgKiAgICAgXCIkZGVmYXVsdFwiOiBcInNyYy9kZWZhdWx0Lm1haW5cIlxuICAgKiAgIH1cbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICByb3V0ZXM/OiBSZWNvcmQ8c3RyaW5nLCBBcGlSb3V0ZVByb3BzPEF1dGhvcml6ZXJLZXlzPj47XG4gIC8qKlxuICAgKiBDT1JTIHN1cHBvcnQgYXBwbGllZCB0byBhbGwgZW5kcG9pbnRzIGluIHRoaXMgQVBJXG4gICAqXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogYGBganNcbiAgICogbmV3IEFwaShzdGFjaywgXCJBcGlcIiwge1xuICAgKiAgIGNvcnM6IHtcbiAgICogICAgIGFsbG93TWV0aG9kczogW1wiR0VUXCJdLFxuICAgKiAgIH0sXG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICpcbiAgICovXG4gIGNvcnM/OiBib29sZWFuIHwgQXBpQ29yc1Byb3BzO1xuICAvKipcbiAgICogRW5hYmxlIENsb3VkV2F0Y2ggYWNjZXNzIGxvZ3MgZm9yIHRoaXMgQVBJXG4gICAqXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEFwaShzdGFjaywgXCJBcGlcIiwge1xuICAgKiAgIGFjY2Vzc0xvZzogdHJ1ZVxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqXG4gICAqIGBgYGpzXG4gICAqIG5ldyBBcGkoc3RhY2ssIFwiQXBpXCIsIHtcbiAgICogICBhY2Nlc3NMb2c6IHtcbiAgICogICAgIHJldGVudGlvbjogXCJvbmVfd2Vla1wiLFxuICAgKiAgIH0sXG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICovXG4gIGFjY2Vzc0xvZz86IGJvb2xlYW4gfCBzdHJpbmcgfCBBcGlBY2Nlc3NMb2dQcm9wcztcbiAgLyoqXG4gICAqIFNwZWNpZnkgYSBjdXN0b20gZG9tYWluIHRvIHVzZSBpbiBhZGRpdGlvbiB0byB0aGUgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgb25lLiBTU1QgY3VycmVudGx5IHN1cHBvcnRzIGRvbWFpbnMgdGhhdCBhcmUgY29uZmlndXJlZCB1c2luZyBbUm91dGUgNTNdKGh0dHBzOi8vYXdzLmFtYXpvbi5jb20vcm91dGU1My8pXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIG5ldyBBcGkoc3RhY2ssIFwiQXBpXCIsIHtcbiAgICogICBjdXN0b21Eb21haW46IFwiYXBpLmV4YW1wbGUuY29tXCJcbiAgICogfSlcbiAgICogYGBgXG4gICAqXG4gICAqIGBgYGpzXG4gICAqIG5ldyBBcGkoc3RhY2ssIFwiQXBpXCIsIHtcbiAgICogICBjdXN0b21Eb21haW46IHtcbiAgICogICAgIGRvbWFpbk5hbWU6IFwiYXBpLmV4YW1wbGUuY29tXCIsXG4gICAqICAgICBob3N0ZWRab25lOiBcImRvbWFpbi5jb21cIixcbiAgICogICAgIHBhdGg6IFwidjFcIlxuICAgKiAgIH1cbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICBjdXN0b21Eb21haW4/OiBzdHJpbmcgfCBBcGlEb21haW5Qcm9wcztcbiAgLyoqXG4gICAqIERlZmluZSB0aGUgYXV0aG9yaXplcnMgZm9yIHRoZSBBUEkuIENhbiBiZSBhIHVzZXIgcG9vbCwgSldULCBvciBMYW1iZGEgYXV0aG9yaXplcnMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIG5ldyBBcGkoc3RhY2ssIFwiQXBpXCIsIHtcbiAgICogICBhdXRob3JpemVyczoge1xuICAgKiAgICAgQXV0aG9yaXplcjoge1xuICAgKiAgICAgICB0eXBlOiBcInVzZXJfcG9vbFwiLFxuICAgKiAgICAgICB1c2VyUG9vbDoge1xuICAgKiAgICAgICAgIGlkOiB1c2VyUG9vbC51c2VyUG9vbElkLFxuICAgKiAgICAgICAgIGNsaWVudElkczogW3VzZXJQb29sQ2xpZW50LnVzZXJQb29sQ2xpZW50SWRdLFxuICAgKiAgICAgICB9LFxuICAgKiAgICAgfSxcbiAgICogICB9LFxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqL1xuICBhdXRob3JpemVycz86IEF1dGhvcml6ZXJzO1xuICBkZWZhdWx0cz86IHtcbiAgICAvKipcbiAgICAgKiBUaGUgZGVmYXVsdCBmdW5jdGlvbiBwcm9wcyB0byBiZSBhcHBsaWVkIHRvIGFsbCB0aGUgTGFtYmRhIGZ1bmN0aW9ucyBpbiB0aGUgQVBJLiBUaGUgYGVudmlyb25tZW50YCwgYHBlcm1pc3Npb25zYCBhbmQgYGxheWVyc2AgcHJvcGVydGllcyB3aWxsIGJlIG1lcmdlZCB3aXRoIHBlciByb3V0ZSBkZWZpbml0aW9ucyBpZiB0aGV5IGFyZSBkZWZpbmVkLlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGBqc1xuICAgICAqIG5ldyBBcGkoc3RhY2ssIFwiQXBpXCIsIHtcbiAgICAgKiAgIGRlZmF1bHRzOiB7XG4gICAgICogICAgIGZ1bmN0aW9uOiB7XG4gICAgICogICAgICAgdGltZW91dDogMjAsXG4gICAgICogICAgICAgZW52aXJvbm1lbnQ6IHsgdGFibGVOYW1lOiB0YWJsZS50YWJsZU5hbWUgfSxcbiAgICAgKiAgICAgICBwZXJtaXNzaW9uczogW3RhYmxlXSxcbiAgICAgKiAgICAgfVxuICAgICAqICAgfVxuICAgICAqIH0pO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGZ1bmN0aW9uPzogRnVuY3Rpb25Qcm9wcztcbiAgICAvKipcbiAgICAgKiBUaGUgZGVmYXVsdCBhdXRob3JpemVyIGZvciBhbGwgdGhlIHJvdXRlcyBpbiB0aGUgQVBJLlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGBqc1xuICAgICAqIG5ldyBBcGkoc3RhY2ssIFwiQXBpXCIsIHtcbiAgICAgKiAgIGRlZmF1bHRzOiB7XG4gICAgICogICAgIGF1dGhvcml6ZXI6IFwiaWFtXCIsXG4gICAgICogICB9XG4gICAgICogfSk7XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYGpzXG4gICAgICogbmV3IEFwaShzdGFjaywgXCJBcGlcIiwge1xuICAgICAqICAgYXV0aG9yaXplcnM6IHtcbiAgICAgKiAgICAgQXV0aG9yaXplcjoge1xuICAgICAqICAgICAgIHR5cGU6IFwidXNlcl9wb29sXCIsXG4gICAgICogICAgICAgdXNlclBvb2w6IHtcbiAgICAgKiAgICAgICAgIGlkOiB1c2VyUG9vbC51c2VyUG9vbElkLFxuICAgICAqICAgICAgICAgY2xpZW50SWRzOiBbdXNlclBvb2xDbGllbnQudXNlclBvb2xDbGllbnRJZF0sXG4gICAgICogICAgICAgfSxcbiAgICAgKiAgICAgfSxcbiAgICAgKiAgIH0sXG4gICAgICogICBkZWZhdWx0czoge1xuICAgICAqICAgICBhdXRob3JpemVyOiBcIkF1dGhvcml6ZXJcIixcbiAgICAgKiAgIH1cbiAgICAgKiB9KTtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBhdXRob3JpemVyPzpcbiAgICAgIHwgXCJub25lXCJcbiAgICAgIHwgXCJpYW1cIlxuICAgICAgfCAoc3RyaW5nIGV4dGVuZHMgQXV0aG9yaXplcktleXNcbiAgICAgICAgICA/IE9taXQ8QXV0aG9yaXplcktleXMsIFwibm9uZVwiIHwgXCJpYW1cIj5cbiAgICAgICAgICA6IEF1dGhvcml6ZXJLZXlzKTtcbiAgICAvKipcbiAgICAgKiBBbiBhcnJheSBvZiBzY29wZXMgdG8gaW5jbHVkZSBpbiB0aGUgYXV0aG9yaXphdGlvbiB3aGVuIHVzaW5nIGB1c2VyX3Bvb2xgIG9yIGBqd3RgIGF1dGhvcml6ZXJzLiBUaGVzZSB3aWxsIGJlIG1lcmdlZCB3aXRoIHRoZSBzY29wZXMgZnJvbSB0aGUgYXR0YWNoZWQgYXV0aG9yaXplci5cbiAgICAgKiBAZGVmYXVsdCBbXVxuICAgICAqL1xuICAgIGF1dGhvcml6YXRpb25TY29wZXM/OiBzdHJpbmdbXTtcbiAgICAvKipcbiAgICAgKiBUaGUgW3BheWxvYWQgZm9ybWF0IHZlcnNpb25dKGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9hcGlnYXRld2F5L2xhdGVzdC9kZXZlbG9wZXJndWlkZS9odHRwLWFwaS1kZXZlbG9wLWludGVncmF0aW9ucy1sYW1iZGEuaHRtbCNodHRwLWFwaS1kZXZlbG9wLWludGVncmF0aW9ucy1sYW1iZGEucHJveHktZm9ybWF0KSBmb3IgYWxsIHRoZSBlbmRwb2ludHMgaW4gdGhlIEFQSS5cbiAgICAgKiBAZGVmYXVsdCBcIjIuMFwiXG4gICAgICovXG4gICAgcGF5bG9hZEZvcm1hdFZlcnNpb24/OiBBcGlQYXlsb2FkRm9ybWF0VmVyc2lvbjtcbiAgICB0aHJvdHRsZT86IHtcbiAgICAgIC8qKlxuICAgICAgICogVGhlIFtidXJzdCByYXRlXShodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vYXBpZ2F0ZXdheS9sYXRlc3QvZGV2ZWxvcGVyZ3VpZGUvaHR0cC1hcGktdGhyb3R0bGluZy5odG1sKSBvZiB0aGUgbnVtYmVyIG9mIGNvbmN1cnJlbnQgcmVxdWVzdCBmb3IgYWxsIHRoZSByb3V0ZXMgaW4gdGhlIEFQSS5cbiAgICAgICAqXG4gICAgICAgKiBAZXhhbXBsZVxuICAgICAgICogYGBganNcbiAgICAgICAqIG5ldyBBcGkoc3RhY2ssIFwiQXBpXCIsIHtcbiAgICAgICAqICAgZGVmYXVsdHM6IHtcbiAgICAgICAqICAgICB0aHJvdHRsZToge1xuICAgICAgICogICAgICAgYnVyc3Q6IDEwMFxuICAgICAgICogICAgIH1cbiAgICAgICAqICAgfVxuICAgICAgICogfSlcbiAgICAgICAqIGBgYFxuICAgICAgICovXG4gICAgICBidXJzdD86IG51bWJlcjtcbiAgICAgIC8qKlxuICAgICAgICogVGhlIFtzdGVhZHktc3RhdGUgcmF0ZV0oaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2FwaWdhdGV3YXkvbGF0ZXN0L2RldmVsb3Blcmd1aWRlL2h0dHAtYXBpLXRocm90dGxpbmcuaHRtbCkgb2YgdGhlIG51bWJlciBvZiBjb25jdXJyZW50IHJlcXVlc3QgZm9yIGFsbCB0aGUgcm91dGVzIGluIHRoZSBBUEkuXG4gICAgICAgKlxuICAgICAgICogQGV4YW1wbGVcbiAgICAgICAqIGBgYGpzXG4gICAgICAgKiBuZXcgQXBpKHN0YWNrLCBcIkFwaVwiLCB7XG4gICAgICAgKiAgIGRlZmF1bHRzOiB7XG4gICAgICAgKiAgICAgdGhyb3R0bGU6IHtcbiAgICAgICAqICAgICAgIHJhdGU6IDEwXG4gICAgICAgKiAgICAgfVxuICAgICAgICogICB9XG4gICAgICAgKiB9KVxuICAgICAgICogYGBgXG4gICAgICAgKi9cbiAgICAgIHJhdGU/OiBudW1iZXI7XG4gICAgfTtcbiAgfTtcbiAgY2RrPzoge1xuICAgIC8qKlxuICAgICAqIEltcG9ydCB0aGUgdW5kZXJseWluZyBIVFRQIEFQSSBvciBvdmVycmlkZSB0aGUgZGVmYXVsdCBjb25maWd1cmF0aW9uXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYGpzXG4gICAgICogaW1wb3J0IHsgSHR0cEFwaSB9IGZyb20gXCJAYXdzLWNkay9hd3MtYXBpZ2F0ZXdheXYyLWFscGhhXCI7XG4gICAgICpcbiAgICAgKiBuZXcgQXBpKHN0YWNrLCBcIkFwaVwiLCB7XG4gICAgICogICBjZGs6IHtcbiAgICAgKiAgICAgaHR0cEFwaTogSHR0cEFwaS5mcm9tSHR0cEFwaUF0dHJpYnV0ZXMoc3RhY2ssIFwiTXlIdHRwQXBpXCIsIHtcbiAgICAgKiAgICAgICBodHRwQXBpSWQsXG4gICAgICogICAgIH0pLFxuICAgICAqICAgfVxuICAgICAqIH0pO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGh0dHBBcGk/OiBhcGlnLklIdHRwQXBpIHwgYXBpZy5IdHRwQXBpUHJvcHM7XG4gICAgLyoqXG4gICAgICogQ29uZmlndXJlcyB0aGUgc3RhZ2VzIHRvIGNyZWF0ZSBmb3IgdGhlIEhUVFAgQVBJLlxuICAgICAqXG4gICAgICogTm90ZSB0aGF0LCBhIGRlZmF1bHQgc3RhZ2UgaXMgYXV0b21hdGljYWxseSBjcmVhdGVkLCB1bmxlc3MgdGhlIGBjZGsuaHR0cEFwaS5jcmVhdGVEZWZhdWx0U3RhZ2VgIGlzIHNldCB0byBgZmFsc2UuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYGpzXG4gICAgICogaW1wb3J0IHsgSHR0cEFwaSB9IGZyb20gXCJAYXdzLWNkay9hd3MtYXBpZ2F0ZXdheXYyLWFscGhhXCI7XG4gICAgICpcbiAgICAgKiBuZXcgQXBpKHN0YWNrLCBcIkFwaVwiLCB7XG4gICAgICogICBjZGs6IHtcbiAgICAgKiAgICAgaHR0cFN0YWdlczogW3tcbiAgICAgKiAgICAgICBzdGFnZU5hbWU6IFwiZGV2XCIsXG4gICAgICogICAgICAgYXV0b0RlcGxveTogZmFsc2UsXG4gICAgICogICAgIH1dLFxuICAgICAqICAgfVxuICAgICAqIH0pO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGh0dHBTdGFnZXM/OiBPbWl0PGFwaWcuSHR0cFN0YWdlUHJvcHMsIFwiaHR0cEFwaVwiPltdO1xuICB9O1xufVxuXG5leHBvcnQgdHlwZSBBcGlSb3V0ZVByb3BzPEF1dGhvcml6ZXJLZXlzPiA9XG4gIHwgRnVuY3Rpb25JbmxpbmVEZWZpbml0aW9uXG4gIHwgQXBpRnVuY3Rpb25Sb3V0ZVByb3BzPEF1dGhvcml6ZXJLZXlzPlxuICB8IEFwaUh0dHBSb3V0ZVByb3BzPEF1dGhvcml6ZXJLZXlzPlxuICB8IEFwaUFsYlJvdXRlUHJvcHM8QXV0aG9yaXplcktleXM+O1xuXG5pbnRlcmZhY2UgQXBpQmFzZVJvdXRlUHJvcHM8QXV0aG9yaXplcktleXMgPSBzdHJpbmc+IHtcbiAgYXV0aG9yaXplcj86XG4gICAgfCBcIm5vbmVcIlxuICAgIHwgXCJpYW1cIlxuICAgIHwgKHN0cmluZyBleHRlbmRzIEF1dGhvcml6ZXJLZXlzXG4gICAgICAgID8gT21pdDxBdXRob3JpemVyS2V5cywgXCJub25lXCIgfCBcImlhbVwiPlxuICAgICAgICA6IEF1dGhvcml6ZXJLZXlzKTtcbiAgYXV0aG9yaXphdGlvblNjb3Blcz86IHN0cmluZ1tdO1xufVxuXG4vKipcbiAqIFNwZWNpZnkgYSBmdW5jdGlvbiByb3V0ZSBoYW5kbGVyIGFuZCBjb25maWd1cmUgYWRkaXRpb25hbCBvcHRpb25zXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGpzXG4gKiBhcGkuYWRkUm91dGVzKHN0YWNrLCB7XG4gKiAgIFwiR0VUIC9ub3Rlcy97aWR9XCI6IHtcbiAqICAgICB0eXBlOiBcImZ1bmN0aW9uXCIsXG4gKiAgICAgZnVuY3Rpb246IFwic3JjL2dldC5tYWluXCIsXG4gKiAgICAgcGF5bG9hZEZvcm1hdFZlcnNpb246IFwiMS4wXCIsXG4gKiAgIH1cbiAqIH0pO1xuICogYGBgXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQXBpRnVuY3Rpb25Sb3V0ZVByb3BzPEF1dGhvcml6ZXJzS2V5cyA9IHN0cmluZz5cbiAgZXh0ZW5kcyBBcGlCYXNlUm91dGVQcm9wczxBdXRob3JpemVyc0tleXM+IHtcbiAgdHlwZT86IFwiZnVuY3Rpb25cIjtcbiAgLyoqXG4gICAqVGhlIGZ1bmN0aW9uIGRlZmluaXRpb24gdXNlZCB0byBjcmVhdGUgdGhlIGZ1bmN0aW9uIGZvciB0aGlzIHJvdXRlLlxuICAgKi9cbiAgZnVuY3Rpb246IEZ1bmN0aW9uRGVmaW5pdGlvbjtcbiAgLyoqXG4gICAqIFRoZSBwYXlsb2FkIGZvcm1hdCB2ZXJzaW9uIGZvciB0aGUgcm91dGUuXG4gICAqXG4gICAqIEBkZWZhdWx0IFwiMi4wXCJcbiAgICovXG4gIHBheWxvYWRGb3JtYXRWZXJzaW9uPzogQXBpUGF5bG9hZEZvcm1hdFZlcnNpb247XG59XG5cbi8qKlxuICogU3BlY2lmeSBhIHJvdXRlIGhhbmRsZXIgdGhhdCBmb3J3YXJkcyB0byBhbm90aGVyIFVSTFxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqc1xuICogYXBpLmFkZFJvdXRlcyhzdGFjaywge1xuICogICBcIkdFVCAvbm90ZXMve2lkfVwiOiB7XG4gKiAgICAgdHlwZTogXCJ1cmxcIixcbiAqICAgICB1cmw6IFwiaHR0cHM6Ly9leGFtcGxlLmNvbS9ub3Rlcy97aWR9XCIsXG4gKiAgIH1cbiAqIH0pO1xuICogYGBgXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQXBpSHR0cFJvdXRlUHJvcHM8QXV0aG9yaXplcnNLZXlzPlxuICBleHRlbmRzIEFwaUJhc2VSb3V0ZVByb3BzPEF1dGhvcml6ZXJzS2V5cz4ge1xuICAvKipcbiAgICogVGhpcyBpcyBhIGNvbnN0YW50XG4gICAqL1xuICB0eXBlOiBcInVybFwiO1xuICAvKipcbiAgICogVGhlIFVSTCB0byBmb3J3YXJkIHRvXG4gICAqL1xuICB1cmw6IHN0cmluZztcbiAgY2RrPzoge1xuICAgIC8qKlxuICAgICAqIE92ZXJyaWRlIHRoZSB1bmRlcmx5aW5nIENESyBpbnRlZ3JhdGlvblxuICAgICAqL1xuICAgIGludGVncmF0aW9uOiBhcGlnSW50ZWdyYXRpb25zLkh0dHBVcmxJbnRlZ3JhdGlvblByb3BzO1xuICB9O1xufVxuXG4vKipcbiAqIFNwZWNpZnkgYSByb3V0ZSBoYW5kbGVyIHRoYXQgZm9yd2FyZHMgdG8gYW4gQUxCXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGpzXG4gKiBhcGkuYWRkUm91dGVzKHN0YWNrLCB7XG4gKiAgIFwiR0VUIC9ub3Rlcy97aWR9XCI6IHtcbiAqICAgICB0eXBlOiBcImFsYlwiLFxuICogICAgIGNkazoge1xuICogICAgICAgYWxiTGlzdGVuZXI6IGxpc3RlbmVyLFxuICogICAgIH1cbiAqICAgfVxuICogfSk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBcGlBbGJSb3V0ZVByb3BzPEF1dGhvcml6ZXJzS2V5cz5cbiAgZXh0ZW5kcyBBcGlCYXNlUm91dGVQcm9wczxBdXRob3JpemVyc0tleXM+IHtcbiAgdHlwZTogXCJhbGJcIjtcbiAgY2RrOiB7XG4gICAgLyoqXG4gICAgICogVGhlIGxpc3RlbmVyIHRvIHRoZSBhcHBsaWNhdGlvbiBsb2FkIGJhbGFuY2VyIHVzZWQgZm9yIHRoZSBpbnRlZ3JhdGlvbi5cbiAgICAgKi9cbiAgICBhbGJMaXN0ZW5lcjogZWxiLklBcHBsaWNhdGlvbkxpc3RlbmVyO1xuICAgIGludGVncmF0aW9uPzogYXBpZ0ludGVncmF0aW9ucy5IdHRwQWxiSW50ZWdyYXRpb25Qcm9wcztcbiAgfTtcbn1cblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBDb25zdHJ1Y3Rcbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4vKipcbiAqIFRoZSBBcGkgY29uc3RydWN0IGlzIGEgaGlnaGVyIGxldmVsIENESyBjb25zdHJ1Y3QgdGhhdCBtYWtlcyBpdCBlYXN5IHRvIGNyZWF0ZSBhbiBBUEkuIEl0IHByb3ZpZGVzIGEgc2ltcGxlIHdheSB0byBkZWZpbmUgdGhlIHJvdXRlcyBpbiB5b3VyIEFQSS4gQW5kIGFsbG93cyB5b3UgdG8gY29uZmlndXJlIHRoZSBzcGVjaWZpYyBMYW1iZGEgZnVuY3Rpb25zIGlmIG5lY2Vzc2FyeS4gSXQgYWxzbyBhbGxvd3MgeW91IHRvIGNvbmZpZ3VyZSBhdXRob3JpemF0aW9uIGFuZCBjdXN0b20gZG9tYWlucy5cbiAqXG4gKiBAZXhhbXBsZVxuICogVGhlIGBBcGlgIGNvbnN0cnVjdCBpcyBkZXNpZ25lZCB0byBtYWtlIGl0IGVhc3kgdG8gZ2V0IHN0YXJ0ZWQgd2l0aCwgd2hpbGUgYWxsb3dpbmcgZm9yIGEgd2F5IHRvIGZ1bGx5IGNvbmZpZ3VyZSBpdCBhcyB3ZWxsLiBMZXQncyBsb29rIGF0IGhvdywgdGhyb3VnaCBhIGNvdXBsZSBvZiBleGFtcGxlcy5cbiAqXG4gKiAjIyMgVXNpbmcgdGhlIG1pbmltYWwgY29uZmlnXG4gKlxuICogYGBgdHNcbiAqIGltcG9ydCB7IEFwaSB9IGZyb20gXCJAc2VydmVybGVzcy1zdGFjay9yZXNvdXJjZXNcIjtcbiAqXG4gKiBuZXcgQXBpKHN0YWNrLCBcIkFwaVwiLCB7XG4gKiAgIHJvdXRlczoge1xuICogICAgIFwiR0VUICAgIC9ub3Rlc1wiOiBcInNyYy9saXN0Lm1haW5cIixcbiAqICAgICBcIlBPU1QgICAvbm90ZXNcIjogXCJzcmMvY3JlYXRlLm1haW5cIixcbiAqICAgICBcIkdFVCAgICAvbm90ZXMve2lkfVwiOiBcInNyYy9nZXQubWFpblwiLFxuICogICAgIFwiUFVUICAgIC9ub3Rlcy97aWR9XCI6IFwic3JjL3VwZGF0ZS5tYWluXCIsXG4gKiAgICAgXCJERUxFVEUgL25vdGVzL3tpZH1cIjogXCJzcmMvZGVsZXRlLm1haW5cIixcbiAqICAgfSxcbiAqIH0pO1xuICogYGBgXG4gKi9cbmV4cG9ydCBjbGFzcyBBcGk8XG4gICAgQXV0aG9yaXplcnMgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBBcGlBdXRob3JpemVyPiA9IFJlY29yZDxcbiAgICAgIHN0cmluZyxcbiAgICAgIEFwaUF1dGhvcml6ZXJcbiAgICA+XG4gID5cbiAgZXh0ZW5kcyBDb25zdHJ1Y3RcbiAgaW1wbGVtZW50cyBTU1RDb25zdHJ1Y3RcbntcbiAgcHVibGljIHJlYWRvbmx5IGNkazoge1xuICAgIC8qKlxuICAgICAqIFRoZSBpbnRlcm5hbGx5IGNyZWF0ZWQgQ0RLIEh0dHBBcGkgaW5zdGFuY2UuXG4gICAgICovXG4gICAgaHR0cEFwaTogYXBpZy5IdHRwQXBpO1xuICAgIC8qKlxuICAgICAqIElmIGFjY2VzcyBsb2dzIGFyZSBlbmFibGVkLCB0aGlzIGlzIHRoZSBpbnRlcm5hbGx5IGNyZWF0ZWQgQ0RLIExvZ0dyb3VwIGluc3RhbmNlLlxuICAgICAqL1xuICAgIGFjY2Vzc0xvZ0dyb3VwPzogbG9ncy5Mb2dHcm91cDtcbiAgICAvKipcbiAgICAgKiBJZiBjdXN0b20gZG9tYWluIGlzIGVuYWJsZWQsIHRoaXMgaXMgdGhlIGludGVybmFsbHkgY3JlYXRlZCBDREsgRG9tYWluTmFtZSBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICBkb21haW5OYW1lPzogYXBpZy5Eb21haW5OYW1lO1xuICAgIC8qKlxuICAgICAqIElmIGN1c3RvbSBkb21haW4gaXMgZW5hYmxlZCwgdGhpcyBpcyB0aGUgaW50ZXJuYWxseSBjcmVhdGVkIENESyBDZXJ0aWZpY2F0ZSBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICBjZXJ0aWZpY2F0ZT86IGFjbS5DZXJ0aWZpY2F0ZTtcbiAgfTtcbiAgcHJpdmF0ZSBwcm9wczogQXBpUHJvcHM8QXV0aG9yaXplcnM+O1xuICBwcml2YXRlIF9jdXN0b21Eb21haW5Vcmw/OiBzdHJpbmc7XG4gIHByaXZhdGUgcm91dGVzRGF0YToge1xuICAgIFtrZXk6IHN0cmluZ106IEZuIHwgc3RyaW5nIHwgZWxiLklBcHBsaWNhdGlvbkxpc3RlbmVyO1xuICB9O1xuICBwcml2YXRlIGF1dGhvcml6ZXJzRGF0YTogUmVjb3JkPHN0cmluZywgYXBpZy5JSHR0cFJvdXRlQXV0aG9yaXplcj47XG4gIHByaXZhdGUgcGVybWlzc2lvbnNBdHRhY2hlZEZvckFsbFJvdXRlczogUGVybWlzc2lvbnNbXTtcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wcz86IEFwaVByb3BzPEF1dGhvcml6ZXJzPikge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICB0aGlzLnByb3BzID0gcHJvcHMgfHwge307XG4gICAgdGhpcy5jZGsgPSB7fSBhcyBhbnk7XG4gICAgdGhpcy5yb3V0ZXNEYXRhID0ge307XG4gICAgdGhpcy5hdXRob3JpemVyc0RhdGEgPSB7fTtcbiAgICB0aGlzLnBlcm1pc3Npb25zQXR0YWNoZWRGb3JBbGxSb3V0ZXMgPSBbXTtcblxuICAgIHRoaXMuY3JlYXRlSHR0cEFwaSgpO1xuICAgIHRoaXMuYWRkQXV0aG9yaXplcnModGhpcy5wcm9wcy5hdXRob3JpemVycyB8fCAoe30gYXMgQXV0aG9yaXplcnMpKTtcbiAgICB0aGlzLmFkZFJvdXRlcyh0aGlzLCB0aGlzLnByb3BzLnJvdXRlcyB8fCB7fSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIEFXUyBnZW5lcmF0ZWQgVVJMIG9mIHRoZSBBcGkuXG4gICAqL1xuICBwdWJsaWMgZ2V0IHVybCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmNkay5odHRwQXBpLmFwaUVuZHBvaW50O1xuICB9XG5cbiAgLyoqXG4gICAqIElmIGN1c3RvbSBkb21haW4gaXMgZW5hYmxlZCwgdGhpcyBpcyB0aGUgY3VzdG9tIGRvbWFpbiBVUkwgb2YgdGhlIEFwaS5cbiAgICpcbiAgICogOjo6bm90ZVxuICAgKiBJZiB5b3UgYXJlIHNldHRpbmcgdGhlIGJhc2UgbWFwcGluZyBmb3IgdGhlIGN1c3RvbSBkb21haW4sIHlvdSBuZWVkIHRvIGluY2x1ZGUgdGhlIHRyYWlsaW5nIHNsYXNoIHdoaWxlIHVzaW5nIHRoZSBjdXN0b20gZG9tYWluIFVSTC4gRm9yIGV4YW1wbGUsIGlmIHRoZSBbYGRvbWFpbk5hbWVgXSgjZG9tYWlubmFtZSkgaXMgc2V0IHRvIGBhcGkuZG9tYWluLmNvbWAgYW5kIHRoZSBbYHBhdGhgXSgjcGF0aCkgaXMgYHYxYCwgdGhlIGN1c3RvbSBkb21haW4gVVJMIG9mIHRoZSBBUEkgd2lsbCBiZSBgaHR0cHM6Ly9hcGkuZG9tYWluLmNvbS92MS9gLlxuICAgKiA6OjpcbiAgICovXG4gIHB1YmxpYyBnZXQgY3VzdG9tRG9tYWluVXJsKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbURvbWFpblVybDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgcm91dGVzIGZvciB0aGUgQXBpXG4gICAqL1xuICBwdWJsaWMgZ2V0IHJvdXRlcygpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMucm91dGVzRGF0YSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgaW50ZXJuYWxseSBjcmVhdGVkIEFQSSBHYXRld2F5IEhUVFAgQVBJXG4gICAqL1xuICBwdWJsaWMgZ2V0IGh0dHBBcGlBcm4oKTogc3RyaW5nIHtcbiAgICBjb25zdCBzdGFjayA9IFN0YWNrLm9mKHRoaXMpO1xuICAgIHJldHVybiBgYXJuOiR7c3RhY2sucGFydGl0aW9ufTphcGlnYXRld2F5OiR7c3RhY2sucmVnaW9ufTo6L2FwaXMvJHt0aGlzLmNkay5odHRwQXBpLmFwaUlkfWA7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGlkIG9mIHRoZSBpbnRlcm5hbGx5IGNyZWF0ZWQgQVBJIEdhdGV3YXkgSFRUUCBBUElcbiAgICovXG4gIHB1YmxpYyBnZXQgaHR0cEFwaUlkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY2RrLmh0dHBBcGkuYXBpSWQ7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyByb3V0ZXMgdG8gdGhlIEFwaSBhZnRlciBpdCBoYXMgYmVlbiBjcmVhdGVkLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBhcGkuYWRkUm91dGVzKHN0YWNrLCB7XG4gICAqICAgXCJHRVQgICAgL25vdGVzL3tpZH1cIjogXCJzcmMvZ2V0Lm1haW5cIixcbiAgICogICBcIlBVVCAgICAvbm90ZXMve2lkfVwiOiBcInNyYy91cGRhdGUubWFpblwiLFxuICAgKiAgIFwiREVMRVRFIC9ub3Rlcy97aWR9XCI6IFwic3JjL2RlbGV0ZS5tYWluXCIsXG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICovXG4gIHB1YmxpYyBhZGRSb3V0ZXMoXG4gICAgc2NvcGU6IENvbnN0cnVjdCxcbiAgICByb3V0ZXM6IFJlY29yZDxzdHJpbmcsIEFwaVJvdXRlUHJvcHM8a2V5b2YgQXV0aG9yaXplcnM+PlxuICApOiB2b2lkIHtcbiAgICBPYmplY3Qua2V5cyhyb3V0ZXMpLmZvckVhY2goKHJvdXRlS2V5OiBzdHJpbmcpID0+IHtcbiAgICAgIHRoaXMuYWRkUm91dGUoc2NvcGUsIHJvdXRlS2V5LCByb3V0ZXNbcm91dGVLZXldKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGluc3RhbmNlIG9mIHRoZSBpbnRlcm5hbGx5IGNyZWF0ZWQgRnVuY3Rpb24sIGZvciBhIGdpdmVuIHJvdXRlIGtleSB3aGVyZSB0aGUgYHJvdXRlS2V5YCBpcyB0aGUga2V5IHVzZWQgdG8gZGVmaW5lIGEgcm91dGUuIEZvciBleGFtcGxlLCBgR0VUIC9ub3Rlc2AuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIGNvbnN0IGFwaSA9IG5ldyBBcGkoc3RhY2ssIFwiQXBpXCIsIHtcbiAgICogICByb3V0ZXM6IHtcbiAgICogICAgIFwiR0VUIC9ub3Rlc1wiOiBcInNyYy9saXN0Lm1haW5cIixcbiAgICogICB9LFxuICAgKiB9KTtcbiAgICpcbiAgICogY29uc3QgbGlzdEZ1bmN0aW9uID0gYXBpLmdldEZ1bmN0aW9uKFwiR0VUIC9ub3Rlc1wiKTtcbiAgICogYGBgXG4gICAqL1xuICBwdWJsaWMgZ2V0RnVuY3Rpb24ocm91dGVLZXk6IHN0cmluZyk6IEZuIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCByb3V0ZSA9IHRoaXMucm91dGVzRGF0YVt0aGlzLm5vcm1hbGl6ZVJvdXRlS2V5KHJvdXRlS2V5KV07XG4gICAgcmV0dXJuIHJvdXRlIGluc3RhbmNlb2YgRm4gPyByb3V0ZSA6IHVuZGVmaW5lZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBdHRhY2hlcyB0aGUgZ2l2ZW4gbGlzdCBvZiBwZXJtaXNzaW9ucyB0byBhbGwgdGhlIHJvdXRlcy4gVGhpcyBhbGxvd3MgdGhlIGZ1bmN0aW9ucyB0byBhY2Nlc3Mgb3RoZXIgQVdTIHJlc291cmNlcy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogYGBganNcbiAgICogYXBpLmF0dGFjaFBlcm1pc3Npb25zKFtcInMzXCJdKTtcbiAgICogYGBgXG4gICAqL1xuICBwdWJsaWMgYXR0YWNoUGVybWlzc2lvbnMocGVybWlzc2lvbnM6IFBlcm1pc3Npb25zKTogdm9pZCB7XG4gICAgT2JqZWN0LnZhbHVlcyh0aGlzLnJvdXRlc0RhdGEpXG4gICAgICAuZmlsdGVyKChyb3V0ZSkgPT4gcm91dGUgaW5zdGFuY2VvZiBGbilcbiAgICAgIC5mb3JFYWNoKChyb3V0ZSkgPT4gKHJvdXRlIGFzIEZuKS5hdHRhY2hQZXJtaXNzaW9ucyhwZXJtaXNzaW9ucykpO1xuICAgIHRoaXMucGVybWlzc2lvbnNBdHRhY2hlZEZvckFsbFJvdXRlcy5wdXNoKHBlcm1pc3Npb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBdHRhY2hlcyB0aGUgZ2l2ZW4gbGlzdCBvZiBwZXJtaXNzaW9ucyB0byBhIHNwZWNpZmljIHJvdXRlLiBUaGlzIGFsbG93cyB0aGF0IGZ1bmN0aW9uIHRvIGFjY2VzcyBvdGhlciBBV1MgcmVzb3VyY2VzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBjb25zdCBhcGkgPSBuZXcgQXBpKHN0YWNrLCBcIkFwaVwiLCB7XG4gICAqICAgcm91dGVzOiB7XG4gICAqICAgICBcIkdFVCAgICAvbm90ZXNcIjogXCJzcmMvbGlzdC5tYWluXCIsXG4gICAqICAgfSxcbiAgICogfSk7XG4gICAqXG4gICAqIGFwaS5hdHRhY2hQZXJtaXNzaW9uc1RvUm91dGUoXCJHRVQgL25vdGVzXCIsIFtcInMzXCJdKTtcbiAgICogYGBgXG4gICAqXG4gICAqL1xuICBwdWJsaWMgYXR0YWNoUGVybWlzc2lvbnNUb1JvdXRlKFxuICAgIHJvdXRlS2V5OiBzdHJpbmcsXG4gICAgcGVybWlzc2lvbnM6IFBlcm1pc3Npb25zXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IGZuID0gdGhpcy5nZXRGdW5jdGlvbihyb3V0ZUtleSk7XG4gICAgaWYgKCFmbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgRmFpbGVkIHRvIGF0dGFjaCBwZXJtaXNzaW9ucy4gUm91dGUgXCIke3JvdXRlS2V5fVwiIGRvZXMgbm90IGV4aXN0LmBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgZm4uYXR0YWNoUGVybWlzc2lvbnMocGVybWlzc2lvbnMpO1xuICB9XG5cbiAgcHVibGljIGdldENvbnN0cnVjdE1ldGFkYXRhKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIkFwaVwiIGFzIGNvbnN0LFxuICAgICAgZGF0YToge1xuICAgICAgICBncmFwaHFsOiBmYWxzZSxcbiAgICAgICAgdXJsOiB0aGlzLmNkay5odHRwQXBpLnVybCxcbiAgICAgICAgaHR0cEFwaUlkOiB0aGlzLmNkay5odHRwQXBpLmFwaUlkLFxuICAgICAgICBjdXN0b21Eb21haW5Vcmw6IHRoaXMuX2N1c3RvbURvbWFpblVybCxcbiAgICAgICAgcm91dGVzOiBPYmplY3QuZW50cmllcyh0aGlzLnJvdXRlc0RhdGEpLm1hcCgoW2tleSwgZGF0YV0pID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcm91dGU6IGtleSxcbiAgICAgICAgICAgIGZuOiBnZXRGdW5jdGlvblJlZihkYXRhKSxcbiAgICAgICAgICB9O1xuICAgICAgICB9KSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlSHR0cEFwaSgpIHtcbiAgICBjb25zdCB7IGNkaywgY29ycywgZGVmYXVsdHMsIGFjY2Vzc0xvZywgY3VzdG9tRG9tYWluIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGlkID0gdGhpcy5ub2RlLmlkO1xuICAgIGNvbnN0IGFwcCA9IHRoaXMubm9kZS5yb290IGFzIEFwcDtcblxuICAgIGlmIChpc0NES0NvbnN0cnVjdChjZGs/Lmh0dHBBcGkpKSB7XG4gICAgICBpZiAoY29ycyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgQ2Fubm90IGNvbmZpZ3VyZSB0aGUgXCJjb3JzXCIgd2hlbiBcImNkay5odHRwQXBpXCIgaXMgYSBjb25zdHJ1Y3RgXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoYWNjZXNzTG9nICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBDYW5ub3QgY29uZmlndXJlIHRoZSBcImFjY2Vzc0xvZ1wiIHdoZW4gXCJjZGsuaHR0cEFwaVwiIGlzIGEgY29uc3RydWN0YFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKGN1c3RvbURvbWFpbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgQ2Fubm90IGNvbmZpZ3VyZSB0aGUgXCJjdXN0b21Eb21haW5cIiB3aGVuIFwiY2RrLmh0dHBBcGlcIiBpcyBhIGNvbnN0cnVjdGBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChjZGs/Lmh0dHBTdGFnZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYENhbm5vdCBjb25maWd1cmUgdGhlIFwic3RhZ2VzXCIgd2hlbiBcImNkay5odHRwQXBpXCIgaXMgYSBjb25zdHJ1Y3RgXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICB0aGlzLmNkay5odHRwQXBpID0gY2RrPy5odHRwQXBpIGFzIGFwaWcuSHR0cEFwaTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgaHR0cEFwaVByb3BzID0gKGNkaz8uaHR0cEFwaSB8fCB7fSkgYXMgYXBpZy5IdHRwQXBpUHJvcHM7XG5cbiAgICAgIC8vIFZhbGlkYXRlIGlucHV0XG4gICAgICBpZiAoaHR0cEFwaVByb3BzLmNvcnNQcmVmbGlnaHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYENhbm5vdCBjb25maWd1cmUgdGhlIFwiaHR0cEFwaS5jb3JzUHJlZmxpZ2h0XCIgaW4gdGhlIEFwaWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChodHRwQXBpUHJvcHMuZGVmYXVsdERvbWFpbk1hcHBpbmcgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYENhbm5vdCBjb25maWd1cmUgdGhlIFwiaHR0cEFwaS5kZWZhdWx0RG9tYWluTWFwcGluZ1wiIGluIHRoZSBBcGlgXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSBDdXN0b20gRG9tYWluXG4gICAgICBjb25zdCBjdXN0b21Eb21haW5EYXRhID0gYXBpZ1YyRG9tYWluLmJ1aWxkQ3VzdG9tRG9tYWluRGF0YShcbiAgICAgICAgdGhpcyxcbiAgICAgICAgY3VzdG9tRG9tYWluXG4gICAgICApO1xuICAgICAgbGV0IGRlZmF1bHREb21haW5NYXBwaW5nO1xuICAgICAgaWYgKGN1c3RvbURvbWFpbkRhdGEpIHtcbiAgICAgICAgaWYgKGN1c3RvbURvbWFpbkRhdGEuaXNBcGlnRG9tYWluQ3JlYXRlZCkge1xuICAgICAgICAgIHRoaXMuY2RrLmRvbWFpbk5hbWUgPSBjdXN0b21Eb21haW5EYXRhLmFwaWdEb21haW4gYXMgYXBpZy5Eb21haW5OYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdXN0b21Eb21haW5EYXRhLmlzQ2VydGlmaWNhdGVkQ3JlYXRlZCkge1xuICAgICAgICAgIHRoaXMuY2RrLmNlcnRpZmljYXRlID1cbiAgICAgICAgICAgIGN1c3RvbURvbWFpbkRhdGEuY2VydGlmaWNhdGUgYXMgYWNtLkNlcnRpZmljYXRlO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHREb21haW5NYXBwaW5nID0ge1xuICAgICAgICAgIGRvbWFpbk5hbWU6IGN1c3RvbURvbWFpbkRhdGEuYXBpZ0RvbWFpbixcbiAgICAgICAgICBtYXBwaW5nS2V5OiBjdXN0b21Eb21haW5EYXRhLm1hcHBpbmdLZXksXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX2N1c3RvbURvbWFpblVybCA9IGBodHRwczovLyR7Y3VzdG9tRG9tYWluRGF0YS51cmx9YDtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jZGsuaHR0cEFwaSA9IG5ldyBhcGlnLkh0dHBBcGkodGhpcywgXCJBcGlcIiwge1xuICAgICAgICBhcGlOYW1lOiBhcHAubG9naWNhbFByZWZpeGVkTmFtZShpZCksXG4gICAgICAgIGNvcnNQcmVmbGlnaHQ6IGFwaWdWMkNvcnMuYnVpbGRDb3JzQ29uZmlnKGNvcnMpLFxuICAgICAgICBkZWZhdWx0RG9tYWluTWFwcGluZyxcbiAgICAgICAgLi4uaHR0cEFwaVByb3BzLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGh0dHBTdGFnZSA9IHRoaXMuY2RrLmh0dHBBcGkuZGVmYXVsdFN0YWdlIGFzIGFwaWcuSHR0cFN0YWdlO1xuXG4gICAgICAvLyBDb25maWd1cmUgdGhyb3R0bGluZ1xuICAgICAgaWYgKGRlZmF1bHRzPy50aHJvdHRsZT8uYnVyc3QgJiYgZGVmYXVsdHM/LnRocm90dGxlPy5yYXRlKSB7XG4gICAgICAgIGNvbnN0IGNmblN0YWdlID0gaHR0cFN0YWdlLm5vZGUuZGVmYXVsdENoaWxkIGFzIGNmbkFwaWcuQ2ZuU3RhZ2U7XG4gICAgICAgIGNmblN0YWdlLmRlZmF1bHRSb3V0ZVNldHRpbmdzID0ge1xuICAgICAgICAgIC4uLihjZm5TdGFnZS5yb3V0ZVNldHRpbmdzIHx8IHt9KSxcbiAgICAgICAgICB0aHJvdHRsaW5nQnVyc3RMaW1pdDogZGVmYXVsdHMudGhyb3R0bGUuYnVyc3QsXG4gICAgICAgICAgdGhyb3R0bGluZ1JhdGVMaW1pdDogZGVmYXVsdHMudGhyb3R0bGUucmF0ZSxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29uZmlndXJlIGFjY2VzcyBsb2dcbiAgICAgIGZvciAoY29uc3QgZGVmIG9mIGNkaz8uaHR0cFN0YWdlcyB8fCBbXSkge1xuICAgICAgICBjb25zdCBzdGFnZSA9IG5ldyBhcGlnLkh0dHBTdGFnZSh0aGlzLCBcIlN0YWdlXCIgKyBkZWYuc3RhZ2VOYW1lLCB7XG4gICAgICAgICAgLi4uZGVmLFxuICAgICAgICAgIGh0dHBBcGk6IHRoaXMuY2RrLmh0dHBBcGksXG4gICAgICAgIH0pO1xuICAgICAgICBhcGlnVjJBY2Nlc3NMb2cuYnVpbGRBY2Nlc3NMb2dEYXRhKHRoaXMsIGFjY2Vzc0xvZywgc3RhZ2UsIGZhbHNlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuY2RrLmh0dHBBcGkuZGVmYXVsdFN0YWdlKVxuICAgICAgICB0aGlzLmNkay5hY2Nlc3NMb2dHcm91cCA9IGFwaWdWMkFjY2Vzc0xvZy5idWlsZEFjY2Vzc0xvZ0RhdGEoXG4gICAgICAgICAgdGhpcyxcbiAgICAgICAgICBhY2Nlc3NMb2csXG4gICAgICAgICAgdGhpcy5jZGsuaHR0cEFwaS5kZWZhdWx0U3RhZ2UgYXMgYXBpZy5IdHRwU3RhZ2UsXG4gICAgICAgICAgdHJ1ZVxuICAgICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRkQXV0aG9yaXplcnMoYXV0aG9yaXplcnM6IEF1dGhvcml6ZXJzKSB7XG4gICAgT2JqZWN0LmVudHJpZXMoYXV0aG9yaXplcnMpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgaWYgKGtleSA9PT0gXCJub25lXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgbmFtZSBhbiBhdXRob3JpemVyIFwibm9uZVwiYCk7XG4gICAgICB9IGVsc2UgaWYgKGtleSA9PT0gXCJpYW1cIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBuYW1lIGFuIGF1dGhvcml6ZXIgXCJpYW1cImApO1xuICAgICAgfSBlbHNlIGlmICh2YWx1ZS50eXBlID09PSBcInVzZXJfcG9vbFwiKSB7XG4gICAgICAgIGlmICh2YWx1ZS5jZGs/LmF1dGhvcml6ZXIpIHtcbiAgICAgICAgICB0aGlzLmF1dGhvcml6ZXJzRGF0YVtrZXldID0gdmFsdWUuY2RrLmF1dGhvcml6ZXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKCF2YWx1ZS51c2VyUG9vbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIFwidXNlclBvb2xcIiBmb3IgXCIke2tleX1cIiBhdXRob3JpemVyYCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHVzZXJQb29sID0gY29nbml0by5Vc2VyUG9vbC5mcm9tVXNlclBvb2xJZChcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBgQXBpLSR7dGhpcy5ub2RlLmlkfS1BdXRob3JpemVyLSR7a2V5fS1Vc2VyUG9vbGAsXG4gICAgICAgICAgICB2YWx1ZS51c2VyUG9vbC5pZFxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgdXNlclBvb2xDbGllbnRzID1cbiAgICAgICAgICAgIHZhbHVlLnVzZXJQb29sLmNsaWVudElkcyAmJlxuICAgICAgICAgICAgdmFsdWUudXNlclBvb2wuY2xpZW50SWRzLm1hcCgoY2xpZW50SWQsIGkpID0+XG4gICAgICAgICAgICAgIGNvZ25pdG8uVXNlclBvb2xDbGllbnQuZnJvbVVzZXJQb29sQ2xpZW50SWQoXG4gICAgICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgICAgICBgQXBpLSR7dGhpcy5ub2RlLmlkfS1BdXRob3JpemVyLSR7a2V5fS1Vc2VyUG9vbENsaWVudC0ke2l9YCxcbiAgICAgICAgICAgICAgICBjbGllbnRJZFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICAgIHRoaXMuYXV0aG9yaXplcnNEYXRhW2tleV0gPVxuICAgICAgICAgICAgbmV3IGFwaWdBdXRob3JpemVycy5IdHRwVXNlclBvb2xBdXRob3JpemVyKGtleSwgdXNlclBvb2wsIHtcbiAgICAgICAgICAgICAgYXV0aG9yaXplck5hbWU6IHZhbHVlLm5hbWUsXG4gICAgICAgICAgICAgIGlkZW50aXR5U291cmNlOiB2YWx1ZS5pZGVudGl0eVNvdXJjZSxcbiAgICAgICAgICAgICAgdXNlclBvb2xDbGllbnRzLFxuICAgICAgICAgICAgICB1c2VyUG9vbFJlZ2lvbjogdmFsdWUudXNlclBvb2wucmVnaW9uLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodmFsdWUudHlwZSA9PT0gXCJqd3RcIikge1xuICAgICAgICBpZiAodmFsdWUuY2RrPy5hdXRob3JpemVyKSB7XG4gICAgICAgICAgdGhpcy5hdXRob3JpemVyc0RhdGFba2V5XSA9IHZhbHVlLmNkay5hdXRob3JpemVyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICghdmFsdWUuand0KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgXCJqd3RcIiBmb3IgXCIke2tleX1cIiBhdXRob3JpemVyYCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuYXV0aG9yaXplcnNEYXRhW2tleV0gPSBuZXcgYXBpZ0F1dGhvcml6ZXJzLkh0dHBKd3RBdXRob3JpemVyKFxuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgdmFsdWUuand0Lmlzc3VlcixcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgYXV0aG9yaXplck5hbWU6IHZhbHVlLm5hbWUsXG4gICAgICAgICAgICAgIGlkZW50aXR5U291cmNlOiB2YWx1ZS5pZGVudGl0eVNvdXJjZSxcbiAgICAgICAgICAgICAgand0QXVkaWVuY2U6IHZhbHVlLmp3dC5hdWRpZW5jZSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlLnR5cGUgPT09IFwibGFtYmRhXCIpIHtcbiAgICAgICAgaWYgKHZhbHVlLmNkaz8uYXV0aG9yaXplcikge1xuICAgICAgICAgIHRoaXMuYXV0aG9yaXplcnNEYXRhW2tleV0gPSB2YWx1ZS5jZGsuYXV0aG9yaXplcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoIXZhbHVlLmZ1bmN0aW9uKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgXCJmdW5jdGlvblwiIGZvciBcIiR7a2V5fVwiIGF1dGhvcml6ZXJgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5hdXRob3JpemVyc0RhdGFba2V5XSA9IG5ldyBhcGlnQXV0aG9yaXplcnMuSHR0cExhbWJkYUF1dGhvcml6ZXIoXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICB2YWx1ZS5mdW5jdGlvbixcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgYXV0aG9yaXplck5hbWU6IHZhbHVlLm5hbWUsXG4gICAgICAgICAgICAgIGlkZW50aXR5U291cmNlOiB2YWx1ZS5pZGVudGl0eVNvdXJjZSxcbiAgICAgICAgICAgICAgcmVzcG9uc2VUeXBlczpcbiAgICAgICAgICAgICAgICB2YWx1ZS5yZXNwb25zZVR5cGVzICYmXG4gICAgICAgICAgICAgICAgdmFsdWUucmVzcG9uc2VUeXBlcy5tYXAoXG4gICAgICAgICAgICAgICAgICAodHlwZSkgPT5cbiAgICAgICAgICAgICAgICAgICAgYXBpZ0F1dGhvcml6ZXJzLkh0dHBMYW1iZGFSZXNwb25zZVR5cGVbXG4gICAgICAgICAgICAgICAgICAgICAgdHlwZS50b1VwcGVyQ2FzZSgpIGFzIGtleW9mIHR5cGVvZiBhcGlnQXV0aG9yaXplcnMuSHR0cExhbWJkYVJlc3BvbnNlVHlwZVxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgcmVzdWx0c0NhY2hlVHRsOiB2YWx1ZS5yZXN1bHRzQ2FjaGVUdGxcbiAgICAgICAgICAgICAgICA/IHRvQ2RrRHVyYXRpb24odmFsdWUucmVzdWx0c0NhY2hlVHRsKVxuICAgICAgICAgICAgICAgIDogY2RrLkR1cmF0aW9uLnNlY29uZHMoMCksXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRSb3V0ZShcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIHJvdXRlS2V5OiBzdHJpbmcsXG4gICAgcm91dGVWYWx1ZTogQXBpUm91dGVQcm9wczxrZXlvZiBBdXRob3JpemVycz5cbiAgKTogdm9pZCB7XG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIE5vcm1hbGl6ZSByb3V0ZUtleVxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICByb3V0ZUtleSA9IHRoaXMubm9ybWFsaXplUm91dGVLZXkocm91dGVLZXkpO1xuICAgIGlmICh0aGlzLnJvdXRlc0RhdGFbcm91dGVLZXldKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEEgcm91dGUgYWxyZWFkeSBleGlzdHMgZm9yIFwiJHtyb3V0ZUtleX1cImApO1xuICAgIH1cblxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBHZXQgcGF0aCBhbmQgbWV0aG9kXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIGxldCBwb3N0Zml4TmFtZTtcbiAgICBsZXQgaHR0cFJvdXRlS2V5O1xuICAgIGxldCBtZXRob2Q6IEFwaUh0dHBNZXRob2Q7XG4gICAgbGV0IHBhdGg7XG4gICAgaWYgKHJvdXRlS2V5ID09PSBcIiRkZWZhdWx0XCIpIHtcbiAgICAgIHBvc3RmaXhOYW1lID0gXCJkZWZhdWx0XCI7XG4gICAgICBodHRwUm91dGVLZXkgPSBhcGlnLkh0dHBSb3V0ZUtleS5ERUZBVUxUO1xuICAgICAgbWV0aG9kID0gXCJBTllcIjtcbiAgICAgIHBhdGggPSByb3V0ZUtleTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgcm91dGVLZXlQYXJ0cyA9IHJvdXRlS2V5LnNwbGl0KFwiIFwiKTtcbiAgICAgIGlmIChyb3V0ZUtleVBhcnRzLmxlbmd0aCAhPT0gMikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgcm91dGUgJHtyb3V0ZUtleX1gKTtcbiAgICAgIH1cbiAgICAgIG1ldGhvZCA9IHJvdXRlS2V5UGFydHNbMF0udG9VcHBlckNhc2UoKSBhcyBBcGlIdHRwTWV0aG9kO1xuICAgICAgaWYgKCFhcGlnLkh0dHBNZXRob2RbbWV0aG9kXSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbWV0aG9kIGRlZmluZWQgZm9yIFwiJHtyb3V0ZUtleX1cImApO1xuICAgICAgfVxuICAgICAgcGF0aCA9IHJvdXRlS2V5UGFydHNbMV07XG4gICAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHBhdGggZGVmaW5lZCBmb3IgXCIke3JvdXRlS2V5fVwiYCk7XG4gICAgICB9XG5cbiAgICAgIHBvc3RmaXhOYW1lID0gYCR7bWV0aG9kfV8ke3BhdGh9YDtcbiAgICAgIGh0dHBSb3V0ZUtleSA9IGFwaWcuSHR0cFJvdXRlS2V5LndpdGgocGF0aCwgYXBpZy5IdHRwTWV0aG9kW21ldGhvZF0pO1xuICAgIH1cblxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBDcmVhdGUgcm91dGVcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgY29uc3QgW3JvdXRlUHJvcHMsIGludGVncmF0aW9uXSA9ICgoKSA9PiB7XG4gICAgICBpZiAoRm4uaXNJbmxpbmVEZWZpbml0aW9uKHJvdXRlVmFsdWUpKSB7XG4gICAgICAgIGNvbnN0IHJvdXRlUHJvcHMgPSB7IGZ1bmN0aW9uOiByb3V0ZVZhbHVlIH07XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgcm91dGVQcm9wcyxcbiAgICAgICAgICB0aGlzLmNyZWF0ZUZ1bmN0aW9uSW50ZWdyYXRpb24oXG4gICAgICAgICAgICBzY29wZSxcbiAgICAgICAgICAgIHJvdXRlS2V5LFxuICAgICAgICAgICAgcm91dGVQcm9wcyxcbiAgICAgICAgICAgIHBvc3RmaXhOYW1lXG4gICAgICAgICAgKSxcbiAgICAgICAgXTtcbiAgICAgIH1cbiAgICAgIGlmIChyb3V0ZVZhbHVlLnR5cGUgPT09IFwiYWxiXCIpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICByb3V0ZVZhbHVlLFxuICAgICAgICAgIHRoaXMuY3JlYXRlQWxiSW50ZWdyYXRpb24oc2NvcGUsIHJvdXRlS2V5LCByb3V0ZVZhbHVlLCBwb3N0Zml4TmFtZSksXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgICBpZiAocm91dGVWYWx1ZS50eXBlID09PSBcInVybFwiKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgcm91dGVWYWx1ZSxcbiAgICAgICAgICB0aGlzLmNyZWF0ZUh0dHBJbnRlZ3JhdGlvbihzY29wZSwgcm91dGVLZXksIHJvdXRlVmFsdWUsIHBvc3RmaXhOYW1lKSxcbiAgICAgICAgXTtcbiAgICAgIH1cbiAgICAgIGlmIChcImZ1bmN0aW9uXCIgaW4gcm91dGVWYWx1ZSkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgIHJvdXRlVmFsdWUsXG4gICAgICAgICAgdGhpcy5jcmVhdGVGdW5jdGlvbkludGVncmF0aW9uKFxuICAgICAgICAgICAgc2NvcGUsXG4gICAgICAgICAgICByb3V0ZUtleSxcbiAgICAgICAgICAgIHJvdXRlVmFsdWUsXG4gICAgICAgICAgICBwb3N0Zml4TmFtZVxuICAgICAgICAgICksXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgICBpZiAoXCJoYW5kbGVyXCIgaW4gcm91dGVWYWx1ZSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBGdW5jdGlvbiBkZWZpbml0aW9uIG11c3QgYmUgbmVzdGVkIHVuZGVyIHRoZSBcImZ1bmN0aW9uXCIga2V5IGluIHRoZSByb3V0ZSBwcm9wcyBmb3IgXCIke3JvdXRlS2V5fVwiLiBpZS4geyBmdW5jdGlvbjogeyBoYW5kbGVyOiBcIm15ZnVuYy5oYW5kbGVyXCIgfSB9YFxuICAgICAgICApO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgSW52YWxpZCByb3V0ZSB0eXBlIGZvciBcIiR7cm91dGVLZXl9XCIuIE11c3QgYmUgb25lIG9mOiBhbGIsIHVybCwgZnVuY3Rpb25gXG4gICAgICApO1xuICAgIH0pKCk7XG5cbiAgICBjb25zdCB7IGF1dGhvcml6YXRpb25UeXBlLCBhdXRob3JpemVyLCBhdXRob3JpemF0aW9uU2NvcGVzIH0gPVxuICAgICAgdGhpcy5idWlsZFJvdXRlQXV0aChyb3V0ZVByb3BzKTtcbiAgICBjb25zdCByb3V0ZSA9IG5ldyBhcGlnLkh0dHBSb3V0ZShzY29wZSwgYFJvdXRlXyR7cG9zdGZpeE5hbWV9YCwge1xuICAgICAgaHR0cEFwaTogdGhpcy5jZGsuaHR0cEFwaSxcbiAgICAgIHJvdXRlS2V5OiBodHRwUm91dGVLZXksXG4gICAgICBpbnRlZ3JhdGlvbixcbiAgICAgIGF1dGhvcml6ZXIsXG4gICAgICBhdXRob3JpemF0aW9uU2NvcGVzLFxuICAgIH0pO1xuXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBDb25maWd1cmUgcm91dGUgYXV0aG9yaXphdGlvbiB0eXBlXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBOb3RlOiB3ZSBuZWVkIHRvIGV4cGxpY2l0bHkgc2V0IGBjZm5Sb3V0ZS5hdXRob3JpemF0aW9uVHlwZWAgdG8gYE5PTkVgXG4gICAgLy8gICAgICAgYmVjYXVzZSBpZiBpdCB3ZXJlIHNldCB0byBgQVdTX0lBTWAsIGFuZCB0aGVuIGl0IGlzIHJlbW92ZWQgZnJvbVxuICAgIC8vICAgICAgIHRoZSBDbG91ZEZvcm1hdGlvbiB0ZW1wbGF0ZSAoaWUuIHNldCB0byB1bmRlZmluZWQpLCBDbG91ZEZvcm1hdGlvblxuICAgIC8vICAgICAgIGRvZXNuJ3QgdXBkYXRlcyB0aGUgcm91dGUuIFRoZSByb3V0ZSdzIGF1dGhvcml6YXRpb25UeXBlIHdvdWxkIHN0aWxsXG4gICAgLy8gICAgICAgYmUgYEFXU19JQU1gLlxuICAgIGNvbnN0IGNmblJvdXRlID0gcm91dGUubm9kZS5kZWZhdWx0Q2hpbGQhIGFzIGNmbkFwaWcuQ2ZuUm91dGU7XG4gICAgaWYgKGF1dGhvcml6YXRpb25UeXBlID09PSBcImlhbVwiKSB7XG4gICAgICBjZm5Sb3V0ZS5hdXRob3JpemF0aW9uVHlwZSA9IFwiQVdTX0lBTVwiO1xuICAgIH0gZWxzZSBpZiAoYXV0aG9yaXphdGlvblR5cGUgPT09IFwibm9uZVwiKSB7XG4gICAgICBjZm5Sb3V0ZS5hdXRob3JpemF0aW9uVHlwZSA9IFwiTk9ORVwiO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlSHR0cEludGVncmF0aW9uKFxuICAgIHNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgcm91dGVLZXk6IHN0cmluZyxcbiAgICByb3V0ZVByb3BzOiBBcGlIdHRwUm91dGVQcm9wczxrZXlvZiBBdXRob3JpemVycz4sXG4gICAgcG9zdGZpeE5hbWU6IHN0cmluZ1xuICApOiBhcGlnLkh0dHBSb3V0ZUludGVncmF0aW9uIHtcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gQ3JlYXRlIGludGVncmF0aW9uXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIGNvbnN0IGludGVncmF0aW9uID0gbmV3IGFwaWdJbnRlZ3JhdGlvbnMuSHR0cFVybEludGVncmF0aW9uKFxuICAgICAgYEludGVncmF0aW9uXyR7cG9zdGZpeE5hbWV9YCxcbiAgICAgIHJvdXRlUHJvcHMudXJsLFxuICAgICAgcm91dGVQcm9wcy5jZGs/LmludGVncmF0aW9uXG4gICAgKTtcblxuICAgIC8vIFN0b3JlIHJvdXRlXG4gICAgdGhpcy5yb3V0ZXNEYXRhW3JvdXRlS2V5XSA9IHJvdXRlUHJvcHMudXJsO1xuXG4gICAgcmV0dXJuIGludGVncmF0aW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBbGJJbnRlZ3JhdGlvbihcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIHJvdXRlS2V5OiBzdHJpbmcsXG4gICAgcm91dGVQcm9wczogQXBpQWxiUm91dGVQcm9wczxrZXlvZiBBdXRob3JpemVycz4sXG4gICAgcG9zdGZpeE5hbWU6IHN0cmluZ1xuICApOiBhcGlnLkh0dHBSb3V0ZUludGVncmF0aW9uIHtcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gQ3JlYXRlIGludGVncmF0aW9uXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIGNvbnN0IGludGVncmF0aW9uID0gbmV3IGFwaWdJbnRlZ3JhdGlvbnMuSHR0cEFsYkludGVncmF0aW9uKFxuICAgICAgYEludGVncmF0aW9uXyR7cG9zdGZpeE5hbWV9YCxcbiAgICAgIHJvdXRlUHJvcHMuY2RrPy5hbGJMaXN0ZW5lciEsXG4gICAgICByb3V0ZVByb3BzLmNkaz8uaW50ZWdyYXRpb25cbiAgICApO1xuXG4gICAgLy8gU3RvcmUgcm91dGVcbiAgICB0aGlzLnJvdXRlc0RhdGFbcm91dGVLZXldID0gcm91dGVQcm9wcy5jZGs/LmFsYkxpc3RlbmVyITtcblxuICAgIHJldHVybiBpbnRlZ3JhdGlvbjtcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVGdW5jdGlvbkludGVncmF0aW9uKFxuICAgIHNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgcm91dGVLZXk6IHN0cmluZyxcbiAgICByb3V0ZVByb3BzOiBBcGlGdW5jdGlvblJvdXRlUHJvcHM8a2V5b2YgQXV0aG9yaXplcnM+LFxuICAgIHBvc3RmaXhOYW1lOiBzdHJpbmdcbiAgKTogYXBpZy5IdHRwUm91dGVJbnRlZ3JhdGlvbiB7XG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIEdldCBwYXlsb2FkIGZvcm1hdFxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICBjb25zdCBwYXlsb2FkRm9ybWF0VmVyc2lvbjogQXBpUGF5bG9hZEZvcm1hdFZlcnNpb24gPVxuICAgICAgcm91dGVQcm9wcy5wYXlsb2FkRm9ybWF0VmVyc2lvbiB8fFxuICAgICAgdGhpcy5wcm9wcy5kZWZhdWx0cz8ucGF5bG9hZEZvcm1hdFZlcnNpb24gfHxcbiAgICAgIFwiMi4wXCI7XG4gICAgaWYgKCFQYXlsb2FkRm9ybWF0VmVyc2lvbnMuaW5jbHVkZXMocGF5bG9hZEZvcm1hdFZlcnNpb24pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBQYXlsb2FkRm9ybWF0VmVyc2lvbjogc3N0LkFwaSBkb2VzIG5vdCBjdXJyZW50bHkgc3VwcG9ydCAke3BheWxvYWRGb3JtYXRWZXJzaW9ufSBwYXlsb2FkIGZvcm1hdCB2ZXJzaW9uLiBPbmx5IFwiVjFcIiBhbmQgXCJWMlwiIGFyZSBjdXJyZW50bHkgc3VwcG9ydGVkLmBcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IGludGVncmF0aW9uUGF5bG9hZEZvcm1hdFZlcnNpb24gPVxuICAgICAgcGF5bG9hZEZvcm1hdFZlcnNpb24gPT09IFwiMS4wXCJcbiAgICAgICAgPyBhcGlnLlBheWxvYWRGb3JtYXRWZXJzaW9uLlZFUlNJT05fMV8wXG4gICAgICAgIDogYXBpZy5QYXlsb2FkRm9ybWF0VmVyc2lvbi5WRVJTSU9OXzJfMDtcblxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBDcmVhdGUgRnVuY3Rpb25cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgY29uc3QgbGFtYmRhID0gRm4uZnJvbURlZmluaXRpb24oXG4gICAgICBzY29wZSxcbiAgICAgIGBMYW1iZGFfJHtwb3N0Zml4TmFtZX1gLFxuICAgICAgcm91dGVQcm9wcy5mdW5jdGlvbixcbiAgICAgIHRoaXMucHJvcHMuZGVmYXVsdHM/LmZ1bmN0aW9uLFxuICAgICAgYFRoZSBcImRlZmF1bHRzLmZ1bmN0aW9uXCIgY2Fubm90IGJlIGFwcGxpZWQgaWYgYW4gaW5zdGFuY2Ugb2YgYSBGdW5jdGlvbiBjb25zdHJ1Y3QgaXMgcGFzc2VkIGluLiBNYWtlIHN1cmUgdG8gZGVmaW5lIGFsbCB0aGUgcm91dGVzIHVzaW5nIEZ1bmN0aW9uUHJvcHMsIHNvIHRoZSBBcGkgY29uc3RydWN0IGNhbiBhcHBseSB0aGUgXCJkZWZhdWx0cy5mdW5jdGlvblwiIHRvIHRoZW0uYFxuICAgICk7XG4gICAgLy8gQWRkIGFuIGVudmlyb25tZW50IHZhcmlhYmxlIHRvIGRldGVybWluZSBpZiB0aGUgZnVuY3Rpb24gaXMgYW4gQXBpIHJvdXRlLlxuICAgIC8vIElmIGl0IGlzLCB3aGVuIFwic3N0IHN0YXJ0XCIgaXMgbm90IGNvbm5lY3RlZCwgd2Ugd2FudCB0byByZXR1cm4gYW4gNTAwXG4gICAgLy8gc3RhdHVzIGNvZGUgYW5kIGEgZGVzY3JpcHRpdmUgZXJyb3IgbWVzc2FnZS5cbiAgICBjb25zdCByb290ID0gc2NvcGUubm9kZS5yb290IGFzIEFwcDtcbiAgICBpZiAocm9vdC5sb2NhbCkge1xuICAgICAgbGFtYmRhLmFkZEVudmlyb25tZW50KFwiU1NUX0RFQlVHX0lTX0FQSV9ST1VURVwiLCBcIjFcIiwge1xuICAgICAgICByZW1vdmVJbkVkZ2U6IHRydWUsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gQ3JlYXRlIGludGVncmF0aW9uXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIGNvbnN0IGludGVncmF0aW9uID0gbmV3IGFwaWdJbnRlZ3JhdGlvbnMuSHR0cExhbWJkYUludGVncmF0aW9uKFxuICAgICAgYEludGVncmF0aW9uXyR7cG9zdGZpeE5hbWV9YCxcbiAgICAgIGxhbWJkYSxcbiAgICAgIHtcbiAgICAgICAgcGF5bG9hZEZvcm1hdFZlcnNpb246IGludGVncmF0aW9uUGF5bG9hZEZvcm1hdFZlcnNpb24sXG4gICAgICB9XG4gICAgKTtcblxuICAgIC8vIFN0b3JlIHJvdXRlXG4gICAgdGhpcy5yb3V0ZXNEYXRhW3JvdXRlS2V5XSA9IGxhbWJkYTtcblxuICAgIC8vIEF0dGFjaGVkIGV4aXN0aW5nIHBlcm1pc3Npb25zXG4gICAgdGhpcy5wZXJtaXNzaW9uc0F0dGFjaGVkRm9yQWxsUm91dGVzLmZvckVhY2goKHBlcm1pc3Npb25zKSA9PlxuICAgICAgbGFtYmRhLmF0dGFjaFBlcm1pc3Npb25zKHBlcm1pc3Npb25zKVxuICAgICk7XG5cbiAgICByZXR1cm4gaW50ZWdyYXRpb247XG4gIH1cblxuICBwcml2YXRlIGJ1aWxkUm91dGVBdXRoKFxuICAgIHJvdXRlUHJvcHM6XG4gICAgICB8IEFwaUZ1bmN0aW9uUm91dGVQcm9wczxrZXlvZiBBdXRob3JpemVycz5cbiAgICAgIHwgQXBpSHR0cFJvdXRlUHJvcHM8a2V5b2YgQXV0aG9yaXplcnM+XG4gICAgICB8IEFwaUFsYlJvdXRlUHJvcHM8a2V5b2YgQXV0aG9yaXplcnM+XG4gICkge1xuICAgIGNvbnN0IGF1dGhvcml6ZXJLZXkgPVxuICAgICAgcm91dGVQcm9wcy5hdXRob3JpemVyIHx8IHRoaXMucHJvcHMuZGVmYXVsdHM/LmF1dGhvcml6ZXIgfHwgXCJub25lXCI7XG4gICAgaWYgKGF1dGhvcml6ZXJLZXkgPT09IFwibm9uZVwiKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhdXRob3JpemF0aW9uVHlwZTogXCJub25lXCIsXG4gICAgICAgIGF1dGhvcml6ZXI6IG5ldyBhcGlnLkh0dHBOb25lQXV0aG9yaXplcigpLFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKGF1dGhvcml6ZXJLZXkgPT09IFwiaWFtXCIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGF1dGhvcml6YXRpb25UeXBlOiBcImlhbVwiLFxuICAgICAgICBhdXRob3JpemVyOiBuZXcgYXBpZ0F1dGhvcml6ZXJzLkh0dHBJYW1BdXRob3JpemVyKCksXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgICF0aGlzLnByb3BzLmF1dGhvcml6ZXJzIHx8XG4gICAgICAhdGhpcy5wcm9wcy5hdXRob3JpemVyc1thdXRob3JpemVyS2V5IGFzIHN0cmluZ11cbiAgICApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGZpbmQgYXV0aG9yaXplciBcIiR7YXV0aG9yaXplcktleX1cImApO1xuICAgIH1cblxuICAgIGNvbnN0IGF1dGhvcml6ZXIgPSB0aGlzLmF1dGhvcml6ZXJzRGF0YVthdXRob3JpemVyS2V5IGFzIHN0cmluZ107XG4gICAgY29uc3QgYXV0aG9yaXphdGlvblR5cGUgPVxuICAgICAgdGhpcy5wcm9wcy5hdXRob3JpemVyc1thdXRob3JpemVyS2V5IGFzIHN0cmluZ10udHlwZTtcbiAgICBjb25zdCBhdXRob3JpemF0aW9uU2NvcGVzID1cbiAgICAgIGF1dGhvcml6YXRpb25UeXBlID09PSBcImp3dFwiIHx8IGF1dGhvcml6YXRpb25UeXBlID09PSBcInVzZXJfcG9vbFwiXG4gICAgICAgID8gcm91dGVQcm9wcy5hdXRob3JpemF0aW9uU2NvcGVzIHx8XG4gICAgICAgICAgdGhpcy5wcm9wcy5kZWZhdWx0cz8uYXV0aG9yaXphdGlvblNjb3Blc1xuICAgICAgICA6IHVuZGVmaW5lZDtcblxuICAgIHJldHVybiB7IGF1dGhvcml6YXRpb25UeXBlLCBhdXRob3JpemVyLCBhdXRob3JpemF0aW9uU2NvcGVzIH07XG4gIH1cblxuICBwcml2YXRlIG5vcm1hbGl6ZVJvdXRlS2V5KHJvdXRlS2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiByb3V0ZUtleS5zcGxpdCgvXFxzKy8pLmpvaW4oXCIgXCIpO1xuICB9XG59XG4iXX0=