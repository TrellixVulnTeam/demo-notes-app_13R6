"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Auth = void 0;
const constructs_1 = require("constructs");
const iam = __importStar(require("aws-cdk-lib/aws-iam"));
const cognito = __importStar(require("aws-cdk-lib/aws-cognito"));
const Stack_1 = require("./Stack");
const Construct_1 = require("./Construct");
const Function_1 = require("./Function");
const permission_1 = require("./util/permission");
const AuthUserPoolTriggerOperationMapping = {
    createAuthChallenge: cognito.UserPoolOperation.CREATE_AUTH_CHALLENGE,
    customEmailSender: cognito.UserPoolOperation.CUSTOM_EMAIL_SENDER,
    customMessage: cognito.UserPoolOperation.CUSTOM_MESSAGE,
    customSmsSender: cognito.UserPoolOperation.CUSTOM_SMS_SENDER,
    defineAuthChallenge: cognito.UserPoolOperation.DEFINE_AUTH_CHALLENGE,
    postAuthentication: cognito.UserPoolOperation.POST_AUTHENTICATION,
    postConfirmation: cognito.UserPoolOperation.POST_CONFIRMATION,
    preAuthentication: cognito.UserPoolOperation.PRE_AUTHENTICATION,
    preSignUp: cognito.UserPoolOperation.PRE_SIGN_UP,
    preTokenGeneration: cognito.UserPoolOperation.PRE_TOKEN_GENERATION,
    userMigration: cognito.UserPoolOperation.USER_MIGRATION,
    verifyAuthChallengeResponse: cognito.UserPoolOperation.VERIFY_AUTH_CHALLENGE_RESPONSE,
};
/////////////////////
// Construct
/////////////////////
/**
 * The `Auth` construct is a higher level CDK construct that makes it easy to configure a [Cognito User Pool](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools.html) and [Cognito Identity Pool](https://docs.aws.amazon.com/cognito/latest/developerguide/identity-pools.html). Also, allows setting up Auth0, Facebook, Google, Twitter, Apple, and Amazon as authentication providers.
 */
class Auth extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        this.props = props || {};
        this.cdk = {};
        this.functions = {};
        this.permissionsAttachedForAllTriggers = [];
        this.createUserPool();
        this.createUserPoolClient();
        this.addTriggers();
        this.createIdentityPool();
    }
    /**
     * The id of the internally created Cognito User Pool.
     */
    get userPoolId() {
        return this.cdk.userPool.userPoolId;
    }
    /**
     * The ARN of the internally created Cognito User Pool.
     */
    get userPoolArn() {
        return this.cdk.userPool.userPoolArn;
    }
    /**
     * The id of the internally created Cognito User Pool client.
     */
    get userPoolClientId() {
        return this.cdk.userPoolClient.userPoolClientId;
    }
    /**
     * The id of the internally created `IdentityPool` instance.
     */
    get cognitoIdentityPoolId() {
        var _a;
        return (_a = this.cdk.cfnIdentityPool) === null || _a === void 0 ? void 0 : _a.ref;
    }
    attachPermissionsForAuthUsers(permissions) {
        (0, permission_1.attachPermissionsToRole)(this.cdk.authRole, permissions);
    }
    attachPermissionsForUnauthUsers(permissions) {
        (0, permission_1.attachPermissionsToRole)(this.cdk.unauthRole, permissions);
    }
    attachPermissionsForTriggers(permissions) {
        Object.values(this.functions).forEach((fn) => fn.attachPermissions(permissions));
        this.permissionsAttachedForAllTriggers.push(permissions);
    }
    attachPermissionsForTrigger(triggerKey, permissions) {
        const fn = this.getFunction(triggerKey);
        if (!fn) {
            throw new Error(`Failed to attach permissions. Trigger "${triggerKey}" does not exist.`);
        }
        fn.attachPermissions(permissions);
    }
    getFunction(triggerKey) {
        return this.functions[triggerKey];
    }
    getConstructMetadata() {
        var _a;
        return {
            type: "Auth",
            data: {
                identityPoolId: (_a = this.cdk.cfnIdentityPool) === null || _a === void 0 ? void 0 : _a.ref,
                userPoolId: this.cdk.userPool.userPoolId,
                triggers: Object.entries(this.functions).map(([name, fun]) => ({
                    name,
                    fn: (0, Construct_1.getFunctionRef)(fun),
                })),
            },
        };
    }
    createUserPool() {
        const { login, cdk } = this.props;
        const app = this.node.root;
        if ((0, Construct_1.isCDKConstruct)(cdk === null || cdk === void 0 ? void 0 : cdk.userPool)) {
            this.cdk.userPool = cdk === null || cdk === void 0 ? void 0 : cdk.userPool;
        }
        else {
            const cognitoUserPoolProps = ((cdk === null || cdk === void 0 ? void 0 : cdk.userPool) ||
                {});
            // validate `lambdaTriggers` is not specified
            if (cognitoUserPoolProps.lambdaTriggers) {
                throw new Error(`Cannot configure the "cdk.userPool.lambdaTriggers" in the Auth construct. Use the "triggers" instead.`);
            }
            // validate `cdk.userPoolClient` is not imported
            if ((0, Construct_1.isCDKConstruct)(cdk === null || cdk === void 0 ? void 0 : cdk.userPoolClient)) {
                throw new Error(`Cannot import the "userPoolClient" when the "userPool" is not imported.`);
            }
            this.cdk.userPool = new cognito.UserPool(this, "UserPool", Object.assign({ userPoolName: app.logicalPrefixedName(this.node.id), selfSignUpEnabled: true, signInCaseSensitive: false, signInAliases: this.buildSignInAliases(login) }, cognitoUserPoolProps));
        }
    }
    createUserPoolClient() {
        const { cdk } = this.props;
        if ((0, Construct_1.isCDKConstruct)(cdk === null || cdk === void 0 ? void 0 : cdk.userPoolClient)) {
            this.cdk.userPoolClient = cdk === null || cdk === void 0 ? void 0 : cdk.userPoolClient;
        }
        else {
            const clientProps = ((cdk === null || cdk === void 0 ? void 0 : cdk.userPoolClient) ||
                {});
            this.cdk.userPoolClient = new cognito.UserPoolClient(this, "UserPoolClient", Object.assign({ userPool: this.cdk.userPool }, clientProps));
        }
    }
    createIdentityPool() {
        var _a;
        const { identityPoolFederation } = this.props;
        if (identityPoolFederation === false) {
            return;
        }
        const id = this.node.id;
        const app = this.node.root;
        const cognitoIdentityProviders = [];
        const openIdConnectProviderArns = [];
        const supportedLoginProviders = {};
        ////////////////////
        // Handle Cognito Identity Providers (ie. User Pool)
        ////////////////////
        const urlSuffix = Stack_1.Stack.of(this).urlSuffix;
        cognitoIdentityProviders.push({
            providerName: `cognito-idp.${app.region}.${urlSuffix}/${this.cdk.userPool.userPoolId}`,
            clientId: this.cdk.userPoolClient.userPoolClientId,
        });
        if (typeof identityPoolFederation === "object") {
            const { auth0, amazon, apple, facebook, google, twitter } = identityPoolFederation;
            ////////////////////
            // Handle OpenId Connect Providers (ie. Auth0)
            ////////////////////
            if (auth0) {
                if (!auth0.domain) {
                    throw new Error(`Auth0Domain: No Auth0 domain defined for the "${id}" Auth`);
                }
                if (!auth0.clientId) {
                    throw new Error(`Auth0ClientId: No Auth0 clientId defined for the "${id}" Auth`);
                }
                const provider = new iam.OpenIdConnectProvider(this, "Auth0Provider", {
                    url: auth0.domain.startsWith("https://")
                        ? auth0.domain
                        : `https://${auth0.domain}`,
                    clientIds: [auth0.clientId],
                });
                openIdConnectProviderArns.push(provider.openIdConnectProviderArn);
            }
            ////////////////////
            // Handle Social Identity Providers
            ////////////////////
            if (amazon) {
                if (!amazon.appId) {
                    throw new Error(`AmazonAppId: No Amazon appId defined for the "${id}" Auth`);
                }
                supportedLoginProviders["www.amazon.com"] = amazon.appId;
            }
            if (facebook) {
                if (!facebook.appId) {
                    throw new Error(`FacebookAppId: No Facebook appId defined for the "${id}" Auth`);
                }
                supportedLoginProviders["graph.facebook.com"] = facebook.appId;
            }
            if (google) {
                if (!google.clientId) {
                    throw new Error(`GoogleClientId: No Google appId defined for the "${id}" Auth`);
                }
                supportedLoginProviders["accounts.google.com"] = google.clientId;
            }
            if (twitter) {
                if (!twitter.consumerKey) {
                    throw new Error(`TwitterConsumerKey: No Twitter consumer key defined for the "${id}" Auth`);
                }
                if (!twitter.consumerSecret) {
                    throw new Error(`TwitterConsumerSecret: No Twitter consumer secret defined for the "${id}" Auth`);
                }
                supportedLoginProviders["api.twitter.com"] = `${twitter.consumerKey};${twitter.consumerSecret}`;
            }
            if (apple) {
                if (!apple.servicesId) {
                    throw new Error(`AppleServicesId: No Apple servicesId defined for the "${id}" Auth`);
                }
                supportedLoginProviders["appleid.apple.com"] = apple.servicesId;
            }
        }
        // Create Cognito Identity Pool
        const identityPoolProps = typeof identityPoolFederation === "object"
            ? ((_a = identityPoolFederation.cdk) === null || _a === void 0 ? void 0 : _a.cfnIdentityPool) || {}
            : {};
        this.cdk.cfnIdentityPool = new cognito.CfnIdentityPool(this, "IdentityPool", Object.assign({ identityPoolName: app.logicalPrefixedName(id), allowUnauthenticatedIdentities: true, cognitoIdentityProviders,
            supportedLoginProviders,
            openIdConnectProviderArns }, identityPoolProps));
        this.cdk.authRole = this.createAuthRole(this.cdk.cfnIdentityPool);
        this.cdk.unauthRole = this.createUnauthRole(this.cdk.cfnIdentityPool);
        // Attach roles to Identity Pool
        new cognito.CfnIdentityPoolRoleAttachment(this, "IdentityPoolRoleAttachment", {
            identityPoolId: this.cdk.cfnIdentityPool.ref,
            roles: {
                authenticated: this.cdk.authRole.roleArn,
                unauthenticated: this.cdk.unauthRole.roleArn,
            },
        });
    }
    addTriggers() {
        const { triggers, defaults } = this.props;
        if (!triggers || Object.keys(triggers).length === 0) {
            return;
        }
        // Validate cognito user pool is not imported
        // ie. imported IUserPool does not have the "addTrigger" function
        if (!this.cdk.userPool.addTrigger) {
            throw new Error(`Cannot add triggers when the "userPool" is imported.`);
        }
        Object.entries(triggers).forEach(([triggerKey, triggerValue]) => this.addTrigger(this, triggerKey, triggerValue, defaults === null || defaults === void 0 ? void 0 : defaults.function));
    }
    addTrigger(scope, triggerKey, triggerValue, functionProps) {
        // Validate cognito user pool is defined
        if (!this.cdk.userPool) {
            throw new Error(`Triggers cannot be added. No Cognito UserPool defined for the Auth construct.`);
        }
        // Create Function
        const lambda = Function_1.Function.fromDefinition(scope, triggerKey, triggerValue, functionProps, `The "defaults.function" cannot be applied if an instance of a Function construct is passed in. Make sure to define all the triggers using FunctionProps, so the Auth construct can apply the "defaults.function" to them.`);
        // Create trigger
        const operation = AuthUserPoolTriggerOperationMapping[triggerKey];
        this.cdk.userPool.addTrigger(operation, lambda);
        // Store function
        this.functions[triggerKey] = lambda;
        return lambda;
    }
    createAuthRole(identityPool) {
        const role = new iam.Role(this, "IdentityPoolAuthRole", {
            assumedBy: new iam.FederatedPrincipal("cognito-identity.amazonaws.com", {
                StringEquals: {
                    "cognito-identity.amazonaws.com:aud": identityPool.ref,
                },
                "ForAnyValue:StringLike": {
                    "cognito-identity.amazonaws.com:amr": "authenticated",
                },
            }, "sts:AssumeRoleWithWebIdentity"),
        });
        role.addToPolicy(new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: [
                "mobileanalytics:PutEvents",
                "cognito-sync:*",
                "cognito-identity:*",
            ],
            resources: ["*"],
        }));
        return role;
    }
    createUnauthRole(identityPool) {
        const role = new iam.Role(this, "IdentityPoolUnauthRole", {
            assumedBy: new iam.FederatedPrincipal("cognito-identity.amazonaws.com", {
                StringEquals: {
                    "cognito-identity.amazonaws.com:aud": identityPool.ref,
                },
                "ForAnyValue:StringLike": {
                    "cognito-identity.amazonaws.com:amr": "unauthenticated",
                },
            }, "sts:AssumeRoleWithWebIdentity"),
        });
        role.addToPolicy(new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: ["mobileanalytics:PutEvents", "cognito-sync:*"],
            resources: ["*"],
        }));
        return role;
    }
    buildSignInAliases(login) {
        if (!login) {
            return;
        }
        return {
            email: login.includes("email"),
            phone: login.includes("phone"),
            username: login.includes("username"),
            preferredUsername: login.includes("preferredUsername"),
        };
    }
}
exports.Auth = Auth;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXV0aC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9BdXRoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQXVDO0FBQ3ZDLHlEQUEyQztBQUMzQyxpRUFBbUQ7QUFHbkQsbUNBQWdDO0FBQ2hDLDJDQUEyRTtBQUMzRSx5Q0FBK0U7QUFDL0Usa0RBQXlFO0FBRXpFLE1BQU0sbUNBQW1DLEdBQUc7SUFDMUMsbUJBQW1CLEVBQUUsT0FBTyxDQUFDLGlCQUFpQixDQUFDLHFCQUFxQjtJQUNwRSxpQkFBaUIsRUFBRSxPQUFPLENBQUMsaUJBQWlCLENBQUMsbUJBQW1CO0lBQ2hFLGFBQWEsRUFBRSxPQUFPLENBQUMsaUJBQWlCLENBQUMsY0FBYztJQUN2RCxlQUFlLEVBQUUsT0FBTyxDQUFDLGlCQUFpQixDQUFDLGlCQUFpQjtJQUM1RCxtQkFBbUIsRUFBRSxPQUFPLENBQUMsaUJBQWlCLENBQUMscUJBQXFCO0lBQ3BFLGtCQUFrQixFQUFFLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxtQkFBbUI7SUFDakUsZ0JBQWdCLEVBQUUsT0FBTyxDQUFDLGlCQUFpQixDQUFDLGlCQUFpQjtJQUM3RCxpQkFBaUIsRUFBRSxPQUFPLENBQUMsaUJBQWlCLENBQUMsa0JBQWtCO0lBQy9ELFNBQVMsRUFBRSxPQUFPLENBQUMsaUJBQWlCLENBQUMsV0FBVztJQUNoRCxrQkFBa0IsRUFBRSxPQUFPLENBQUMsaUJBQWlCLENBQUMsb0JBQW9CO0lBQ2xFLGFBQWEsRUFBRSxPQUFPLENBQUMsaUJBQWlCLENBQUMsY0FBYztJQUN2RCwyQkFBMkIsRUFDekIsT0FBTyxDQUFDLGlCQUFpQixDQUFDLDhCQUE4QjtDQUMzRCxDQUFDO0FBNEhGLHFCQUFxQjtBQUNyQixZQUFZO0FBQ1oscUJBQXFCO0FBRXJCOztHQUVHO0FBQ0gsTUFBYSxJQUFLLFNBQVEsc0JBQVM7SUFZakMsWUFBWSxLQUFnQixFQUFFLEVBQVUs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QyxHQUFHO2lCQUN2RDtnQkFDRCx3QkFBd0IsRUFBRTtvQkFDeEIsb0NBQW9DLEVBQUUsaUJBQWlCO2lCQUN4RDthQUNGLEVBQ0QsK0JBQStCLENBQ2hDO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFdBQVcsQ0FDZCxJQUFJLEdBQUcsQ0FBQyxlQUFlLENBQUM7WUFDdEIsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSztZQUN4QixPQUFPLEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxnQkFBZ0IsQ0FBQztZQUN4RCxTQUFTLEVBQUUsQ0FBQyxHQUFHLENBQUM7U0FDakIsQ0FBQyxDQUNILENBQUM7UUFFRixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFTyxrQkFBa0IsQ0FDeEIsS0FBZ0U7UUFFaEUsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNWLE9BQU87U0FDUjtRQUVELE9BQU87WUFDTCxLQUFLLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUM7WUFDOUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDO1lBQzlCLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQztZQUNwQyxpQkFBaUIsRUFBRSxLQUFLLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDO1NBQ3ZELENBQUM7SUFDSixDQUFDO0NBQ0Y7QUEvWkQsb0JBK1pDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcbmltcG9ydCAqIGFzIGlhbSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWlhbVwiO1xuaW1wb3J0ICogYXMgY29nbml0byBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWNvZ25pdG9cIjtcblxuaW1wb3J0IHsgQXBwIH0gZnJvbSBcIi4vQXBwXCI7XG5pbXBvcnQgeyBTdGFjayB9IGZyb20gXCIuL1N0YWNrXCI7XG5pbXBvcnQgeyBnZXRGdW5jdGlvblJlZiwgU1NUQ29uc3RydWN0LCBpc0NES0NvbnN0cnVjdCB9IGZyb20gXCIuL0NvbnN0cnVjdFwiO1xuaW1wb3J0IHsgRnVuY3Rpb24gYXMgRm4sIEZ1bmN0aW9uUHJvcHMsIEZ1bmN0aW9uRGVmaW5pdGlvbiB9IGZyb20gXCIuL0Z1bmN0aW9uXCI7XG5pbXBvcnQgeyBQZXJtaXNzaW9ucywgYXR0YWNoUGVybWlzc2lvbnNUb1JvbGUgfSBmcm9tIFwiLi91dGlsL3Blcm1pc3Npb25cIjtcblxuY29uc3QgQXV0aFVzZXJQb29sVHJpZ2dlck9wZXJhdGlvbk1hcHBpbmcgPSB7XG4gIGNyZWF0ZUF1dGhDaGFsbGVuZ2U6IGNvZ25pdG8uVXNlclBvb2xPcGVyYXRpb24uQ1JFQVRFX0FVVEhfQ0hBTExFTkdFLFxuICBjdXN0b21FbWFpbFNlbmRlcjogY29nbml0by5Vc2VyUG9vbE9wZXJhdGlvbi5DVVNUT01fRU1BSUxfU0VOREVSLFxuICBjdXN0b21NZXNzYWdlOiBjb2duaXRvLlVzZXJQb29sT3BlcmF0aW9uLkNVU1RPTV9NRVNTQUdFLFxuICBjdXN0b21TbXNTZW5kZXI6IGNvZ25pdG8uVXNlclBvb2xPcGVyYXRpb24uQ1VTVE9NX1NNU19TRU5ERVIsXG4gIGRlZmluZUF1dGhDaGFsbGVuZ2U6IGNvZ25pdG8uVXNlclBvb2xPcGVyYXRpb24uREVGSU5FX0FVVEhfQ0hBTExFTkdFLFxuICBwb3N0QXV0aGVudGljYXRpb246IGNvZ25pdG8uVXNlclBvb2xPcGVyYXRpb24uUE9TVF9BVVRIRU5USUNBVElPTixcbiAgcG9zdENvbmZpcm1hdGlvbjogY29nbml0by5Vc2VyUG9vbE9wZXJhdGlvbi5QT1NUX0NPTkZJUk1BVElPTixcbiAgcHJlQXV0aGVudGljYXRpb246IGNvZ25pdG8uVXNlclBvb2xPcGVyYXRpb24uUFJFX0FVVEhFTlRJQ0FUSU9OLFxuICBwcmVTaWduVXA6IGNvZ25pdG8uVXNlclBvb2xPcGVyYXRpb24uUFJFX1NJR05fVVAsXG4gIHByZVRva2VuR2VuZXJhdGlvbjogY29nbml0by5Vc2VyUG9vbE9wZXJhdGlvbi5QUkVfVE9LRU5fR0VORVJBVElPTixcbiAgdXNlck1pZ3JhdGlvbjogY29nbml0by5Vc2VyUG9vbE9wZXJhdGlvbi5VU0VSX01JR1JBVElPTixcbiAgdmVyaWZ5QXV0aENoYWxsZW5nZVJlc3BvbnNlOlxuICAgIGNvZ25pdG8uVXNlclBvb2xPcGVyYXRpb24uVkVSSUZZX0FVVEhfQ0hBTExFTkdFX1JFU1BPTlNFLFxufTtcblxuZXhwb3J0IGludGVyZmFjZSBBdXRoVXNlclBvb2xUcmlnZ2VycyB7XG4gIGNyZWF0ZUF1dGhDaGFsbGVuZ2U/OiBGdW5jdGlvbkRlZmluaXRpb247XG4gIGN1c3RvbUVtYWlsU2VuZGVyPzogRnVuY3Rpb25EZWZpbml0aW9uO1xuICBjdXN0b21NZXNzYWdlPzogRnVuY3Rpb25EZWZpbml0aW9uO1xuICBjdXN0b21TbXNTZW5kZXI/OiBGdW5jdGlvbkRlZmluaXRpb247XG4gIGRlZmluZUF1dGhDaGFsbGVuZ2U/OiBGdW5jdGlvbkRlZmluaXRpb247XG4gIHBvc3RBdXRoZW50aWNhdGlvbj86IEZ1bmN0aW9uRGVmaW5pdGlvbjtcbiAgcG9zdENvbmZpcm1hdGlvbj86IEZ1bmN0aW9uRGVmaW5pdGlvbjtcbiAgcHJlQXV0aGVudGljYXRpb24/OiBGdW5jdGlvbkRlZmluaXRpb247XG4gIHByZVNpZ25VcD86IEZ1bmN0aW9uRGVmaW5pdGlvbjtcbiAgcHJlVG9rZW5HZW5lcmF0aW9uPzogRnVuY3Rpb25EZWZpbml0aW9uO1xuICB1c2VyTWlncmF0aW9uPzogRnVuY3Rpb25EZWZpbml0aW9uO1xuICB2ZXJpZnlBdXRoQ2hhbGxlbmdlUmVzcG9uc2U/OiBGdW5jdGlvbkRlZmluaXRpb247XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXV0aEF1dGgwUHJvcHMge1xuICBkb21haW46IHN0cmluZztcbiAgY2xpZW50SWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBdXRoQW1hem9uUHJvcHMge1xuICBhcHBJZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhBcHBsZVByb3BzIHtcbiAgc2VydmljZXNJZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhGYWNlYm9va1Byb3BzIHtcbiAgYXBwSWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBdXRoR29vZ2xlUHJvcHMge1xuICBjbGllbnRJZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhUd2l0dGVyUHJvcHMge1xuICBjb25zdW1lcktleTogc3RyaW5nO1xuICBjb25zdW1lclNlY3JldDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhDZGtDZm5JZGVudGl0eVBvb2xQcm9wc1xuICBleHRlbmRzIE9taXQ8Y29nbml0by5DZm5JZGVudGl0eVBvb2xQcm9wcywgXCJhbGxvd1VuYXV0aGVudGljYXRlZElkZW50aXRpZXNcIj4ge1xuICBhbGxvd1VuYXV0aGVudGljYXRlZElkZW50aXRpZXM/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhDb2duaXRvSWRlbnRpdHlQb29sRmVkZXJhdGlvblByb3BzIHtcbiAgYXV0aDA/OiBBdXRoQXV0aDBQcm9wcztcbiAgYW1hem9uPzogQXV0aEFtYXpvblByb3BzO1xuICBhcHBsZT86IEF1dGhBcHBsZVByb3BzO1xuICBmYWNlYm9vaz86IEF1dGhGYWNlYm9va1Byb3BzO1xuICBnb29nbGU/OiBBdXRoR29vZ2xlUHJvcHM7XG4gIHR3aXR0ZXI/OiBBdXRoVHdpdHRlclByb3BzO1xuICBjZGs/OiB7XG4gICAgY2ZuSWRlbnRpdHlQb29sPzogQXV0aENka0NmbklkZW50aXR5UG9vbFByb3BzO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhQcm9wcyB7XG4gIGRlZmF1bHRzPzoge1xuICAgIC8qKlxuICAgICAqIFRoZSBkZWZhdWx0IGZ1bmN0aW9uIHByb3BzIHRvIGJlIGFwcGxpZWQgdG8gYWxsIHRoZSB0cmlnZ2VycyBpbiB0aGUgVXNlclBvb2wuIFRoZSBgZW52aXJvbm1lbnRgLCBgcGVybWlzc2lvbnNgIGFuZCBgbGF5ZXJzYCBwcm9wZXJ0aWVzIHdpbGwgYmUgbWVyZ2VkIHdpdGggcGVyIHJvdXRlIGRlZmluaXRpb25zIGlmIHRoZXkgYXJlIGRlZmluZWQuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogYGBganNcbiAgICAgKiBuZXcgQXV0aChzdGFjaywgXCJBdXRoXCIsIHtcbiAgICAgKiAgIGRlZmF1bHRzOiB7XG4gICAgICogICAgIGZ1bmN0aW9uOiB7XG4gICAgICogICAgICAgdGltZW91dDogMjAsXG4gICAgICogICAgICAgZW52aXJvbm1lbnQ6IHsgdG9waWNOYW1lOiB0b3BpYy50b3BpY05hbWUgfSxcbiAgICAgKiAgICAgICBwZXJtaXNzaW9uczogW3RvcGljXSxcbiAgICAgKiAgICAgfVxuICAgICAqICAgfSxcbiAgICAgKiB9KTtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBmdW5jdGlvbj86IEZ1bmN0aW9uUHJvcHM7XG4gIH07XG4gIC8qKlxuICAgKiBDb25maWd1cmUgdGhlIGRpZmZlcmVudCB3YXlzIGEgdXNlciBjYW4gc2lnbiBpbiB0byBvdXIgYXBwbGljYXRpb24gZm9yIG91ciBVc2VyIFBvb2wuIEZvciBleGFtcGxlLCB5b3UgbWlnaHQgd2FudCBhIHVzZXIgdG8gYmUgYWJsZSB0byBzaWduIGluIHdpdGggdGhlaXIgZW1haWwgb3IgdXNlcm5hbWUuIE9yIHdpdGggdGhlaXIgcGhvbmUgbnVtYmVyLlxuICAgKiBcbiAgICogOjo6Y2F1dGlvblxuICAgKiBZb3UgY2Fubm90IGNoYW5nZSB0aGUgbG9naW4gcHJvcGVydHkgb25jZSB0aGUgVXNlciBQb29sIGhhcyBiZWVuIGNyZWF0ZWQuXG4gICAqIDo6OlxuICAgKiBcbiAgICogQGRlZmF1bHQgYFtcInVzZXJuYW1lXCJdYFxuICAgKi9cbiAgbG9naW4/OiAoXCJlbWFpbFwiIHwgXCJwaG9uZVwiIHwgXCJ1c2VybmFtZVwiIHwgXCJwcmVmZXJyZWRVc2VybmFtZVwiKVtdO1xuICAvKipcbiAgICogQ29uZmlndXJlIHRyaWdnZXJzIGZvciB0aGlzIFVzZXIgUG9vbFxuICAgKiBAZGVmYXVsdCBObyB0cmlnZ2Vyc1xuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBgYGBqc1xuICAgKiBuZXcgQXV0aChzdGFjaywgXCJBdXRoXCIsIHtcbiAgICogICB0cmlnZ2Vyczoge1xuICAgKiAgICAgcHJlQXV0aGVudGljYXRpb246IFwic3JjL3ByZUF1dGhlbnRpY2F0aW9uLm1haW5cIixcbiAgICogICAgIHBvc3RBdXRoZW50aWNhdGlvbjogXCJzcmMvcG9zdEF1dGhlbnRpY2F0aW9uLm1haW5cIixcbiAgICogICB9LFxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqL1xuICB0cmlnZ2Vycz86IEF1dGhVc2VyUG9vbFRyaWdnZXJzO1xuICAvKipcbiAgICogQ29uZmlndXJlIHRoZSBDb2duaXRvIElkZW50aXR5IFBvb2wgYW5kIGl0cyBhdXRoZW50aWNhdGlvbiBwcm92aWRlcnMuXG4gICAqIEBkZWZhdWx0IElkZW50aXR5IFBvb2wgY3JlYXRlZCB3aXRoIHRoZSBVc2VyIFBvb2wgYXMgdGhlIGF1dGhlbnRpY2F0aW9uIHByb3ZpZGVyXG4gICAqL1xuICBpZGVudGl0eVBvb2xGZWRlcmF0aW9uPzogYm9vbGVhbiB8IEF1dGhDb2duaXRvSWRlbnRpdHlQb29sRmVkZXJhdGlvblByb3BzO1xuICBjZGs/OiB7XG4gICAgLyoqXG4gICAgICogVGhpcyBhbGxvd3MgeW91IHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHNldHRpbmdzIHRoaXMgY29uc3RydWN0IHVzZXMgaW50ZXJuYWxseSB0byBjcmVhdGUgdGhlIFVzZXIgUG9vbC5cbiAgICAgKi9cbiAgICB1c2VyUG9vbD86IGNvZ25pdG8uVXNlclBvb2xQcm9wcyB8IGNvZ25pdG8uSVVzZXJQb29sO1xuICAgIC8qKlxuICAgICAqIFRoaXMgYWxsb3dzIHlvdSB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBzZXR0aW5ncyB0aGlzIGNvbnN0cnVjdCB1c2VzIGludGVybmFsbHkgdG8gY3JlYXRlIHRoZSBVc2VyIFBvb2wgY2xpZW50LlxuICAgICAqL1xuICAgIHVzZXJQb29sQ2xpZW50PzogY29nbml0by5Vc2VyUG9vbENsaWVudE9wdGlvbnMgfCBjb2duaXRvLklVc2VyUG9vbENsaWVudDtcbiAgfTtcbn1cblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBDb25zdHJ1Y3Rcbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4vKipcbiAqIFRoZSBgQXV0aGAgY29uc3RydWN0IGlzIGEgaGlnaGVyIGxldmVsIENESyBjb25zdHJ1Y3QgdGhhdCBtYWtlcyBpdCBlYXN5IHRvIGNvbmZpZ3VyZSBhIFtDb2duaXRvIFVzZXIgUG9vbF0oaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2NvZ25pdG8vbGF0ZXN0L2RldmVsb3Blcmd1aWRlL2NvZ25pdG8tdXNlci1pZGVudGl0eS1wb29scy5odG1sKSBhbmQgW0NvZ25pdG8gSWRlbnRpdHkgUG9vbF0oaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2NvZ25pdG8vbGF0ZXN0L2RldmVsb3Blcmd1aWRlL2lkZW50aXR5LXBvb2xzLmh0bWwpLiBBbHNvLCBhbGxvd3Mgc2V0dGluZyB1cCBBdXRoMCwgRmFjZWJvb2ssIEdvb2dsZSwgVHdpdHRlciwgQXBwbGUsIGFuZCBBbWF6b24gYXMgYXV0aGVudGljYXRpb24gcHJvdmlkZXJzLlxuICovXG5leHBvcnQgY2xhc3MgQXV0aCBleHRlbmRzIENvbnN0cnVjdCBpbXBsZW1lbnRzIFNTVENvbnN0cnVjdCB7XG4gIHB1YmxpYyByZWFkb25seSBjZGs6IHtcbiAgICB1c2VyUG9vbDogY29nbml0by5JVXNlclBvb2w7XG4gICAgdXNlclBvb2xDbGllbnQ6IGNvZ25pdG8uSVVzZXJQb29sQ2xpZW50O1xuICAgIGNmbklkZW50aXR5UG9vbD86IGNvZ25pdG8uQ2ZuSWRlbnRpdHlQb29sO1xuICAgIGF1dGhSb2xlOiBpYW0uUm9sZTtcbiAgICB1bmF1dGhSb2xlOiBpYW0uUm9sZTtcbiAgfTtcbiAgcHJpdmF0ZSBmdW5jdGlvbnM6IHsgW2tleTogc3RyaW5nXTogRm4gfTtcbiAgcHJpdmF0ZSBwZXJtaXNzaW9uc0F0dGFjaGVkRm9yQWxsVHJpZ2dlcnM6IFBlcm1pc3Npb25zW107XG4gIHByaXZhdGUgcHJvcHM6IEF1dGhQcm9wcztcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wcz86IEF1dGhQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICB0aGlzLnByb3BzID0gcHJvcHMgfHwge307XG4gICAgdGhpcy5jZGsgPSB7fSBhcyBhbnk7XG4gICAgdGhpcy5mdW5jdGlvbnMgPSB7fTtcbiAgICB0aGlzLnBlcm1pc3Npb25zQXR0YWNoZWRGb3JBbGxUcmlnZ2VycyA9IFtdO1xuXG4gICAgdGhpcy5jcmVhdGVVc2VyUG9vbCgpO1xuICAgIHRoaXMuY3JlYXRlVXNlclBvb2xDbGllbnQoKTtcbiAgICB0aGlzLmFkZFRyaWdnZXJzKCk7XG4gICAgdGhpcy5jcmVhdGVJZGVudGl0eVBvb2woKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgaWQgb2YgdGhlIGludGVybmFsbHkgY3JlYXRlZCBDb2duaXRvIFVzZXIgUG9vbC5cbiAgICovXG4gIHB1YmxpYyBnZXQgdXNlclBvb2xJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmNkay51c2VyUG9vbC51c2VyUG9vbElkO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIGludGVybmFsbHkgY3JlYXRlZCBDb2duaXRvIFVzZXIgUG9vbC5cbiAgICovXG4gIHB1YmxpYyBnZXQgdXNlclBvb2xBcm4oKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5jZGsudXNlclBvb2wudXNlclBvb2xBcm47XG4gIH1cblxuICAvKipcbiAgICogVGhlIGlkIG9mIHRoZSBpbnRlcm5hbGx5IGNyZWF0ZWQgQ29nbml0byBVc2VyIFBvb2wgY2xpZW50LlxuICAgKi9cbiAgcHVibGljIGdldCB1c2VyUG9vbENsaWVudElkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY2RrLnVzZXJQb29sQ2xpZW50LnVzZXJQb29sQ2xpZW50SWQ7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGlkIG9mIHRoZSBpbnRlcm5hbGx5IGNyZWF0ZWQgYElkZW50aXR5UG9vbGAgaW5zdGFuY2UuXG4gICAqL1xuICBwdWJsaWMgZ2V0IGNvZ25pdG9JZGVudGl0eVBvb2xJZCgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmNkay5jZm5JZGVudGl0eVBvb2w/LnJlZjtcbiAgfVxuXG4gIHB1YmxpYyBhdHRhY2hQZXJtaXNzaW9uc0ZvckF1dGhVc2VycyhwZXJtaXNzaW9uczogUGVybWlzc2lvbnMpOiB2b2lkIHtcbiAgICBhdHRhY2hQZXJtaXNzaW9uc1RvUm9sZSh0aGlzLmNkay5hdXRoUm9sZSwgcGVybWlzc2lvbnMpO1xuICB9XG5cbiAgcHVibGljIGF0dGFjaFBlcm1pc3Npb25zRm9yVW5hdXRoVXNlcnMocGVybWlzc2lvbnM6IFBlcm1pc3Npb25zKTogdm9pZCB7XG4gICAgYXR0YWNoUGVybWlzc2lvbnNUb1JvbGUodGhpcy5jZGsudW5hdXRoUm9sZSwgcGVybWlzc2lvbnMpO1xuICB9XG5cbiAgcHVibGljIGF0dGFjaFBlcm1pc3Npb25zRm9yVHJpZ2dlcnMocGVybWlzc2lvbnM6IFBlcm1pc3Npb25zKTogdm9pZCB7XG4gICAgT2JqZWN0LnZhbHVlcyh0aGlzLmZ1bmN0aW9ucykuZm9yRWFjaCgoZm4pID0+XG4gICAgICBmbi5hdHRhY2hQZXJtaXNzaW9ucyhwZXJtaXNzaW9ucylcbiAgICApO1xuICAgIHRoaXMucGVybWlzc2lvbnNBdHRhY2hlZEZvckFsbFRyaWdnZXJzLnB1c2gocGVybWlzc2lvbnMpO1xuICB9XG5cbiAgcHVibGljIGF0dGFjaFBlcm1pc3Npb25zRm9yVHJpZ2dlcihcbiAgICB0cmlnZ2VyS2V5OiBrZXlvZiBBdXRoVXNlclBvb2xUcmlnZ2VycyxcbiAgICBwZXJtaXNzaW9uczogUGVybWlzc2lvbnNcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgZm4gPSB0aGlzLmdldEZ1bmN0aW9uKHRyaWdnZXJLZXkpO1xuICAgIGlmICghZm4pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEZhaWxlZCB0byBhdHRhY2ggcGVybWlzc2lvbnMuIFRyaWdnZXIgXCIke3RyaWdnZXJLZXl9XCIgZG9lcyBub3QgZXhpc3QuYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBmbi5hdHRhY2hQZXJtaXNzaW9ucyhwZXJtaXNzaW9ucyk7XG4gIH1cblxuICBwdWJsaWMgZ2V0RnVuY3Rpb24odHJpZ2dlcktleToga2V5b2YgQXV0aFVzZXJQb29sVHJpZ2dlcnMpOiBGbiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuZnVuY3Rpb25zW3RyaWdnZXJLZXldO1xuICB9XG5cbiAgcHVibGljIGdldENvbnN0cnVjdE1ldGFkYXRhKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIkF1dGhcIiBhcyBjb25zdCxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgaWRlbnRpdHlQb29sSWQ6IHRoaXMuY2RrLmNmbklkZW50aXR5UG9vbD8ucmVmLFxuICAgICAgICB1c2VyUG9vbElkOiB0aGlzLmNkay51c2VyUG9vbC51c2VyUG9vbElkLFxuICAgICAgICB0cmlnZ2VyczogT2JqZWN0LmVudHJpZXModGhpcy5mdW5jdGlvbnMpLm1hcCgoW25hbWUsIGZ1bl0pID0+ICh7XG4gICAgICAgICAgbmFtZSxcbiAgICAgICAgICBmbjogZ2V0RnVuY3Rpb25SZWYoZnVuKSxcbiAgICAgICAgfSkpLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVVc2VyUG9vbCgpOiB2b2lkIHtcbiAgICBjb25zdCB7IGxvZ2luLCBjZGsgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCBhcHAgPSB0aGlzLm5vZGUucm9vdCBhcyBBcHA7XG5cbiAgICBpZiAoaXNDREtDb25zdHJ1Y3QoY2RrPy51c2VyUG9vbCkpIHtcbiAgICAgIHRoaXMuY2RrLnVzZXJQb29sID0gY2RrPy51c2VyUG9vbCBhcyBjb2duaXRvLlVzZXJQb29sO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBjb2duaXRvVXNlclBvb2xQcm9wcyA9IChjZGs/LnVzZXJQb29sIHx8XG4gICAgICAgIHt9KSBhcyBjb2duaXRvLlVzZXJQb29sUHJvcHM7XG4gICAgICAvLyB2YWxpZGF0ZSBgbGFtYmRhVHJpZ2dlcnNgIGlzIG5vdCBzcGVjaWZpZWRcbiAgICAgIGlmIChjb2duaXRvVXNlclBvb2xQcm9wcy5sYW1iZGFUcmlnZ2Vycykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYENhbm5vdCBjb25maWd1cmUgdGhlIFwiY2RrLnVzZXJQb29sLmxhbWJkYVRyaWdnZXJzXCIgaW4gdGhlIEF1dGggY29uc3RydWN0LiBVc2UgdGhlIFwidHJpZ2dlcnNcIiBpbnN0ZWFkLmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIC8vIHZhbGlkYXRlIGBjZGsudXNlclBvb2xDbGllbnRgIGlzIG5vdCBpbXBvcnRlZFxuICAgICAgaWYgKGlzQ0RLQ29uc3RydWN0KGNkaz8udXNlclBvb2xDbGllbnQpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgQ2Fubm90IGltcG9ydCB0aGUgXCJ1c2VyUG9vbENsaWVudFwiIHdoZW4gdGhlIFwidXNlclBvb2xcIiBpcyBub3QgaW1wb3J0ZWQuYFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmNkay51c2VyUG9vbCA9IG5ldyBjb2duaXRvLlVzZXJQb29sKHRoaXMsIFwiVXNlclBvb2xcIiwge1xuICAgICAgICB1c2VyUG9vbE5hbWU6IGFwcC5sb2dpY2FsUHJlZml4ZWROYW1lKHRoaXMubm9kZS5pZCksXG4gICAgICAgIHNlbGZTaWduVXBFbmFibGVkOiB0cnVlLFxuICAgICAgICBzaWduSW5DYXNlU2Vuc2l0aXZlOiBmYWxzZSxcbiAgICAgICAgc2lnbkluQWxpYXNlczogdGhpcy5idWlsZFNpZ25JbkFsaWFzZXMobG9naW4pLFxuICAgICAgICAuLi5jb2duaXRvVXNlclBvb2xQcm9wcyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlVXNlclBvb2xDbGllbnQoKTogdm9pZCB7XG4gICAgY29uc3QgeyBjZGsgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoaXNDREtDb25zdHJ1Y3QoY2RrPy51c2VyUG9vbENsaWVudCkpIHtcbiAgICAgIHRoaXMuY2RrLnVzZXJQb29sQ2xpZW50ID0gY2RrPy51c2VyUG9vbENsaWVudCBhcyBjb2duaXRvLlVzZXJQb29sQ2xpZW50O1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBjbGllbnRQcm9wcyA9IChjZGs/LnVzZXJQb29sQ2xpZW50IHx8XG4gICAgICAgIHt9KSBhcyBjb2duaXRvLlVzZXJQb29sQ2xpZW50T3B0aW9ucztcbiAgICAgIHRoaXMuY2RrLnVzZXJQb29sQ2xpZW50ID0gbmV3IGNvZ25pdG8uVXNlclBvb2xDbGllbnQoXG4gICAgICAgIHRoaXMsXG4gICAgICAgIFwiVXNlclBvb2xDbGllbnRcIixcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJQb29sOiB0aGlzLmNkay51c2VyUG9vbCxcbiAgICAgICAgICAuLi5jbGllbnRQcm9wcyxcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUlkZW50aXR5UG9vbCgpOiB2b2lkIHtcbiAgICBjb25zdCB7IGlkZW50aXR5UG9vbEZlZGVyYXRpb24gfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoaWRlbnRpdHlQb29sRmVkZXJhdGlvbiA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBpZCA9IHRoaXMubm9kZS5pZDtcbiAgICBjb25zdCBhcHAgPSB0aGlzLm5vZGUucm9vdCBhcyBBcHA7XG4gICAgY29uc3QgY29nbml0b0lkZW50aXR5UHJvdmlkZXJzID0gW107XG4gICAgY29uc3Qgb3BlbklkQ29ubmVjdFByb3ZpZGVyQXJucyA9IFtdO1xuICAgIGNvbnN0IHN1cHBvcnRlZExvZ2luUHJvdmlkZXJzID0ge30gYXMgeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfTtcblxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gSGFuZGxlIENvZ25pdG8gSWRlbnRpdHkgUHJvdmlkZXJzIChpZS4gVXNlciBQb29sKVxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgY29uc3QgdXJsU3VmZml4ID0gU3RhY2sub2YodGhpcykudXJsU3VmZml4O1xuICAgIGNvZ25pdG9JZGVudGl0eVByb3ZpZGVycy5wdXNoKHtcbiAgICAgIHByb3ZpZGVyTmFtZTogYGNvZ25pdG8taWRwLiR7YXBwLnJlZ2lvbn0uJHt1cmxTdWZmaXh9LyR7dGhpcy5jZGsudXNlclBvb2wudXNlclBvb2xJZH1gLFxuICAgICAgY2xpZW50SWQ6IHRoaXMuY2RrLnVzZXJQb29sQ2xpZW50LnVzZXJQb29sQ2xpZW50SWQsXG4gICAgfSk7XG5cbiAgICBpZiAodHlwZW9mIGlkZW50aXR5UG9vbEZlZGVyYXRpb24gPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGNvbnN0IHsgYXV0aDAsIGFtYXpvbiwgYXBwbGUsIGZhY2Vib29rLCBnb29nbGUsIHR3aXR0ZXIgfSA9XG4gICAgICAgIGlkZW50aXR5UG9vbEZlZGVyYXRpb247XG5cbiAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgICAvLyBIYW5kbGUgT3BlbklkIENvbm5lY3QgUHJvdmlkZXJzIChpZS4gQXV0aDApXG4gICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgaWYgKGF1dGgwKSB7XG4gICAgICAgIGlmICghYXV0aDAuZG9tYWluKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEF1dGgwRG9tYWluOiBObyBBdXRoMCBkb21haW4gZGVmaW5lZCBmb3IgdGhlIFwiJHtpZH1cIiBBdXRoYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFhdXRoMC5jbGllbnRJZCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBBdXRoMENsaWVudElkOiBObyBBdXRoMCBjbGllbnRJZCBkZWZpbmVkIGZvciB0aGUgXCIke2lkfVwiIEF1dGhgXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwcm92aWRlciA9IG5ldyBpYW0uT3BlbklkQ29ubmVjdFByb3ZpZGVyKHRoaXMsIFwiQXV0aDBQcm92aWRlclwiLCB7XG4gICAgICAgICAgdXJsOiBhdXRoMC5kb21haW4uc3RhcnRzV2l0aChcImh0dHBzOi8vXCIpXG4gICAgICAgICAgICA/IGF1dGgwLmRvbWFpblxuICAgICAgICAgICAgOiBgaHR0cHM6Ly8ke2F1dGgwLmRvbWFpbn1gLFxuICAgICAgICAgIGNsaWVudElkczogW2F1dGgwLmNsaWVudElkXSxcbiAgICAgICAgfSk7XG4gICAgICAgIG9wZW5JZENvbm5lY3RQcm92aWRlckFybnMucHVzaChwcm92aWRlci5vcGVuSWRDb25uZWN0UHJvdmlkZXJBcm4pO1xuICAgICAgfVxuXG4gICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgLy8gSGFuZGxlIFNvY2lhbCBJZGVudGl0eSBQcm92aWRlcnNcbiAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgICBpZiAoYW1hem9uKSB7XG4gICAgICAgIGlmICghYW1hem9uLmFwcElkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEFtYXpvbkFwcElkOiBObyBBbWF6b24gYXBwSWQgZGVmaW5lZCBmb3IgdGhlIFwiJHtpZH1cIiBBdXRoYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgc3VwcG9ydGVkTG9naW5Qcm92aWRlcnNbXCJ3d3cuYW1hem9uLmNvbVwiXSA9IGFtYXpvbi5hcHBJZDtcbiAgICAgIH1cbiAgICAgIGlmIChmYWNlYm9vaykge1xuICAgICAgICBpZiAoIWZhY2Vib29rLmFwcElkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEZhY2Vib29rQXBwSWQ6IE5vIEZhY2Vib29rIGFwcElkIGRlZmluZWQgZm9yIHRoZSBcIiR7aWR9XCIgQXV0aGBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHN1cHBvcnRlZExvZ2luUHJvdmlkZXJzW1wiZ3JhcGguZmFjZWJvb2suY29tXCJdID0gZmFjZWJvb2suYXBwSWQ7XG4gICAgICB9XG4gICAgICBpZiAoZ29vZ2xlKSB7XG4gICAgICAgIGlmICghZ29vZ2xlLmNsaWVudElkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEdvb2dsZUNsaWVudElkOiBObyBHb29nbGUgYXBwSWQgZGVmaW5lZCBmb3IgdGhlIFwiJHtpZH1cIiBBdXRoYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgc3VwcG9ydGVkTG9naW5Qcm92aWRlcnNbXCJhY2NvdW50cy5nb29nbGUuY29tXCJdID0gZ29vZ2xlLmNsaWVudElkO1xuICAgICAgfVxuICAgICAgaWYgKHR3aXR0ZXIpIHtcbiAgICAgICAgaWYgKCF0d2l0dGVyLmNvbnN1bWVyS2V5KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYFR3aXR0ZXJDb25zdW1lcktleTogTm8gVHdpdHRlciBjb25zdW1lciBrZXkgZGVmaW5lZCBmb3IgdGhlIFwiJHtpZH1cIiBBdXRoYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0d2l0dGVyLmNvbnN1bWVyU2VjcmV0KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYFR3aXR0ZXJDb25zdW1lclNlY3JldDogTm8gVHdpdHRlciBjb25zdW1lciBzZWNyZXQgZGVmaW5lZCBmb3IgdGhlIFwiJHtpZH1cIiBBdXRoYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgc3VwcG9ydGVkTG9naW5Qcm92aWRlcnNbXG4gICAgICAgICAgXCJhcGkudHdpdHRlci5jb21cIlxuICAgICAgICBdID0gYCR7dHdpdHRlci5jb25zdW1lcktleX07JHt0d2l0dGVyLmNvbnN1bWVyU2VjcmV0fWA7XG4gICAgICB9XG4gICAgICBpZiAoYXBwbGUpIHtcbiAgICAgICAgaWYgKCFhcHBsZS5zZXJ2aWNlc0lkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEFwcGxlU2VydmljZXNJZDogTm8gQXBwbGUgc2VydmljZXNJZCBkZWZpbmVkIGZvciB0aGUgXCIke2lkfVwiIEF1dGhgXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBzdXBwb3J0ZWRMb2dpblByb3ZpZGVyc1tcImFwcGxlaWQuYXBwbGUuY29tXCJdID0gYXBwbGUuc2VydmljZXNJZDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgQ29nbml0byBJZGVudGl0eSBQb29sXG4gICAgY29uc3QgaWRlbnRpdHlQb29sUHJvcHMgPVxuICAgICAgdHlwZW9mIGlkZW50aXR5UG9vbEZlZGVyYXRpb24gPT09IFwib2JqZWN0XCJcbiAgICAgICAgPyBpZGVudGl0eVBvb2xGZWRlcmF0aW9uLmNkaz8uY2ZuSWRlbnRpdHlQb29sIHx8IHt9XG4gICAgICAgIDoge307XG4gICAgdGhpcy5jZGsuY2ZuSWRlbnRpdHlQb29sID0gbmV3IGNvZ25pdG8uQ2ZuSWRlbnRpdHlQb29sKFxuICAgICAgdGhpcyxcbiAgICAgIFwiSWRlbnRpdHlQb29sXCIsXG4gICAgICB7XG4gICAgICAgIGlkZW50aXR5UG9vbE5hbWU6IGFwcC5sb2dpY2FsUHJlZml4ZWROYW1lKGlkKSxcbiAgICAgICAgYWxsb3dVbmF1dGhlbnRpY2F0ZWRJZGVudGl0aWVzOiB0cnVlLFxuICAgICAgICBjb2duaXRvSWRlbnRpdHlQcm92aWRlcnMsXG4gICAgICAgIHN1cHBvcnRlZExvZ2luUHJvdmlkZXJzLFxuICAgICAgICBvcGVuSWRDb25uZWN0UHJvdmlkZXJBcm5zLFxuICAgICAgICAuLi5pZGVudGl0eVBvb2xQcm9wcyxcbiAgICAgIH1cbiAgICApO1xuICAgIHRoaXMuY2RrLmF1dGhSb2xlID0gdGhpcy5jcmVhdGVBdXRoUm9sZSh0aGlzLmNkay5jZm5JZGVudGl0eVBvb2wpO1xuICAgIHRoaXMuY2RrLnVuYXV0aFJvbGUgPSB0aGlzLmNyZWF0ZVVuYXV0aFJvbGUodGhpcy5jZGsuY2ZuSWRlbnRpdHlQb29sKTtcblxuICAgIC8vIEF0dGFjaCByb2xlcyB0byBJZGVudGl0eSBQb29sXG4gICAgbmV3IGNvZ25pdG8uQ2ZuSWRlbnRpdHlQb29sUm9sZUF0dGFjaG1lbnQoXG4gICAgICB0aGlzLFxuICAgICAgXCJJZGVudGl0eVBvb2xSb2xlQXR0YWNobWVudFwiLFxuICAgICAge1xuICAgICAgICBpZGVudGl0eVBvb2xJZDogdGhpcy5jZGsuY2ZuSWRlbnRpdHlQb29sLnJlZixcbiAgICAgICAgcm9sZXM6IHtcbiAgICAgICAgICBhdXRoZW50aWNhdGVkOiB0aGlzLmNkay5hdXRoUm9sZS5yb2xlQXJuLFxuICAgICAgICAgIHVuYXV0aGVudGljYXRlZDogdGhpcy5jZGsudW5hdXRoUm9sZS5yb2xlQXJuLFxuICAgICAgICB9LFxuICAgICAgfVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFkZFRyaWdnZXJzKCk6IHZvaWQge1xuICAgIGNvbnN0IHsgdHJpZ2dlcnMsIGRlZmF1bHRzIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKCF0cmlnZ2VycyB8fCBPYmplY3Qua2V5cyh0cmlnZ2VycykubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgY29nbml0byB1c2VyIHBvb2wgaXMgbm90IGltcG9ydGVkXG4gICAgLy8gaWUuIGltcG9ydGVkIElVc2VyUG9vbCBkb2VzIG5vdCBoYXZlIHRoZSBcImFkZFRyaWdnZXJcIiBmdW5jdGlvblxuICAgIGlmICghKHRoaXMuY2RrLnVzZXJQb29sIGFzIGNvZ25pdG8uVXNlclBvb2wpLmFkZFRyaWdnZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGFkZCB0cmlnZ2VycyB3aGVuIHRoZSBcInVzZXJQb29sXCIgaXMgaW1wb3J0ZWQuYCk7XG4gICAgfVxuXG4gICAgT2JqZWN0LmVudHJpZXModHJpZ2dlcnMpLmZvckVhY2goKFt0cmlnZ2VyS2V5LCB0cmlnZ2VyVmFsdWVdKSA9PlxuICAgICAgdGhpcy5hZGRUcmlnZ2VyKFxuICAgICAgICB0aGlzLFxuICAgICAgICB0cmlnZ2VyS2V5IGFzIGtleW9mIEF1dGhVc2VyUG9vbFRyaWdnZXJzLFxuICAgICAgICB0cmlnZ2VyVmFsdWUsXG4gICAgICAgIGRlZmF1bHRzPy5mdW5jdGlvblxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFkZFRyaWdnZXIoXG4gICAgc2NvcGU6IENvbnN0cnVjdCxcbiAgICB0cmlnZ2VyS2V5OiBrZXlvZiBBdXRoVXNlclBvb2xUcmlnZ2VycyxcbiAgICB0cmlnZ2VyVmFsdWU6IEZ1bmN0aW9uRGVmaW5pdGlvbixcbiAgICBmdW5jdGlvblByb3BzPzogRnVuY3Rpb25Qcm9wc1xuICApOiBGbiB7XG4gICAgLy8gVmFsaWRhdGUgY29nbml0byB1c2VyIHBvb2wgaXMgZGVmaW5lZFxuICAgIGlmICghdGhpcy5jZGsudXNlclBvb2wpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYFRyaWdnZXJzIGNhbm5vdCBiZSBhZGRlZC4gTm8gQ29nbml0byBVc2VyUG9vbCBkZWZpbmVkIGZvciB0aGUgQXV0aCBjb25zdHJ1Y3QuYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgRnVuY3Rpb25cbiAgICBjb25zdCBsYW1iZGEgPSBGbi5mcm9tRGVmaW5pdGlvbihcbiAgICAgIHNjb3BlLFxuICAgICAgdHJpZ2dlcktleSxcbiAgICAgIHRyaWdnZXJWYWx1ZSxcbiAgICAgIGZ1bmN0aW9uUHJvcHMsXG4gICAgICBgVGhlIFwiZGVmYXVsdHMuZnVuY3Rpb25cIiBjYW5ub3QgYmUgYXBwbGllZCBpZiBhbiBpbnN0YW5jZSBvZiBhIEZ1bmN0aW9uIGNvbnN0cnVjdCBpcyBwYXNzZWQgaW4uIE1ha2Ugc3VyZSB0byBkZWZpbmUgYWxsIHRoZSB0cmlnZ2VycyB1c2luZyBGdW5jdGlvblByb3BzLCBzbyB0aGUgQXV0aCBjb25zdHJ1Y3QgY2FuIGFwcGx5IHRoZSBcImRlZmF1bHRzLmZ1bmN0aW9uXCIgdG8gdGhlbS5gXG4gICAgKTtcblxuICAgIC8vIENyZWF0ZSB0cmlnZ2VyXG4gICAgY29uc3Qgb3BlcmF0aW9uID0gQXV0aFVzZXJQb29sVHJpZ2dlck9wZXJhdGlvbk1hcHBpbmdbdHJpZ2dlcktleV07XG4gICAgKHRoaXMuY2RrLnVzZXJQb29sIGFzIGNvZ25pdG8uVXNlclBvb2wpLmFkZFRyaWdnZXIob3BlcmF0aW9uLCBsYW1iZGEpO1xuXG4gICAgLy8gU3RvcmUgZnVuY3Rpb25cbiAgICB0aGlzLmZ1bmN0aW9uc1t0cmlnZ2VyS2V5XSA9IGxhbWJkYTtcblxuICAgIHJldHVybiBsYW1iZGE7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUF1dGhSb2xlKGlkZW50aXR5UG9vbDogY29nbml0by5DZm5JZGVudGl0eVBvb2wpOiBpYW0uUm9sZSB7XG4gICAgY29uc3Qgcm9sZSA9IG5ldyBpYW0uUm9sZSh0aGlzLCBcIklkZW50aXR5UG9vbEF1dGhSb2xlXCIsIHtcbiAgICAgIGFzc3VtZWRCeTogbmV3IGlhbS5GZWRlcmF0ZWRQcmluY2lwYWwoXG4gICAgICAgIFwiY29nbml0by1pZGVudGl0eS5hbWF6b25hd3MuY29tXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBTdHJpbmdFcXVhbHM6IHtcbiAgICAgICAgICAgIFwiY29nbml0by1pZGVudGl0eS5hbWF6b25hd3MuY29tOmF1ZFwiOiBpZGVudGl0eVBvb2wucmVmLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJGb3JBbnlWYWx1ZTpTdHJpbmdMaWtlXCI6IHtcbiAgICAgICAgICAgIFwiY29nbml0by1pZGVudGl0eS5hbWF6b25hd3MuY29tOmFtclwiOiBcImF1dGhlbnRpY2F0ZWRcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBcInN0czpBc3N1bWVSb2xlV2l0aFdlYklkZW50aXR5XCJcbiAgICAgICksXG4gICAgfSk7XG5cbiAgICByb2xlLmFkZFRvUG9saWN5KFxuICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXG4gICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICBcIm1vYmlsZWFuYWx5dGljczpQdXRFdmVudHNcIixcbiAgICAgICAgICBcImNvZ25pdG8tc3luYzoqXCIsXG4gICAgICAgICAgXCJjb2duaXRvLWlkZW50aXR5OipcIixcbiAgICAgICAgXSxcbiAgICAgICAgcmVzb3VyY2VzOiBbXCIqXCJdLFxuICAgICAgfSlcbiAgICApO1xuXG4gICAgcmV0dXJuIHJvbGU7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVVuYXV0aFJvbGUoaWRlbnRpdHlQb29sOiBjb2duaXRvLkNmbklkZW50aXR5UG9vbCk6IGlhbS5Sb2xlIHtcbiAgICBjb25zdCByb2xlID0gbmV3IGlhbS5Sb2xlKHRoaXMsIFwiSWRlbnRpdHlQb29sVW5hdXRoUm9sZVwiLCB7XG4gICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uRmVkZXJhdGVkUHJpbmNpcGFsKFxuICAgICAgICBcImNvZ25pdG8taWRlbnRpdHkuYW1hem9uYXdzLmNvbVwiLFxuICAgICAgICB7XG4gICAgICAgICAgU3RyaW5nRXF1YWxzOiB7XG4gICAgICAgICAgICBcImNvZ25pdG8taWRlbnRpdHkuYW1hem9uYXdzLmNvbTphdWRcIjogaWRlbnRpdHlQb29sLnJlZixcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiRm9yQW55VmFsdWU6U3RyaW5nTGlrZVwiOiB7XG4gICAgICAgICAgICBcImNvZ25pdG8taWRlbnRpdHkuYW1hem9uYXdzLmNvbTphbXJcIjogXCJ1bmF1dGhlbnRpY2F0ZWRcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBcInN0czpBc3N1bWVSb2xlV2l0aFdlYklkZW50aXR5XCJcbiAgICAgICksXG4gICAgfSk7XG5cbiAgICByb2xlLmFkZFRvUG9saWN5KFxuICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXG4gICAgICAgIGFjdGlvbnM6IFtcIm1vYmlsZWFuYWx5dGljczpQdXRFdmVudHNcIiwgXCJjb2duaXRvLXN5bmM6KlwiXSxcbiAgICAgICAgcmVzb3VyY2VzOiBbXCIqXCJdLFxuICAgICAgfSlcbiAgICApO1xuXG4gICAgcmV0dXJuIHJvbGU7XG4gIH1cblxuICBwcml2YXRlIGJ1aWxkU2lnbkluQWxpYXNlcyhcbiAgICBsb2dpbj86IChcImVtYWlsXCIgfCBcInBob25lXCIgfCBcInVzZXJuYW1lXCIgfCBcInByZWZlcnJlZFVzZXJuYW1lXCIpW10sXG4gICk6IGNvZ25pdG8uU2lnbkluQWxpYXNlcyB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKCFsb2dpbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBlbWFpbDogbG9naW4uaW5jbHVkZXMoXCJlbWFpbFwiKSxcbiAgICAgIHBob25lOiBsb2dpbi5pbmNsdWRlcyhcInBob25lXCIpLFxuICAgICAgdXNlcm5hbWU6IGxvZ2luLmluY2x1ZGVzKFwidXNlcm5hbWVcIiksXG4gICAgICBwcmVmZXJyZWRVc2VybmFtZTogbG9naW4uaW5jbHVkZXMoXCJwcmVmZXJyZWRVc2VybmFtZVwiKSxcbiAgICB9O1xuICB9XG59XG4iXX0=