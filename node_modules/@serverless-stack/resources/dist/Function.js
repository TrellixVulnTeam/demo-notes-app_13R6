"use strict";
/* eslint-disable @typescript-eslint/ban-types */
// Note: disabling ban-type rule so we don't get an error referencing the class Function
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Function = void 0;
const path_1 = __importDefault(require("path"));
const fs = __importStar(require("fs-extra"));
const cdk = __importStar(require("aws-cdk-lib"));
const iam = __importStar(require("aws-cdk-lib/aws-iam"));
const lambda = __importStar(require("aws-cdk-lib/aws-lambda"));
const ssm = __importStar(require("aws-cdk-lib/aws-ssm"));
const Stack_1 = require("./Stack");
const size_1 = require("./util/size");
const duration_1 = require("./util/duration");
const permission_1 = require("./util/permission");
const core_1 = require("@serverless-stack/core");
const supportedRuntimes = [
    lambda.Runtime.NODEJS,
    lambda.Runtime.NODEJS_4_3,
    lambda.Runtime.NODEJS_6_10,
    lambda.Runtime.NODEJS_8_10,
    lambda.Runtime.NODEJS_10_X,
    lambda.Runtime.NODEJS_12_X,
    lambda.Runtime.NODEJS_14_X,
    lambda.Runtime.NODEJS_16_X,
    lambda.Runtime.PYTHON_2_7,
    lambda.Runtime.PYTHON_3_6,
    lambda.Runtime.PYTHON_3_7,
    lambda.Runtime.PYTHON_3_8,
    lambda.Runtime.PYTHON_3_9,
    lambda.Runtime.DOTNET_CORE_1,
    lambda.Runtime.DOTNET_CORE_2,
    lambda.Runtime.DOTNET_CORE_2_1,
    lambda.Runtime.DOTNET_CORE_3_1,
    lambda.Runtime.GO_1_X,
];
/**
 * A construct for a Lambda Function that allows you to [develop your it locally](live-lambda-development.md). Supports JS, TypeScript, Python, Golang, and C#. It also applies a couple of defaults:
 *
 * - Sets the default memory setting to 1024MB.
 * - Sets the default Lambda function timeout to 10 seconds.
 * - [Enables AWS X-Ray](https://docs.aws.amazon.com/lambda/latest/dg/nodejs-tracing.html) by default so you can trace your serverless applications.
 * - `AWS_NODEJS_CONNECTION_REUSE_ENABLED` is turned on. Meaning that the Lambda function will automatically reuse TCP connections when working with the AWS SDK. [Read more about this here](https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/node-reusing-connections.html).
 * - Sets the `IS_LOCAL` environment variable for the Lambda function when it is invoked locally through the `sst start` command.
 *
 * @example
 *
 * ### Creating a Function
 *
 * ```js
 * import { Function } from "@serverless-stack/resources";
 *
 * new Function(stack, "MySnsLambda", {
 *   handler: "src/sns/index.main",
 * });
 * ```
 */
class Function extends lambda.Function {
    constructor(scope, id, props) {
        const root = scope.node.root;
        const stack = Stack_1.Stack.of(scope);
        // Merge with app defaultFunctionProps
        // note: reverse order so later prop override earlier ones
        stack.defaultFunctionProps
            .slice()
            .reverse()
            .forEach((per) => {
            props = Function.mergeProps(per, props);
        });
        // Set defaults
        const functionName = props.functionName &&
            (typeof props.functionName === "string"
                ? props.functionName
                : props.functionName({ stack, functionProps: props }));
        const handler = props.handler;
        const timeout = Function.normalizeTimeout(props.timeout);
        const srcPath = Function.normalizeSrcPath(props.srcPath || ".");
        const runtime = Function.normalizeRuntime(props.runtime);
        const architecture = (() => {
            if (props.architecture === "arm_64")
                return lambda.Architecture.ARM_64;
            if (props.architecture === "x86_64")
                return lambda.Architecture.X86_64;
            return undefined;
        })();
        const memorySize = Function.normalizeMemorySize(props.memorySize);
        const diskSize = Function.normalizeDiskSize(props.diskSize);
        const tracing = lambda.Tracing[(props.tracing || "active").toUpperCase()];
        let bundle = props.bundle;
        const permissions = props.permissions;
        const isLiveDevEnabled = props.enableLiveDev === false ? false : true;
        // Validate handler
        if (!handler) {
            throw new Error(`No handler defined for the "${id}" Lambda function`);
        }
        // Validate input
        const isNodeRuntime = runtime.toString().startsWith("nodejs");
        const isPythonRuntime = runtime.toString().startsWith("python");
        if (isNodeRuntime) {
            bundle = bundle === undefined ? true : props.bundle;
            if (!bundle && srcPath === ".") {
                throw new Error(`Bundle cannot be disabled for the "${id}" function since the "srcPath" is set to the project root. Read more here â€” https://github.com/serverless-stack/serverless-stack/issues/78`);
            }
        }
        else if (isPythonRuntime) {
            bundle = bundle === undefined ? {} : props.bundle;
            if (srcPath === ".") {
                throw new Error(`Cannot set the "srcPath" to the project root for the "${id}" function.`);
            }
        }
        const localId = path_1.default.posix
            .join(scope.node.path, id)
            .replace(/\$/g, "-")
            .replace(/\//g, "-")
            .replace(/\./g, "-");
        // Handle local development (ie. sst start)
        // - set runtime to nodejs12.x for non-Node runtimes (b/c the stub is in Node)
        // - set retry to 0. When the debugger is disconnected, the Cron construct
        //   will still try to periodically invoke the Lambda, and the requests would
        //   fail and retry. So when launching `sst start`, a couple of retry requests
        //   from recent failed request will be received. And this behavior is confusing.
        if (isLiveDevEnabled &&
            root.local &&
            root.debugEndpoint &&
            root.debugBucketName &&
            root.debugBucketArn) {
            // If debugIncreaseTimeout is enabled:
            //   set timeout to 900s. This will give people more time to debug the function
            //   without timing out the request. Note API Gateway requests have a maximum
            //   timeout of 29s. In this case, the API will timeout, but the Lambda function
            //   will continue to run.
            let debugOverrideProps;
            if (root.debugIncreaseTimeout) {
                debugOverrideProps = {
                    timeout: cdk.Duration.seconds(900),
                };
            }
            if (root.debugBridge) {
                super(scope, id, Object.assign(Object.assign(Object.assign({}, props), { architecture, code: lambda.Code.fromAsset(path_1.default.resolve(__dirname, "../dist/bridge_client/")), handler: "handler", functionName, runtime: lambda.Runtime.GO_1_X, memorySize, ephemeralStorageSize: diskSize, timeout,
                    tracing, environment: Object.assign(Object.assign({}, (props.environment || {})), { SST_DEBUG_BRIDGE: root.debugBridge, SST_DEBUG_SRC_PATH: srcPath, SST_DEBUG_SRC_HANDLER: handler, SST_DEBUG_ENDPOINT: root.debugEndpoint }), layers: Function.buildLayers(scope, id, props) }), (debugOverrideProps || {})));
            }
            else {
                super(scope, id, Object.assign(Object.assign(Object.assign({}, props), { architecture, code: lambda.Code.fromAsset(path_1.default.resolve(__dirname, "../dist/stub.zip")), handler: "index.main", functionName, runtime: isNodeRuntime ? runtime : lambda.Runtime.NODEJS_12_X, memorySize, ephemeralStorageSize: diskSize, timeout,
                    tracing, environment: Object.assign(Object.assign({}, (props.environment || {})), { SST_DEBUG_SRC_PATH: srcPath, SST_DEBUG_SRC_HANDLER: handler, SST_DEBUG_ENDPOINT: root.debugEndpoint, SST_DEBUG_BUCKET_NAME: root.debugBucketName }), layers: Function.buildLayers(scope, id, props), retryAttempts: 0 }), (debugOverrideProps || {})));
            }
            core_1.State.Function.append(root.appPath, {
                id: localId,
                handler: handler,
                runtime: runtime.toString(),
                srcPath: srcPath,
                bundle: props.bundle,
            });
            this.addEnvironment("SST_FUNCTION_ID", localId);
            this.attachPermissions([
                new iam.PolicyStatement({
                    actions: ["s3:*"],
                    effect: iam.Effect.ALLOW,
                    resources: [root.debugBucketArn, `${root.debugBucketArn}/*`],
                }),
            ]);
        }
        // Handle remove (ie. sst remove)
        else if (root.skipBuild) {
            // Note: need to override runtime as CDK does not support inline code
            //       for some runtimes.
            super(scope, id, Object.assign(Object.assign({}, props), { architecture, code: lambda.Code.fromAsset(path_1.default.resolve(__dirname, "../assets/Function/placeholder-stub")), handler: "placeholder", functionName, runtime: lambda.Runtime.NODEJS_12_X, memorySize, ephemeralStorageSize: diskSize, timeout,
                tracing, environment: props.environment, layers: Function.buildLayers(scope, id, props) }));
        }
        // Handle build
        else {
            console.log("Building function", handler);
            const bundled = core_1.Runtime.Handler.bundle({
                id: localId,
                root: root.appPath,
                handler: handler,
                runtime: runtime.toString(),
                srcPath: srcPath,
                bundle: props.bundle,
            });
            // Python builder returns AssetCode instead of directory
            const code = (() => {
                if ("directory" in bundled) {
                    Function.copyFiles(bundle, srcPath, bundled.directory);
                    return lambda.AssetCode.fromAsset(bundled.directory);
                }
                return bundled.asset;
            })();
            super(scope, id, Object.assign(Object.assign({}, props), { architecture, code: code, handler: bundled.handler, functionName,
                runtime,
                memorySize, ephemeralStorageSize: diskSize, timeout,
                tracing, environment: props.environment, layers: Function.buildLayers(scope, id, props) }));
        }
        // Enable reusing connections with Keep-Alive for NodeJs Lambda function
        if (isNodeRuntime) {
            this.addEnvironment("AWS_NODEJS_CONNECTION_REUSE_ENABLED", "1", {
                removeInEdge: true,
            });
        }
        // Attach permissions
        if (permissions) {
            this.attachPermissions(permissions);
        }
        root.registerLambdaHandler({
            bundle: props.bundle,
            handler: handler,
            runtime: runtime.toString(),
            srcPath,
        });
        this._isLiveDevEnabled = isLiveDevEnabled;
        this.localId = localId;
    }
    /**
     * Attaches additional permissions to function
     *
     * @example
     * ```js {20}
     * fn.attachPermissions(["s3"]);
     * ```
     */
    attachPermissions(permissions) {
        if (this.role) {
            (0, permission_1.attachPermissionsToRole)(this.role, permissions);
        }
    }
    getConstructMetadata() {
        return {
            type: "Function",
            data: {
                localId: this.localId,
                arn: this.functionArn,
            },
        };
    }
    static buildLayers(scope, id, props) {
        return (props.layers || []).map((layer) => {
            if (typeof layer === "string") {
                return lambda.LayerVersion.fromLayerVersionArn(scope, `${id}${layer}`, layer);
            }
            return Function.handleImportedLayer(scope, layer);
        });
    }
    static normalizeMemorySize(memorySize) {
        if (typeof memorySize === "string") {
            return (0, size_1.toCdkSize)(memorySize).toMebibytes();
        }
        return memorySize || 1024;
    }
    static normalizeDiskSize(diskSize) {
        if (typeof diskSize === "string") {
            return (0, size_1.toCdkSize)(diskSize);
        }
        return cdk.Size.mebibytes(diskSize || 512);
    }
    static normalizeTimeout(timeout) {
        if (typeof timeout === "string") {
            return (0, duration_1.toCdkDuration)(timeout);
        }
        return cdk.Duration.seconds(timeout || 10);
    }
    static normalizeRuntime(runtime) {
        runtime = runtime || "nodejs14.x";
        const runtimeClass = supportedRuntimes.find((per) => per.toString() === runtime);
        if (!runtimeClass) {
            throw new Error(`The specified runtime is not supported for sst.Function. Only NodeJS, Python, Go, and .NET runtimes are currently supported.`);
        }
        return runtimeClass;
    }
    static normalizeSrcPath(srcPath) {
        return srcPath.replace(/\/+$/, "");
    }
    static copyFiles(bundle, srcPath, buildPath) {
        if (!bundle)
            return;
        if (typeof bundle === "boolean")
            return;
        if (!bundle.copyFiles)
            return;
        bundle.copyFiles.forEach((entry) => {
            const fromPath = path_1.default.join(srcPath, entry.from);
            if (!fs.existsSync(fromPath))
                throw new Error(`Tried to copy nonexistent file from "${path_1.default.resolve(fromPath)}" - check copyFiles entry "${entry.from}"`);
            const to = entry.to || entry.from;
            if (path_1.default.isAbsolute(to))
                throw new Error(`Copy destination path "${to}" must be relative`);
            const toPath = path_1.default.join(buildPath, to);
            fs.copySync(fromPath, toPath);
        });
    }
    static handleImportedLayer(scope, layer) {
        const layerStack = Stack_1.Stack.of(layer);
        const currentStack = Stack_1.Stack.of(scope);
        // Use layer directly if:
        // - layer is created in the current stack; OR
        // - layer is imported (ie. layerArn is a string)
        if (layerStack === currentStack ||
            !cdk.Token.isUnresolved(layer.layerVersionArn)) {
            return layer;
        }
        // layer is created from another stack
        else {
            // set stack dependency b/c layerStack need to create the SSM first
            currentStack.addDependency(layerStack);
            // store layer ARN in SSM in layer's stack
            const parameterId = `${layer.node.id}Arn-${layer.node.addr}`;
            const parameterName = `/layers/${layerStack.node.id}/${parameterId}`;
            const existingSsmParam = layerStack.node.tryFindChild(parameterId);
            if (!existingSsmParam) {
                new ssm.StringParameter(layerStack, parameterId, {
                    parameterName,
                    stringValue: layer.layerVersionArn,
                });
            }
            // import layer from SSM value
            const layerId = `I${layer.node.id}-${layer.node.addr}`;
            const existingLayer = scope.node.tryFindChild(layerId);
            if (existingLayer) {
                return existingLayer;
            }
            else {
                return lambda.LayerVersion.fromLayerVersionArn(scope, layerId, ssm.StringParameter.valueForStringParameter(scope, parameterName));
            }
        }
    }
    static isInlineDefinition(definition) {
        return typeof definition === "string" || definition instanceof Function;
    }
    static fromDefinition(scope, id, definition, inheritedProps, inheritErrorMessage) {
        if (typeof definition === "string") {
            return new Function(scope, id, Object.assign(Object.assign({}, (inheritedProps || {})), { handler: definition }));
        }
        else if (definition instanceof Function) {
            if (inheritedProps && Object.keys(inheritedProps).length > 0) {
                throw new Error(inheritErrorMessage ||
                    `Cannot inherit default props when a Function is provided`);
            }
            return definition;
        }
        else if (definition instanceof lambda.Function) {
            throw new Error(`Please use sst.Function instead of lambda.Function for the "${id}" Function.`);
        }
        else if (definition.handler !== undefined) {
            return new Function(scope, id, Function.mergeProps(inheritedProps, definition));
        }
        throw new Error(`Invalid function definition for the "${id}" Function`);
    }
    static mergeProps(baseProps, props) {
        // Merge environment
        const environment = Object.assign(Object.assign({}, ((baseProps === null || baseProps === void 0 ? void 0 : baseProps.environment) || {})), ((props === null || props === void 0 ? void 0 : props.environment) || {}));
        const environmentProp = Object.keys(environment).length === 0 ? {} : { environment };
        // Merge layers
        const layers = [...((baseProps === null || baseProps === void 0 ? void 0 : baseProps.layers) || []), ...((props === null || props === void 0 ? void 0 : props.layers) || [])];
        const layersProp = layers.length === 0 ? {} : { layers };
        // Merge permissions
        let permissionsProp;
        if ((baseProps === null || baseProps === void 0 ? void 0 : baseProps.permissions) === "*") {
            permissionsProp = { permissions: baseProps.permissions };
        }
        else if ((props === null || props === void 0 ? void 0 : props.permissions) === "*") {
            permissionsProp = { permissions: props.permissions };
        }
        else {
            const permissions = ((baseProps === null || baseProps === void 0 ? void 0 : baseProps.permissions) || []).concat((props === null || props === void 0 ? void 0 : props.permissions) || []);
            permissionsProp = permissions.length === 0 ? {} : { permissions };
        }
        return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({}, (baseProps || {})), (props || {})), layersProp), environmentProp), permissionsProp);
    }
}
exports.Function = Function;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRnVuY3Rpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvRnVuY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLGlEQUFpRDtBQUNqRCx3RkFBd0Y7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRXhGLGdEQUF3QjtBQUV4Qiw2Q0FBK0I7QUFFL0IsaURBQW1DO0FBQ25DLHlEQUEyQztBQUMzQywrREFBaUQ7QUFFakQseURBQTJDO0FBRzNDLG1DQUFnQztBQUNoQyxzQ0FBOEM7QUFDOUMsOENBQTBEO0FBRTFELGtEQUF5RTtBQUN6RSxpREFBd0Q7QUFHeEQsTUFBTSxpQkFBaUIsR0FBRztJQUN4QixNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU07SUFDckIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVO0lBQ3pCLE1BQU0sQ0FBQyxPQUFPLENBQUMsV0FBVztJQUMxQixNQUFNLENBQUMsT0FBTyxDQUFDLFdBQVc7SUFDMUIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXO0lBQzFCLE1BQU0sQ0FBQyxPQUFPLENBQUMsV0FBVztJQUMxQixNQUFNLENBQUMsT0FBTyxDQUFDLFdBQVc7SUFDMUIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXO0lBQzFCLE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBVTtJQUN6QixNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVU7SUFDekIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVO0lBQ3pCLE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBVTtJQUN6QixNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVU7SUFDekIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxhQUFhO0lBQzVCLE1BQU0sQ0FBQyxPQUFPLENBQUMsYUFBYTtJQUM1QixNQUFNLENBQUMsT0FBTyxDQUFDLGVBQWU7SUFDOUIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxlQUFlO0lBQzlCLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTTtDQUN0QixDQUFDO0FBOGRG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RSxDQUFDLENBQUMsQ0FBQyxFQUFFLFdBQVcsRUFBRSxDQUFDO1NBQ25FO1FBRUQsaUZBQ0ssQ0FBQyxTQUFTLElBQUksRUFBRSxDQUFDLEdBQ2pCLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQyxHQUNiLFVBQVUsR0FDVixlQUFlLEdBQ2YsZUFBZSxFQUNsQjtJQUNKLENBQUM7Q0FDRjtBQWhkRCw0QkFnZEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXR5cGVzICovXG4vLyBOb3RlOiBkaXNhYmxpbmcgYmFuLXR5cGUgcnVsZSBzbyB3ZSBkb24ndCBnZXQgYW4gZXJyb3IgcmVmZXJlbmNpbmcgdGhlIGNsYXNzIEZ1bmN0aW9uXG5cbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgKiBhcyBlc2J1aWxkIGZyb20gXCJlc2J1aWxkXCI7XG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnMtZXh0cmFcIjtcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSBcImF3cy1jZGstbGliXCI7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1pYW1cIjtcbmltcG9ydCAqIGFzIGxhbWJkYSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWxhbWJkYVwiO1xuaW1wb3J0ICogYXMgbGFtYmRhTm9kZSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWxhbWJkYS1ub2RlanNcIjtcbmltcG9ydCAqIGFzIHNzbSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLXNzbVwiO1xuXG5pbXBvcnQgeyBBcHAgfSBmcm9tIFwiLi9BcHBcIjtcbmltcG9ydCB7IFN0YWNrIH0gZnJvbSBcIi4vU3RhY2tcIjtcbmltcG9ydCB7IFNpemUsIHRvQ2RrU2l6ZSB9IGZyb20gXCIuL3V0aWwvc2l6ZVwiO1xuaW1wb3J0IHsgRHVyYXRpb24sIHRvQ2RrRHVyYXRpb24gfSBmcm9tIFwiLi91dGlsL2R1cmF0aW9uXCI7XG5pbXBvcnQgeyBTU1RDb25zdHJ1Y3QgfSBmcm9tIFwiLi9Db25zdHJ1Y3RcIjtcbmltcG9ydCB7IFBlcm1pc3Npb25zLCBhdHRhY2hQZXJtaXNzaW9uc1RvUm9sZSB9IGZyb20gXCIuL3V0aWwvcGVybWlzc2lvblwiO1xuaW1wb3J0IHsgU3RhdGUsIFJ1bnRpbWUgfSBmcm9tIFwiQHNlcnZlcmxlc3Mtc3RhY2svY29yZVwiO1xuaW1wb3J0IHsgQXJjaGl0ZWN0dXJlIH0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1sYW1iZGFcIjtcblxuY29uc3Qgc3VwcG9ydGVkUnVudGltZXMgPSBbXG4gIGxhbWJkYS5SdW50aW1lLk5PREVKUyxcbiAgbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzRfMyxcbiAgbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzZfMTAsXG4gIGxhbWJkYS5SdW50aW1lLk5PREVKU184XzEwLFxuICBsYW1iZGEuUnVudGltZS5OT0RFSlNfMTBfWCxcbiAgbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzEyX1gsXG4gIGxhbWJkYS5SdW50aW1lLk5PREVKU18xNF9YLFxuICBsYW1iZGEuUnVudGltZS5OT0RFSlNfMTZfWCxcbiAgbGFtYmRhLlJ1bnRpbWUuUFlUSE9OXzJfNyxcbiAgbGFtYmRhLlJ1bnRpbWUuUFlUSE9OXzNfNixcbiAgbGFtYmRhLlJ1bnRpbWUuUFlUSE9OXzNfNyxcbiAgbGFtYmRhLlJ1bnRpbWUuUFlUSE9OXzNfOCxcbiAgbGFtYmRhLlJ1bnRpbWUuUFlUSE9OXzNfOSxcbiAgbGFtYmRhLlJ1bnRpbWUuRE9UTkVUX0NPUkVfMSxcbiAgbGFtYmRhLlJ1bnRpbWUuRE9UTkVUX0NPUkVfMixcbiAgbGFtYmRhLlJ1bnRpbWUuRE9UTkVUX0NPUkVfMl8xLFxuICBsYW1iZGEuUnVudGltZS5ET1RORVRfQ09SRV8zXzEsXG4gIGxhbWJkYS5SdW50aW1lLkdPXzFfWCxcbl07XG5cbmV4cG9ydCB0eXBlIEZ1bmN0aW9uSW5saW5lRGVmaW5pdGlvbiA9IHN0cmluZyB8IEZ1bmN0aW9uO1xuZXhwb3J0IHR5cGUgRnVuY3Rpb25EZWZpbml0aW9uID0gc3RyaW5nIHwgRnVuY3Rpb24gfCBGdW5jdGlvblByb3BzO1xuXG5leHBvcnQgdHlwZSBSdW50aW1lID1cbiAgfCBcIm5vZGVqc1wiXG4gIHwgXCJub2RlanM0LjNcIlxuICB8IFwibm9kZWpzNi4xMFwiXG4gIHwgXCJub2RlanM4LjEwXCJcbiAgfCBcIm5vZGVqczEwLnhcIlxuICB8IFwibm9kZWpzMTIueFwiXG4gIHwgXCJub2RlanMxNC54XCJcbiAgfCBcIm5vZGVqczE2LnhcIlxuICB8IFwicHl0aG9uMi43XCJcbiAgfCBcInB5dGhvbjMuNlwiXG4gIHwgXCJweXRob24zLjdcIlxuICB8IFwicHl0aG9uMy44XCJcbiAgfCBcInB5dGhvbjMuOVwiXG4gIHwgXCJkb3RuZXRjb3JlMS4wXCJcbiAgfCBcImRvdG5ldGNvcmUyLjBcIlxuICB8IFwiZG90bmV0Y29yZTIuMVwiXG4gIHwgXCJkb3RuZXRjb3JlMy4xXCJcbiAgfCBcImdvMS54XCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRnVuY3Rpb25Qcm9wc1xuICBleHRlbmRzIE9taXQ8XG4gICAgbGFtYmRhLkZ1bmN0aW9uT3B0aW9ucyxcbiAgICB8IFwiZnVuY3Rpb25OYW1lXCJcbiAgICB8IFwibWVtb3J5U2l6ZVwiXG4gICAgfCBcInRpbWVvdXRcIlxuICAgIHwgXCJydW50aW1lXCJcbiAgICB8IFwidHJhY2luZ1wiXG4gICAgfCBcImxheWVyc1wiXG4gICAgfCBcImFyY2hpdGVjdHVyZVwiXG4gID4ge1xuICAvKipcbiAgICogVGhlIENQVSBhcmNoaXRlY3R1cmUgb2YgdGhlIGxhbWJkYSBmdW5jdGlvbi5cbiAgICpcbiAgICogQGRlZmF1bHQgXCJ4ODZfNjRcIlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBuZXcgRnVuY3Rpb24oc3RhY2ssIFwiRnVuY3Rpb25cIiwge1xuICAgKiAgIGFyY2hpdGVjdHVyZTogXCJhcm1fNjRcIixcbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICBhcmNoaXRlY3R1cmU/OiBMb3dlcmNhc2U8XG4gICAga2V5b2YgUGljazx0eXBlb2YgbGFtYmRhLkFyY2hpdGVjdHVyZSwgXCJBUk1fNjRcIiB8IFwiWDg2XzY0XCI+XG4gID47XG4gIC8qKlxuICAgKiBCeSBkZWZhdWx0LCB0aGUgbmFtZSBvZiB0aGUgZnVuY3Rpb24gaXMgYXV0by1nZW5lcmF0ZWQgYnkgQVdTLiBZb3UgY2FuIGNvbmZpZ3VyZSB0aGUgbmFtZSBieSBwcm92aWRpbmcgYSBzdHJpbmcuXG4gICAqXG4gICAqIEBkZWZhdWx0IEF1dG8tZ2VuZXJhdGVkIGZ1bmN0aW9uIG5hbWVcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkZ1bmN0aW9uXCIsIHtcbiAgICogICBmdW5jdGlvbk5hbWU6IFwibXktZnVuY3Rpb25cIixcbiAgICogfSlcbiAgICpgYGBcbiAgICovXG4gIGZ1bmN0aW9uTmFtZT86IHN0cmluZyB8ICgocHJvcHM6IEZ1bmN0aW9uTmFtZVByb3BzKSA9PiBzdHJpbmcpO1xuICAvKipcbiAgICogUGF0aCB0byB0aGUgZW50cnkgcG9pbnQgYW5kIGhhbmRsZXIgZnVuY3Rpb24uIE9mIHRoZSBmb3JtYXQ6XG4gICAqIGAvcGF0aC90by9maWxlLmZ1bmN0aW9uYC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkZ1bmN0aW9uXCIsIHtcbiAgICogICBoYW5kbGVyOiBcInNyYy9mdW5jdGlvbi5oYW5kbGVyXCIsXG4gICAqIH0pXG4gICAqYGBgXG4gICAqL1xuICBoYW5kbGVyPzogc3RyaW5nO1xuICAvKipcbiAgICogUm9vdCBkaXJlY3Rvcnkgb2YgdGhlIHByb2plY3QsIHR5cGljYWxseSB3aGVyZSBwYWNrYWdlLmpzb24gaXMgbG9jYXRlZC4gU2V0IGlmIHVzaW5nIGEgbW9ub3JlcG8gd2l0aCBtdWx0aXBsZSBzdWJwYWNrYWdlc1xuICAgKlxuICAgKiBAZGVmYXVsdCBEZWZhdWx0cyB0byB0aGUgc2FtZSBkaXJlY3RvcnkgYXMgc3N0Lmpzb25cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkZ1bmN0aW9uXCIsIHtcbiAgICogICBzcmNQYXRoOiBcInBhY2thZ2VzL2JhY2tlbmRcIixcbiAgICogICBoYW5kbGVyOiBcImZ1bmN0aW9uLmhhbmRsZXJcIixcbiAgICogfSlcbiAgICpgYGBcbiAgICovXG4gIHNyY1BhdGg/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgcnVudGltZSBlbnZpcm9ubWVudC4gT25seSBydW50aW1lcyBvZiB0aGUgTm9kZS5qcywgUHl0aG9uLCBHbywgYW5kIC5ORVQgKEMjIGFuZCBGIykgZmFtaWx5IGFyZSBzdXBwb3J0ZWQuXG4gICAqXG4gICAqIEBkZWZhdWx0IFwibm9kZWpzMTQueFwiXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIG5ldyBGdW5jdGlvbihzdGFjaywgXCJGdW5jdGlvblwiLCB7XG4gICAqICAgcnVudGltZTogXCJub2RlanMxNi54XCIsXG4gICAqIH0pXG4gICAqYGBgXG4gICAqL1xuICBydW50aW1lPzogUnVudGltZTtcbiAgLyoqXG4gICAqIFRoZSBhbW91bnQgb2YgZGlzayBzdG9yYWdlIGluIE1CIGFsbG9jYXRlZC5cbiAgICpcbiAgICogQGRlZmF1bHQgXCI1MTIgTUJcIlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBuZXcgRnVuY3Rpb24oc3RhY2ssIFwiRnVuY3Rpb25cIiwge1xuICAgKiAgIGRpc2tTaXplOiBcIjIgR0JcIixcbiAgICogfSlcbiAgICpgYGBcbiAgICovXG4gIGRpc2tTaXplPzogbnVtYmVyIHwgU2l6ZTtcbiAgLyoqXG4gICAqIFRoZSBhbW91bnQgb2YgbWVtb3J5IGluIE1CIGFsbG9jYXRlZC5cbiAgICpcbiAgICogQGRlZmF1bHQgXCIxIEdCXCJcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkZ1bmN0aW9uXCIsIHtcbiAgICogICBtZW1vcnlTaXplOiBcIjIgR0JcIixcbiAgICogfSlcbiAgICpgYGBcbiAgICovXG4gIG1lbW9yeVNpemU/OiBudW1iZXIgfCBTaXplO1xuICAvKipcbiAgICogVGhlIGV4ZWN1dGlvbiB0aW1lb3V0IGluIHNlY29uZHMuXG4gICAqXG4gICAqIEBkZWZhdWx0IFwiMTAgc2Vjb25kc1wiXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIG5ldyBGdW5jdGlvbihzdGFjaywgXCJGdW5jdGlvblwiLCB7XG4gICAqICAgdGltZW91dDogXCIzMCBzZWNvbmRzXCIsXG4gICAqIH0pXG4gICAqYGBgXG4gICAqL1xuICB0aW1lb3V0PzogbnVtYmVyIHwgRHVyYXRpb247XG4gIC8qKlxuICAgKiBFbmFibGUgQVdTIFgtUmF5IFRyYWNpbmcuXG4gICAqXG4gICAqIEBkZWZhdWx0IFwiYWN0aXZlXCJcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkZ1bmN0aW9uXCIsIHtcbiAgICogICB0cmFjaW5nOiBcInBhc3NfdGhyb3VnaFwiLFxuICAgKiB9KVxuICAgKmBgYFxuICAgKi9cbiAgdHJhY2luZz86IExvd2VyY2FzZTxrZXlvZiB0eXBlb2YgbGFtYmRhLlRyYWNpbmc+O1xuICAvKipcbiAgICogQ2FuIGJlIHVzZWQgdG8gZGlzYWJsZSBMaXZlIExhbWJkYSBEZXZlbG9wbWVudCB3aGVuIHVzaW5nIGBzc3Qgc3RhcnRgLiBVc2VmdWwgZm9yIHRoaW5ncyBsaWtlIEN1c3RvbSBSZXNvdXJjZXMgdGhhdCBuZWVkIHRvIGV4ZWN1dGUgZHVyaW5nIGRlcGxveW1lbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkZ1bmN0aW9uXCIsIHtcbiAgICogICBlbmFibGVMaXZlRGV2OiBmYWxzZVxuICAgKiB9KVxuICAgKmBgYFxuICAgKi9cbiAgZW5hYmxlTGl2ZURldj86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBDb25maWd1cmUgZW52aXJvbm1lbnQgdmFyaWFibGVzIGZvciB0aGUgZnVuY3Rpb25cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkZ1bmN0aW9uXCIsIHtcbiAgICogICBlbnZpcm9ubWVudDoge1xuICAgKiAgICAgVEFCTEVfTkFNRTogdGFibGUudGFibGVOYW1lLFxuICAgKiAgIH1cbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICBlbnZpcm9ubWVudD86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gIC8qKlxuICAgKiBDb25maWd1cmUgb3IgZGlzYWJsZSBidW5kbGluZyBvcHRpb25zXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIG5ldyBGdW5jdGlvbihzdGFjaywgXCJGdW5jdGlvblwiLCB7XG4gICAqICAgYnVuZGxlOiB7XG4gICAqICAgICBjb3B5RmlsZXM6IFt7IGZyb206IFwic3JjL2luZGV4LmpzXCIgfV1cbiAgICogICB9XG4gICAqIH0pXG4gICAqYGBgXG4gICAqL1xuICBidW5kbGU/OiBGdW5jdGlvbkJ1bmRsZVByb3A7XG4gIC8qKlxuICAgKiBBdHRhY2hlcyB0aGUgZ2l2ZW4gbGlzdCBvZiBwZXJtaXNzaW9ucyB0byB0aGUgZnVuY3Rpb24uIENvbmZpZ3VyaW5nIHRoaXMgcHJvcGVydHkgaXMgZXF1aXZhbGVudCB0byBjYWxsaW5nIGBhdHRhY2hQZXJtaXNzaW9ucygpYCBhZnRlciB0aGUgZnVuY3Rpb24gaXMgY3JlYXRlZC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkZ1bmN0aW9uXCIsIHtcbiAgICogICBwZXJtaXNzaW9uczogW1wic2VzXCIsIGJ1Y2tldF1cbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICBwZXJtaXNzaW9ucz86IFBlcm1pc3Npb25zO1xuICAvKipcbiAgICogQSBsaXN0IG9mIExheWVycyB0byBhZGQgdG8gdGhlIGZ1bmN0aW9uJ3MgZXhlY3V0aW9uIGVudmlyb25tZW50LlxuICAgKlxuICAgKiBOb3RlIHRoYXQsIGlmIGEgTGF5ZXIgaXMgY3JlYXRlZCBpbiBhIHN0YWNrIChzYXkgYHN0YWNrQWApIGFuZCBpcyByZWZlcmVuY2VkIGluIGFub3RoZXIgc3RhY2sgKHNheSBgc3RhY2tCYCksIFNTVCBhdXRvbWF0aWNhbGx5IGNyZWF0ZXMgYW4gU1NNIHBhcmFtZXRlciBpbiBgc3RhY2tBYCB3aXRoIHRoZSBMYXllcidzIEFSTi4gQW5kIGluIGBzdGFja0JgLCBTU1QgcmVhZHMgdGhlIEFSTiBmcm9tIHRoZSBTU00gcGFyYW1ldGVyLCBhbmQgdGhlbiBpbXBvcnRzIHRoZSBMYXllci5cbiAgICpcbiAgICogIFRoaXMgaXMgdG8gZ2V0IGFyb3VuZCB0aGUgbGltaXRhdGlvbiB0aGF0IGEgTGFtYmRhIExheWVyIEFSTiBjYW5ub3QgYmUgcmVmZXJlbmNlZCBhY3Jvc3Mgc3RhY2tzIHZpYSBhIHN0YWNrIGV4cG9ydC4gVGhlIExheWVyIEFSTiBjb250YWlucyBhIHZlcnNpb24gbnVtYmVyIHRoYXQgaXMgaW5jcmVtZW50ZWQgZXZlcnl0aW1lIHRoZSBMYXllciBpcyBtb2RpZmllZC4gV2hlbiB5b3UgcmVmZXIgdG8gYSBMYXllcidzIEFSTiBhY3Jvc3Mgc3RhY2tzLCBhIENsb3VkRm9ybWF0aW9uIGV4cG9ydCBpcyBjcmVhdGVkLiBIb3dldmVyLCBDbG91ZEZvcm1hdGlvbiBkb2VzIG5vdCBhbGxvdyBhbiBleHBvcnRlZCB2YWx1ZSB0byBiZSB1cGRhdGVkLiBPbmNlIGV4cG9ydGVkLCBpZiB5b3UgdHJ5IHRvIGRlcGxveSB0aGUgdXBkYXRlZCBsYXllciwgdGhlIENsb3VkRm9ybWF0aW9uIHVwZGF0ZSB3aWxsIGZhaWwuIFlvdSBjYW4gcmVhZCBtb3JlIGFib3V0IHRoaXMgaXNzdWUgaGVyZSAtIGh0dHBzOi8vZ2l0aHViLmNvbS9zZXJ2ZXJsZXNzLXN0YWNrL3NlcnZlcmxlc3Mtc3RhY2svaXNzdWVzLzU0OS5cbiAgICpcbiAgICogQGRlZmF1bHQgbm8gbGF5ZXJzXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIG5ldyBGdW5jdGlvbihzdGFjaywgXCJGdW5jdGlvblwiLCB7XG4gICAqICAgbGF5ZXJzOiBbXCJhcm46YXdzOmxhbWJkYTp1cy1lYXN0LTE6NzY0ODY2NDUyNzk4OmxheWVyOmNocm9tZS1hd3MtbGFtYmRhOjIyXCIsIG15TGF5ZXJdXG4gICAqIH0pXG4gICAqIGBgYFxuICAgKi9cbiAgbGF5ZXJzPzogKHN0cmluZyB8IGxhbWJkYS5JTGF5ZXJWZXJzaW9uKVtdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZ1bmN0aW9uTmFtZVByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBzdGFjayB0aGUgZnVuY3Rpb24gaXMgYmVpbmcgY3JlYXRlZCBpblxuICAgKi9cbiAgc3RhY2s6IFN0YWNrO1xuICAvKipcbiAgICogVGhlIGZ1bmN0aW9uIHByb3BlcnRpZXNcbiAgICovXG4gIGZ1bmN0aW9uUHJvcHM6IEZ1bmN0aW9uUHJvcHM7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRnVuY3Rpb25IYW5kbGVyUHJvcHMge1xuICBzcmNQYXRoOiBzdHJpbmc7XG4gIGhhbmRsZXI6IHN0cmluZztcbiAgYnVuZGxlOiBGdW5jdGlvbkJ1bmRsZVByb3A7XG4gIHJ1bnRpbWU6IHN0cmluZztcbn1cblxuZXhwb3J0IHR5cGUgRnVuY3Rpb25CdW5kbGVQcm9wID1cbiAgfCBGdW5jdGlvbkJ1bmRsZU5vZGVqc1Byb3BzXG4gIHwgRnVuY3Rpb25CdW5kbGVQeXRob25Qcm9wc1xuICB8IGJvb2xlYW47XG5cbmludGVyZmFjZSBGdW5jdGlvbkJ1bmRsZUJhc2Uge1xuICAvKipcbiAgICogVXNlZCB0byBjb25maWd1cmUgYWRkaXRpb25hbCBmaWxlcyB0byBjb3B5IGludG8gdGhlIGZ1bmN0aW9uIGJ1bmRsZVxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBuZXcgRnVuY3Rpb24oc3RhY2ssIFwiRnVuY3Rpb25cIiwge1xuICAgKiAgIGJ1bmRsZToge1xuICAgKiAgICAgY29weUZpbGVzOiBbeyBmcm9tOiBcInNyYy9pbmRleC5qc1wiIH1dXG4gICAqICAgfVxuICAgKiB9KVxuICAgKmBgYFxuICAgKi9cbiAgY29weUZpbGVzPzogRnVuY3Rpb25CdW5kbGVDb3B5RmlsZXNQcm9wc1tdO1xufVxuXG4vKipcbiAqIFVzZWQgdG8gY29uZmlndXJlIE5vZGVKUyBidW5kbGluZyBvcHRpb25zXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGpzXG4gKiBuZXcgRnVuY3Rpb24oc3RhY2ssIFwiRnVuY3Rpb25cIiwge1xuICogICBidW5kbGU6IHtcbiAqICAgIGZvcm1hdDogXCJlc21cIixcbiAqICAgIG1pbmlmeTogZmFsc2VcbiAqICAgfVxuICogfSlcbiAqIGBgYFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZ1bmN0aW9uQnVuZGxlTm9kZWpzUHJvcHMgZXh0ZW5kcyBGdW5jdGlvbkJ1bmRsZUJhc2Uge1xuICAvKipcbiAgICogQ29uZmlndXJlIGFkZGl0aW9uYWwgZXNidWlsZCBsb2FkZXJzIGZvciBvdGhlciBmaWxlIGV4dGVuc2lvbnNcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkZ1bmN0aW9uXCIsIHtcbiAgICogICBidW5kbGU6IHtcbiAgICogICAgIGxvYWRlcjoge1xuICAgKiAgICAgIFwiLnBuZ1wiOiBcImZpbGVcIlxuICAgKiAgICAgfVxuICAgKiAgIH1cbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICBsb2FkZXI/OiBSZWNvcmQ8c3RyaW5nLCBlc2J1aWxkLkxvYWRlcj47XG4gIC8qKlxuICAgKiBQYWNrYWdlcyB0aGF0IHdpbGwgbm90IGJlIGluY2x1ZGVkIGluIHRoZSBidW5kbGUuIFVzdWFsbHkgdXNlZCB0byBleGNsdWRlIGRlcGVuZGVuY2llcyB0aGF0IGFyZSBwcm92aWRlZCBpbiBsYXllcnNcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkZ1bmN0aW9uXCIsIHtcbiAgICogICBidW5kbGU6IHtcbiAgICogICAgIGV4dGVybmFsTW9kdWxlczogW1wicHJpc21hXCJdXG4gICAqICAgfVxuICAgKiB9KVxuICAgKiBgYGBcbiAgICovXG4gIGV4dGVybmFsTW9kdWxlcz86IHN0cmluZ1tdO1xuICAvKipcbiAgICogUGFja2FnZXMgdGhhdCB3aWxsIGJlIGV4Y2x1ZGVkIGZyb20gdGhlIGJ1bmRsZSBhbmQgaW5zdGFsbGVkIGludG8gbm9kZV9tb2R1bGVzIGluc3RlYWQuIFVzZWZ1bCBmb3IgZGVwZW5kZW5jaWVzIHRoYXQgY2Fubm90IGJlIGJ1bmRsZWQsIGxpa2UgdGhvc2Ugd2l0aCBiaW5hcnkgZGVwZW5kZW5jaWVzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBuZXcgRnVuY3Rpb24oc3RhY2ssIFwiRnVuY3Rpb25cIiwge1xuICAgKiAgIGJ1bmRsZToge1xuICAgKiAgICAgbm9kZU1vZHVsZXM6IFtcInBnXCJdXG4gICAqICAgfVxuICAgKiB9KVxuICAgKiBgYGBcbiAgICovXG4gIG5vZGVNb2R1bGVzPzogc3RyaW5nW107XG4gIC8qKlxuICAgKiBIb29rcyB0byBydW4gYXQgdmFyaW91cyBzdGFnZXMgb2YgYnVuZGxpbmdcbiAgICovXG4gIGNvbW1hbmRIb29rcz86IGxhbWJkYU5vZGUuSUNvbW1hbmRIb29rcztcbiAgLyoqXG4gICAqIFRoaXMgYWxsb3dzIHlvdSB0byBjdXN0b21pemUgZXNidWlsZCBjb25maWcuXG4gICAqL1xuICBlc2J1aWxkQ29uZmlnPzoge1xuICAgIC8qKlxuICAgICAqIFJlcGxhY2UgZ2xvYmFsIGlkZW50aWZpZXJzIHdpdGggY29uc3RhbnQgZXhwcmVzc2lvbnMuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYGpzXG4gICAgICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkZ1bmN0aW9uXCIsIHtcbiAgICAgKiAgIGJ1bmRsZToge1xuICAgICAqICAgICBlc2J1aWxkQ29uZmlnOiB7XG4gICAgICogICAgICAgZGVmaW5lOiB7XG4gICAgICogICAgICAgICBzdHI6IFwidGV4dFwiXG4gICAgICogICAgICAgfVxuICAgICAqICAgICB9XG4gICAgICogICB9XG4gICAgICogfSlcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBkZWZpbmU/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICAgIC8qKlxuICAgICAqIFdoZW4gbWluaWZ5aW5nIHByZXNlcnZlIG5hbWVzIG9mIGZ1bmN0aW9ucyBhbmQgdmFyaWFibGVzXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYGpzXG4gICAgICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIkZ1bmN0aW9uXCIsIHtcbiAgICAgKiAgIGJ1bmRsZToge1xuICAgICAqICAgICBlc2J1aWxkQ29uZmlnOiB7XG4gICAgICogICAgICAga2VlcE5hbWVzOiB0cnVlXG4gICAgICogICAgIH1cbiAgICAgKiAgIH1cbiAgICAgKiB9KVxuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGtlZXBOYW1lcz86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogUGF0aCB0byBhIGZpbGUgdGhhdCByZXR1cm5zIGFuIGFycmF5IG9mIGVzYnVpbGQgcGx1Z2luc1xuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGBqc1xuICAgICAqIG5ldyBGdW5jdGlvbihzdGFjaywgXCJGdW5jdGlvblwiLCB7XG4gICAgICogICBidW5kbGU6IHtcbiAgICAgKiAgICAgZXNidWlsZENvbmZpZzoge1xuICAgICAqICAgICAgIHBsdWdpbnM6IFwicGF0aC90by9wbHVnaW5zLmpzXCJcbiAgICAgKiAgICAgfVxuICAgICAqICAgfVxuICAgICAqIH0pXG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBXaGVyZSBgcGF0aC90by9wbHVnaW5zLmpzYCBsb29rcyBzb21ldGhpbmcgbGlrZSB0aGlzOlxuICAgICAqXG4gICAgICogYGBganNcbiAgICAgKiBjb25zdCB7IGVzYnVpbGREZWNvcmF0b3JzIH0gPSByZXF1aXJlKFwiQGFuYXRpbmUvZXNidWlsZC1kZWNvcmF0b3JzXCIpO1xuICAgICAqXG4gICAgICogbW9kdWxlLmV4cG9ydHMgPSBbXG4gICAgICogICBlc2J1aWxkRGVjb3JhdG9ycygpLFxuICAgICAqIF07XG4gICAgICogYGBgXG4gICAgICovXG4gICAgcGx1Z2lucz86IHN0cmluZztcbiAgfTtcbiAgLyoqXG4gICAqIEVuYWJsZSBvciBkaXNhYmxlIG1pbmlmaWNhdGlvblxuICAgKlxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIG5ldyBGdW5jdGlvbihzdGFjaywgXCJGdW5jdGlvblwiLCB7XG4gICAqICAgYnVuZGxlOiB7XG4gICAqICAgICBtaW5pZnk6IGZhbHNlXG4gICAqICAgfVxuICAgKiB9KVxuICAgKiBgYGBcbiAgICovXG4gIG1pbmlmeT86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBDb25maWd1cmUgYnVuZGxlIGZvcm1hdFxuICAgKlxuICAgKiBAZGVmYXVsdCBcImNqc1wiXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIG5ldyBGdW5jdGlvbihzdGFjaywgXCJGdW5jdGlvblwiLCB7XG4gICAqICAgYnVuZGxlOiB7XG4gICAqICAgICBmb3JtYXQ6IFwiZXNtXCJcbiAgICogICB9XG4gICAqIH0pXG4gICAqIGBgYFxuICAgKi9cbiAgZm9ybWF0PzogXCJjanNcIiB8IFwiZXNtXCI7XG59XG5cbi8qKlxuICogVXNlZCB0byBjb25maWd1cmUgUHl0aG9uIGJ1bmRsaW5nIG9wdGlvbnNcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBganNcbiAqIG5ldyBGdW5jdGlvbihzdGFjaywgXCJGdW5jdGlvblwiLCB7XG4gKiAgIGJ1bmRsZToge1xuICogICAgIGluc3RhbGxDb21tYW5kczogW1xuICogICAgICAgJ2V4cG9ydCBWQVJOQU1FPVwibXkgdmFsdWVcIicsXG4gKiAgICAgICAncGlwIGluc3RhbGwgLS1pbmRleC11cmwgaHR0cHM6Ly9kb21haW4uY29tL3B5cGkvbXlwcml2YXRlbW9kdWxlL3NpbXBsZS8gLS1leHRyYS1pbmRleC11cmwgaHR0cHM6Ly9weXBpLm9yZy9zaW1wbGUnLFxuICogICAgIF1cbiAqICAgfVxuICogfSlcbiAqIGBgYFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZ1bmN0aW9uQnVuZGxlUHl0aG9uUHJvcHMgZXh0ZW5kcyBGdW5jdGlvbkJ1bmRsZUJhc2Uge1xuICAvKipcbiAgICogQSBsaXN0IG9mIGNvbW1hbmRzIHRvIG92ZXJyaWRlIHRoZSBbZGVmYXVsdCBpbnN0YWxsaW5nIGJlaGF2aW9yXShGdW5jdGlvbiNidW5kbGUpIGZvciBQeXRob24gZGVwZW5kZW5jaWVzLlxuICAgKlxuICAgKiBFYWNoIHN0cmluZyBpbiB0aGUgYXJyYXkgaXMgYSBjb21tYW5kIHRoYXQnbGwgYmUgcnVuLiBGb3IgZXhhbXBsZTpcbiAgICpcbiAgICogQGRlZmF1bHQgXCJbXVwiXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIG5ldyBGdW5jdGlvbihzdGFjaywgXCJGdW5jdGlvblwiLCB7XG4gICAqICAgYnVuZGxlOiB7XG4gICAqICAgICBpbnN0YWxsQ29tbWFuZHM6IFtcbiAgICogICAgICAgJ2V4cG9ydCBWQVJOQU1FPVwibXkgdmFsdWVcIicsXG4gICAqICAgICAgICdwaXAgaW5zdGFsbCAtLWluZGV4LXVybCBodHRwczovL2RvbWFpbi5jb20vcHlwaS9teXByaXZhdGVtb2R1bGUvc2ltcGxlLyAtLWV4dHJhLWluZGV4LXVybCBodHRwczovL3B5cGkub3JnL3NpbXBsZScsXG4gICAqICAgICBdXG4gICAqICAgfVxuICAgKiB9KVxuICAgKiBgYGBcbiAgICovXG4gIGluc3RhbGxDb21tYW5kcz86IHN0cmluZ1tdO1xufVxuXG4vKipcbiAqIFVzZWQgdG8gY29uZmlndXJlIGFkZGl0aW9uYWwgZmlsZXMgdG8gY29weSBpbnRvIHRoZSBmdW5jdGlvbiBidW5kbGVcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBganNcbiAqIG5ldyBGdW5jdGlvbihzdGFjaywgXCJGdW5jdGlvblwiLCB7XG4gKiAgIGJ1bmRsZToge1xuICogICAgIGNvcHlGaWxlczogW3sgZnJvbTogXCJzcmMvaW5kZXguanNcIiB9XVxuICogICB9XG4gKiB9KVxuICpgYGBcbiAqL1xuXG5leHBvcnQgaW50ZXJmYWNlIEZ1bmN0aW9uQnVuZGxlQ29weUZpbGVzUHJvcHMge1xuICAvKipcbiAgICogU291cmNlIHBhdGggcmVsYXRpdmUgdG8gc3N0Lmpzb25cbiAgICovXG4gIGZyb206IHN0cmluZztcbiAgLyoqXG4gICAqIERlc3RpbmF0aW9uIHBhdGggcmVsYXRpdmUgdG8gZnVuY3Rpb24gcm9vdCBpbiBidW5kbGVcbiAgICovXG4gIHRvPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIEEgY29uc3RydWN0IGZvciBhIExhbWJkYSBGdW5jdGlvbiB0aGF0IGFsbG93cyB5b3UgdG8gW2RldmVsb3AgeW91ciBpdCBsb2NhbGx5XShsaXZlLWxhbWJkYS1kZXZlbG9wbWVudC5tZCkuIFN1cHBvcnRzIEpTLCBUeXBlU2NyaXB0LCBQeXRob24sIEdvbGFuZywgYW5kIEMjLiBJdCBhbHNvIGFwcGxpZXMgYSBjb3VwbGUgb2YgZGVmYXVsdHM6XG4gKlxuICogLSBTZXRzIHRoZSBkZWZhdWx0IG1lbW9yeSBzZXR0aW5nIHRvIDEwMjRNQi5cbiAqIC0gU2V0cyB0aGUgZGVmYXVsdCBMYW1iZGEgZnVuY3Rpb24gdGltZW91dCB0byAxMCBzZWNvbmRzLlxuICogLSBbRW5hYmxlcyBBV1MgWC1SYXldKGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9sYW1iZGEvbGF0ZXN0L2RnL25vZGVqcy10cmFjaW5nLmh0bWwpIGJ5IGRlZmF1bHQgc28geW91IGNhbiB0cmFjZSB5b3VyIHNlcnZlcmxlc3MgYXBwbGljYXRpb25zLlxuICogLSBgQVdTX05PREVKU19DT05ORUNUSU9OX1JFVVNFX0VOQUJMRURgIGlzIHR1cm5lZCBvbi4gTWVhbmluZyB0aGF0IHRoZSBMYW1iZGEgZnVuY3Rpb24gd2lsbCBhdXRvbWF0aWNhbGx5IHJldXNlIFRDUCBjb25uZWN0aW9ucyB3aGVuIHdvcmtpbmcgd2l0aCB0aGUgQVdTIFNESy4gW1JlYWQgbW9yZSBhYm91dCB0aGlzIGhlcmVdKGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9zZGstZm9yLWphdmFzY3JpcHQvdjIvZGV2ZWxvcGVyLWd1aWRlL25vZGUtcmV1c2luZy1jb25uZWN0aW9ucy5odG1sKS5cbiAqIC0gU2V0cyB0aGUgYElTX0xPQ0FMYCBlbnZpcm9ubWVudCB2YXJpYWJsZSBmb3IgdGhlIExhbWJkYSBmdW5jdGlvbiB3aGVuIGl0IGlzIGludm9rZWQgbG9jYWxseSB0aHJvdWdoIHRoZSBgc3N0IHN0YXJ0YCBjb21tYW5kLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogIyMjIENyZWF0aW5nIGEgRnVuY3Rpb25cbiAqXG4gKiBgYGBqc1xuICogaW1wb3J0IHsgRnVuY3Rpb24gfSBmcm9tIFwiQHNlcnZlcmxlc3Mtc3RhY2svcmVzb3VyY2VzXCI7XG4gKlxuICogbmV3IEZ1bmN0aW9uKHN0YWNrLCBcIk15U25zTGFtYmRhXCIsIHtcbiAqICAgaGFuZGxlcjogXCJzcmMvc25zL2luZGV4Lm1haW5cIixcbiAqIH0pO1xuICogYGBgXG4gKi9cbmV4cG9ydCBjbGFzcyBGdW5jdGlvbiBleHRlbmRzIGxhbWJkYS5GdW5jdGlvbiBpbXBsZW1lbnRzIFNTVENvbnN0cnVjdCB7XG4gIHB1YmxpYyByZWFkb25seSBfaXNMaXZlRGV2RW5hYmxlZDogYm9vbGVhbjtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2NhbElkOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IEZ1bmN0aW9uUHJvcHMpIHtcbiAgICBjb25zdCByb290ID0gc2NvcGUubm9kZS5yb290IGFzIEFwcDtcbiAgICBjb25zdCBzdGFjayA9IFN0YWNrLm9mKHNjb3BlKSBhcyBTdGFjaztcblxuICAgIC8vIE1lcmdlIHdpdGggYXBwIGRlZmF1bHRGdW5jdGlvblByb3BzXG4gICAgLy8gbm90ZTogcmV2ZXJzZSBvcmRlciBzbyBsYXRlciBwcm9wIG92ZXJyaWRlIGVhcmxpZXIgb25lc1xuICAgIHN0YWNrLmRlZmF1bHRGdW5jdGlvblByb3BzXG4gICAgICAuc2xpY2UoKVxuICAgICAgLnJldmVyc2UoKVxuICAgICAgLmZvckVhY2goKHBlcikgPT4ge1xuICAgICAgICBwcm9wcyA9IEZ1bmN0aW9uLm1lcmdlUHJvcHMocGVyLCBwcm9wcyk7XG4gICAgICB9KTtcblxuICAgIC8vIFNldCBkZWZhdWx0c1xuICAgIGNvbnN0IGZ1bmN0aW9uTmFtZSA9XG4gICAgICBwcm9wcy5mdW5jdGlvbk5hbWUgJiZcbiAgICAgICh0eXBlb2YgcHJvcHMuZnVuY3Rpb25OYW1lID09PSBcInN0cmluZ1wiXG4gICAgICAgID8gcHJvcHMuZnVuY3Rpb25OYW1lXG4gICAgICAgIDogcHJvcHMuZnVuY3Rpb25OYW1lKHsgc3RhY2ssIGZ1bmN0aW9uUHJvcHM6IHByb3BzIH0pKTtcbiAgICBjb25zdCBoYW5kbGVyID0gcHJvcHMuaGFuZGxlcjtcbiAgICBjb25zdCB0aW1lb3V0ID0gRnVuY3Rpb24ubm9ybWFsaXplVGltZW91dChwcm9wcy50aW1lb3V0KTtcbiAgICBjb25zdCBzcmNQYXRoID0gRnVuY3Rpb24ubm9ybWFsaXplU3JjUGF0aChwcm9wcy5zcmNQYXRoIHx8IFwiLlwiKTtcbiAgICBjb25zdCBydW50aW1lID0gRnVuY3Rpb24ubm9ybWFsaXplUnVudGltZShwcm9wcy5ydW50aW1lKTtcbiAgICBjb25zdCBhcmNoaXRlY3R1cmUgPSAoKCkgPT4ge1xuICAgICAgaWYgKHByb3BzLmFyY2hpdGVjdHVyZSA9PT0gXCJhcm1fNjRcIikgcmV0dXJuIGxhbWJkYS5BcmNoaXRlY3R1cmUuQVJNXzY0O1xuICAgICAgaWYgKHByb3BzLmFyY2hpdGVjdHVyZSA9PT0gXCJ4ODZfNjRcIikgcmV0dXJuIGxhbWJkYS5BcmNoaXRlY3R1cmUuWDg2XzY0O1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9KSgpO1xuICAgIGNvbnN0IG1lbW9yeVNpemUgPSBGdW5jdGlvbi5ub3JtYWxpemVNZW1vcnlTaXplKHByb3BzLm1lbW9yeVNpemUpO1xuICAgIGNvbnN0IGRpc2tTaXplID0gRnVuY3Rpb24ubm9ybWFsaXplRGlza1NpemUocHJvcHMuZGlza1NpemUpO1xuICAgIGNvbnN0IHRyYWNpbmcgPVxuICAgICAgbGFtYmRhLlRyYWNpbmdbXG4gICAgICAgIChwcm9wcy50cmFjaW5nIHx8IFwiYWN0aXZlXCIpLnRvVXBwZXJDYXNlKCkgYXMga2V5b2YgdHlwZW9mIGxhbWJkYS5UcmFjaW5nXG4gICAgICBdO1xuICAgIGxldCBidW5kbGUgPSBwcm9wcy5idW5kbGU7XG4gICAgY29uc3QgcGVybWlzc2lvbnMgPSBwcm9wcy5wZXJtaXNzaW9ucztcbiAgICBjb25zdCBpc0xpdmVEZXZFbmFibGVkID0gcHJvcHMuZW5hYmxlTGl2ZURldiA9PT0gZmFsc2UgPyBmYWxzZSA6IHRydWU7XG5cbiAgICAvLyBWYWxpZGF0ZSBoYW5kbGVyXG4gICAgaWYgKCFoYW5kbGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGhhbmRsZXIgZGVmaW5lZCBmb3IgdGhlIFwiJHtpZH1cIiBMYW1iZGEgZnVuY3Rpb25gKTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBpbnB1dFxuICAgIGNvbnN0IGlzTm9kZVJ1bnRpbWUgPSBydW50aW1lLnRvU3RyaW5nKCkuc3RhcnRzV2l0aChcIm5vZGVqc1wiKTtcbiAgICBjb25zdCBpc1B5dGhvblJ1bnRpbWUgPSBydW50aW1lLnRvU3RyaW5nKCkuc3RhcnRzV2l0aChcInB5dGhvblwiKTtcbiAgICBpZiAoaXNOb2RlUnVudGltZSkge1xuICAgICAgYnVuZGxlID0gYnVuZGxlID09PSB1bmRlZmluZWQgPyB0cnVlIDogcHJvcHMuYnVuZGxlO1xuICAgICAgaWYgKCFidW5kbGUgJiYgc3JjUGF0aCA9PT0gXCIuXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBCdW5kbGUgY2Fubm90IGJlIGRpc2FibGVkIGZvciB0aGUgXCIke2lkfVwiIGZ1bmN0aW9uIHNpbmNlIHRoZSBcInNyY1BhdGhcIiBpcyBzZXQgdG8gdGhlIHByb2plY3Qgcm9vdC4gUmVhZCBtb3JlIGhlcmUg4oCUIGh0dHBzOi8vZ2l0aHViLmNvbS9zZXJ2ZXJsZXNzLXN0YWNrL3NlcnZlcmxlc3Mtc3RhY2svaXNzdWVzLzc4YFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoaXNQeXRob25SdW50aW1lKSB7XG4gICAgICBidW5kbGUgPSBidW5kbGUgPT09IHVuZGVmaW5lZCA/IHt9IDogcHJvcHMuYnVuZGxlO1xuICAgICAgaWYgKHNyY1BhdGggPT09IFwiLlwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgQ2Fubm90IHNldCB0aGUgXCJzcmNQYXRoXCIgdG8gdGhlIHByb2plY3Qgcm9vdCBmb3IgdGhlIFwiJHtpZH1cIiBmdW5jdGlvbi5gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgbG9jYWxJZCA9IHBhdGgucG9zaXhcbiAgICAgIC5qb2luKHNjb3BlLm5vZGUucGF0aCwgaWQpXG4gICAgICAucmVwbGFjZSgvXFwkL2csIFwiLVwiKVxuICAgICAgLnJlcGxhY2UoL1xcLy9nLCBcIi1cIilcbiAgICAgIC5yZXBsYWNlKC9cXC4vZywgXCItXCIpO1xuXG4gICAgLy8gSGFuZGxlIGxvY2FsIGRldmVsb3BtZW50IChpZS4gc3N0IHN0YXJ0KVxuICAgIC8vIC0gc2V0IHJ1bnRpbWUgdG8gbm9kZWpzMTIueCBmb3Igbm9uLU5vZGUgcnVudGltZXMgKGIvYyB0aGUgc3R1YiBpcyBpbiBOb2RlKVxuICAgIC8vIC0gc2V0IHJldHJ5IHRvIDAuIFdoZW4gdGhlIGRlYnVnZ2VyIGlzIGRpc2Nvbm5lY3RlZCwgdGhlIENyb24gY29uc3RydWN0XG4gICAgLy8gICB3aWxsIHN0aWxsIHRyeSB0byBwZXJpb2RpY2FsbHkgaW52b2tlIHRoZSBMYW1iZGEsIGFuZCB0aGUgcmVxdWVzdHMgd291bGRcbiAgICAvLyAgIGZhaWwgYW5kIHJldHJ5LiBTbyB3aGVuIGxhdW5jaGluZyBgc3N0IHN0YXJ0YCwgYSBjb3VwbGUgb2YgcmV0cnkgcmVxdWVzdHNcbiAgICAvLyAgIGZyb20gcmVjZW50IGZhaWxlZCByZXF1ZXN0IHdpbGwgYmUgcmVjZWl2ZWQuIEFuZCB0aGlzIGJlaGF2aW9yIGlzIGNvbmZ1c2luZy5cbiAgICBpZiAoXG4gICAgICBpc0xpdmVEZXZFbmFibGVkICYmXG4gICAgICByb290LmxvY2FsICYmXG4gICAgICByb290LmRlYnVnRW5kcG9pbnQgJiZcbiAgICAgIHJvb3QuZGVidWdCdWNrZXROYW1lICYmXG4gICAgICByb290LmRlYnVnQnVja2V0QXJuXG4gICAgKSB7XG4gICAgICAvLyBJZiBkZWJ1Z0luY3JlYXNlVGltZW91dCBpcyBlbmFibGVkOlxuICAgICAgLy8gICBzZXQgdGltZW91dCB0byA5MDBzLiBUaGlzIHdpbGwgZ2l2ZSBwZW9wbGUgbW9yZSB0aW1lIHRvIGRlYnVnIHRoZSBmdW5jdGlvblxuICAgICAgLy8gICB3aXRob3V0IHRpbWluZyBvdXQgdGhlIHJlcXVlc3QuIE5vdGUgQVBJIEdhdGV3YXkgcmVxdWVzdHMgaGF2ZSBhIG1heGltdW1cbiAgICAgIC8vICAgdGltZW91dCBvZiAyOXMuIEluIHRoaXMgY2FzZSwgdGhlIEFQSSB3aWxsIHRpbWVvdXQsIGJ1dCB0aGUgTGFtYmRhIGZ1bmN0aW9uXG4gICAgICAvLyAgIHdpbGwgY29udGludWUgdG8gcnVuLlxuICAgICAgbGV0IGRlYnVnT3ZlcnJpZGVQcm9wcztcbiAgICAgIGlmIChyb290LmRlYnVnSW5jcmVhc2VUaW1lb3V0KSB7XG4gICAgICAgIGRlYnVnT3ZlcnJpZGVQcm9wcyA9IHtcbiAgICAgICAgICB0aW1lb3V0OiBjZGsuRHVyYXRpb24uc2Vjb25kcyg5MDApLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBpZiAocm9vdC5kZWJ1Z0JyaWRnZSkge1xuICAgICAgICBzdXBlcihzY29wZSwgaWQsIHtcbiAgICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgICBhcmNoaXRlY3R1cmUsXG4gICAgICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KFxuICAgICAgICAgICAgcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgXCIuLi9kaXN0L2JyaWRnZV9jbGllbnQvXCIpXG4gICAgICAgICAgKSxcbiAgICAgICAgICBoYW5kbGVyOiBcImhhbmRsZXJcIixcbiAgICAgICAgICBmdW5jdGlvbk5hbWUsXG4gICAgICAgICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuR09fMV9YLFxuICAgICAgICAgIG1lbW9yeVNpemUsXG4gICAgICAgICAgZXBoZW1lcmFsU3RvcmFnZVNpemU6IGRpc2tTaXplLFxuICAgICAgICAgIHRpbWVvdXQsXG4gICAgICAgICAgdHJhY2luZyxcbiAgICAgICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICAgICAgLi4uKHByb3BzLmVudmlyb25tZW50IHx8IHt9KSxcbiAgICAgICAgICAgIFNTVF9ERUJVR19CUklER0U6IHJvb3QuZGVidWdCcmlkZ2UsXG4gICAgICAgICAgICBTU1RfREVCVUdfU1JDX1BBVEg6IHNyY1BhdGgsXG4gICAgICAgICAgICBTU1RfREVCVUdfU1JDX0hBTkRMRVI6IGhhbmRsZXIsXG4gICAgICAgICAgICBTU1RfREVCVUdfRU5EUE9JTlQ6IHJvb3QuZGVidWdFbmRwb2ludCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGxheWVyczogRnVuY3Rpb24uYnVpbGRMYXllcnMoc2NvcGUsIGlkLCBwcm9wcyksXG4gICAgICAgICAgLi4uKGRlYnVnT3ZlcnJpZGVQcm9wcyB8fCB7fSksXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3VwZXIoc2NvcGUsIGlkLCB7XG4gICAgICAgICAgLi4ucHJvcHMsXG4gICAgICAgICAgYXJjaGl0ZWN0dXJlLFxuICAgICAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21Bc3NldChcbiAgICAgICAgICAgIHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIFwiLi4vZGlzdC9zdHViLnppcFwiKVxuICAgICAgICAgICksXG4gICAgICAgICAgaGFuZGxlcjogXCJpbmRleC5tYWluXCIsXG4gICAgICAgICAgZnVuY3Rpb25OYW1lLFxuICAgICAgICAgIHJ1bnRpbWU6IGlzTm9kZVJ1bnRpbWUgPyBydW50aW1lIDogbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzEyX1gsXG4gICAgICAgICAgbWVtb3J5U2l6ZSxcbiAgICAgICAgICBlcGhlbWVyYWxTdG9yYWdlU2l6ZTogZGlza1NpemUsXG4gICAgICAgICAgdGltZW91dCxcbiAgICAgICAgICB0cmFjaW5nLFxuICAgICAgICAgIGVudmlyb25tZW50OiB7XG4gICAgICAgICAgICAuLi4ocHJvcHMuZW52aXJvbm1lbnQgfHwge30pLFxuICAgICAgICAgICAgU1NUX0RFQlVHX1NSQ19QQVRIOiBzcmNQYXRoLFxuICAgICAgICAgICAgU1NUX0RFQlVHX1NSQ19IQU5ETEVSOiBoYW5kbGVyLFxuICAgICAgICAgICAgU1NUX0RFQlVHX0VORFBPSU5UOiByb290LmRlYnVnRW5kcG9pbnQsXG4gICAgICAgICAgICBTU1RfREVCVUdfQlVDS0VUX05BTUU6IHJvb3QuZGVidWdCdWNrZXROYW1lLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgbGF5ZXJzOiBGdW5jdGlvbi5idWlsZExheWVycyhzY29wZSwgaWQsIHByb3BzKSxcbiAgICAgICAgICByZXRyeUF0dGVtcHRzOiAwLFxuICAgICAgICAgIC4uLihkZWJ1Z092ZXJyaWRlUHJvcHMgfHwge30pLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFN0YXRlLkZ1bmN0aW9uLmFwcGVuZChyb290LmFwcFBhdGgsIHtcbiAgICAgICAgaWQ6IGxvY2FsSWQsXG4gICAgICAgIGhhbmRsZXI6IGhhbmRsZXIsXG4gICAgICAgIHJ1bnRpbWU6IHJ1bnRpbWUudG9TdHJpbmcoKSxcbiAgICAgICAgc3JjUGF0aDogc3JjUGF0aCxcbiAgICAgICAgYnVuZGxlOiBwcm9wcy5idW5kbGUsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuYWRkRW52aXJvbm1lbnQoXCJTU1RfRlVOQ1RJT05fSURcIiwgbG9jYWxJZCk7XG4gICAgICB0aGlzLmF0dGFjaFBlcm1pc3Npb25zKFtcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFtcInMzOipcIl0sXG4gICAgICAgICAgZWZmZWN0OiBpYW0uRWZmZWN0LkFMTE9XLFxuICAgICAgICAgIHJlc291cmNlczogW3Jvb3QuZGVidWdCdWNrZXRBcm4sIGAke3Jvb3QuZGVidWdCdWNrZXRBcm59LypgXSxcbiAgICAgICAgfSksXG4gICAgICBdKTtcbiAgICB9XG4gICAgLy8gSGFuZGxlIHJlbW92ZSAoaWUuIHNzdCByZW1vdmUpXG4gICAgZWxzZSBpZiAocm9vdC5za2lwQnVpbGQpIHtcbiAgICAgIC8vIE5vdGU6IG5lZWQgdG8gb3ZlcnJpZGUgcnVudGltZSBhcyBDREsgZG9lcyBub3Qgc3VwcG9ydCBpbmxpbmUgY29kZVxuICAgICAgLy8gICAgICAgZm9yIHNvbWUgcnVudGltZXMuXG4gICAgICBzdXBlcihzY29wZSwgaWQsIHtcbiAgICAgICAgLi4ucHJvcHMsXG4gICAgICAgIGFyY2hpdGVjdHVyZSxcbiAgICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KFxuICAgICAgICAgIHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIFwiLi4vYXNzZXRzL0Z1bmN0aW9uL3BsYWNlaG9sZGVyLXN0dWJcIilcbiAgICAgICAgKSxcbiAgICAgICAgaGFuZGxlcjogXCJwbGFjZWhvbGRlclwiLFxuICAgICAgICBmdW5jdGlvbk5hbWUsXG4gICAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU18xMl9YLFxuICAgICAgICBtZW1vcnlTaXplLFxuICAgICAgICBlcGhlbWVyYWxTdG9yYWdlU2l6ZTogZGlza1NpemUsXG4gICAgICAgIHRpbWVvdXQsXG4gICAgICAgIHRyYWNpbmcsXG4gICAgICAgIGVudmlyb25tZW50OiBwcm9wcy5lbnZpcm9ubWVudCxcbiAgICAgICAgbGF5ZXJzOiBGdW5jdGlvbi5idWlsZExheWVycyhzY29wZSwgaWQsIHByb3BzKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBIYW5kbGUgYnVpbGRcbiAgICBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiQnVpbGRpbmcgZnVuY3Rpb25cIiwgaGFuZGxlcik7XG4gICAgICBjb25zdCBidW5kbGVkID0gUnVudGltZS5IYW5kbGVyLmJ1bmRsZSh7XG4gICAgICAgIGlkOiBsb2NhbElkLFxuICAgICAgICByb290OiByb290LmFwcFBhdGgsXG4gICAgICAgIGhhbmRsZXI6IGhhbmRsZXIsXG4gICAgICAgIHJ1bnRpbWU6IHJ1bnRpbWUudG9TdHJpbmcoKSxcbiAgICAgICAgc3JjUGF0aDogc3JjUGF0aCxcbiAgICAgICAgYnVuZGxlOiBwcm9wcy5idW5kbGUsXG4gICAgICB9KSE7XG5cbiAgICAgIC8vIFB5dGhvbiBidWlsZGVyIHJldHVybnMgQXNzZXRDb2RlIGluc3RlYWQgb2YgZGlyZWN0b3J5XG4gICAgICBjb25zdCBjb2RlID0gKCgpID0+IHtcbiAgICAgICAgaWYgKFwiZGlyZWN0b3J5XCIgaW4gYnVuZGxlZCkge1xuICAgICAgICAgIEZ1bmN0aW9uLmNvcHlGaWxlcyhidW5kbGUsIHNyY1BhdGgsIGJ1bmRsZWQuZGlyZWN0b3J5KTtcbiAgICAgICAgICByZXR1cm4gbGFtYmRhLkFzc2V0Q29kZS5mcm9tQXNzZXQoYnVuZGxlZC5kaXJlY3RvcnkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBidW5kbGVkLmFzc2V0O1xuICAgICAgfSkoKTtcblxuICAgICAgc3VwZXIoc2NvcGUsIGlkLCB7XG4gICAgICAgIC4uLnByb3BzLFxuICAgICAgICBhcmNoaXRlY3R1cmUsXG4gICAgICAgIGNvZGU6IGNvZGUhLFxuICAgICAgICBoYW5kbGVyOiBidW5kbGVkLmhhbmRsZXIsXG4gICAgICAgIGZ1bmN0aW9uTmFtZSxcbiAgICAgICAgcnVudGltZSxcbiAgICAgICAgbWVtb3J5U2l6ZSxcbiAgICAgICAgZXBoZW1lcmFsU3RvcmFnZVNpemU6IGRpc2tTaXplLFxuICAgICAgICB0aW1lb3V0LFxuICAgICAgICB0cmFjaW5nLFxuICAgICAgICBlbnZpcm9ubWVudDogcHJvcHMuZW52aXJvbm1lbnQsXG4gICAgICAgIGxheWVyczogRnVuY3Rpb24uYnVpbGRMYXllcnMoc2NvcGUsIGlkLCBwcm9wcyksXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBFbmFibGUgcmV1c2luZyBjb25uZWN0aW9ucyB3aXRoIEtlZXAtQWxpdmUgZm9yIE5vZGVKcyBMYW1iZGEgZnVuY3Rpb25cbiAgICBpZiAoaXNOb2RlUnVudGltZSkge1xuICAgICAgdGhpcy5hZGRFbnZpcm9ubWVudChcIkFXU19OT0RFSlNfQ09OTkVDVElPTl9SRVVTRV9FTkFCTEVEXCIsIFwiMVwiLCB7XG4gICAgICAgIHJlbW92ZUluRWRnZTogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEF0dGFjaCBwZXJtaXNzaW9uc1xuICAgIGlmIChwZXJtaXNzaW9ucykge1xuICAgICAgdGhpcy5hdHRhY2hQZXJtaXNzaW9ucyhwZXJtaXNzaW9ucyk7XG4gICAgfVxuXG4gICAgcm9vdC5yZWdpc3RlckxhbWJkYUhhbmRsZXIoe1xuICAgICAgYnVuZGxlOiBwcm9wcy5idW5kbGUhLFxuICAgICAgaGFuZGxlcjogaGFuZGxlcixcbiAgICAgIHJ1bnRpbWU6IHJ1bnRpbWUudG9TdHJpbmcoKSxcbiAgICAgIHNyY1BhdGgsXG4gICAgfSk7XG4gICAgdGhpcy5faXNMaXZlRGV2RW5hYmxlZCA9IGlzTGl2ZURldkVuYWJsZWQ7XG4gICAgdGhpcy5sb2NhbElkID0gbG9jYWxJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBdHRhY2hlcyBhZGRpdGlvbmFsIHBlcm1pc3Npb25zIHRvIGZ1bmN0aW9uXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzIHsyMH1cbiAgICogZm4uYXR0YWNoUGVybWlzc2lvbnMoW1wiczNcIl0pO1xuICAgKiBgYGBcbiAgICovXG4gIHB1YmxpYyBhdHRhY2hQZXJtaXNzaW9ucyhwZXJtaXNzaW9uczogUGVybWlzc2lvbnMpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5yb2xlKSB7XG4gICAgICBhdHRhY2hQZXJtaXNzaW9uc1RvUm9sZSh0aGlzLnJvbGUgYXMgaWFtLlJvbGUsIHBlcm1pc3Npb25zKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0Q29uc3RydWN0TWV0YWRhdGEoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiRnVuY3Rpb25cIiBhcyBjb25zdCxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgbG9jYWxJZDogdGhpcy5sb2NhbElkLFxuICAgICAgICBhcm46IHRoaXMuZnVuY3Rpb25Bcm4sXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgYnVpbGRMYXllcnMoc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IEZ1bmN0aW9uUHJvcHMpIHtcbiAgICByZXR1cm4gKHByb3BzLmxheWVycyB8fCBbXSkubWFwKChsYXllcikgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBsYXllciA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4gbGFtYmRhLkxheWVyVmVyc2lvbi5mcm9tTGF5ZXJWZXJzaW9uQXJuKFxuICAgICAgICAgIHNjb3BlLFxuICAgICAgICAgIGAke2lkfSR7bGF5ZXJ9YCxcbiAgICAgICAgICBsYXllclxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIEZ1bmN0aW9uLmhhbmRsZUltcG9ydGVkTGF5ZXIoc2NvcGUsIGxheWVyKTtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBub3JtYWxpemVNZW1vcnlTaXplKG1lbW9yeVNpemU/OiBudW1iZXIgfCBTaXplKTogbnVtYmVyIHtcbiAgICBpZiAodHlwZW9mIG1lbW9yeVNpemUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHJldHVybiB0b0Nka1NpemUobWVtb3J5U2l6ZSkudG9NZWJpYnl0ZXMoKTtcbiAgICB9XG4gICAgcmV0dXJuIG1lbW9yeVNpemUgfHwgMTAyNDtcbiAgfVxuXG4gIHN0YXRpYyBub3JtYWxpemVEaXNrU2l6ZShkaXNrU2l6ZT86IG51bWJlciB8IFNpemUpOiBjZGsuU2l6ZSB7XG4gICAgaWYgKHR5cGVvZiBkaXNrU2l6ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuIHRvQ2RrU2l6ZShkaXNrU2l6ZSk7XG4gICAgfVxuICAgIHJldHVybiBjZGsuU2l6ZS5tZWJpYnl0ZXMoZGlza1NpemUgfHwgNTEyKTtcbiAgfVxuXG4gIHN0YXRpYyBub3JtYWxpemVUaW1lb3V0KHRpbWVvdXQ/OiBudW1iZXIgfCBEdXJhdGlvbik6IGNkay5EdXJhdGlvbiB7XG4gICAgaWYgKHR5cGVvZiB0aW1lb3V0ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gdG9DZGtEdXJhdGlvbih0aW1lb3V0KTtcbiAgICB9XG4gICAgcmV0dXJuIGNkay5EdXJhdGlvbi5zZWNvbmRzKHRpbWVvdXQgfHwgMTApO1xuICB9XG5cbiAgc3RhdGljIG5vcm1hbGl6ZVJ1bnRpbWUocnVudGltZT86IHN0cmluZyk6IGxhbWJkYS5SdW50aW1lIHtcbiAgICBydW50aW1lID0gcnVudGltZSB8fCBcIm5vZGVqczE0LnhcIjtcbiAgICBjb25zdCBydW50aW1lQ2xhc3MgPSBzdXBwb3J0ZWRSdW50aW1lcy5maW5kKFxuICAgICAgKHBlcikgPT4gcGVyLnRvU3RyaW5nKCkgPT09IHJ1bnRpbWVcbiAgICApO1xuICAgIGlmICghcnVudGltZUNsYXNzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBUaGUgc3BlY2lmaWVkIHJ1bnRpbWUgaXMgbm90IHN1cHBvcnRlZCBmb3Igc3N0LkZ1bmN0aW9uLiBPbmx5IE5vZGVKUywgUHl0aG9uLCBHbywgYW5kIC5ORVQgcnVudGltZXMgYXJlIGN1cnJlbnRseSBzdXBwb3J0ZWQuYFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHJ1bnRpbWVDbGFzcztcbiAgfVxuXG4gIHN0YXRpYyBub3JtYWxpemVTcmNQYXRoKHNyY1BhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHNyY1BhdGgucmVwbGFjZSgvXFwvKyQvLCBcIlwiKTtcbiAgfVxuXG4gIHN0YXRpYyBjb3B5RmlsZXMoXG4gICAgYnVuZGxlOiBGdW5jdGlvbkJ1bmRsZVByb3AgfCB1bmRlZmluZWQsXG4gICAgc3JjUGF0aDogc3RyaW5nLFxuICAgIGJ1aWxkUGF0aDogc3RyaW5nXG4gICkge1xuICAgIGlmICghYnVuZGxlKSByZXR1cm47XG4gICAgaWYgKHR5cGVvZiBidW5kbGUgPT09IFwiYm9vbGVhblwiKSByZXR1cm47XG4gICAgaWYgKCFidW5kbGUuY29weUZpbGVzKSByZXR1cm47XG5cbiAgICBidW5kbGUuY29weUZpbGVzLmZvckVhY2goKGVudHJ5KSA9PiB7XG4gICAgICBjb25zdCBmcm9tUGF0aCA9IHBhdGguam9pbihzcmNQYXRoLCBlbnRyeS5mcm9tKTtcbiAgICAgIGlmICghZnMuZXhpc3RzU3luYyhmcm9tUGF0aCkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgVHJpZWQgdG8gY29weSBub25leGlzdGVudCBmaWxlIGZyb20gXCIke3BhdGgucmVzb2x2ZShcbiAgICAgICAgICAgIGZyb21QYXRoXG4gICAgICAgICAgKX1cIiAtIGNoZWNrIGNvcHlGaWxlcyBlbnRyeSBcIiR7ZW50cnkuZnJvbX1cImBcbiAgICAgICAgKTtcbiAgICAgIGNvbnN0IHRvID0gZW50cnkudG8gfHwgZW50cnkuZnJvbTtcbiAgICAgIGlmIChwYXRoLmlzQWJzb2x1dGUodG8pKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvcHkgZGVzdGluYXRpb24gcGF0aCBcIiR7dG99XCIgbXVzdCBiZSByZWxhdGl2ZWApO1xuICAgICAgY29uc3QgdG9QYXRoID0gcGF0aC5qb2luKGJ1aWxkUGF0aCwgdG8pO1xuICAgICAgZnMuY29weVN5bmMoZnJvbVBhdGgsIHRvUGF0aCk7XG4gICAgfSk7XG4gIH1cblxuICBzdGF0aWMgaGFuZGxlSW1wb3J0ZWRMYXllcihcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIGxheWVyOiBsYW1iZGEuSUxheWVyVmVyc2lvblxuICApOiBsYW1iZGEuSUxheWVyVmVyc2lvbiB7XG4gICAgY29uc3QgbGF5ZXJTdGFjayA9IFN0YWNrLm9mKGxheWVyKTtcbiAgICBjb25zdCBjdXJyZW50U3RhY2sgPSBTdGFjay5vZihzY29wZSk7XG4gICAgLy8gVXNlIGxheWVyIGRpcmVjdGx5IGlmOlxuICAgIC8vIC0gbGF5ZXIgaXMgY3JlYXRlZCBpbiB0aGUgY3VycmVudCBzdGFjazsgT1JcbiAgICAvLyAtIGxheWVyIGlzIGltcG9ydGVkIChpZS4gbGF5ZXJBcm4gaXMgYSBzdHJpbmcpXG4gICAgaWYgKFxuICAgICAgbGF5ZXJTdGFjayA9PT0gY3VycmVudFN0YWNrIHx8XG4gICAgICAhY2RrLlRva2VuLmlzVW5yZXNvbHZlZChsYXllci5sYXllclZlcnNpb25Bcm4pXG4gICAgKSB7XG4gICAgICByZXR1cm4gbGF5ZXI7XG4gICAgfVxuICAgIC8vIGxheWVyIGlzIGNyZWF0ZWQgZnJvbSBhbm90aGVyIHN0YWNrXG4gICAgZWxzZSB7XG4gICAgICAvLyBzZXQgc3RhY2sgZGVwZW5kZW5jeSBiL2MgbGF5ZXJTdGFjayBuZWVkIHRvIGNyZWF0ZSB0aGUgU1NNIGZpcnN0XG4gICAgICBjdXJyZW50U3RhY2suYWRkRGVwZW5kZW5jeShsYXllclN0YWNrKTtcbiAgICAgIC8vIHN0b3JlIGxheWVyIEFSTiBpbiBTU00gaW4gbGF5ZXIncyBzdGFja1xuICAgICAgY29uc3QgcGFyYW1ldGVySWQgPSBgJHtsYXllci5ub2RlLmlkfUFybi0ke2xheWVyLm5vZGUuYWRkcn1gO1xuICAgICAgY29uc3QgcGFyYW1ldGVyTmFtZSA9IGAvbGF5ZXJzLyR7bGF5ZXJTdGFjay5ub2RlLmlkfS8ke3BhcmFtZXRlcklkfWA7XG4gICAgICBjb25zdCBleGlzdGluZ1NzbVBhcmFtID0gbGF5ZXJTdGFjay5ub2RlLnRyeUZpbmRDaGlsZChwYXJhbWV0ZXJJZCk7XG4gICAgICBpZiAoIWV4aXN0aW5nU3NtUGFyYW0pIHtcbiAgICAgICAgbmV3IHNzbS5TdHJpbmdQYXJhbWV0ZXIobGF5ZXJTdGFjaywgcGFyYW1ldGVySWQsIHtcbiAgICAgICAgICBwYXJhbWV0ZXJOYW1lLFxuICAgICAgICAgIHN0cmluZ1ZhbHVlOiBsYXllci5sYXllclZlcnNpb25Bcm4sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgLy8gaW1wb3J0IGxheWVyIGZyb20gU1NNIHZhbHVlXG4gICAgICBjb25zdCBsYXllcklkID0gYEkke2xheWVyLm5vZGUuaWR9LSR7bGF5ZXIubm9kZS5hZGRyfWA7XG4gICAgICBjb25zdCBleGlzdGluZ0xheWVyID0gc2NvcGUubm9kZS50cnlGaW5kQ2hpbGQobGF5ZXJJZCk7XG4gICAgICBpZiAoZXhpc3RpbmdMYXllcikge1xuICAgICAgICByZXR1cm4gZXhpc3RpbmdMYXllciBhcyBsYW1iZGEuTGF5ZXJWZXJzaW9uO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGxhbWJkYS5MYXllclZlcnNpb24uZnJvbUxheWVyVmVyc2lvbkFybihcbiAgICAgICAgICBzY29wZSxcbiAgICAgICAgICBsYXllcklkLFxuICAgICAgICAgIHNzbS5TdHJpbmdQYXJhbWV0ZXIudmFsdWVGb3JTdHJpbmdQYXJhbWV0ZXIoc2NvcGUsIHBhcmFtZXRlck5hbWUpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGlzSW5saW5lRGVmaW5pdGlvbihcbiAgICBkZWZpbml0aW9uOiBhbnlcbiAgKTogZGVmaW5pdGlvbiBpcyBGdW5jdGlvbklubGluZURlZmluaXRpb24ge1xuICAgIHJldHVybiB0eXBlb2YgZGVmaW5pdGlvbiA9PT0gXCJzdHJpbmdcIiB8fCBkZWZpbml0aW9uIGluc3RhbmNlb2YgRnVuY3Rpb247XG4gIH1cblxuICBzdGF0aWMgZnJvbURlZmluaXRpb24oXG4gICAgc2NvcGU6IENvbnN0cnVjdCxcbiAgICBpZDogc3RyaW5nLFxuICAgIGRlZmluaXRpb246IEZ1bmN0aW9uRGVmaW5pdGlvbixcbiAgICBpbmhlcml0ZWRQcm9wcz86IEZ1bmN0aW9uUHJvcHMsXG4gICAgaW5oZXJpdEVycm9yTWVzc2FnZT86IHN0cmluZ1xuICApOiBGdW5jdGlvbiB7XG4gICAgaWYgKHR5cGVvZiBkZWZpbml0aW9uID09PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKHNjb3BlLCBpZCwge1xuICAgICAgICAuLi4oaW5oZXJpdGVkUHJvcHMgfHwge30pLFxuICAgICAgICBoYW5kbGVyOiBkZWZpbml0aW9uLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChkZWZpbml0aW9uIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcbiAgICAgIGlmIChpbmhlcml0ZWRQcm9wcyAmJiBPYmplY3Qua2V5cyhpbmhlcml0ZWRQcm9wcykubGVuZ3RoID4gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgaW5oZXJpdEVycm9yTWVzc2FnZSB8fFxuICAgICAgICAgICAgYENhbm5vdCBpbmhlcml0IGRlZmF1bHQgcHJvcHMgd2hlbiBhIEZ1bmN0aW9uIGlzIHByb3ZpZGVkYFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGRlZmluaXRpb247XG4gICAgfSBlbHNlIGlmIChkZWZpbml0aW9uIGluc3RhbmNlb2YgbGFtYmRhLkZ1bmN0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBQbGVhc2UgdXNlIHNzdC5GdW5jdGlvbiBpbnN0ZWFkIG9mIGxhbWJkYS5GdW5jdGlvbiBmb3IgdGhlIFwiJHtpZH1cIiBGdW5jdGlvbi5gXG4gICAgICApO1xuICAgIH0gZWxzZSBpZiAoKGRlZmluaXRpb24gYXMgRnVuY3Rpb25Qcm9wcykuaGFuZGxlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKFxuICAgICAgICBzY29wZSxcbiAgICAgICAgaWQsXG4gICAgICAgIEZ1bmN0aW9uLm1lcmdlUHJvcHMoaW5oZXJpdGVkUHJvcHMsIGRlZmluaXRpb24pXG4gICAgICApO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZnVuY3Rpb24gZGVmaW5pdGlvbiBmb3IgdGhlIFwiJHtpZH1cIiBGdW5jdGlvbmApO1xuICB9XG5cbiAgc3RhdGljIG1lcmdlUHJvcHMoXG4gICAgYmFzZVByb3BzPzogRnVuY3Rpb25Qcm9wcyxcbiAgICBwcm9wcz86IEZ1bmN0aW9uUHJvcHNcbiAgKTogRnVuY3Rpb25Qcm9wcyB7XG4gICAgLy8gTWVyZ2UgZW52aXJvbm1lbnRcbiAgICBjb25zdCBlbnZpcm9ubWVudCA9IHtcbiAgICAgIC4uLihiYXNlUHJvcHM/LmVudmlyb25tZW50IHx8IHt9KSxcbiAgICAgIC4uLihwcm9wcz8uZW52aXJvbm1lbnQgfHwge30pLFxuICAgIH07XG4gICAgY29uc3QgZW52aXJvbm1lbnRQcm9wID1cbiAgICAgIE9iamVjdC5rZXlzKGVudmlyb25tZW50KS5sZW5ndGggPT09IDAgPyB7fSA6IHsgZW52aXJvbm1lbnQgfTtcblxuICAgIC8vIE1lcmdlIGxheWVyc1xuICAgIGNvbnN0IGxheWVycyA9IFsuLi4oYmFzZVByb3BzPy5sYXllcnMgfHwgW10pLCAuLi4ocHJvcHM/LmxheWVycyB8fCBbXSldO1xuICAgIGNvbnN0IGxheWVyc1Byb3AgPSBsYXllcnMubGVuZ3RoID09PSAwID8ge30gOiB7IGxheWVycyB9O1xuXG4gICAgLy8gTWVyZ2UgcGVybWlzc2lvbnNcbiAgICBsZXQgcGVybWlzc2lvbnNQcm9wO1xuICAgIGlmIChiYXNlUHJvcHM/LnBlcm1pc3Npb25zID09PSBcIipcIikge1xuICAgICAgcGVybWlzc2lvbnNQcm9wID0geyBwZXJtaXNzaW9uczogYmFzZVByb3BzLnBlcm1pc3Npb25zIH07XG4gICAgfSBlbHNlIGlmIChwcm9wcz8ucGVybWlzc2lvbnMgPT09IFwiKlwiKSB7XG4gICAgICBwZXJtaXNzaW9uc1Byb3AgPSB7IHBlcm1pc3Npb25zOiBwcm9wcy5wZXJtaXNzaW9ucyB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBwZXJtaXNzaW9ucyA9IChiYXNlUHJvcHM/LnBlcm1pc3Npb25zIHx8IFtdKS5jb25jYXQoXG4gICAgICAgIHByb3BzPy5wZXJtaXNzaW9ucyB8fCBbXVxuICAgICAgKTtcbiAgICAgIHBlcm1pc3Npb25zUHJvcCA9IHBlcm1pc3Npb25zLmxlbmd0aCA9PT0gMCA/IHt9IDogeyBwZXJtaXNzaW9ucyB9O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAuLi4oYmFzZVByb3BzIHx8IHt9KSxcbiAgICAgIC4uLihwcm9wcyB8fCB7fSksXG4gICAgICAuLi5sYXllcnNQcm9wLFxuICAgICAgLi4uZW52aXJvbm1lbnRQcm9wLFxuICAgICAgLi4ucGVybWlzc2lvbnNQcm9wLFxuICAgIH07XG4gIH1cbn1cbiJdfQ==