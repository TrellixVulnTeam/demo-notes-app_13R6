"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.StaticSite = void 0;
const chalk_1 = __importDefault(require("chalk"));
const path = __importStar(require("path"));
const fs = __importStar(require("fs-extra"));
const crypto = __importStar(require("crypto"));
const child_process_1 = require("child_process");
const constructs_1 = require("constructs");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
const s3Assets = __importStar(require("aws-cdk-lib/aws-s3-assets"));
const acm = __importStar(require("aws-cdk-lib/aws-certificatemanager"));
const iam = __importStar(require("aws-cdk-lib/aws-iam"));
const lambda = __importStar(require("aws-cdk-lib/aws-lambda"));
const route53 = __importStar(require("aws-cdk-lib/aws-route53"));
const route53Patterns = __importStar(require("aws-cdk-lib/aws-route53-patterns"));
const route53Targets = __importStar(require("aws-cdk-lib/aws-route53-targets"));
const cloudfront = __importStar(require("aws-cdk-lib/aws-cloudfront"));
const cfOrigins = __importStar(require("aws-cdk-lib/aws-cloudfront-origins"));
const lambda_layer_awscli_1 = require("aws-cdk-lib/lambda-layer-awscli");
const Stack_1 = require("./Stack");
const BaseSite_1 = require("./BaseSite");
/////////////////////
// Construct
/////////////////////
/**
 * The `StaticSite` construct is a higher level CDK construct that makes it easy to create a static website. It provides a simple way to build and deploy the site to an S3 bucket; setup a CloudFront CDN for fast content delivery; and configure a custom domain for the website URL. In addition:
 *
 * - Visitors to the `http://` url will be redirected to the `https://` URL.
 * - If a [domain alias](#domainalias) is configured, visitors to the alias domain will be redirected to the main one. So if `www.example.com` is the domain alias for `example.com`, visitors to `www.example.com` will be redirected to `example.com`.
 *
 * @example
 *
 * The `StaticSite` construct is designed to make it easy to get started with, while allowing for a way to fully configure it as well. Let's look at how, through a couple of examples.
 *
 * ### Creating a plain HTML site
 *
 * Deploys a plain HTML website in the `path/to/src` directory.
 *
 * ```js
 * import { StaticSite } from "@serverless-stack/resources";
 *
 * new StaticSite(stack, "Site", {
 *   path: "path/to/src",
 * });
 * ```
 */
class StaticSite extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        const root = scope.node.root;
        // Local development or skip build => stub asset
        this.isPlaceholder =
            (root.local || root.skipBuild) && !props.disablePlaceholder;
        const buildDir = root.buildDir;
        const fileSizeLimit = root.isJestTest()
            ? // eslint-disable-next-line @typescript-eslint/ban-ts-comment
                // @ts-ignore: "jestFileSizeLimitOverride" not exposed in props
                props.jestFileSizeLimitOverride || 200
            : 200;
        this.props = props;
        this.cdk = {};
        this.awsCliLayer = new lambda_layer_awscli_1.AwsCliLayer(this, "AwsCliLayer");
        this.registerSiteEnvironment();
        // Validate input
        this.validateCustomDomainSettings();
        // Build app
        this.buildApp();
        this.assets = this.bundleAssets(fileSizeLimit, buildDir);
        this.filenamesAsset = this.bundleFilenamesAsset(buildDir);
        // Create Bucket
        this.cdk.bucket = this.createS3Bucket();
        // Create Custom Domain
        this.cdk.hostedZone = this.lookupHostedZone();
        this.cdk.certificate = this.createCertificate();
        // Create S3 Deployment
        const s3deployCR = this.createS3Deployment();
        // Create CloudFront
        this.cdk.distribution = this.createCfDistribution();
        this.cdk.distribution.node.addDependency(s3deployCR);
        // Invalidate CloudFront
        const invalidationCR = this.createCloudFrontInvalidation();
        invalidationCR.node.addDependency(this.cdk.distribution);
        // Connect Custom Domain to CloudFront Distribution
        this.createRoute53Records();
    }
    /**
     * The CloudFront URL of the website.
     */
    get url() {
        return `https://${this.cdk.distribution.distributionDomainName}`;
    }
    /**
     * If the custom domain is enabled, this is the URL of the website with the custom domain.
     */
    get customDomainUrl() {
        const { customDomain } = this.props;
        if (!customDomain) {
            return;
        }
        if (typeof customDomain === "string") {
            return `https://${customDomain}`;
        }
        else {
            return `https://${customDomain.domainName}`;
        }
    }
    /**
     * The ARN of the internally created S3 Bucket.
     */
    get bucketArn() {
        return this.cdk.bucket.bucketArn;
    }
    /**
     * The name of the internally created S3 Bucket.
     */
    get bucketName() {
        return this.cdk.bucket.bucketName;
    }
    /**
     * The ID of the internally created CloudFront Distribution.
     */
    get distributionId() {
        return this.cdk.distribution.distributionId;
    }
    /**
     * The domain name of the internally created CloudFront Distribution.
     */
    get distributionDomain() {
        return this.cdk.distribution.distributionDomainName;
    }
    getConstructMetadata() {
        return {
            type: "StaticSite",
            data: {
                distributionId: this.cdk.distribution.distributionId,
                customDomainUrl: this.customDomainUrl,
            },
        };
    }
    buildApp() {
        if (this.isPlaceholder) {
            return;
        }
        const { path: sitePath, buildCommand } = this.props;
        // validate site path exists
        if (!fs.existsSync(sitePath)) {
            throw new Error(`No path found at "${path.resolve(sitePath)}" for the "${this.node.id}" StaticSite.`);
        }
        // build
        if (buildCommand) {
            try {
                console.log(chalk_1.default.grey(`Building static site ${sitePath}`));
                (0, child_process_1.execSync)(buildCommand, {
                    cwd: sitePath,
                    stdio: "inherit",
                    env: Object.assign(Object.assign({}, process.env), (0, BaseSite_1.getBuildCmdEnvironment)(this.props.environment)),
                });
            }
            catch (e) {
                throw new Error(`There was a problem building the "${this.node.id}" StaticSite.`);
            }
        }
    }
    bundleAssets(fileSizeLimit, buildDir) {
        if (this.isPlaceholder) {
            return [
                new s3Assets.Asset(this, "Asset", {
                    path: path.resolve(__dirname, "../assets/StaticSite/stub"),
                }),
            ];
        }
        const { path: sitePath } = this.props;
        const buildOutput = this.props.buildOutput || ".";
        // validate buildOutput exists
        const siteOutputPath = path.resolve(path.join(sitePath, buildOutput));
        if (!fs.existsSync(siteOutputPath)) {
            throw new Error(`No build output found at "${siteOutputPath}" for the "${this.node.id}" StaticSite.`);
        }
        // create zip files
        const script = path.join(__dirname, "../assets/BaseSite/archiver.js");
        const zipPath = path.resolve(path.join(buildDir, `StaticSite-${this.node.id}-${this.node.addr}`));
        // clear zip path to ensure no partX.zip remain from previous build
        fs.removeSync(zipPath);
        const cmd = ["node", script, siteOutputPath, zipPath, fileSizeLimit].join(" ");
        try {
            (0, child_process_1.execSync)(cmd, {
                cwd: sitePath,
                stdio: "inherit",
            });
        }
        catch (e) {
            throw new Error(`There was a problem generating the "${this.node.id}" StaticSite package.`);
        }
        // create assets
        const assets = [];
        for (let partId = 0;; partId++) {
            const zipFilePath = path.join(zipPath, `part${partId}.zip`);
            if (!fs.existsSync(zipFilePath)) {
                break;
            }
            assets.push(new s3Assets.Asset(this, `Asset${partId}`, {
                path: zipFilePath,
            }));
        }
        return assets;
    }
    bundleFilenamesAsset(buildDir) {
        if (this.isPlaceholder) {
            return;
        }
        if (this.props.purgeFiles === false) {
            return;
        }
        const zipPath = path.resolve(path.join(buildDir, `StaticSite-${this.node.id}-${this.node.addr}`));
        // create assets
        const filenamesPath = path.join(zipPath, `filenames`);
        if (!fs.existsSync(filenamesPath)) {
            throw new Error(`There was a problem generating the "${this.node.id}" StaticSite package.`);
        }
        return new s3Assets.Asset(this, `AssetFilenames`, {
            path: filenamesPath,
        });
    }
    createS3Bucket() {
        var _a, _b;
        const { cdk } = this.props;
        // Validate s3Bucket
        if ((_a = cdk === null || cdk === void 0 ? void 0 : cdk.bucket) === null || _a === void 0 ? void 0 : _a.websiteIndexDocument) {
            throw new Error(`Do not configure the "s3Bucket.websiteIndexDocument". Use the "indexPage" to configure the StaticSite index page.`);
        }
        if ((_b = cdk === null || cdk === void 0 ? void 0 : cdk.bucket) === null || _b === void 0 ? void 0 : _b.websiteErrorDocument) {
            throw new Error(`Do not configure the "s3Bucket.websiteErrorDocument". Use the "errorPage" to configure the StaticSite index page.`);
        }
        return new s3.Bucket(this, "S3Bucket", Object.assign({ autoDeleteObjects: true, removalPolicy: aws_cdk_lib_1.RemovalPolicy.DESTROY }, cdk === null || cdk === void 0 ? void 0 : cdk.bucket));
    }
    createS3Deployment() {
        var _a;
        const { fileOptions } = this.props;
        // Create a Lambda function that will be doing the uploading
        const uploader = new lambda.Function(this, "S3Uploader", {
            code: lambda.Code.fromAsset(path.join(__dirname, "../assets/BaseSite/custom-resource")),
            layers: [this.awsCliLayer],
            runtime: lambda.Runtime.PYTHON_3_7,
            handler: "s3-upload.handler",
            timeout: aws_cdk_lib_1.Duration.minutes(15),
            memorySize: 1024,
        });
        this.cdk.bucket.grantReadWrite(uploader);
        this.assets.forEach((asset) => asset.grantRead(uploader));
        // Create the custom resource function
        const handler = new lambda.Function(this, "S3Handler", {
            code: lambda.Code.fromAsset(path.join(__dirname, "../assets/BaseSite/custom-resource")),
            layers: [this.awsCliLayer],
            runtime: lambda.Runtime.PYTHON_3_7,
            handler: "s3-handler.handler",
            timeout: aws_cdk_lib_1.Duration.minutes(15),
            memorySize: 1024,
            environment: {
                UPLOADER_FUNCTION_NAME: uploader.functionName,
            },
        });
        this.cdk.bucket.grantReadWrite(handler);
        (_a = this.filenamesAsset) === null || _a === void 0 ? void 0 : _a.grantRead(handler);
        uploader.grantInvoke(handler);
        // Create custom resource
        return new aws_cdk_lib_1.CustomResource(this, "S3Deployment", {
            serviceToken: handler.functionArn,
            resourceType: "Custom::SSTBucketDeployment",
            properties: {
                Sources: this.assets.map((asset) => ({
                    BucketName: asset.s3BucketName,
                    ObjectKey: asset.s3ObjectKey,
                })),
                DestinationBucketName: this.cdk.bucket.bucketName,
                Filenames: this.filenamesAsset && {
                    BucketName: this.filenamesAsset.s3BucketName,
                    ObjectKey: this.filenamesAsset.s3ObjectKey,
                },
                FileOptions: (fileOptions || []).map(({ exclude, include, cacheControl }) => {
                    if (typeof exclude === "string") {
                        exclude = [exclude];
                    }
                    if (typeof include === "string") {
                        include = [include];
                    }
                    const options = [];
                    exclude.forEach((per) => options.push("--exclude", per));
                    include.forEach((per) => options.push("--include", per));
                    options.push("--cache-control", cacheControl);
                    return options;
                }),
                ReplaceValues: this.getS3ContentReplaceValues(),
            },
        });
    }
    /////////////////////
    // CloudFront Distribution
    /////////////////////
    createCfDistribution() {
        var _a, _b, _c, _d, _e;
        const { cdk, customDomain } = this.props;
        const indexPage = this.props.indexPage || "index.html";
        const errorPage = this.props.errorPage;
        // Validate input
        if ((_a = cdk === null || cdk === void 0 ? void 0 : cdk.distribution) === null || _a === void 0 ? void 0 : _a.certificate) {
            throw new Error(`Do not configure the "cfDistribution.certificate". Use the "customDomain" to configure the StaticSite domain certificate.`);
        }
        if ((_b = cdk === null || cdk === void 0 ? void 0 : cdk.distribution) === null || _b === void 0 ? void 0 : _b.domainNames) {
            throw new Error(`Do not configure the "cfDistribution.domainNames". Use the "customDomain" to configure the StaticSite domain.`);
        }
        // Build domainNames
        const domainNames = [];
        if (!customDomain) {
            // no domain
        }
        else if (typeof customDomain === "string") {
            domainNames.push(customDomain);
        }
        else {
            domainNames.push(customDomain.domainName);
            if (customDomain.alternateNames) {
                if (!((_c = customDomain.cdk) === null || _c === void 0 ? void 0 : _c.certificate))
                    throw new Error("Certificates for alternate domains cannot be automatically created. Please specify certificate to use");
                domainNames.push(...customDomain.alternateNames);
            }
        }
        // Build errorResponses
        let errorResponses;
        // case: sst start => showing stub site, and redirect all routes to the index page
        if (this.isPlaceholder) {
            errorResponses = (0, BaseSite_1.buildErrorResponsesForRedirectToIndex)(indexPage);
        }
        else if (errorPage) {
            if ((_d = cdk === null || cdk === void 0 ? void 0 : cdk.distribution) === null || _d === void 0 ? void 0 : _d.errorResponses) {
                throw new Error(`Cannot configure the "cfDistribution.errorResponses" when "errorPage" is passed in. Use one or the other to configure the behavior for error pages.`);
            }
            errorResponses =
                errorPage === "redirect_to_index_page"
                    ? (0, BaseSite_1.buildErrorResponsesForRedirectToIndex)(indexPage)
                    : (0, BaseSite_1.buildErrorResponsesFor404ErrorPage)(errorPage);
        }
        // Create CloudFront distribution
        return new cloudfront.Distribution(this, "Distribution", Object.assign(Object.assign({ 
            // these values can be overwritten by cfDistributionProps
            defaultRootObject: indexPage, errorResponses }, cdk === null || cdk === void 0 ? void 0 : cdk.distribution), { 
            // these values can NOT be overwritten by cfDistributionProps
            domainNames, certificate: this.cdk.certificate, defaultBehavior: Object.assign({ origin: new cfOrigins.S3Origin(this.cdk.bucket), viewerProtocolPolicy: cloudfront.ViewerProtocolPolicy.REDIRECT_TO_HTTPS }, (_e = cdk === null || cdk === void 0 ? void 0 : cdk.distribution) === null || _e === void 0 ? void 0 : _e.defaultBehavior) }));
    }
    createCloudFrontInvalidation() {
        // Create a Lambda function that will be doing the invalidation
        const invalidator = new lambda.Function(this, "CloudFrontInvalidator", {
            code: lambda.Code.fromAsset(path.join(__dirname, "../assets/BaseSite/custom-resource")),
            layers: [this.awsCliLayer],
            runtime: lambda.Runtime.PYTHON_3_7,
            handler: "cf-invalidate.handler",
            timeout: aws_cdk_lib_1.Duration.minutes(15),
            memorySize: 1024,
        });
        // Grant permissions to invalidate CF Distribution
        invalidator.addToRolePolicy(new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: [
                "cloudfront:GetInvalidation",
                "cloudfront:CreateInvalidation",
            ],
            resources: ["*"],
        }));
        // Need the AssetHash field so the CR gets updated on each deploy
        const assetsHash = crypto
            .createHash("md5")
            .update(this.assets.map(({ assetHash }) => assetHash).join(""))
            .digest("hex");
        // Create custom resource
        const waitForInvalidation = this.props.waitForInvalidation === false ? false : true;
        return new aws_cdk_lib_1.CustomResource(this, "CloudFrontInvalidation", {
            serviceToken: invalidator.functionArn,
            resourceType: "Custom::SSTCloudFrontInvalidation",
            properties: {
                AssetsHash: assetsHash,
                DistributionId: this.cdk.distribution.distributionId,
                DistributionPaths: ["/*"],
                WaitForInvalidation: waitForInvalidation,
            },
        });
    }
    /////////////////////
    // Custom Domain
    /////////////////////
    validateCustomDomainSettings() {
        var _a;
        const { customDomain } = this.props;
        if (!customDomain) {
            return;
        }
        if (typeof customDomain === "string") {
            return;
        }
        if (customDomain.isExternalDomain === true) {
            if (!((_a = customDomain.cdk) === null || _a === void 0 ? void 0 : _a.certificate)) {
                throw new Error(`A valid certificate is required when "isExternalDomain" is set to "true".`);
            }
            if (customDomain.domainAlias) {
                throw new Error(`Domain alias is only supported for domains hosted on Amazon Route 53. Do not set the "customDomain.domainAlias" when "isExternalDomain" is enabled.`);
            }
            if (customDomain.hostedZone) {
                throw new Error(`Hosted zones can only be configured for domains hosted on Amazon Route 53. Do not set the "customDomain.hostedZone" when "isExternalDomain" is enabled.`);
            }
        }
    }
    lookupHostedZone() {
        var _a;
        const { customDomain } = this.props;
        // Skip if customDomain is not configured
        if (!customDomain) {
            return;
        }
        let hostedZone;
        if (typeof customDomain === "string") {
            hostedZone = route53.HostedZone.fromLookup(this, "HostedZone", {
                domainName: customDomain,
            });
        }
        else if ((_a = customDomain.cdk) === null || _a === void 0 ? void 0 : _a.hostedZone) {
            hostedZone = customDomain.cdk.hostedZone;
        }
        else if (typeof customDomain.hostedZone === "string") {
            hostedZone = route53.HostedZone.fromLookup(this, "HostedZone", {
                domainName: customDomain.hostedZone,
            });
        }
        else if (typeof customDomain.domainName === "string") {
            // Skip if domain is not a Route53 domain
            if (customDomain.isExternalDomain === true) {
                return;
            }
            hostedZone = route53.HostedZone.fromLookup(this, "HostedZone", {
                domainName: customDomain.domainName,
            });
        }
        else {
            hostedZone = customDomain.hostedZone;
        }
        return hostedZone;
    }
    createCertificate() {
        var _a, _b;
        const { customDomain } = this.props;
        if (!customDomain) {
            return;
        }
        let acmCertificate;
        // HostedZone is set for Route 53 domains
        if (this.cdk.hostedZone) {
            if (typeof customDomain === "string") {
                acmCertificate = new acm.DnsValidatedCertificate(this, "Certificate", {
                    domainName: customDomain,
                    hostedZone: this.cdk.hostedZone,
                    region: "us-east-1",
                });
            }
            else if ((_a = customDomain.cdk) === null || _a === void 0 ? void 0 : _a.certificate) {
                acmCertificate = customDomain.cdk.certificate;
            }
            else {
                acmCertificate = new acm.DnsValidatedCertificate(this, "Certificate", {
                    domainName: customDomain.domainName,
                    hostedZone: this.cdk.hostedZone,
                    region: "us-east-1",
                });
            }
        }
        // HostedZone is NOT set for non-Route 53 domains
        else {
            if (typeof customDomain !== "string") {
                acmCertificate = (_b = customDomain.cdk) === null || _b === void 0 ? void 0 : _b.certificate;
            }
        }
        return acmCertificate;
    }
    createRoute53Records() {
        const { customDomain } = this.props;
        if (!customDomain || !this.cdk.hostedZone) {
            return;
        }
        let recordName;
        let domainAlias;
        if (typeof customDomain === "string") {
            recordName = customDomain;
        }
        else {
            recordName = customDomain.domainName;
            domainAlias = customDomain.domainAlias;
        }
        // Create DNS record
        const recordProps = {
            recordName,
            zone: this.cdk.hostedZone,
            target: route53.RecordTarget.fromAlias(new route53Targets.CloudFrontTarget(this.cdk.distribution)),
        };
        new route53.ARecord(this, "AliasRecord", recordProps);
        new route53.AaaaRecord(this, "AliasRecordAAAA", recordProps);
        // Create Alias redirect record
        if (domainAlias) {
            new route53Patterns.HttpsRedirect(this, "Redirect", {
                zone: this.cdk.hostedZone,
                recordNames: [domainAlias],
                targetDomain: recordName,
            });
        }
    }
    /////////////////////
    // Helper Functions
    /////////////////////
    getS3ContentReplaceValues() {
        const replaceValues = this.props.replaceValues || [];
        Object.entries(this.props.environment || {})
            .filter(([, value]) => aws_cdk_lib_1.Token.isUnresolved(value))
            .forEach(([key, value]) => {
            const token = `{{ ${key} }}`;
            replaceValues.push({
                files: "**/*.html",
                search: token,
                replace: value,
            }, {
                files: "**/*.js",
                search: token,
                replace: value,
            });
        });
        return replaceValues;
    }
    registerSiteEnvironment() {
        const environmentOutputs = {};
        for (const [key, value] of Object.entries(this.props.environment || {})) {
            const outputId = `SstSiteEnv_${key}`;
            const output = new aws_cdk_lib_1.CfnOutput(this, outputId, { value });
            environmentOutputs[key] = Stack_1.Stack.of(this).getLogicalId(output);
        }
        const root = this.node.root;
        root.registerSiteEnvironment({
            id: this.node.id,
            path: this.props.path,
            stack: Stack_1.Stack.of(this).node.id,
            environmentOutputs,
        });
    }
}
exports.StaticSite = StaticSite;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhdGljU2l0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9TdGF0aWNTaXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsa0RBQTBCO0FBQzFCLDJDQUE2QjtBQUM3Qiw2Q0FBK0I7QUFDL0IsK0NBQWlDO0FBQ2pDLGlEQUF5QztBQUV6QywyQ0FBdUM7QUFDdkMsNkNBTXFCO0FBQ3JCLHVEQUF5QztBQUN6QyxvRUFBc0Q7QUFDdEQsd0VBQTBEO0FBQzFELHlEQUEyQztBQUMzQywrREFBaUQ7QUFDakQsaUVBQW1EO0FBQ25ELGtGQUFvRTtBQUNwRSxnRkFBa0U7QUFDbEUsdUVBQXlEO0FBQ3pELDhFQUFnRTtBQUNoRSx5RUFBOEQ7QUFHOUQsbUNBQWdDO0FBQ2hDLHlDQVFvQjtBQXdPcEIscUJBQXFCO0FBQ3JCLFlBQVk7QUFDWixxQkFBcUI7QUFFckI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXFCRztBQUNILE1BQWEsVUFBVyxTQUFRLHNCQUFTO0lBeUJ2QyxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQXNCO1FBQzlELEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFakIsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFXLENBQUM7UUFDcEMsZ0RBQWdEO1FBQ2hELElBQUksQ0FBQyxhQUFhO1lBQ2hCLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsa0JBQWtCLENBQUM7UUFDOUQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUMvQixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ3JDLENBQUMsQ0FBQyw2REFBNkQ7Z0JBQzdELCtEQUErRDtnQkFDL0QsS0FBSyxDQUFDLHlCQUF5QixJQUFJLEdBQUc7WUFDeEMs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QkFBUyxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ3hELGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxHQUFHLGFBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQy9EO1FBRUQsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFXLENBQUM7UUFDbkMsSUFBSSxDQUFDLHVCQUF1QixDQUFDO1lBQzNCLEVBQUUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDaEIsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSTtZQUNyQixLQUFLLEVBQUUsYUFBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUM3QixrQkFBa0I7U0FDZSxDQUFDLENBQUM7SUFDdkMsQ0FBQztDQUNGO0FBanBCRCxnQ0FpcEJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNoYWxrIGZyb20gXCJjaGFsa1wiO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzLWV4dHJhXCI7XG5pbXBvcnQgKiBhcyBjcnlwdG8gZnJvbSBcImNyeXB0b1wiO1xuaW1wb3J0IHsgZXhlY1N5bmMgfSBmcm9tIFwiY2hpbGRfcHJvY2Vzc1wiO1xuXG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tIFwiY29uc3RydWN0c1wiO1xuaW1wb3J0IHtcbiAgVG9rZW4sXG4gIER1cmF0aW9uLFxuICBDZm5PdXRwdXQsXG4gIFJlbW92YWxQb2xpY3ksXG4gIEN1c3RvbVJlc291cmNlLFxufSBmcm9tIFwiYXdzLWNkay1saWJcIjtcbmltcG9ydCAqIGFzIHMzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtczNcIjtcbmltcG9ydCAqIGFzIHMzQXNzZXRzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtczMtYXNzZXRzXCI7XG5pbXBvcnQgKiBhcyBhY20gZnJvbSBcImF3cy1jZGstbGliL2F3cy1jZXJ0aWZpY2F0ZW1hbmFnZXJcIjtcbmltcG9ydCAqIGFzIGlhbSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWlhbVwiO1xuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtbGFtYmRhXCI7XG5pbXBvcnQgKiBhcyByb3V0ZTUzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3Mtcm91dGU1M1wiO1xuaW1wb3J0ICogYXMgcm91dGU1M1BhdHRlcm5zIGZyb20gXCJhd3MtY2RrLWxpYi9hd3Mtcm91dGU1My1wYXR0ZXJuc1wiO1xuaW1wb3J0ICogYXMgcm91dGU1M1RhcmdldHMgZnJvbSBcImF3cy1jZGstbGliL2F3cy1yb3V0ZTUzLXRhcmdldHNcIjtcbmltcG9ydCAqIGFzIGNsb3VkZnJvbnQgZnJvbSBcImF3cy1jZGstbGliL2F3cy1jbG91ZGZyb250XCI7XG5pbXBvcnQgKiBhcyBjZk9yaWdpbnMgZnJvbSBcImF3cy1jZGstbGliL2F3cy1jbG91ZGZyb250LW9yaWdpbnNcIjtcbmltcG9ydCB7IEF3c0NsaUxheWVyIH0gZnJvbSBcImF3cy1jZGstbGliL2xhbWJkYS1sYXllci1hd3NjbGlcIjtcblxuaW1wb3J0IHsgQXBwIH0gZnJvbSBcIi4vQXBwXCI7XG5pbXBvcnQgeyBTdGFjayB9IGZyb20gXCIuL1N0YWNrXCI7XG5pbXBvcnQge1xuICBCYXNlU2l0ZURvbWFpblByb3BzLFxuICBCYXNlU2l0ZVJlcGxhY2VQcm9wcyxcbiAgQmFzZVNpdGVDZGtEaXN0cmlidXRpb25Qcm9wcyxcbiAgQmFzZVNpdGVFbnZpcm9ubWVudE91dHB1dHNJbmZvLFxuICBnZXRCdWlsZENtZEVudmlyb25tZW50LFxuICBidWlsZEVycm9yUmVzcG9uc2VzRm9yNDA0RXJyb3JQYWdlLFxuICBidWlsZEVycm9yUmVzcG9uc2VzRm9yUmVkaXJlY3RUb0luZGV4LFxufSBmcm9tIFwiLi9CYXNlU2l0ZVwiO1xuaW1wb3J0IHsgU1NUQ29uc3RydWN0IH0gZnJvbSBcIi4vQ29uc3RydWN0XCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGljU2l0ZUZpbGVPcHRpb25zIHtcbiAgZXhjbHVkZTogc3RyaW5nIHwgc3RyaW5nW107XG4gIGluY2x1ZGU6IHN0cmluZyB8IHN0cmluZ1tdO1xuICBjYWNoZUNvbnRyb2w6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdGF0aWNTaXRlUHJvcHMge1xuICBjZGs/OiB7XG4gICAgLyoqXG4gICAgICogUGFzcyBpbiBhIGJ1Y2tldCBjb25maWd1cmF0aW9uIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHNldHRpbmdzIHRoaXMgY29uc3RydWN0IHVzZXMgdG8gY3JlYXRlIHRoZSBDREsgYEJ1Y2tldGAgaW50ZXJuYWxseS5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBganNcbiAgICAgKiBuZXcgU3RhdGljU2l0ZShzdGFjaywgXCJTaXRlXCIsIHtcbiAgICAgKiAgIHBhdGg6IFwicGF0aC90by9zcmNcIixcbiAgICAgKiAgIGNkazoge1xuICAgICAqICAgICBidWNrZXQ6IHtcbiAgICAgKiAgICAgICBidWNrZXROYW1lOiBcIm15YnVja2V0XCIsXG4gICAgICogICAgIH0sXG4gICAgICogICB9XG4gICAgICogfSk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgYnVja2V0PzogczMuQnVja2V0UHJvcHM7XG4gICAgLyoqXG4gICAgICogQ29uZmlndXJlIHRoZSBpbnRlcm5hbGx5IGNyZWF0ZWQgQ0RLIGBEaXN0cmlidXRpb25gIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGBqc1xuICAgICAqIG5ldyBTdGF0aWNTaXRlKHN0YWNrLCBcIlNpdGVcIiwge1xuICAgICAqICAgcGF0aDogXCJwYXRoL3RvL3NyY1wiLFxuICAgICAqICAgY2RrOiB7XG4gICAgICogICAgIGRpc3RyaWJ1dGlvbjoge1xuICAgICAqICAgICAgIGNvbW1lbnQ6IFwiRGlzdHJpYnV0aW9uIGZvciBteSBSZWFjdCB3ZWJzaXRlXCIsXG4gICAgICogICAgIH0sXG4gICAgICogICB9XG4gICAgICogfSk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgZGlzdHJpYnV0aW9uPzogU3RhdGljU2l0ZUNka0Rpc3RyaWJ1dGlvblByb3BzO1xuICB9O1xuICAvKipcbiAgICogUGF0aCB0byB0aGUgZGlyZWN0b3J5IHdoZXJlIHRoZSB3ZWJzaXRlIHNvdXJjZSBpcyBsb2NhdGVkLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBuZXcgU3RhdGljU2l0ZShzdGFjaywgXCJTaXRlXCIsIHtcbiAgICogICBwYXRoOiBcInBhdGgvdG8vc3JjXCIsXG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICovXG4gIHBhdGg6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBpbmRleCBwYWdlIChlLmcuIFwiaW5kZXguaHRtbFwiKSBvZiB0aGUgd2Vic2l0ZS5cbiAgICpcbiAgICogQGRlZmF1bHQgXCJpbmRleC5odG1sXCJcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IFN0YXRpY1NpdGUoc3RhY2ssIFwiU2l0ZVwiLCB7XG4gICAqICAgaW5kZXhQYWdlOiBcIm90aGVyLWluZGV4Lmh0bWxcIixcbiAgICogfSk7XG4gICAqIGBgYFxuICAgKi9cbiAgaW5kZXhQYWdlPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGVycm9yIHBhZ2UgYmVoYXZpb3IgZm9yIHRoaXMgd2Vic2l0ZS4gVGFrZXMgZWl0aGVyIGFuIEhUTUwgcGFnZS5cbiAgICogYGBgXG4gICAqIDQwNC5odG1sXG4gICAqIGBgYFxuICAgKiBPciB0aGUgY29uc3RhbnQgYFwicmVkaXJlY3RfdG9faW5kZXhfcGFnZVwiYCB0byByZWRpcmVjdCB0byB0aGUgaW5kZXggcGFnZS5cbiAgICpcbiAgICogTm90ZSB0aGF0LCBpZiB0aGUgZXJyb3IgcGFnZXMgYXJlIHJlZGlyZWN0ZWQgdG8gdGhlIGluZGV4IHBhZ2UsIHRoZSBIVFRQIHN0YXR1cyBjb2RlIGlzIHNldCB0byAyMDAuIFRoaXMgaXMgbmVjZXNzYXJ5IGZvciBzaW5nbGUgcGFnZSBhcHBzLCB0aGF0IGhhbmRsZSA0MDQgcGFnZXMgb24gdGhlIGNsaWVudCBzaWRlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBuZXcgU3RhdGljU2l0ZShzdGFjaywgXCJTaXRlXCIsIHtcbiAgICogICBlcnJvclBhZ2U6IFwicmVkaXJlY3RfdG9faW5kZXhfcGFnZVwiLFxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqL1xuICBlcnJvclBhZ2U/OiBcInJlZGlyZWN0X3RvX2luZGV4X3BhZ2VcIiB8IE9taXQ8c3RyaW5nLCBcInJlZGlyZWN0X3RvX2luZGV4X3BhZ2VcIj47XG4gIC8qKlxuICAgKiBUaGUgY29tbWFuZCBmb3IgYnVpbGRpbmcgdGhlIHdlYnNpdGVcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IFN0YXRpY1NpdGUoc3RhY2ssIFwiU2l0ZVwiLCB7XG4gICAqICAgYnVpbGRDb21tYW5kOiBcIm5wbSBydW4gYnVpbGRcIixcbiAgICogfSk7XG4gICAqIGBgYFxuICAgKi9cbiAgYnVpbGRDb21tYW5kPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGRpcmVjdG9yeSB3aXRoIHRoZSBjb250ZW50IHRoYXQgd2lsbCBiZSB1cGxvYWRlZCB0byB0aGUgUzMgYnVja2V0LiBJZiBhIGBidWlsZENvbW1hbmRgIGlzIHByb3ZpZGVkLCB0aGlzIGlzIHVzdWFsbHkgd2hlcmUgdGhlIGJ1aWxkIG91dHB1dCBpcyBnZW5lcmF0ZWQuIFRoZSBwYXRoIGlzIHJlbGF0aXZlIHRvIHRoZSBbYHBhdGhgXSgjcGF0aCkgd2hlcmUgdGhlIHdlYnNpdGUgc291cmNlIGlzIGxvY2F0ZWQuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIG5ldyBTdGF0aWNTaXRlKHN0YWNrLCBcIlNpdGVcIiwge1xuICAgKiAgIGJ1aWxkT3V0cHV0OiBcImRpc3RcIixcbiAgICogfSk7XG4gICAqIGBgYFxuICAgKi9cbiAgYnVpbGRPdXRwdXQ/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBQYXNzIGluIGEgbGlzdCBvZiBmaWxlIG9wdGlvbnMgdG8gY29uZmlndXJlIGNhY2hlIGNvbnRyb2wgZm9yIGRpZmZlcmVudCBmaWxlcy4gQmVoaW5kIHRoZSBzY2VuZXMsIHRoZSBgU3RhdGljU2l0ZWAgY29uc3RydWN0IHVzZXMgYSBjb21iaW5hdGlvbiBvZiB0aGUgYHMzIGNwYCBhbmQgYHMzIHN5bmNgIGNvbW1hbmRzIHRvIHVwbG9hZCB0aGUgd2Vic2l0ZSBjb250ZW50IHRvIHRoZSBTMyBidWNrZXQuIEFuIGBzMyBjcGAgY29tbWFuZCBpcyBydW4gZm9yIGVhY2ggZmlsZSBvcHRpb24gYmxvY2ssIGFuZCB0aGUgb3B0aW9ucyBhcmUgcGFzc2VkIGluIGFzIHRoZSBjb21tYW5kIG9wdGlvbnMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIG5ldyBTdGF0aWNTaXRlKHN0YWNrLCBcIlNpdGVcIiwge1xuICAgKiAgIGJ1aWxkT3V0cHV0OiBcImRpc3RcIixcbiAgICogICBmaWxlT3B0aW9uczoge1xuICAgKiAgICAgZXhjbHVkZTogXCIqXCIsXG4gICAqICAgICBpbmNsdWRlOiBcIiouanNcIixcbiAgICogICAgIGNhY2hlQ29udHJvbDogXCJtYXgtYWdlPTMxNTM2MDAwLHB1YmxpYyxpbW11dGFibGVcIixcbiAgICogICB9XG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICovXG4gIGZpbGVPcHRpb25zPzogU3RhdGljU2l0ZUZpbGVPcHRpb25zW107XG4gIC8qKlxuICAgKiBQYXNzIGluIGEgbGlzdCBvZiBwbGFjZWhvbGRlciB2YWx1ZXMgdG8gYmUgcmVwbGFjZWQgaW4gdGhlIHdlYnNpdGUgY29udGVudC4gRm9yIGV4YW1wbGUsIHRoZSBmb2xsb3cgY29uZmlndXJhdGlvbjpcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IFN0YXRpY1NpdGUoc3RhY2ssIFwiUmVhY3RTaXRlXCIsIHtcbiAgICogICByZXBsYWNlVmFsdWVzOiBbXG4gICAqICAgICB7XG4gICAqICAgICAgIGZpbGVzOiBcIiouanNcIixcbiAgICogICAgICAgc2VhcmNoOiBcInt7IEFQSV9VUkwgfX1cIixcbiAgICogICAgICAgcmVwbGFjZTogYXBpLnVybCxcbiAgICogICAgIH0sXG4gICAqICAgICB7XG4gICAqICAgICAgIGZpbGVzOiBcIiouanNcIixcbiAgICogICAgICAgc2VhcmNoOiBcInt7IENPR05JVE9fVVNFUl9QT09MX0NMSUVOVF9JRCB9fVwiLFxuICAgKiAgICAgICByZXBsYWNlOiBhdXRoLmNvZ25pdG9Vc2VyUG9vbENsaWVudC51c2VyUG9vbENsaWVudElkLFxuICAgKiAgICAgfSxcbiAgICogICBdLFxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqL1xuICByZXBsYWNlVmFsdWVzPzogU3RhdGljU2l0ZVJlcGxhY2VQcm9wc1tdO1xuICAvKipcbiAgICogVGhlIGN1c3RvbURvbWFpbiBmb3IgdGhpcyB3ZWJzaXRlLiBTU1Qgc3VwcG9ydHMgZG9tYWlucyB0aGF0IGFyZSBob3N0ZWQgZWl0aGVyIG9uIFtSb3V0ZSA1M10oaHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9yb3V0ZTUzLykgb3IgZXh0ZXJuYWxseS5cbiAgICpcbiAgICogTm90ZSB0aGF0IHlvdSBjYW4gYWxzbyBtaWdyYXRlIGV4dGVybmFsbHkgaG9zdGVkIGRvbWFpbnMgdG8gUm91dGUgNTMgYnkgW2ZvbGxvd2luZyB0aGlzIGd1aWRlXShodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vUm91dGU1My9sYXRlc3QvRGV2ZWxvcGVyR3VpZGUvTWlncmF0aW5nRE5TLmh0bWwpLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBuZXcgU3RhdGljU2l0ZShzdGFjaywgXCJTaXRlXCIsIHtcbiAgICogICBwYXRoOiBcInBhdGgvdG8vc3JjXCIsXG4gICAqICAgY3VzdG9tRG9tYWluOiBcImRvbWFpbi5jb21cIixcbiAgICogfSk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBuZXcgU3RhdGljU2l0ZShzdGFjaywgXCJTaXRlXCIsIHtcbiAgICogICBwYXRoOiBcInBhdGgvdG8vc3JjXCIsXG4gICAqICAgY3VzdG9tRG9tYWluOiB7XG4gICAqICAgICBkb21haW5OYW1lOiBcImRvbWFpbi5jb21cIixcbiAgICogICAgIGRvbWFpbkFsaWFzOiBcInd3dy5kb21haW4uY29tXCIsXG4gICAqICAgICBob3N0ZWRab25lOiBcImRvbWFpbi5jb21cIlxuICAgKiAgIH1cbiAgICogfSk7XG4gICAqIGBgYFxuICAgKi9cbiAgY3VzdG9tRG9tYWluPzogc3RyaW5nIHwgU3RhdGljU2l0ZURvbWFpblByb3BzO1xuICAvKipcbiAgICogQW4gb2JqZWN0IHdpdGggdGhlIGtleSBiZWluZyB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGUgbmFtZS4gTm90ZSwgdGhpcyByZXF1aXJlcyB5b3VyIGJ1aWxkIHRvb2wgdG8gc3VwcG9ydCBidWlsZCB0aW1lIGVudmlyb25tZW50IHZhcmlhYmxlcy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IFN0YXRpY1NpdGUoc3RhY2ssIFwiUmVhY3RTaXRlXCIsIHtcbiAgICogICBlbnZpcm9ubWVudDoge1xuICAgKiAgICAgUkVBQ1RfQVBQX0FQSV9VUkw6IGFwaS51cmwsXG4gICAqICAgICBSRUFDVF9BUFBfVVNFUl9QT09MX0NMSUVOVDogYXV0aC5jb2duaXRvVXNlclBvb2xDbGllbnQudXNlclBvb2xDbGllbnRJZCxcbiAgICogICB9LFxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqL1xuICBlbnZpcm9ubWVudD86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gIC8qKlxuICAgKiBXaGlsZSBkZXBsb3lpbmcsIFNTVCByZW1vdmVzIG9sZCBmaWxlcyB0aGF0IG5vIGxvbmdlciBleGlzdC4gUGFzcyBpbiBgZmFsc2VgIHRvIGtlZXAgdGhlIG9sZCBmaWxlcyBhcm91bmQuXG4gICAqXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IFN0YXRpY1NpdGUoc3RhY2ssIFwiUmVhY3RTaXRlXCIsIHtcbiAgICogIHB1cmdlOiBmYWxzZVxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqL1xuICBwdXJnZUZpbGVzPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFdoZW4gcnVubmluZyBgc3N0IHN0YXJ0YCwgYSBwbGFjZWhvbGRlciBzaXRlIGlzIGRlcGxveWVkLiBUaGlzIGlzIHRvIGVuc3VyZSB0aGF0IHRoZSBzaXRlIGNvbnRlbnQgcmVtYWlucyB1bmNoYW5nZWQsIGFuZCBzdWJzZXF1ZW50IGBzc3Qgc3RhcnRgIGNhbiBzdGFydCB1cCBxdWlja2x5LlxuICAgKlxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBuZXcgU3RhdGljU2l0ZShzdGFjaywgXCJSZWFjdFNpdGVcIiwge1xuICAgKiAgZGlzYWJsZVBsYWNlaG9sZGVyOiB0cnVlXG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICovXG4gIGRpc2FibGVQbGFjZWhvbGRlcj86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFdoaWxlIGRlcGxveWluZywgU1NUIHdhaXRzIGZvciB0aGUgQ2xvdWRGcm9udCBjYWNoZSBpbnZhbGlkYXRpb24gcHJvY2VzcyB0byBmaW5pc2guIFRoaXMgZW5zdXJlcyB0aGF0IHRoZSBuZXcgY29udGVudCB3aWxsIGJlIHNlcnZlZCBvbmNlIHRoZSBkZXBsb3kgY29tbWFuZCBmaW5pc2hlcy4gSG93ZXZlciwgdGhpcyBwcm9jZXNzIGNhbiBzb21ldGltZXMgdGFrZSBtb3JlIHRoYW4gNSBtaW5zLiBGb3Igbm9uLXByb2QgZW52aXJvbm1lbnRzIGl0IG1pZ2h0IG1ha2Ugc2Vuc2UgdG8gcGFzcyBpbiBgZmFsc2VgLiBUaGF0J2xsIHNraXAgd2FpdGluZyBmb3IgdGhlIGNhY2hlIHRvIGludmFsaWRhdGUgYW5kIHNwZWVkIHVwIHRoZSBkZXBsb3kgcHJvY2Vzcy5cbiAgICpcbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBuZXcgU3RhdGljU2l0ZShzdGFjaywgXCJSZWFjdFNpdGVcIiwge1xuICAgKiAgd2FpdEZvckludmFsaWRhdGlvbjogZmFsc2VcbiAgICogfSk7XG4gICAqIGBgYFxuICAgKi9cbiAgd2FpdEZvckludmFsaWRhdGlvbj86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGljU2l0ZURvbWFpblByb3BzIGV4dGVuZHMgQmFzZVNpdGVEb21haW5Qcm9wcyB7fVxuZXhwb3J0IGludGVyZmFjZSBTdGF0aWNTaXRlUmVwbGFjZVByb3BzIGV4dGVuZHMgQmFzZVNpdGVSZXBsYWNlUHJvcHMge31cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGljU2l0ZUNka0Rpc3RyaWJ1dGlvblByb3BzXG4gIGV4dGVuZHMgQmFzZVNpdGVDZGtEaXN0cmlidXRpb25Qcm9wcyB7fVxuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIENvbnN0cnVjdFxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbi8qKlxuICogVGhlIGBTdGF0aWNTaXRlYCBjb25zdHJ1Y3QgaXMgYSBoaWdoZXIgbGV2ZWwgQ0RLIGNvbnN0cnVjdCB0aGF0IG1ha2VzIGl0IGVhc3kgdG8gY3JlYXRlIGEgc3RhdGljIHdlYnNpdGUuIEl0IHByb3ZpZGVzIGEgc2ltcGxlIHdheSB0byBidWlsZCBhbmQgZGVwbG95IHRoZSBzaXRlIHRvIGFuIFMzIGJ1Y2tldDsgc2V0dXAgYSBDbG91ZEZyb250IENETiBmb3IgZmFzdCBjb250ZW50IGRlbGl2ZXJ5OyBhbmQgY29uZmlndXJlIGEgY3VzdG9tIGRvbWFpbiBmb3IgdGhlIHdlYnNpdGUgVVJMLiBJbiBhZGRpdGlvbjpcbiAqXG4gKiAtIFZpc2l0b3JzIHRvIHRoZSBgaHR0cDovL2AgdXJsIHdpbGwgYmUgcmVkaXJlY3RlZCB0byB0aGUgYGh0dHBzOi8vYCBVUkwuXG4gKiAtIElmIGEgW2RvbWFpbiBhbGlhc10oI2RvbWFpbmFsaWFzKSBpcyBjb25maWd1cmVkLCB2aXNpdG9ycyB0byB0aGUgYWxpYXMgZG9tYWluIHdpbGwgYmUgcmVkaXJlY3RlZCB0byB0aGUgbWFpbiBvbmUuIFNvIGlmIGB3d3cuZXhhbXBsZS5jb21gIGlzIHRoZSBkb21haW4gYWxpYXMgZm9yIGBleGFtcGxlLmNvbWAsIHZpc2l0b3JzIHRvIGB3d3cuZXhhbXBsZS5jb21gIHdpbGwgYmUgcmVkaXJlY3RlZCB0byBgZXhhbXBsZS5jb21gLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogVGhlIGBTdGF0aWNTaXRlYCBjb25zdHJ1Y3QgaXMgZGVzaWduZWQgdG8gbWFrZSBpdCBlYXN5IHRvIGdldCBzdGFydGVkIHdpdGgsIHdoaWxlIGFsbG93aW5nIGZvciBhIHdheSB0byBmdWxseSBjb25maWd1cmUgaXQgYXMgd2VsbC4gTGV0J3MgbG9vayBhdCBob3csIHRocm91Z2ggYSBjb3VwbGUgb2YgZXhhbXBsZXMuXG4gKlxuICogIyMjIENyZWF0aW5nIGEgcGxhaW4gSFRNTCBzaXRlXG4gKlxuICogRGVwbG95cyBhIHBsYWluIEhUTUwgd2Vic2l0ZSBpbiB0aGUgYHBhdGgvdG8vc3JjYCBkaXJlY3RvcnkuXG4gKlxuICogYGBganNcbiAqIGltcG9ydCB7IFN0YXRpY1NpdGUgfSBmcm9tIFwiQHNlcnZlcmxlc3Mtc3RhY2svcmVzb3VyY2VzXCI7XG4gKlxuICogbmV3IFN0YXRpY1NpdGUoc3RhY2ssIFwiU2l0ZVwiLCB7XG4gKiAgIHBhdGg6IFwicGF0aC90by9zcmNcIixcbiAqIH0pO1xuICogYGBgXG4gKi9cbmV4cG9ydCBjbGFzcyBTdGF0aWNTaXRlIGV4dGVuZHMgQ29uc3RydWN0IGltcGxlbWVudHMgU1NUQ29uc3RydWN0IHtcbiAgcHVibGljIHJlYWRvbmx5IGNkazoge1xuICAgIC8qKlxuICAgICAqIFRoZSBpbnRlcm5hbGx5IGNyZWF0ZWQgQ0RLIGBCdWNrZXRgIGluc3RhbmNlLlxuICAgICAqL1xuICAgIGJ1Y2tldDogczMuQnVja2V0O1xuICAgIC8qKlxuICAgICAqIFRoZSBpbnRlcm5hbGx5IGNyZWF0ZWQgQ0RLIGBEaXN0cmlidXRpb25gIGluc3RhbmNlLlxuICAgICAqL1xuICAgIGRpc3RyaWJ1dGlvbjogY2xvdWRmcm9udC5EaXN0cmlidXRpb247XG4gICAgLyoqXG4gICAgICogVGhlIFJvdXRlIDUzIGhvc3RlZCB6b25lIGZvciB0aGUgY3VzdG9tIGRvbWFpbi5cbiAgICAgKi9cbiAgICBob3N0ZWRab25lPzogcm91dGU1My5JSG9zdGVkWm9uZTtcbiAgICAvKlxuICAgICAqIFRoZSBBV1MgQ2VydGlmaWNhdGUgTWFuYWdlciBjZXJ0aWZpY2F0ZSBmb3IgdGhlIGN1c3RvbSBkb21haW4uXG4gICAgICovXG4gICAgY2VydGlmaWNhdGU/OiBhY20uSUNlcnRpZmljYXRlO1xuICB9O1xuICBwcml2YXRlIHByb3BzOiBTdGF0aWNTaXRlUHJvcHM7XG4gIHByaXZhdGUgaXNQbGFjZWhvbGRlcjogYm9vbGVhbjtcbiAgcHJpdmF0ZSBhc3NldHM6IHMzQXNzZXRzLkFzc2V0W107XG4gIHByaXZhdGUgZmlsZW5hbWVzQXNzZXQ/OiBzM0Fzc2V0cy5Bc3NldDtcbiAgcHJpdmF0ZSBhd3NDbGlMYXllcjogQXdzQ2xpTGF5ZXI7XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IFN0YXRpY1NpdGVQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICBjb25zdCByb290ID0gc2NvcGUubm9kZS5yb290IGFzIEFwcDtcbiAgICAvLyBMb2NhbCBkZXZlbG9wbWVudCBvciBza2lwIGJ1aWxkID0+IHN0dWIgYXNzZXRcbiAgICB0aGlzLmlzUGxhY2Vob2xkZXIgPVxuICAgICAgKHJvb3QubG9jYWwgfHwgcm9vdC5za2lwQnVpbGQpICYmICFwcm9wcy5kaXNhYmxlUGxhY2Vob2xkZXI7XG4gICAgY29uc3QgYnVpbGREaXIgPSByb290LmJ1aWxkRGlyO1xuICAgIGNvbnN0IGZpbGVTaXplTGltaXQgPSByb290LmlzSmVzdFRlc3QoKVxuICAgICAgPyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XG4gICAgICAgIC8vIEB0cy1pZ25vcmU6IFwiamVzdEZpbGVTaXplTGltaXRPdmVycmlkZVwiIG5vdCBleHBvc2VkIGluIHByb3BzXG4gICAgICAgIHByb3BzLmplc3RGaWxlU2l6ZUxpbWl0T3ZlcnJpZGUgfHwgMjAwXG4gICAgICA6IDIwMDtcblxuICAgIHRoaXMucHJvcHMgPSBwcm9wcztcbiAgICB0aGlzLmNkayA9IHt9IGFzIGFueTtcbiAgICB0aGlzLmF3c0NsaUxheWVyID0gbmV3IEF3c0NsaUxheWVyKHRoaXMsIFwiQXdzQ2xpTGF5ZXJcIik7XG4gICAgdGhpcy5yZWdpc3RlclNpdGVFbnZpcm9ubWVudCgpO1xuXG4gICAgLy8gVmFsaWRhdGUgaW5wdXRcbiAgICB0aGlzLnZhbGlkYXRlQ3VzdG9tRG9tYWluU2V0dGluZ3MoKTtcblxuICAgIC8vIEJ1aWxkIGFwcFxuICAgIHRoaXMuYnVpbGRBcHAoKTtcbiAgICB0aGlzLmFzc2V0cyA9IHRoaXMuYnVuZGxlQXNzZXRzKGZpbGVTaXplTGltaXQsIGJ1aWxkRGlyKTtcbiAgICB0aGlzLmZpbGVuYW1lc0Fzc2V0ID0gdGhpcy5idW5kbGVGaWxlbmFtZXNBc3NldChidWlsZERpcik7XG5cbiAgICAvLyBDcmVhdGUgQnVja2V0XG4gICAgdGhpcy5jZGsuYnVja2V0ID0gdGhpcy5jcmVhdGVTM0J1Y2tldCgpO1xuXG4gICAgLy8gQ3JlYXRlIEN1c3RvbSBEb21haW5cbiAgICB0aGlzLmNkay5ob3N0ZWRab25lID0gdGhpcy5sb29rdXBIb3N0ZWRab25lKCk7XG4gICAgdGhpcy5jZGsuY2VydGlmaWNhdGUgPSB0aGlzLmNyZWF0ZUNlcnRpZmljYXRlKCk7XG5cbiAgICAvLyBDcmVhdGUgUzMgRGVwbG95bWVudFxuICAgIGNvbnN0IHMzZGVwbG95Q1IgPSB0aGlzLmNyZWF0ZVMzRGVwbG95bWVudCgpO1xuXG4gICAgLy8gQ3JlYXRlIENsb3VkRnJvbnRcbiAgICB0aGlzLmNkay5kaXN0cmlidXRpb24gPSB0aGlzLmNyZWF0ZUNmRGlzdHJpYnV0aW9uKCk7XG4gICAgdGhpcy5jZGsuZGlzdHJpYnV0aW9uLm5vZGUuYWRkRGVwZW5kZW5jeShzM2RlcGxveUNSKTtcblxuICAgIC8vIEludmFsaWRhdGUgQ2xvdWRGcm9udFxuICAgIGNvbnN0IGludmFsaWRhdGlvbkNSID0gdGhpcy5jcmVhdGVDbG91ZEZyb250SW52YWxpZGF0aW9uKCk7XG4gICAgaW52YWxpZGF0aW9uQ1Iubm9kZS5hZGREZXBlbmRlbmN5KHRoaXMuY2RrLmRpc3RyaWJ1dGlvbik7XG5cbiAgICAvLyBDb25uZWN0IEN1c3RvbSBEb21haW4gdG8gQ2xvdWRGcm9udCBEaXN0cmlidXRpb25cbiAgICB0aGlzLmNyZWF0ZVJvdXRlNTNSZWNvcmRzKCk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIENsb3VkRnJvbnQgVVJMIG9mIHRoZSB3ZWJzaXRlLlxuICAgKi9cbiAgcHVibGljIGdldCB1cmwoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYGh0dHBzOi8vJHt0aGlzLmNkay5kaXN0cmlidXRpb24uZGlzdHJpYnV0aW9uRG9tYWluTmFtZX1gO1xuICB9XG5cbiAgLyoqXG4gICAqIElmIHRoZSBjdXN0b20gZG9tYWluIGlzIGVuYWJsZWQsIHRoaXMgaXMgdGhlIFVSTCBvZiB0aGUgd2Vic2l0ZSB3aXRoIHRoZSBjdXN0b20gZG9tYWluLlxuICAgKi9cbiAgcHVibGljIGdldCBjdXN0b21Eb21haW5VcmwoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCB7IGN1c3RvbURvbWFpbiB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoIWN1c3RvbURvbWFpbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgY3VzdG9tRG9tYWluID09PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gYGh0dHBzOi8vJHtjdXN0b21Eb21haW59YDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGBodHRwczovLyR7Y3VzdG9tRG9tYWluLmRvbWFpbk5hbWV9YDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgaW50ZXJuYWxseSBjcmVhdGVkIFMzIEJ1Y2tldC5cbiAgICovXG4gIHB1YmxpYyBnZXQgYnVja2V0QXJuKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY2RrLmJ1Y2tldC5idWNrZXRBcm47XG4gIH1cblxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGludGVybmFsbHkgY3JlYXRlZCBTMyBCdWNrZXQuXG4gICAqL1xuICBwdWJsaWMgZ2V0IGJ1Y2tldE5hbWUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5jZGsuYnVja2V0LmJ1Y2tldE5hbWU7XG4gIH1cblxuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSBpbnRlcm5hbGx5IGNyZWF0ZWQgQ2xvdWRGcm9udCBEaXN0cmlidXRpb24uXG4gICAqL1xuICBwdWJsaWMgZ2V0IGRpc3RyaWJ1dGlvbklkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY2RrLmRpc3RyaWJ1dGlvbi5kaXN0cmlidXRpb25JZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgZG9tYWluIG5hbWUgb2YgdGhlIGludGVybmFsbHkgY3JlYXRlZCBDbG91ZEZyb250IERpc3RyaWJ1dGlvbi5cbiAgICovXG4gIHB1YmxpYyBnZXQgZGlzdHJpYnV0aW9uRG9tYWluKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY2RrLmRpc3RyaWJ1dGlvbi5kaXN0cmlidXRpb25Eb21haW5OYW1lO1xuICB9XG5cbiAgcHVibGljIGdldENvbnN0cnVjdE1ldGFkYXRhKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIlN0YXRpY1NpdGVcIiBhcyBjb25zdCxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgZGlzdHJpYnV0aW9uSWQ6IHRoaXMuY2RrLmRpc3RyaWJ1dGlvbi5kaXN0cmlidXRpb25JZCxcbiAgICAgICAgY3VzdG9tRG9tYWluVXJsOiB0aGlzLmN1c3RvbURvbWFpblVybCxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgYnVpbGRBcHAoKSB7XG4gICAgaWYgKHRoaXMuaXNQbGFjZWhvbGRlcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHsgcGF0aDogc2l0ZVBhdGgsIGJ1aWxkQ29tbWFuZCB9ID0gdGhpcy5wcm9wcztcblxuICAgIC8vIHZhbGlkYXRlIHNpdGUgcGF0aCBleGlzdHNcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoc2l0ZVBhdGgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBObyBwYXRoIGZvdW5kIGF0IFwiJHtwYXRoLnJlc29sdmUoc2l0ZVBhdGgpfVwiIGZvciB0aGUgXCIke1xuICAgICAgICAgIHRoaXMubm9kZS5pZFxuICAgICAgICB9XCIgU3RhdGljU2l0ZS5gXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIGJ1aWxkXG4gICAgaWYgKGJ1aWxkQ29tbWFuZCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc29sZS5sb2coY2hhbGsuZ3JleShgQnVpbGRpbmcgc3RhdGljIHNpdGUgJHtzaXRlUGF0aH1gKSk7XG4gICAgICAgIGV4ZWNTeW5jKGJ1aWxkQ29tbWFuZCwge1xuICAgICAgICAgIGN3ZDogc2l0ZVBhdGgsXG4gICAgICAgICAgc3RkaW86IFwiaW5oZXJpdFwiLFxuICAgICAgICAgIGVudjoge1xuICAgICAgICAgICAgLi4ucHJvY2Vzcy5lbnYsXG4gICAgICAgICAgICAuLi5nZXRCdWlsZENtZEVudmlyb25tZW50KHRoaXMucHJvcHMuZW52aXJvbm1lbnQpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYFRoZXJlIHdhcyBhIHByb2JsZW0gYnVpbGRpbmcgdGhlIFwiJHt0aGlzLm5vZGUuaWR9XCIgU3RhdGljU2l0ZS5gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBidW5kbGVBc3NldHMoXG4gICAgZmlsZVNpemVMaW1pdDogbnVtYmVyLFxuICAgIGJ1aWxkRGlyOiBzdHJpbmdcbiAgKTogczNBc3NldHMuQXNzZXRbXSB7XG4gICAgaWYgKHRoaXMuaXNQbGFjZWhvbGRlcikge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgbmV3IHMzQXNzZXRzLkFzc2V0KHRoaXMsIFwiQXNzZXRcIiwge1xuICAgICAgICAgIHBhdGg6IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIFwiLi4vYXNzZXRzL1N0YXRpY1NpdGUvc3R1YlwiKSxcbiAgICAgICAgfSksXG4gICAgICBdO1xuICAgIH1cblxuICAgIGNvbnN0IHsgcGF0aDogc2l0ZVBhdGggfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgYnVpbGRPdXRwdXQgPSB0aGlzLnByb3BzLmJ1aWxkT3V0cHV0IHx8IFwiLlwiO1xuXG4gICAgLy8gdmFsaWRhdGUgYnVpbGRPdXRwdXQgZXhpc3RzXG4gICAgY29uc3Qgc2l0ZU91dHB1dFBhdGggPSBwYXRoLnJlc29sdmUocGF0aC5qb2luKHNpdGVQYXRoLCBidWlsZE91dHB1dCkpO1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhzaXRlT3V0cHV0UGF0aCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYE5vIGJ1aWxkIG91dHB1dCBmb3VuZCBhdCBcIiR7c2l0ZU91dHB1dFBhdGh9XCIgZm9yIHRoZSBcIiR7dGhpcy5ub2RlLmlkfVwiIFN0YXRpY1NpdGUuYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGUgemlwIGZpbGVzXG4gICAgY29uc3Qgc2NyaXB0ID0gcGF0aC5qb2luKF9fZGlybmFtZSwgXCIuLi9hc3NldHMvQmFzZVNpdGUvYXJjaGl2ZXIuanNcIik7XG4gICAgY29uc3QgemlwUGF0aCA9IHBhdGgucmVzb2x2ZShcbiAgICAgIHBhdGguam9pbihidWlsZERpciwgYFN0YXRpY1NpdGUtJHt0aGlzLm5vZGUuaWR9LSR7dGhpcy5ub2RlLmFkZHJ9YClcbiAgICApO1xuICAgIC8vIGNsZWFyIHppcCBwYXRoIHRvIGVuc3VyZSBubyBwYXJ0WC56aXAgcmVtYWluIGZyb20gcHJldmlvdXMgYnVpbGRcbiAgICBmcy5yZW1vdmVTeW5jKHppcFBhdGgpO1xuICAgIGNvbnN0IGNtZCA9IFtcIm5vZGVcIiwgc2NyaXB0LCBzaXRlT3V0cHV0UGF0aCwgemlwUGF0aCwgZmlsZVNpemVMaW1pdF0uam9pbihcbiAgICAgIFwiIFwiXG4gICAgKTtcblxuICAgIHRyeSB7XG4gICAgICBleGVjU3luYyhjbWQsIHtcbiAgICAgICAgY3dkOiBzaXRlUGF0aCxcbiAgICAgICAgc3RkaW86IFwiaW5oZXJpdFwiLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgVGhlcmUgd2FzIGEgcHJvYmxlbSBnZW5lcmF0aW5nIHRoZSBcIiR7dGhpcy5ub2RlLmlkfVwiIFN0YXRpY1NpdGUgcGFja2FnZS5gXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIGNyZWF0ZSBhc3NldHNcbiAgICBjb25zdCBhc3NldHMgPSBbXTtcbiAgICBmb3IgKGxldCBwYXJ0SWQgPSAwOyA7IHBhcnRJZCsrKSB7XG4gICAgICBjb25zdCB6aXBGaWxlUGF0aCA9IHBhdGguam9pbih6aXBQYXRoLCBgcGFydCR7cGFydElkfS56aXBgKTtcbiAgICAgIGlmICghZnMuZXhpc3RzU3luYyh6aXBGaWxlUGF0aCkpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGFzc2V0cy5wdXNoKFxuICAgICAgICBuZXcgczNBc3NldHMuQXNzZXQodGhpcywgYEFzc2V0JHtwYXJ0SWR9YCwge1xuICAgICAgICAgIHBhdGg6IHppcEZpbGVQYXRoLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGFzc2V0cztcbiAgfVxuXG4gIHByaXZhdGUgYnVuZGxlRmlsZW5hbWVzQXNzZXQoYnVpbGREaXI6IHN0cmluZyk6IHMzQXNzZXRzLkFzc2V0IHwgdW5kZWZpbmVkIHtcbiAgICBpZiAodGhpcy5pc1BsYWNlaG9sZGVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLnByb3BzLnB1cmdlRmlsZXMgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgemlwUGF0aCA9IHBhdGgucmVzb2x2ZShcbiAgICAgIHBhdGguam9pbihidWlsZERpciwgYFN0YXRpY1NpdGUtJHt0aGlzLm5vZGUuaWR9LSR7dGhpcy5ub2RlLmFkZHJ9YClcbiAgICApO1xuXG4gICAgLy8gY3JlYXRlIGFzc2V0c1xuICAgIGNvbnN0IGZpbGVuYW1lc1BhdGggPSBwYXRoLmpvaW4oemlwUGF0aCwgYGZpbGVuYW1lc2ApO1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhmaWxlbmFtZXNQYXRoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgVGhlcmUgd2FzIGEgcHJvYmxlbSBnZW5lcmF0aW5nIHRoZSBcIiR7dGhpcy5ub2RlLmlkfVwiIFN0YXRpY1NpdGUgcGFja2FnZS5gXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgczNBc3NldHMuQXNzZXQodGhpcywgYEFzc2V0RmlsZW5hbWVzYCwge1xuICAgICAgcGF0aDogZmlsZW5hbWVzUGF0aCxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUzNCdWNrZXQoKTogczMuQnVja2V0IHtcbiAgICBjb25zdCB7IGNkayB9ID0gdGhpcy5wcm9wcztcblxuICAgIC8vIFZhbGlkYXRlIHMzQnVja2V0XG4gICAgaWYgKGNkaz8uYnVja2V0Py53ZWJzaXRlSW5kZXhEb2N1bWVudCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgRG8gbm90IGNvbmZpZ3VyZSB0aGUgXCJzM0J1Y2tldC53ZWJzaXRlSW5kZXhEb2N1bWVudFwiLiBVc2UgdGhlIFwiaW5kZXhQYWdlXCIgdG8gY29uZmlndXJlIHRoZSBTdGF0aWNTaXRlIGluZGV4IHBhZ2UuYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoY2RrPy5idWNrZXQ/LndlYnNpdGVFcnJvckRvY3VtZW50KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBEbyBub3QgY29uZmlndXJlIHRoZSBcInMzQnVja2V0LndlYnNpdGVFcnJvckRvY3VtZW50XCIuIFVzZSB0aGUgXCJlcnJvclBhZ2VcIiB0byBjb25maWd1cmUgdGhlIFN0YXRpY1NpdGUgaW5kZXggcGFnZS5gXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgczMuQnVja2V0KHRoaXMsIFwiUzNCdWNrZXRcIiwge1xuICAgICAgYXV0b0RlbGV0ZU9iamVjdHM6IHRydWUsXG4gICAgICByZW1vdmFsUG9saWN5OiBSZW1vdmFsUG9saWN5LkRFU1RST1ksXG4gICAgICAuLi5jZGs/LmJ1Y2tldCxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUzNEZXBsb3ltZW50KCk6IEN1c3RvbVJlc291cmNlIHtcbiAgICBjb25zdCB7IGZpbGVPcHRpb25zIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgLy8gQ3JlYXRlIGEgTGFtYmRhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBkb2luZyB0aGUgdXBsb2FkaW5nXG4gICAgY29uc3QgdXBsb2FkZXIgPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHRoaXMsIFwiUzNVcGxvYWRlclwiLCB7XG4gICAgICBjb2RlOiBsYW1iZGEuQ29kZS5mcm9tQXNzZXQoXG4gICAgICAgIHBhdGguam9pbihfX2Rpcm5hbWUsIFwiLi4vYXNzZXRzL0Jhc2VTaXRlL2N1c3RvbS1yZXNvdXJjZVwiKVxuICAgICAgKSxcbiAgICAgIGxheWVyczogW3RoaXMuYXdzQ2xpTGF5ZXJdLFxuICAgICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuUFlUSE9OXzNfNyxcbiAgICAgIGhhbmRsZXI6IFwiczMtdXBsb2FkLmhhbmRsZXJcIixcbiAgICAgIHRpbWVvdXQ6IER1cmF0aW9uLm1pbnV0ZXMoMTUpLFxuICAgICAgbWVtb3J5U2l6ZTogMTAyNCxcbiAgICB9KTtcbiAgICB0aGlzLmNkay5idWNrZXQuZ3JhbnRSZWFkV3JpdGUodXBsb2FkZXIpO1xuICAgIHRoaXMuYXNzZXRzLmZvckVhY2goKGFzc2V0KSA9PiBhc3NldC5ncmFudFJlYWQodXBsb2FkZXIpKTtcblxuICAgIC8vIENyZWF0ZSB0aGUgY3VzdG9tIHJlc291cmNlIGZ1bmN0aW9uXG4gICAgY29uc3QgaGFuZGxlciA9IG5ldyBsYW1iZGEuRnVuY3Rpb24odGhpcywgXCJTM0hhbmRsZXJcIiwge1xuICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KFxuICAgICAgICBwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uL2Fzc2V0cy9CYXNlU2l0ZS9jdXN0b20tcmVzb3VyY2VcIilcbiAgICAgICksXG4gICAgICBsYXllcnM6IFt0aGlzLmF3c0NsaUxheWVyXSxcbiAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLlBZVEhPTl8zXzcsXG4gICAgICBoYW5kbGVyOiBcInMzLWhhbmRsZXIuaGFuZGxlclwiLFxuICAgICAgdGltZW91dDogRHVyYXRpb24ubWludXRlcygxNSksXG4gICAgICBtZW1vcnlTaXplOiAxMDI0LFxuICAgICAgZW52aXJvbm1lbnQ6IHtcbiAgICAgICAgVVBMT0FERVJfRlVOQ1RJT05fTkFNRTogdXBsb2FkZXIuZnVuY3Rpb25OYW1lLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICB0aGlzLmNkay5idWNrZXQuZ3JhbnRSZWFkV3JpdGUoaGFuZGxlcik7XG4gICAgdGhpcy5maWxlbmFtZXNBc3NldD8uZ3JhbnRSZWFkKGhhbmRsZXIpO1xuICAgIHVwbG9hZGVyLmdyYW50SW52b2tlKGhhbmRsZXIpO1xuXG4gICAgLy8gQ3JlYXRlIGN1c3RvbSByZXNvdXJjZVxuICAgIHJldHVybiBuZXcgQ3VzdG9tUmVzb3VyY2UodGhpcywgXCJTM0RlcGxveW1lbnRcIiwge1xuICAgICAgc2VydmljZVRva2VuOiBoYW5kbGVyLmZ1bmN0aW9uQXJuLFxuICAgICAgcmVzb3VyY2VUeXBlOiBcIkN1c3RvbTo6U1NUQnVja2V0RGVwbG95bWVudFwiLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICBTb3VyY2VzOiB0aGlzLmFzc2V0cy5tYXAoKGFzc2V0KSA9PiAoe1xuICAgICAgICAgIEJ1Y2tldE5hbWU6IGFzc2V0LnMzQnVja2V0TmFtZSxcbiAgICAgICAgICBPYmplY3RLZXk6IGFzc2V0LnMzT2JqZWN0S2V5LFxuICAgICAgICB9KSksXG4gICAgICAgIERlc3RpbmF0aW9uQnVja2V0TmFtZTogdGhpcy5jZGsuYnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICAgIEZpbGVuYW1lczogdGhpcy5maWxlbmFtZXNBc3NldCAmJiB7XG4gICAgICAgICAgQnVja2V0TmFtZTogdGhpcy5maWxlbmFtZXNBc3NldC5zM0J1Y2tldE5hbWUsXG4gICAgICAgICAgT2JqZWN0S2V5OiB0aGlzLmZpbGVuYW1lc0Fzc2V0LnMzT2JqZWN0S2V5LFxuICAgICAgICB9LFxuICAgICAgICBGaWxlT3B0aW9uczogKGZpbGVPcHRpb25zIHx8IFtdKS5tYXAoXG4gICAgICAgICAgKHsgZXhjbHVkZSwgaW5jbHVkZSwgY2FjaGVDb250cm9sIH0pID0+IHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZXhjbHVkZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICBleGNsdWRlID0gW2V4Y2x1ZGVdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBpbmNsdWRlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgIGluY2x1ZGUgPSBbaW5jbHVkZV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0gW107XG4gICAgICAgICAgICBleGNsdWRlLmZvckVhY2goKHBlcikgPT4gb3B0aW9ucy5wdXNoKFwiLS1leGNsdWRlXCIsIHBlcikpO1xuICAgICAgICAgICAgaW5jbHVkZS5mb3JFYWNoKChwZXIpID0+IG9wdGlvbnMucHVzaChcIi0taW5jbHVkZVwiLCBwZXIpKTtcbiAgICAgICAgICAgIG9wdGlvbnMucHVzaChcIi0tY2FjaGUtY29udHJvbFwiLCBjYWNoZUNvbnRyb2wpO1xuICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnM7XG4gICAgICAgICAgfVxuICAgICAgICApLFxuICAgICAgICBSZXBsYWNlVmFsdWVzOiB0aGlzLmdldFMzQ29udGVudFJlcGxhY2VWYWx1ZXMoKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgLy8gQ2xvdWRGcm9udCBEaXN0cmlidXRpb25cbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgcHJpdmF0ZSBjcmVhdGVDZkRpc3RyaWJ1dGlvbigpOiBjbG91ZGZyb250LkRpc3RyaWJ1dGlvbiB7XG4gICAgY29uc3QgeyBjZGssIGN1c3RvbURvbWFpbiB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBpbmRleFBhZ2UgPSB0aGlzLnByb3BzLmluZGV4UGFnZSB8fCBcImluZGV4Lmh0bWxcIjtcbiAgICBjb25zdCBlcnJvclBhZ2UgPSB0aGlzLnByb3BzLmVycm9yUGFnZTtcblxuICAgIC8vIFZhbGlkYXRlIGlucHV0XG4gICAgaWYgKGNkaz8uZGlzdHJpYnV0aW9uPy5jZXJ0aWZpY2F0ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgRG8gbm90IGNvbmZpZ3VyZSB0aGUgXCJjZkRpc3RyaWJ1dGlvbi5jZXJ0aWZpY2F0ZVwiLiBVc2UgdGhlIFwiY3VzdG9tRG9tYWluXCIgdG8gY29uZmlndXJlIHRoZSBTdGF0aWNTaXRlIGRvbWFpbiBjZXJ0aWZpY2F0ZS5gXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoY2RrPy5kaXN0cmlidXRpb24/LmRvbWFpbk5hbWVzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBEbyBub3QgY29uZmlndXJlIHRoZSBcImNmRGlzdHJpYnV0aW9uLmRvbWFpbk5hbWVzXCIuIFVzZSB0aGUgXCJjdXN0b21Eb21haW5cIiB0byBjb25maWd1cmUgdGhlIFN0YXRpY1NpdGUgZG9tYWluLmBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gQnVpbGQgZG9tYWluTmFtZXNcbiAgICBjb25zdCBkb21haW5OYW1lcyA9IFtdO1xuICAgIGlmICghY3VzdG9tRG9tYWluKSB7XG4gICAgICAvLyBubyBkb21haW5cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjdXN0b21Eb21haW4gPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIGRvbWFpbk5hbWVzLnB1c2goY3VzdG9tRG9tYWluKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZG9tYWluTmFtZXMucHVzaChjdXN0b21Eb21haW4uZG9tYWluTmFtZSk7XG4gICAgICBpZiAoY3VzdG9tRG9tYWluLmFsdGVybmF0ZU5hbWVzKSB7XG4gICAgICAgIGlmICghY3VzdG9tRG9tYWluLmNkaz8uY2VydGlmaWNhdGUpXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgXCJDZXJ0aWZpY2F0ZXMgZm9yIGFsdGVybmF0ZSBkb21haW5zIGNhbm5vdCBiZSBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQuIFBsZWFzZSBzcGVjaWZ5IGNlcnRpZmljYXRlIHRvIHVzZVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgZG9tYWluTmFtZXMucHVzaCguLi5jdXN0b21Eb21haW4uYWx0ZXJuYXRlTmFtZXMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEJ1aWxkIGVycm9yUmVzcG9uc2VzXG4gICAgbGV0IGVycm9yUmVzcG9uc2VzO1xuICAgIC8vIGNhc2U6IHNzdCBzdGFydCA9PiBzaG93aW5nIHN0dWIgc2l0ZSwgYW5kIHJlZGlyZWN0IGFsbCByb3V0ZXMgdG8gdGhlIGluZGV4IHBhZ2VcbiAgICBpZiAodGhpcy5pc1BsYWNlaG9sZGVyKSB7XG4gICAgICBlcnJvclJlc3BvbnNlcyA9IGJ1aWxkRXJyb3JSZXNwb25zZXNGb3JSZWRpcmVjdFRvSW5kZXgoaW5kZXhQYWdlKTtcbiAgICB9IGVsc2UgaWYgKGVycm9yUGFnZSkge1xuICAgICAgaWYgKGNkaz8uZGlzdHJpYnV0aW9uPy5lcnJvclJlc3BvbnNlcykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYENhbm5vdCBjb25maWd1cmUgdGhlIFwiY2ZEaXN0cmlidXRpb24uZXJyb3JSZXNwb25zZXNcIiB3aGVuIFwiZXJyb3JQYWdlXCIgaXMgcGFzc2VkIGluLiBVc2Ugb25lIG9yIHRoZSBvdGhlciB0byBjb25maWd1cmUgdGhlIGJlaGF2aW9yIGZvciBlcnJvciBwYWdlcy5gXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGVycm9yUmVzcG9uc2VzID1cbiAgICAgICAgZXJyb3JQYWdlID09PSBcInJlZGlyZWN0X3RvX2luZGV4X3BhZ2VcIlxuICAgICAgICAgID8gYnVpbGRFcnJvclJlc3BvbnNlc0ZvclJlZGlyZWN0VG9JbmRleChpbmRleFBhZ2UpXG4gICAgICAgICAgOiBidWlsZEVycm9yUmVzcG9uc2VzRm9yNDA0RXJyb3JQYWdlKGVycm9yUGFnZSBhcyBzdHJpbmcpO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBDbG91ZEZyb250IGRpc3RyaWJ1dGlvblxuICAgIHJldHVybiBuZXcgY2xvdWRmcm9udC5EaXN0cmlidXRpb24odGhpcywgXCJEaXN0cmlidXRpb25cIiwge1xuICAgICAgLy8gdGhlc2UgdmFsdWVzIGNhbiBiZSBvdmVyd3JpdHRlbiBieSBjZkRpc3RyaWJ1dGlvblByb3BzXG4gICAgICBkZWZhdWx0Um9vdE9iamVjdDogaW5kZXhQYWdlLFxuICAgICAgZXJyb3JSZXNwb25zZXMsXG4gICAgICAuLi5jZGs/LmRpc3RyaWJ1dGlvbixcbiAgICAgIC8vIHRoZXNlIHZhbHVlcyBjYW4gTk9UIGJlIG92ZXJ3cml0dGVuIGJ5IGNmRGlzdHJpYnV0aW9uUHJvcHNcbiAgICAgIGRvbWFpbk5hbWVzLFxuICAgICAgY2VydGlmaWNhdGU6IHRoaXMuY2RrLmNlcnRpZmljYXRlLFxuICAgICAgZGVmYXVsdEJlaGF2aW9yOiB7XG4gICAgICAgIG9yaWdpbjogbmV3IGNmT3JpZ2lucy5TM09yaWdpbih0aGlzLmNkay5idWNrZXQpLFxuICAgICAgICB2aWV3ZXJQcm90b2NvbFBvbGljeTogY2xvdWRmcm9udC5WaWV3ZXJQcm90b2NvbFBvbGljeS5SRURJUkVDVF9UT19IVFRQUyxcbiAgICAgICAgLi4uY2RrPy5kaXN0cmlidXRpb24/LmRlZmF1bHRCZWhhdmlvcixcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNsb3VkRnJvbnRJbnZhbGlkYXRpb24oKTogQ3VzdG9tUmVzb3VyY2Uge1xuICAgIC8vIENyZWF0ZSBhIExhbWJkYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgZG9pbmcgdGhlIGludmFsaWRhdGlvblxuICAgIGNvbnN0IGludmFsaWRhdG9yID0gbmV3IGxhbWJkYS5GdW5jdGlvbih0aGlzLCBcIkNsb3VkRnJvbnRJbnZhbGlkYXRvclwiLCB7XG4gICAgICBjb2RlOiBsYW1iZGEuQ29kZS5mcm9tQXNzZXQoXG4gICAgICAgIHBhdGguam9pbihfX2Rpcm5hbWUsIFwiLi4vYXNzZXRzL0Jhc2VTaXRlL2N1c3RvbS1yZXNvdXJjZVwiKVxuICAgICAgKSxcbiAgICAgIGxheWVyczogW3RoaXMuYXdzQ2xpTGF5ZXJdLFxuICAgICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuUFlUSE9OXzNfNyxcbiAgICAgIGhhbmRsZXI6IFwiY2YtaW52YWxpZGF0ZS5oYW5kbGVyXCIsXG4gICAgICB0aW1lb3V0OiBEdXJhdGlvbi5taW51dGVzKDE1KSxcbiAgICAgIG1lbW9yeVNpemU6IDEwMjQsXG4gICAgfSk7XG5cbiAgICAvLyBHcmFudCBwZXJtaXNzaW9ucyB0byBpbnZhbGlkYXRlIENGIERpc3RyaWJ1dGlvblxuICAgIGludmFsaWRhdG9yLmFkZFRvUm9sZVBvbGljeShcbiAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgZWZmZWN0OiBpYW0uRWZmZWN0LkFMTE9XLFxuICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgXCJjbG91ZGZyb250OkdldEludmFsaWRhdGlvblwiLFxuICAgICAgICAgIFwiY2xvdWRmcm9udDpDcmVhdGVJbnZhbGlkYXRpb25cIixcbiAgICAgICAgXSxcbiAgICAgICAgcmVzb3VyY2VzOiBbXCIqXCJdLFxuICAgICAgfSlcbiAgICApO1xuXG4gICAgLy8gTmVlZCB0aGUgQXNzZXRIYXNoIGZpZWxkIHNvIHRoZSBDUiBnZXRzIHVwZGF0ZWQgb24gZWFjaCBkZXBsb3lcbiAgICBjb25zdCBhc3NldHNIYXNoID0gY3J5cHRvXG4gICAgICAuY3JlYXRlSGFzaChcIm1kNVwiKVxuICAgICAgLnVwZGF0ZSh0aGlzLmFzc2V0cy5tYXAoKHsgYXNzZXRIYXNoIH0pID0+IGFzc2V0SGFzaCkuam9pbihcIlwiKSlcbiAgICAgIC5kaWdlc3QoXCJoZXhcIik7XG5cbiAgICAvLyBDcmVhdGUgY3VzdG9tIHJlc291cmNlXG4gICAgY29uc3Qgd2FpdEZvckludmFsaWRhdGlvbiA9XG4gICAgICB0aGlzLnByb3BzLndhaXRGb3JJbnZhbGlkYXRpb24gPT09IGZhbHNlID8gZmFsc2UgOiB0cnVlO1xuICAgIHJldHVybiBuZXcgQ3VzdG9tUmVzb3VyY2UodGhpcywgXCJDbG91ZEZyb250SW52YWxpZGF0aW9uXCIsIHtcbiAgICAgIHNlcnZpY2VUb2tlbjogaW52YWxpZGF0b3IuZnVuY3Rpb25Bcm4sXG4gICAgICByZXNvdXJjZVR5cGU6IFwiQ3VzdG9tOjpTU1RDbG91ZEZyb250SW52YWxpZGF0aW9uXCIsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIEFzc2V0c0hhc2g6IGFzc2V0c0hhc2gsXG4gICAgICAgIERpc3RyaWJ1dGlvbklkOiB0aGlzLmNkay5kaXN0cmlidXRpb24uZGlzdHJpYnV0aW9uSWQsXG4gICAgICAgIERpc3RyaWJ1dGlvblBhdGhzOiBbXCIvKlwiXSxcbiAgICAgICAgV2FpdEZvckludmFsaWRhdGlvbjogd2FpdEZvckludmFsaWRhdGlvbixcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgLy8gQ3VzdG9tIERvbWFpblxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICBwcm90ZWN0ZWQgdmFsaWRhdGVDdXN0b21Eb21haW5TZXR0aW5ncygpIHtcbiAgICBjb25zdCB7IGN1c3RvbURvbWFpbiB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmICghY3VzdG9tRG9tYWluKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBjdXN0b21Eb21haW4gPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoY3VzdG9tRG9tYWluLmlzRXh0ZXJuYWxEb21haW4gPT09IHRydWUpIHtcbiAgICAgIGlmICghY3VzdG9tRG9tYWluLmNkaz8uY2VydGlmaWNhdGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBBIHZhbGlkIGNlcnRpZmljYXRlIGlzIHJlcXVpcmVkIHdoZW4gXCJpc0V4dGVybmFsRG9tYWluXCIgaXMgc2V0IHRvIFwidHJ1ZVwiLmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChjdXN0b21Eb21haW4uZG9tYWluQWxpYXMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBEb21haW4gYWxpYXMgaXMgb25seSBzdXBwb3J0ZWQgZm9yIGRvbWFpbnMgaG9zdGVkIG9uIEFtYXpvbiBSb3V0ZSA1My4gRG8gbm90IHNldCB0aGUgXCJjdXN0b21Eb21haW4uZG9tYWluQWxpYXNcIiB3aGVuIFwiaXNFeHRlcm5hbERvbWFpblwiIGlzIGVuYWJsZWQuYFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKGN1c3RvbURvbWFpbi5ob3N0ZWRab25lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgSG9zdGVkIHpvbmVzIGNhbiBvbmx5IGJlIGNvbmZpZ3VyZWQgZm9yIGRvbWFpbnMgaG9zdGVkIG9uIEFtYXpvbiBSb3V0ZSA1My4gRG8gbm90IHNldCB0aGUgXCJjdXN0b21Eb21haW4uaG9zdGVkWm9uZVwiIHdoZW4gXCJpc0V4dGVybmFsRG9tYWluXCIgaXMgZW5hYmxlZC5gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGxvb2t1cEhvc3RlZFpvbmUoKTogcm91dGU1My5JSG9zdGVkWm9uZSB8IHVuZGVmaW5lZCB7XG4gICAgY29uc3QgeyBjdXN0b21Eb21haW4gfSA9IHRoaXMucHJvcHM7XG5cbiAgICAvLyBTa2lwIGlmIGN1c3RvbURvbWFpbiBpcyBub3QgY29uZmlndXJlZFxuICAgIGlmICghY3VzdG9tRG9tYWluKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGhvc3RlZFpvbmU7XG5cbiAgICBpZiAodHlwZW9mIGN1c3RvbURvbWFpbiA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgaG9zdGVkWm9uZSA9IHJvdXRlNTMuSG9zdGVkWm9uZS5mcm9tTG9va3VwKHRoaXMsIFwiSG9zdGVkWm9uZVwiLCB7XG4gICAgICAgIGRvbWFpbk5hbWU6IGN1c3RvbURvbWFpbixcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoY3VzdG9tRG9tYWluLmNkaz8uaG9zdGVkWm9uZSkge1xuICAgICAgaG9zdGVkWm9uZSA9IGN1c3RvbURvbWFpbi5jZGsuaG9zdGVkWm9uZTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjdXN0b21Eb21haW4uaG9zdGVkWm9uZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgaG9zdGVkWm9uZSA9IHJvdXRlNTMuSG9zdGVkWm9uZS5mcm9tTG9va3VwKHRoaXMsIFwiSG9zdGVkWm9uZVwiLCB7XG4gICAgICAgIGRvbWFpbk5hbWU6IGN1c3RvbURvbWFpbi5ob3N0ZWRab25lLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgY3VzdG9tRG9tYWluLmRvbWFpbk5hbWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIC8vIFNraXAgaWYgZG9tYWluIGlzIG5vdCBhIFJvdXRlNTMgZG9tYWluXG4gICAgICBpZiAoY3VzdG9tRG9tYWluLmlzRXh0ZXJuYWxEb21haW4gPT09IHRydWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBob3N0ZWRab25lID0gcm91dGU1My5Ib3N0ZWRab25lLmZyb21Mb29rdXAodGhpcywgXCJIb3N0ZWRab25lXCIsIHtcbiAgICAgICAgZG9tYWluTmFtZTogY3VzdG9tRG9tYWluLmRvbWFpbk5hbWUsXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaG9zdGVkWm9uZSA9IGN1c3RvbURvbWFpbi5ob3N0ZWRab25lO1xuICAgIH1cblxuICAgIHJldHVybiBob3N0ZWRab25lO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDZXJ0aWZpY2F0ZSgpOiBhY20uSUNlcnRpZmljYXRlIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCB7IGN1c3RvbURvbWFpbiB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmICghY3VzdG9tRG9tYWluKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGFjbUNlcnRpZmljYXRlO1xuXG4gICAgLy8gSG9zdGVkWm9uZSBpcyBzZXQgZm9yIFJvdXRlIDUzIGRvbWFpbnNcbiAgICBpZiAodGhpcy5jZGsuaG9zdGVkWm9uZSkge1xuICAgICAgaWYgKHR5cGVvZiBjdXN0b21Eb21haW4gPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgYWNtQ2VydGlmaWNhdGUgPSBuZXcgYWNtLkRuc1ZhbGlkYXRlZENlcnRpZmljYXRlKHRoaXMsIFwiQ2VydGlmaWNhdGVcIiwge1xuICAgICAgICAgIGRvbWFpbk5hbWU6IGN1c3RvbURvbWFpbixcbiAgICAgICAgICBob3N0ZWRab25lOiB0aGlzLmNkay5ob3N0ZWRab25lLFxuICAgICAgICAgIHJlZ2lvbjogXCJ1cy1lYXN0LTFcIixcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKGN1c3RvbURvbWFpbi5jZGs/LmNlcnRpZmljYXRlKSB7XG4gICAgICAgIGFjbUNlcnRpZmljYXRlID0gY3VzdG9tRG9tYWluLmNkay5jZXJ0aWZpY2F0ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFjbUNlcnRpZmljYXRlID0gbmV3IGFjbS5EbnNWYWxpZGF0ZWRDZXJ0aWZpY2F0ZSh0aGlzLCBcIkNlcnRpZmljYXRlXCIsIHtcbiAgICAgICAgICBkb21haW5OYW1lOiBjdXN0b21Eb21haW4uZG9tYWluTmFtZSxcbiAgICAgICAgICBob3N0ZWRab25lOiB0aGlzLmNkay5ob3N0ZWRab25lLFxuICAgICAgICAgIHJlZ2lvbjogXCJ1cy1lYXN0LTFcIixcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIEhvc3RlZFpvbmUgaXMgTk9UIHNldCBmb3Igbm9uLVJvdXRlIDUzIGRvbWFpbnNcbiAgICBlbHNlIHtcbiAgICAgIGlmICh0eXBlb2YgY3VzdG9tRG9tYWluICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGFjbUNlcnRpZmljYXRlID0gY3VzdG9tRG9tYWluLmNkaz8uY2VydGlmaWNhdGU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGFjbUNlcnRpZmljYXRlO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZVJvdXRlNTNSZWNvcmRzKCk6IHZvaWQge1xuICAgIGNvbnN0IHsgY3VzdG9tRG9tYWluIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKCFjdXN0b21Eb21haW4gfHwgIXRoaXMuY2RrLmhvc3RlZFpvbmUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgcmVjb3JkTmFtZTtcbiAgICBsZXQgZG9tYWluQWxpYXM7XG4gICAgaWYgKHR5cGVvZiBjdXN0b21Eb21haW4gPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHJlY29yZE5hbWUgPSBjdXN0b21Eb21haW47XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlY29yZE5hbWUgPSBjdXN0b21Eb21haW4uZG9tYWluTmFtZTtcbiAgICAgIGRvbWFpbkFsaWFzID0gY3VzdG9tRG9tYWluLmRvbWFpbkFsaWFzO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBETlMgcmVjb3JkXG4gICAgY29uc3QgcmVjb3JkUHJvcHMgPSB7XG4gICAgICByZWNvcmROYW1lLFxuICAgICAgem9uZTogdGhpcy5jZGsuaG9zdGVkWm9uZSxcbiAgICAgIHRhcmdldDogcm91dGU1My5SZWNvcmRUYXJnZXQuZnJvbUFsaWFzKFxuICAgICAgICBuZXcgcm91dGU1M1RhcmdldHMuQ2xvdWRGcm9udFRhcmdldCh0aGlzLmNkay5kaXN0cmlidXRpb24pXG4gICAgICApLFxuICAgIH07XG4gICAgbmV3IHJvdXRlNTMuQVJlY29yZCh0aGlzLCBcIkFsaWFzUmVjb3JkXCIsIHJlY29yZFByb3BzKTtcbiAgICBuZXcgcm91dGU1My5BYWFhUmVjb3JkKHRoaXMsIFwiQWxpYXNSZWNvcmRBQUFBXCIsIHJlY29yZFByb3BzKTtcblxuICAgIC8vIENyZWF0ZSBBbGlhcyByZWRpcmVjdCByZWNvcmRcbiAgICBpZiAoZG9tYWluQWxpYXMpIHtcbiAgICAgIG5ldyByb3V0ZTUzUGF0dGVybnMuSHR0cHNSZWRpcmVjdCh0aGlzLCBcIlJlZGlyZWN0XCIsIHtcbiAgICAgICAgem9uZTogdGhpcy5jZGsuaG9zdGVkWm9uZSxcbiAgICAgICAgcmVjb3JkTmFtZXM6IFtkb21haW5BbGlhc10sXG4gICAgICAgIHRhcmdldERvbWFpbjogcmVjb3JkTmFtZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAvLyBIZWxwZXIgRnVuY3Rpb25zXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIHByaXZhdGUgZ2V0UzNDb250ZW50UmVwbGFjZVZhbHVlcygpOiBTdGF0aWNTaXRlUmVwbGFjZVByb3BzW10ge1xuICAgIGNvbnN0IHJlcGxhY2VWYWx1ZXM6IFN0YXRpY1NpdGVSZXBsYWNlUHJvcHNbXSA9XG4gICAgICB0aGlzLnByb3BzLnJlcGxhY2VWYWx1ZXMgfHwgW107XG5cbiAgICBPYmplY3QuZW50cmllcyh0aGlzLnByb3BzLmVudmlyb25tZW50IHx8IHt9KVxuICAgICAgLmZpbHRlcigoWywgdmFsdWVdKSA9PiBUb2tlbi5pc1VucmVzb2x2ZWQodmFsdWUpKVxuICAgICAgLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICBjb25zdCB0b2tlbiA9IGB7eyAke2tleX0gfX1gO1xuICAgICAgICByZXBsYWNlVmFsdWVzLnB1c2goXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmlsZXM6IFwiKiovKi5odG1sXCIsXG4gICAgICAgICAgICBzZWFyY2g6IHRva2VuLFxuICAgICAgICAgICAgcmVwbGFjZTogdmFsdWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWxlczogXCIqKi8qLmpzXCIsXG4gICAgICAgICAgICBzZWFyY2g6IHRva2VuLFxuICAgICAgICAgICAgcmVwbGFjZTogdmFsdWUsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgcmV0dXJuIHJlcGxhY2VWYWx1ZXM7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyU2l0ZUVudmlyb25tZW50KCkge1xuICAgIGNvbnN0IGVudmlyb25tZW50T3V0cHV0czogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMucHJvcHMuZW52aXJvbm1lbnQgfHwge30pKSB7XG4gICAgICBjb25zdCBvdXRwdXRJZCA9IGBTc3RTaXRlRW52XyR7a2V5fWA7XG4gICAgICBjb25zdCBvdXRwdXQgPSBuZXcgQ2ZuT3V0cHV0KHRoaXMsIG91dHB1dElkLCB7IHZhbHVlIH0pO1xuICAgICAgZW52aXJvbm1lbnRPdXRwdXRzW2tleV0gPSBTdGFjay5vZih0aGlzKS5nZXRMb2dpY2FsSWQob3V0cHV0KTtcbiAgICB9XG5cbiAgICBjb25zdCByb290ID0gdGhpcy5ub2RlLnJvb3QgYXMgQXBwO1xuICAgIHJvb3QucmVnaXN0ZXJTaXRlRW52aXJvbm1lbnQoe1xuICAgICAgaWQ6IHRoaXMubm9kZS5pZCxcbiAgICAgIHBhdGg6IHRoaXMucHJvcHMucGF0aCxcbiAgICAgIHN0YWNrOiBTdGFjay5vZih0aGlzKS5ub2RlLmlkLFxuICAgICAgZW52aXJvbm1lbnRPdXRwdXRzLFxuICAgIH0gYXMgQmFzZVNpdGVFbnZpcm9ubWVudE91dHB1dHNJbmZvKTtcbiAgfVxufVxuIl19