"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Cron = void 0;
const constructs_1 = require("constructs");
const events = __importStar(require("aws-cdk-lib/aws-events"));
const eventsTargets = __importStar(require("aws-cdk-lib/aws-events-targets"));
const Construct_1 = require("./Construct");
const Function_1 = require("./Function");
/////////////////////
// Construct
/////////////////////
/**
 * The `Cron` construct is a higher level CDK construct that makes it easy to create a cron job. You can create a cron job by handler function and specifying the schedule it needs to run on. Internally this construct uses a [EventBridge Rule](https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_events.Rule.html).
 */
class Cron extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        this.props = props;
        this.cdk = {};
        this.createEventsRule();
        this.jobFunction = this.createRuleTarget();
    }
    /**
     * Attaches the given list of [permissions](Permissions.md) to the `jobFunction`. This allows the function to access other AWS resources.
     *
     * Internally calls [`Function.attachPermissions`](Function.md#attachpermissions).
     *
     */
    attachPermissions(permissions) {
        this.jobFunction.attachPermissions(permissions);
    }
    getConstructMetadata() {
        const cfnRule = this.cdk.rule.node.defaultChild;
        return {
            type: "Cron",
            data: {
                schedule: cfnRule.scheduleExpression,
                ruleName: this.cdk.rule.ruleName,
                job: (0, Construct_1.getFunctionRef)(this.jobFunction),
            },
        };
    }
    createEventsRule() {
        var _a;
        const { cdk, schedule } = this.props;
        const id = this.node.id;
        // Configure Schedule
        if (!schedule && !((_a = cdk === null || cdk === void 0 ? void 0 : cdk.rule) === null || _a === void 0 ? void 0 : _a.schedule)) {
            throw new Error(`No schedule defined for the "${id}" Cron`);
        }
        this.cdk.rule = new events.Rule(this, "Rule", Object.assign({ schedule: schedule && events.Schedule.expression(schedule) }, cdk === null || cdk === void 0 ? void 0 : cdk.rule));
    }
    createRuleTarget() {
        var _a;
        const { job } = this.props;
        const id = this.node.id;
        if (!job) {
            throw new Error(`No job defined for the "${id}" Cron`);
        }
        // normalize job
        let jobFunction, jobProps;
        if (job.function) {
            jobFunction = job.function;
            jobProps = (_a = job.cdk) === null || _a === void 0 ? void 0 : _a.target;
        }
        else {
            jobFunction = job;
            jobProps = {};
        }
        // create function
        const fn = Function_1.Function.fromDefinition(this, "Job", jobFunction);
        this.cdk.rule.addTarget(new eventsTargets.LambdaFunction(fn, jobProps));
        return fn;
    }
}
exports.Cron = Cron;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3Jvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9Dcm9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQXVDO0FBQ3ZDLCtEQUFpRDtBQUNqRCw4RUFBZ0U7QUFFaEUsMkNBQTJEO0FBQzNELHlDQUlvQjtBQWdGcEIscUJBQXFCO0FBQ3JCLFlBQVk7QUFDWixxQkFBcUI7QUFFckI7O0dBRUc7QUFDSCxNQUFhLElBQUssU0FBUSxzQkFBUztJQWFqQyxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQWdCO1FBQ3hELEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFakIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFTLENBQUM7UUFFckIsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDeEIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUM3QyxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSSxpQkFBaUIsQ0FBQyxXQUF3QjtRQUMvQyxJQUFJLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ2xELENBQUM7SUFFTSxvQkFBb0I7UUFDekIsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQThCLENBQUM7UUFDbEUsT0FBTztZQUNMLElBQUksRUFBRSxNQUFlO1lBQ3JCLElBQUksRUFBRTtnQkFDSixRQUFRLEVBQUUsT0FBTyxDQUFDLGtCQUFrQjtnQkFDcEMsUUFBUSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVE7Z0JBQ2hDLEdBQUcsRUFBRSxJQUFBLDBCQUFjLEVBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQzthQUN0QztTQUNGLENBQUM7SUFDSixDQUFDO0lBRU8sZ0JBQWdCOztRQUN0QixNQUFNLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDckMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFFeEIscUJBQXFCO1FBQ3JCLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFBLE1BQUEsR0FBRyxhQUFILEdBQUcsdUJBQUgsR0FBRyxDQUFFLElBQUksMENBQUUsUUFBUSxDQUFBLEVBQUU7WUFDckMsTUFBTSxJQUFJLEtBQUssQ0FBQyxnQ0FBZ0MsRUFBRSxRQUFRLENBQUMsQ0FBQztTQUM3RDtRQUVELElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxrQkFDMUMsUUFBUSxFQUFFLFFBQVEsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFDdkQsR0FBRyxhQUFILEdBQUcsdUJBQUgsR0FBRyxDQUFFLElBQUksRUFDWixDQUFDO0lBQ0wsQ0FBQztJQUVPLGdCQUFnQjs7UUFDdEIsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDM0IsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFFeEIsSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUNSLE1BQU0sSUFBSSxLQUFLLENBQUMsMkJBQTJCLEVBQUUsUUFBUSxDQUFDLENBQUM7U0FDeEQ7UUFFRCxnQkFBZ0I7UUFDaEIsSUFBSSxXQUFXLEVBQUUsUUFBUSxDQUFDO1FBQzFCLElBQUssR0FBb0IsQ0FBQyxRQUFRLEVBQUU7WUFDbEMsV0FBVyxHQUFJLEdBQW9CLENBQUMsUUFBUSxDQUFDO1lBQzdDLFFBQVEsR0FBRyxNQUFDLEdBQW9CLENBQUMsR0FBRywwQ0FBRSxNQUFNLENBQUM7U0FDOUM7YUFBTTtZQUNMLFdBQVcsR0FBRyxHQUErQixDQUFDO1lBQzlDLFFBQVEsR0FBRyxFQUFFLENBQUM7U0FDZjtRQUVELGtCQUFrQjtRQUNsQixNQUFNLEVBQUUsR0FBRyxtQkFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3pELElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLGFBQWEsQ0FBQyxjQUFjLENBQUMsRUFBRSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFFeEUsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0NBQ0Y7QUFwRkQsb0JBb0ZDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcbmltcG9ydCAqIGFzIGV2ZW50cyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWV2ZW50c1wiO1xuaW1wb3J0ICogYXMgZXZlbnRzVGFyZ2V0cyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWV2ZW50cy10YXJnZXRzXCI7XG5cbmltcG9ydCB7IGdldEZ1bmN0aW9uUmVmLCBTU1RDb25zdHJ1Y3QgfSBmcm9tIFwiLi9Db25zdHJ1Y3RcIjtcbmltcG9ydCB7XG4gIEZ1bmN0aW9uIGFzIEZ1bmMsXG4gIEZ1bmN0aW9uSW5saW5lRGVmaW5pdGlvbixcbiAgRnVuY3Rpb25EZWZpbml0aW9uLFxufSBmcm9tIFwiLi9GdW5jdGlvblwiO1xuaW1wb3J0IHsgUGVybWlzc2lvbnMgfSBmcm9tIFwiLi91dGlsL3Blcm1pc3Npb25cIjtcblxuZXhwb3J0IGludGVyZmFjZSBDcm9uSm9iUHJvcHMge1xuICAvKipcbiAgICogVGhlIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCB3aGVuIHRoZSBqb2IgcnVucy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogICBuZXcgQ3JvbihzdGFjaywgXCJDcm9uXCIsIHtcbiAgICogICAgIGpvYjoge1xuICAgKiAgICAgICBmdW5jdGlvbjogXCJzcmMvbGFtYmRhLm1haW5cIixcbiAgICogICAgIH0sXG4gICAqICAgfSk7XG4gICAqIGBgYFxuICAgKi9cbiAgZnVuY3Rpb246IEZ1bmN0aW9uRGVmaW5pdGlvbjtcbiAgY2RrPzoge1xuICAgIC8qKlxuICAgICAqIE92ZXJyaWRlIHRoZSBkZWZhdWx0IHNldHRpbmdzIHRoaXMgY29uc3RydWN0IHVzZXMgaW50ZXJuYWxseSB0byBjcmVhdGUgdGhlIGV2ZW50cyBydWxlLlxuICAgICAqL1xuICAgIHRhcmdldD86IGV2ZW50c1RhcmdldHMuTGFtYmRhRnVuY3Rpb25Qcm9wcztcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDcm9uUHJvcHMge1xuICBjZGs/OiB7XG4gICAgLyoqXG4gICAgICogT3ZlcnJpZGUgdGhlIGRlZmF1bHQgc2V0dGluZ3MgdGhpcyBjb25zdHJ1Y3QgdXNlcyBpbnRlcm5hbGx5IHRvIGNyZWF0ZSB0aGUgZXZlbnRzIHJ1bGUuXG4gICAgICovXG4gICAgcnVsZT86IGV2ZW50cy5SdWxlUHJvcHM7XG4gIH07XG5cbiAgLyoqXG4gICAqIFRoZSBkZWZpbml0aW9uIG9mIHRoZSBmdW5jdGlvbiB0byBiZSBleGVjdXRlZFxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBuZXcgQ3JvbihzdGFjaywgXCJDcm9uXCIsIHtcbiAgICogICBqb2IgOiBcInNyYy9mdW5jdGlvbi5oYW5kbGVyXCIsXG4gICAqIH0pXG4gICAqIGBgYFxuICAgKi9cbiAgam9iOiBGdW5jdGlvbklubGluZURlZmluaXRpb24gfCBDcm9uSm9iUHJvcHM7XG4gIC8qKlxuICAgKiBUaGUgc2NoZWR1bGUgZm9yIHRoZSBjcm9uIGpvYi5cbiAgICpcbiAgICogVGhlIHN0cmluZyBmb3JtYXQgdGFrZXMgYSBbcmF0ZSBleHByZXNzaW9uXShodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vbGFtYmRhL2xhdGVzdC9kZy9zZXJ2aWNlcy1jbG91ZHdhdGNoZXZlbnRzLWV4cHJlc3Npb25zLmh0bWwpLlxuICAgKlxuICAgKiBgYGB0eHRcbiAgICogcmF0ZSgxIG1pbnV0ZSlcbiAgICogcmF0ZSg1IG1pbnV0ZXMpXG4gICAqIHJhdGUoMSBob3VyKVxuICAgKiByYXRlKDUgaG91cnMpXG4gICAqIHJhdGUoMSBkYXkpXG4gICAqIHJhdGUoNSBkYXlzKVxuICAgKiBgYGBcbiAgICogT3IgYXMgYSBbY3JvbiBleHByZXNzaW9uXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Dcm9uI0NST05fZXhwcmVzc2lvbikuXG4gICAqXG4gICAqIGBgYHR4dFxuICAgKiBjcm9uKDE1IDEwICogKiA/ICopICAgIC8vIDEwOjE1IEFNIChVVEMpIGV2ZXJ5IGRheS5cbiAgICogYGBgXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIG5ldyBDcm9uKHN0YWNrLCBcIkNyb25cIiwge1xuICAgKiAgIGpvYjogXCJzcmMvbGFtYmRhLm1haW5cIixcbiAgICogICBzY2hlZHVsZTogXCJyYXRlKDUgbWludXRlcylcIixcbiAgICogfSk7XG4gICAqIGBgYFxuICAgKiBgYGBqc1xuICAgKiBuZXcgQ3JvbihzdGFjaywgXCJDcm9uXCIsIHtcbiAgICogICBqb2I6IFwic3JjL2xhbWJkYS5tYWluXCIsXG4gICAqICAgc2NoZWR1bGU6IFwiY3JvbigxNSAxMCAqICogPyAqKVwiLFxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqL1xuICBzY2hlZHVsZT86IGByYXRlKCR7c3RyaW5nfSlgIHwgYGNyb24oJHtzdHJpbmd9KWA7XG59XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gQ29uc3RydWN0XG4vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuLyoqXG4gKiBUaGUgYENyb25gIGNvbnN0cnVjdCBpcyBhIGhpZ2hlciBsZXZlbCBDREsgY29uc3RydWN0IHRoYXQgbWFrZXMgaXQgZWFzeSB0byBjcmVhdGUgYSBjcm9uIGpvYi4gWW91IGNhbiBjcmVhdGUgYSBjcm9uIGpvYiBieSBoYW5kbGVyIGZ1bmN0aW9uIGFuZCBzcGVjaWZ5aW5nIHRoZSBzY2hlZHVsZSBpdCBuZWVkcyB0byBydW4gb24uIEludGVybmFsbHkgdGhpcyBjb25zdHJ1Y3QgdXNlcyBhIFtFdmVudEJyaWRnZSBSdWxlXShodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vY2RrL2FwaS92Mi9kb2NzL2F3cy1jZGstbGliLmF3c19ldmVudHMuUnVsZS5odG1sKS5cbiAqL1xuZXhwb3J0IGNsYXNzIENyb24gZXh0ZW5kcyBDb25zdHJ1Y3QgaW1wbGVtZW50cyBTU1RDb25zdHJ1Y3Qge1xuICBwdWJsaWMgcmVhZG9ubHkgY2RrOiB7XG4gICAgLyoqXG4gICAgICogVGhlIGludGVybmFsbHkgY3JlYXRlZCBDREsgRXZlbnRCcmlkZ2UgUnVsZSBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICBydWxlOiBldmVudHMuUnVsZTtcbiAgfTtcbiAgLyoqXG4gICAqIFRoZSBpbnRlcm5hbGx5IGNyZWF0ZWQgRnVuY3Rpb24gaW5zdGFuY2UgdGhhdCdsbCBiZSBydW4gb24gc2NoZWR1bGUuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgam9iRnVuY3Rpb246IEZ1bmM7XG4gIHByaXZhdGUgcHJvcHM6IENyb25Qcm9wcztcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogQ3JvblByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIHRoaXMucHJvcHMgPSBwcm9wcztcbiAgICB0aGlzLmNkayA9IHt9IGFzIGFueTtcblxuICAgIHRoaXMuY3JlYXRlRXZlbnRzUnVsZSgpO1xuICAgIHRoaXMuam9iRnVuY3Rpb24gPSB0aGlzLmNyZWF0ZVJ1bGVUYXJnZXQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBdHRhY2hlcyB0aGUgZ2l2ZW4gbGlzdCBvZiBbcGVybWlzc2lvbnNdKFBlcm1pc3Npb25zLm1kKSB0byB0aGUgYGpvYkZ1bmN0aW9uYC4gVGhpcyBhbGxvd3MgdGhlIGZ1bmN0aW9uIHRvIGFjY2VzcyBvdGhlciBBV1MgcmVzb3VyY2VzLlxuICAgKlxuICAgKiBJbnRlcm5hbGx5IGNhbGxzIFtgRnVuY3Rpb24uYXR0YWNoUGVybWlzc2lvbnNgXShGdW5jdGlvbi5tZCNhdHRhY2hwZXJtaXNzaW9ucykuXG4gICAqXG4gICAqL1xuICBwdWJsaWMgYXR0YWNoUGVybWlzc2lvbnMocGVybWlzc2lvbnM6IFBlcm1pc3Npb25zKTogdm9pZCB7XG4gICAgdGhpcy5qb2JGdW5jdGlvbi5hdHRhY2hQZXJtaXNzaW9ucyhwZXJtaXNzaW9ucyk7XG4gIH1cblxuICBwdWJsaWMgZ2V0Q29uc3RydWN0TWV0YWRhdGEoKSB7XG4gICAgY29uc3QgY2ZuUnVsZSA9IHRoaXMuY2RrLnJ1bGUubm9kZS5kZWZhdWx0Q2hpbGQgYXMgZXZlbnRzLkNmblJ1bGU7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiQ3JvblwiIGFzIGNvbnN0LFxuICAgICAgZGF0YToge1xuICAgICAgICBzY2hlZHVsZTogY2ZuUnVsZS5zY2hlZHVsZUV4cHJlc3Npb24sXG4gICAgICAgIHJ1bGVOYW1lOiB0aGlzLmNkay5ydWxlLnJ1bGVOYW1lLFxuICAgICAgICBqb2I6IGdldEZ1bmN0aW9uUmVmKHRoaXMuam9iRnVuY3Rpb24pLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVFdmVudHNSdWxlKCkge1xuICAgIGNvbnN0IHsgY2RrLCBzY2hlZHVsZSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBpZCA9IHRoaXMubm9kZS5pZDtcblxuICAgIC8vIENvbmZpZ3VyZSBTY2hlZHVsZVxuICAgIGlmICghc2NoZWR1bGUgJiYgIWNkaz8ucnVsZT8uc2NoZWR1bGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gc2NoZWR1bGUgZGVmaW5lZCBmb3IgdGhlIFwiJHtpZH1cIiBDcm9uYCk7XG4gICAgfVxuXG4gICAgdGhpcy5jZGsucnVsZSA9IG5ldyBldmVudHMuUnVsZSh0aGlzLCBcIlJ1bGVcIiwge1xuICAgICAgc2NoZWR1bGU6IHNjaGVkdWxlICYmIGV2ZW50cy5TY2hlZHVsZS5leHByZXNzaW9uKHNjaGVkdWxlKSxcbiAgICAgIC4uLmNkaz8ucnVsZSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUnVsZVRhcmdldCgpIHtcbiAgICBjb25zdCB7IGpvYiB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBpZCA9IHRoaXMubm9kZS5pZDtcblxuICAgIGlmICgham9iKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGpvYiBkZWZpbmVkIGZvciB0aGUgXCIke2lkfVwiIENyb25gKTtcbiAgICB9XG5cbiAgICAvLyBub3JtYWxpemUgam9iXG4gICAgbGV0IGpvYkZ1bmN0aW9uLCBqb2JQcm9wcztcbiAgICBpZiAoKGpvYiBhcyBDcm9uSm9iUHJvcHMpLmZ1bmN0aW9uKSB7XG4gICAgICBqb2JGdW5jdGlvbiA9IChqb2IgYXMgQ3JvbkpvYlByb3BzKS5mdW5jdGlvbjtcbiAgICAgIGpvYlByb3BzID0gKGpvYiBhcyBDcm9uSm9iUHJvcHMpLmNkaz8udGFyZ2V0O1xuICAgIH0gZWxzZSB7XG4gICAgICBqb2JGdW5jdGlvbiA9IGpvYiBhcyBGdW5jdGlvbklubGluZURlZmluaXRpb247XG4gICAgICBqb2JQcm9wcyA9IHt9O1xuICAgIH1cblxuICAgIC8vIGNyZWF0ZSBmdW5jdGlvblxuICAgIGNvbnN0IGZuID0gRnVuYy5mcm9tRGVmaW5pdGlvbih0aGlzLCBcIkpvYlwiLCBqb2JGdW5jdGlvbik7XG4gICAgdGhpcy5jZGsucnVsZS5hZGRUYXJnZXQobmV3IGV2ZW50c1RhcmdldHMuTGFtYmRhRnVuY3Rpb24oZm4sIGpvYlByb3BzKSk7XG5cbiAgICByZXR1cm4gZm47XG4gIH1cbn1cbiJdfQ==