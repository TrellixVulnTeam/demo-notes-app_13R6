"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ApiGatewayV1Api = void 0;
const constructs_1 = require("constructs");
const cdk = __importStar(require("aws-cdk-lib"));
const route53 = __importStar(require("aws-cdk-lib/aws-route53"));
const route53Targets = __importStar(require("aws-cdk-lib/aws-route53-targets"));
const acm = __importStar(require("aws-cdk-lib/aws-certificatemanager"));
const cognito = __importStar(require("aws-cdk-lib/aws-cognito"));
const apig = __importStar(require("aws-cdk-lib/aws-apigateway"));
const apigV1AccessLog = __importStar(require("./util/apiGatewayV1AccessLog"));
const Stack_1 = require("./Stack");
const duration_1 = require("./util/duration");
const Construct_1 = require("./Construct");
const Function_1 = require("./Function");
const allowedMethods = [
    "ANY",
    "GET",
    "PUT",
    "POST",
    "HEAD",
    "PATCH",
    "DELETE",
    "OPTIONS",
];
/////////////////////
// Construct
/////////////////////
/**
 *
 * The `ApiGatewayV1Api` construct is a higher level CDK construct that makes it easy to create an API Gateway REST API. It provides a simple way to define the routes in your API. And allows you to configure the specific Lambda functions if necessary. It also allows you to configure authorization and custom domains. See the [examples](#examples) for more details.
 *
 * :::note
 * If you are creating a new API, use the `Api` construct instead.
 * :::
 *
 * The Api construct uses [API Gateway V2](https://aws.amazon.com/blogs/compute/announcing-http-apis-for-amazon-api-gateway/). It's both faster and cheaper. However, if you need features like Usage Plans and API keys, use the `ApiGatewayV1Api` construct instead. You can [check out a detailed comparison here](https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-vs-rest.html).
 *
 * @example
 * ### Minimal config
 *
 * ```js
 * import { ApiGatewayV1Api } from "@serverless-stack/resources";
 *
 * new ApiGatewayV1Api(stack, "Api", {
 *   routes: {
 *     "GET    /notes"     : "src/list.main",
 *     "POST   /notes"     : "src/create.main",
 *     "GET    /notes/{id}": "src/get.main",
 *     "PUT    /notes/{id}": "src/update.main",
 *     "DELETE /notes/{id}": "src/delete.main",
 *   },
 * });
 * ```
 */
class ApiGatewayV1Api extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        this.props = props || {};
        this.cdk = {};
        this.functions = {};
        this.authorizersData = {};
        this.importedResources = {};
        this.permissionsAttachedForAllRoutes = [];
        this.createRestApi();
        this.addAuthorizers(this.props.authorizers || {});
        this.addRoutes(this, this.props.routes || {});
    }
    /**
     * The AWS generated URL of the Api.
     */
    get url() {
        return this.cdk.restApi.url;
    }
    /**
     * If custom domain is enabled, this is the custom domain URL of the Api.
     *
     * :::note
     * If you are setting the base mapping for the custom domain, you need to include the trailing slash while using the custom domain URL. For example, if the [`domainName`](#domainname) is set to `api.domain.com` and the [`path`](#path) is `v1`, the custom domain URL of the API will be `https://api.domain.com/v1/`.
     * :::
     */
    get customDomainUrl() {
        return this._customDomainUrl;
    }
    /**
     * The routes for the Api
     */
    get routes() {
        return Object.keys(this.functions);
    }
    /**
     * The ARN of the internally created API Gateway REST API
     */
    get restApiArn() {
        const stack = Stack_1.Stack.of(this);
        return `arn:${stack.partition}:apigateway:${stack.region}::/restapis/${this.cdk.restApi.restApiId}`;
    }
    /**
     * The id of the internally created API Gateway REST API
     */
    get restApiId() {
        return this.cdk.restApi.restApiId;
    }
    /**
     * Adds routes to the Api after it has been created.
     *
     * @example
     * ```js
     * api.addRoutes(stack, {
     *   "GET    /notes/{id}": "src/get.main",
     *   "PUT    /notes/{id}": "src/update.main",
     *   "DELETE /notes/{id}": "src/delete.main",
     * });
     * ```
     */
    addRoutes(scope, routes) {
        Object.keys(routes).forEach((routeKey) => {
            // add route
            const fn = this.addRoute(scope, routeKey, routes[routeKey]);
            // attached existing permissions
            this.permissionsAttachedForAllRoutes.forEach((permissions) => fn.attachPermissions(permissions));
        });
    }
    /**
     * Get the instance of the internally created Function, for a given route key where the `routeKey` is the key used to define a route. For example, `GET /notes`.
     *
     * @example
     * ```js
     * const api = new ApiGatewayV1Api(stack, "Api", {
     *   routes: {
     *     "GET    /notes": "src/list.main",
     *   },
     * });
     *
     * const listFunction = api.getFunction("GET /notes");
     * ```
     */
    getFunction(routeKey) {
        return this.functions[this.normalizeRouteKey(routeKey)];
    }
    /**
     * Attaches the given list of permissions to all the routes. This allows the functions to access other AWS resources.
     *
     * @example
     *
     * ```js
     * api.attachPermissions(["s3"]);
     * ```
     */
    attachPermissions(permissions) {
        Object.values(this.functions).forEach((fn) => fn.attachPermissions(permissions));
        this.permissionsAttachedForAllRoutes.push(permissions);
    }
    /**
     * Attaches the given list of permissions to a specific route. This allows that function to access other AWS resources.
     *
     * @example
     * ```js
     * const api = new ApiGatewayV1Api(stack, "Api", {
     *   routes: {
     *     "GET /notes": "src/list.main",
     *   },
     * });
     *
     * api.attachPermissionsToRoute("GET /notes", ["s3"]);
     * ```
     */
    attachPermissionsToRoute(routeKey, permissions) {
        const fn = this.getFunction(routeKey);
        if (!fn) {
            throw new Error(`Failed to attach permissions. Route "${routeKey}" does not exist.`);
        }
        fn.attachPermissions(permissions);
    }
    getConstructMetadata() {
        return {
            type: "ApiGatewayV1Api",
            data: {
                customDomainUrl: this._customDomainUrl,
                url: this.cdk.restApi.url,
                restApiId: this.cdk.restApi.restApiId,
                routes: Object.entries(this.functions).map(([key, data]) => {
                    return {
                        route: key,
                        fn: (0, Construct_1.getFunctionRef)(data),
                    };
                }),
            },
        };
    }
    createRestApi() {
        var _a, _b, _c, _d, _e, _f, _g;
        const { cdk, cors, accessLog, customDomain } = this.props;
        const id = this.node.id;
        const app = this.node.root;
        if ((0, Construct_1.isCDKConstruct)(cdk === null || cdk === void 0 ? void 0 : cdk.restApi)) {
            if (cors !== undefined) {
                throw new Error(`Cannot configure the "cors" when the "restApi" is imported`);
            }
            if (accessLog !== undefined) {
                throw new Error(`Cannot configure the "accessLog" when the "restApi" is imported`);
            }
            if (customDomain !== undefined) {
                throw new Error(`Cannot configure the "customDomain" when the "restApi" is imported`);
            }
            this.cdk.restApi = cdk === null || cdk === void 0 ? void 0 : cdk.restApi;
            // Create an API Gateway deployment resource to trigger a deployment
            this._deployment = new apig.Deployment(this, "Deployment", {
                api: this.cdk.restApi,
            });
            const cfnDeployment = this._deployment.node
                .defaultChild;
            cfnDeployment.stageName = app.stage;
            if (cdk === null || cdk === void 0 ? void 0 : cdk.importedPaths) {
                this.importResources(cdk === null || cdk === void 0 ? void 0 : cdk.importedPaths);
            }
        }
        else {
            const restApiProps = ((cdk === null || cdk === void 0 ? void 0 : cdk.restApi) || {});
            // Validate input
            if ((cdk === null || cdk === void 0 ? void 0 : cdk.importedPaths) !== undefined) {
                throw new Error(`Cannot import route paths when creating a new API.`);
            }
            if (customDomain !== undefined && restApiProps.domainName !== undefined) {
                throw new Error(`Use either the "customDomain" or the "restApi.domainName" to configure the Api domain. Do not use both.`);
            }
            if (cors !== undefined &&
                restApiProps.defaultCorsPreflightOptions !== undefined) {
                throw new Error(`Use either the "cors" or the "restApi.defaultCorsPreflightOptions" to configure the Api's CORS config. Do not use both.`);
            }
            if (accessLog !== undefined &&
                ((_a = restApiProps.deployOptions) === null || _a === void 0 ? void 0 : _a.accessLogDestination) !== undefined) {
                throw new Error(`Use either the "accessLog" or the "restApi.deployOptions.accessLogDestination" to configure the Api's access log. Do not use both.`);
            }
            if (accessLog !== undefined &&
                ((_b = restApiProps.deployOptions) === null || _b === void 0 ? void 0 : _b.accessLogFormat) !== undefined) {
                throw new Error(`Use either the "accessLog" or the "restApi.deployOptions.accessLogFormat" to configure the Api's access log. Do not use both.`);
            }
            const stageName = ((_c = restApiProps.deployOptions) === null || _c === void 0 ? void 0 : _c.stageName) || this.node.root.stage;
            const accessLogData = apigV1AccessLog.buildAccessLogData(this, accessLog);
            this.cdk.accessLogGroup = accessLogData === null || accessLogData === void 0 ? void 0 : accessLogData.logGroup;
            this.cdk.restApi = new apig.RestApi(this, "Api", Object.assign(Object.assign({ restApiName: app.logicalPrefixedName(id) }, restApiProps), { domainName: restApiProps.domainName, defaultCorsPreflightOptions: restApiProps.defaultCorsPreflightOptions ||
                    this.buildCorsConfig(cors), deployOptions: Object.assign(Object.assign({}, (restApiProps.deployOptions || {})), { accessLogDestination: ((_d = restApiProps.deployOptions) === null || _d === void 0 ? void 0 : _d.accessLogDestination) ||
                        (accessLogData === null || accessLogData === void 0 ? void 0 : accessLogData.destination), accessLogFormat: ((_e = restApiProps.deployOptions) === null || _e === void 0 ? void 0 : _e.accessLogFormat) ||
                        (accessLogData === null || accessLogData === void 0 ? void 0 : accessLogData.format), 
                    // default to the name of the sage
                    stageName: stageName, 
                    // default to true
                    tracingEnabled: ((_f = restApiProps.deployOptions) === null || _f === void 0 ? void 0 : _f.tracingEnabled) === undefined
                        ? true
                        : (_g = restApiProps.deployOptions) === null || _g === void 0 ? void 0 : _g.tracingEnabled }) }));
            this.createCustomDomain(customDomain);
            this.createGatewayResponseForCors(cors);
        }
    }
    buildCorsConfig(cors) {
        // Case: cors is false
        if (cors === false) {
            return undefined;
        }
        // Case: cors is true or undefined
        return {
            allowOrigins: apig.Cors.ALL_ORIGINS,
        };
    }
    createGatewayResponseForCors(cors) {
        if (!cors) {
            return;
        }
        this.cdk.restApi.addGatewayResponse("GatewayResponseDefault4XX", {
            type: apig.ResponseType.DEFAULT_4XX,
            responseHeaders: {
                "Access-Control-Allow-Origin": "'*'",
                "Access-Control-Allow-Headers": "'*'",
            },
        });
        this.cdk.restApi.addGatewayResponse("GatewayResponseDefault5XX", {
            type: apig.ResponseType.DEFAULT_5XX,
            responseHeaders: {
                "Access-Control-Allow-Origin": "'*'",
                "Access-Control-Allow-Headers": "'*'",
            },
        });
    }
    createCustomDomain(customDomain) {
        var _a, _b, _c, _d;
        // Case: customDomain is not set
        if (customDomain === undefined) {
            return;
        }
        // To be implemented: to allow more flexible use cases, SST should support 3 more use cases:
        //  1. Allow user passing in `hostedZone` object. The use case is when there are multiple
        //     HostedZones with the same domain, but one is public, and one is private.
        //  2. Allow user passing in `certificate` object. The use case is for user to create wildcard
        //     certificate or using an imported certificate.
        //  3. Allow user passing in `apigDomainName` object. The use case is a user creates multiple API
        //     endpoints, and is mapping them under the same custom domain. `sst.Api` needs to expose the
        //     `apigDomainName` construct created in the first Api, and lets user pass it in when creating
        //     the second Api.
        let domainName, hostedZone, hostedZoneDomain, certificate, apigDomainName, basePath, endpointType, mtls, securityPolicy;
        /////////////////////
        // Parse input
        /////////////////////
        // Case: customDomain is a string
        if (typeof customDomain === "string") {
            // validate: customDomain is a TOKEN string
            // ie. imported SSM value: ssm.StringParameter.valueForStringParameter()
            if (cdk.Token.isUnresolved(customDomain)) {
                throw new Error(`You also need to specify the "hostedZone" if the "domainName" is passed in as a reference.`);
            }
            domainName = customDomain;
            this.assertDomainNameIsLowerCase(domainName);
            hostedZoneDomain = customDomain.split(".").slice(1).join(".");
        }
        // Case: customDomain.domainName is a string
        else if (customDomain.domainName) {
            domainName = customDomain.domainName;
            // parse customDomain.domainName
            if (cdk.Token.isUnresolved(customDomain.domainName)) {
                // If customDomain is a TOKEN string, "hostedZone" has to be passed in. This
                // is because "hostedZone" cannot be parsed from a TOKEN value.
                if (!customDomain.hostedZone) {
                    throw new Error(`You also need to specify the "hostedZone" if the "domainName" is passed in as a reference.`);
                }
                domainName = customDomain.domainName;
            }
            else {
                domainName = customDomain.domainName;
                this.assertDomainNameIsLowerCase(domainName);
            }
            // parse customDomain.hostedZone
            if (!customDomain.hostedZone) {
                hostedZoneDomain = domainName.split(".").slice(1).join(".");
            }
            else if (typeof customDomain.hostedZone === "string") {
                hostedZoneDomain = customDomain.hostedZone;
            }
            else {
                hostedZone = customDomain.hostedZone;
            }
            certificate = (_a = customDomain.cdk) === null || _a === void 0 ? void 0 : _a.certificate;
            basePath = customDomain.path;
            endpointType = customDomain.endpointType;
            mtls = customDomain.mtls;
            securityPolicy = customDomain.securityPolicy;
        }
        // Case: customDomain.domainName is a construct
        else if ((_b = customDomain.cdk) === null || _b === void 0 ? void 0 : _b.domainName) {
            apigDomainName = customDomain.cdk.domainName;
            // customDomain.domainName is imported
            if (apigDomainName &&
                (customDomain.hostedZone || ((_c = customDomain.cdk) === null || _c === void 0 ? void 0 : _c.hostedZone))) {
                throw new Error(`Cannot configure the "hostedZone" when the "domainName" is a construct`);
            }
            if (apigDomainName && ((_d = customDomain.cdk) === null || _d === void 0 ? void 0 : _d.certificate)) {
                throw new Error(`Cannot configure the "certificate" when the "domainName" is a construct`);
            }
            if (apigDomainName && customDomain.endpointType) {
                throw new Error(`Cannot configure the "endpointType" when the "domainName" is a construct`);
            }
            if (apigDomainName && customDomain.mtls) {
                throw new Error(`Cannot configure the "mtls" when the "domainName" is a construct`);
            }
            if (apigDomainName && customDomain.securityPolicy) {
                throw new Error(`Cannot configure the "securityPolicy" when the "domainName" is a construct`);
            }
            basePath = customDomain.path;
        }
        /////////////////////
        // Find hosted zone
        /////////////////////
        if (!apigDomainName && !hostedZone) {
            // Look up hosted zone
            if (!hostedZone && hostedZoneDomain) {
                hostedZone = route53.HostedZone.fromLookup(this, "HostedZone", {
                    domainName: hostedZoneDomain,
                });
            }
        }
        /////////////////////
        // Create certificate
        /////////////////////
        if (!apigDomainName && !certificate) {
            if (endpointType === "edge") {
                certificate = new acm.DnsValidatedCertificate(this, "CrossRegionCertificate", {
                    domainName: domainName,
                    hostedZone: hostedZone,
                    region: "us-east-1",
                });
            }
            else {
                certificate = new acm.Certificate(this, "Certificate", {
                    domainName: domainName,
                    validation: acm.CertificateValidation.fromDns(hostedZone),
                });
            }
            this.cdk.certificate = certificate;
        }
        /////////////////////
        // Create API Gateway domain name
        /////////////////////
        if (!apigDomainName && domainName) {
            // Create custom domain in API Gateway
            apigDomainName = new apig.DomainName(this, "DomainName", {
                domainName,
                certificate: certificate,
                endpointType: endpointType &&
                    apig.EndpointType[endpointType.toLocaleUpperCase()],
                mtls: mtls && Object.assign(Object.assign({}, mtls), { bucket: mtls.bucket.cdk.bucket }),
                securityPolicy: securityPolicy === "TLS 1.0"
                    ? apig.SecurityPolicy.TLS_1_0
                    : securityPolicy === "TLS 1.2"
                        ? apig.SecurityPolicy.TLS_1_2
                        : undefined,
            });
            this.cdk.domainName = apigDomainName;
            // Create DNS record
            this.createARecords(hostedZone, domainName, apigDomainName);
        }
        /////////////////////
        // Create base mapping
        /////////////////////
        if (apigDomainName) {
            new apig.BasePathMapping(this, "BasePath", {
                domainName: apigDomainName,
                restApi: this.cdk.restApi,
                basePath,
            });
        }
        // Note: We only know the full custom domain if domainName is a string.
        //       _customDomainUrl will be undefined if apigDomainName is imported.
        if (domainName && !cdk.Token.isUnresolved(domainName)) {
            this._customDomainUrl = basePath
                ? `https://${domainName}/${basePath}/`
                : `https://${domainName}`;
        }
    }
    createARecords(hostedZone, domainName, apigDomain) {
        // create DNS record
        const recordProps = {
            recordName: domainName,
            zone: hostedZone,
            target: route53.RecordTarget.fromAlias(new route53Targets.ApiGatewayDomain(apigDomain)),
        };
        const records = [
            new route53.ARecord(this, "AliasRecord", recordProps),
            new route53.AaaaRecord(this, "AliasRecordAAAA", recordProps),
        ];
        // note: If domainName is a TOKEN string ie. ${TOKEN..}, the route53.ARecord
        //       construct will append ".${hostedZoneName}" to the end of the domain.
        //       This is because the construct tries to check if the record name
        //       ends with the domain name. If not, it will append the domain name.
        //       So, we need remove this behavior.
        if (cdk.Token.isUnresolved(domainName)) {
            records.forEach((record) => {
                const cfnRecord = record.node.defaultChild;
                cfnRecord.name = domainName;
            });
        }
    }
    importResources(resources) {
        Object.keys(resources).forEach((path) => {
            const resource = apig.Resource.fromResourceAttributes(this, `Resource_${path}`, {
                path,
                resourceId: resources[path],
                restApi: this.cdk.restApi,
            });
            this.importedResources[path] = resource;
        });
    }
    getResourceForPath(path) {
        // Lookup exact match imported resource
        if (this.importedResources[path]) {
            return this.importedResources[path];
        }
        // Lookup parents matching imported resource first
        const parts = path.split("/");
        for (let i = parts.length; i >= 1; i--) {
            const partialPath = parts.slice(0, i).join("/");
            if (this.importedResources[partialPath]) {
                return this.importedResources[partialPath].resourceForPath(parts.slice(i).join("/"));
            }
        }
        // Not child of imported resources, create off the root
        return this.cdk.restApi.root.resourceForPath(path);
    }
    addAuthorizers(authorizers) {
        Object.entries(authorizers).forEach(([key, value]) => {
            var _a, _b, _c, _d, _e;
            if (key === "none") {
                throw new Error(`Cannot name an authorizer "none"`);
            }
            else if (key === "iam") {
                throw new Error(`Cannot name an authorizer "iam"`);
            }
            else if (value.type === "user_pools") {
                if ((_a = value.cdk) === null || _a === void 0 ? void 0 : _a.authorizer) {
                    this.authorizersData[key] = value.cdk.authorizer;
                }
                else {
                    if (!value.userPoolIds) {
                        throw new Error(`Missing "userPoolIds" for "${key}" authorizer`);
                    }
                    const userPools = value.userPoolIds.map((userPoolId) => cognito.UserPool.fromUserPoolId(this, `${key}-ImportedUserPool`, userPoolId));
                    this.authorizersData[key] = new apig.CognitoUserPoolsAuthorizer(this, key, {
                        cognitoUserPools: userPools,
                        authorizerName: value.name,
                        identitySource: value.identitySource,
                        resultsCacheTtl: value.resultsCacheTtl
                            ? (0, duration_1.toCdkDuration)(value.resultsCacheTtl)
                            : cdk.Duration.seconds(0),
                    });
                }
            }
            else if (value.type === "lambda_token") {
                if ((_b = value.cdk) === null || _b === void 0 ? void 0 : _b.authorizer) {
                    this.authorizersData[key] = value.cdk.authorizer;
                }
                else {
                    if (!value.function) {
                        throw new Error(`Missing "function" for "${key}" authorizer`);
                    }
                    this.authorizersData[key] = new apig.TokenAuthorizer(this, key, {
                        handler: value.function,
                        authorizerName: value.name,
                        identitySource: value.identitySource,
                        validationRegex: value.validationRegex,
                        assumeRole: (_c = value.cdk) === null || _c === void 0 ? void 0 : _c.assumeRole,
                        resultsCacheTtl: value.resultsCacheTtl
                            ? (0, duration_1.toCdkDuration)(value.resultsCacheTtl)
                            : cdk.Duration.seconds(0),
                    });
                }
            }
            else if (value.type === "lambda_request") {
                if ((_d = value.cdk) === null || _d === void 0 ? void 0 : _d.authorizer) {
                    this.authorizersData[key] = value.cdk.authorizer;
                }
                else {
                    if (!value.function) {
                        throw new Error(`Missing "function" for "${key}" authorizer`);
                    }
                    else if (!value.identitySources) {
                        throw new Error(`Missing "identitySources" for "${key}" authorizer`);
                    }
                    this.authorizersData[key] = new apig.RequestAuthorizer(this, key, {
                        handler: value.function,
                        authorizerName: value.name,
                        identitySources: value.identitySources,
                        assumeRole: (_e = value.cdk) === null || _e === void 0 ? void 0 : _e.assumeRole,
                        resultsCacheTtl: value.resultsCacheTtl
                            ? (0, duration_1.toCdkDuration)(value.resultsCacheTtl)
                            : cdk.Duration.seconds(0),
                    });
                }
            }
        });
    }
    addRoute(scope, routeKey, routeValue) {
        var _a, _b;
        // Normalize routeKey
        ///////////////////
        routeKey = this.normalizeRouteKey(routeKey);
        if (this.functions[routeKey]) {
            throw new Error(`A route already exists for "${routeKey}"`);
        }
        ///////////////////
        // Get path and method
        ///////////////////
        const routeKeyParts = routeKey.split(" ");
        if (routeKeyParts.length !== 2) {
            throw new Error(`Invalid route ${routeKey}`);
        }
        const methodStr = routeKeyParts[0].toUpperCase();
        const path = routeKeyParts[1];
        const method = allowedMethods.find((per) => per === methodStr);
        if (!method) {
            throw new Error(`Invalid method defined for "${routeKey}"`);
        }
        if (path.length === 0) {
            throw new Error(`Invalid path defined for "${routeKey}"`);
        }
        ///////////////////
        // Create Resources
        ///////////////////
        let resource;
        if (path.endsWith("/{proxy+}")) {
            const parentResource = this.getResourceForPath(path.split("/").slice(0, -1).join("/"));
            resource = parentResource.addProxy({ anyMethod: false });
        }
        else {
            resource = this.getResourceForPath(path);
        }
        ///////////////////
        // Create Method
        ///////////////////
        const routeProps = Function_1.Function.isInlineDefinition(routeValue)
            ? { function: routeValue }
            : routeValue;
        const lambda = Function_1.Function.fromDefinition(scope, `Lambda_${methodStr}_${path}`, routeProps.function, (_a = this.props.defaults) === null || _a === void 0 ? void 0 : _a.function, `The "defaults.function" cannot be applied if an instance of a Function construct is passed in. Make sure to define all the routes using FunctionProps, so the ApiGatewayV1Api construct can apply the "defaults.function" to them.`);
        const integration = new apig.LambdaIntegration(lambda, (_b = routeProps.cdk) === null || _b === void 0 ? void 0 : _b.integration);
        const methodOptions = this.buildRouteMethodOptions(routeProps);
        const apigMethod = resource.addMethod(method, integration, methodOptions);
        // Add an environment variable to determine if the function is an Api route.
        // If it is, when "sst start" is not connected, we want to return an 500
        // status code and a descriptive error message.
        const root = scope.node.root;
        if (root.local) {
            lambda.addEnvironment("SST_DEBUG_IS_API_ROUTE", "1", {
                removeInEdge: true,
            });
        }
        ///////////////////
        // Handle manually created Deployment resource (ie. imported REST API)
        ///////////////////
        if (this._deployment) {
            this._deployment.addToLogicalId({ route: { routeKey, routeValue } });
            this._deployment.node.addDependency(apigMethod);
        }
        ///////////////////
        // Store function
        ///////////////////
        this.functions[routeKey] = lambda;
        return lambda;
    }
    buildRouteMethodOptions(routeProps) {
        var _a, _b, _c, _d, _e, _f;
        const authorizerKey = routeProps.authorizer || ((_a = this.props.defaults) === null || _a === void 0 ? void 0 : _a.authorizer) || "none";
        if (authorizerKey === "none") {
            return Object.assign({ authorizationType: apig.AuthorizationType.NONE }, (_b = routeProps.cdk) === null || _b === void 0 ? void 0 : _b.method);
        }
        else if (authorizerKey === "iam") {
            return Object.assign({ authorizationType: apig.AuthorizationType.IAM }, (_c = routeProps.cdk) === null || _c === void 0 ? void 0 : _c.method);
        }
        if (!this.props.authorizers || !this.props.authorizers[authorizerKey]) {
            throw new Error(`Cannot find authorizer "${authorizerKey}"`);
        }
        const authorizer = this.authorizersData[authorizerKey];
        const authorizationType = this.props.authorizers[authorizerKey].type;
        if (authorizationType === "user_pools") {
            return Object.assign({ authorizationType: apig.AuthorizationType.COGNITO, authorizer, authorizationScopes: routeProps.authorizationScopes ||
                    ((_d = this.props.defaults) === null || _d === void 0 ? void 0 : _d.authorizationScopes) }, (_e = routeProps.cdk) === null || _e === void 0 ? void 0 : _e.method);
        }
        return Object.assign({ authorizationType: apig.AuthorizationType.CUSTOM, authorizer }, (_f = routeProps.cdk) === null || _f === void 0 ? void 0 : _f.method);
    }
    normalizeRouteKey(routeKey) {
        return routeKey.split(/\s+/).join(" ");
    }
    assertDomainNameIsLowerCase(domainName) {
        if (domainName !== domainName.toLowerCase()) {
            throw new Error(`The domain name needs to be in lowercase`);
        }
    }
}
exports.ApiGatewayV1Api = ApiGatewayV1Api;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXBpR2F0ZXdheVYxQXBpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL0FwaUdhdGV3YXlWMUFwaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUF1QztBQUN2QyxpREFBbUM7QUFFbkMsaUVBQW1EO0FBQ25ELGdGQUFrRTtBQUVsRSx3RUFBMEQ7QUFDMUQsaUVBQW1EO0FBQ25ELGlFQUFtRDtBQUNuRCw4RUFBZ0U7QUFHaEUsbUNBQWdDO0FBRWhDLDhDQUEwRDtBQUMxRCwyQ0FBMkU7QUFDM0UseUNBS29CO0FBR3BCLE1BQU0sY0FBYyxHQUFHO0lBQ3JCLEtBQUs7SUFDTCxLQUFLO0lBQ0wsS0FBSztJQUNMLE1BQU07SUFDTixNQUFNO0lBQ04sT0FBTztJQUNQLFFBQVE7SUFDUixTQUFTO0NBQ1YsQ0FBQztBQTBkRixxQkFBcUI7QUFDckIsWUFBWTtBQUNaLHFCQUFxQjtBQUVyQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0EwQkc7QUFDSCxNQUFhLGVBTVgsU0FBUSxzQkFBUztJQTZCakIsWUFDRSxLQUFnQixFQUNoQixFQUFVLEVBQ1YsS0FBeUM7UUFFekMsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssSUFBSSxFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFTLENBQUM7UUFDckIsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDcEIsSUFBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7UUFDMUIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEVBQUUsQ0FBQztRQUM1QixJQUFJLENBQUMsK0JBQStCLEdBQUcsRUFBRSxDQUFDO1FBRTFDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMs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QUFFLE1BQU0sRUFDekI7SUFDSixDQUFDO0lBRU8saUJBQWlCLENBQUMsUUFBZ0I7UUFDeEMsT0FBTyxRQUFRLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRU8sMkJBQTJCLENBQUMsVUFBa0I7UUFDcEQsSUFBSSxVQUFVLEtBQUssVUFBVSxDQUFDLFdBQVcsRUFBRSxFQUFFO1lBQzNDLE1BQU0sSUFBSSxLQUFLLENBQUMsMENBQTBDLENBQUMsQ0FBQztTQUM3RDtJQUNILENBQUM7Q0FDRjtBQWwwQkQsMENBazBCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSBcImF3cy1jZGstbGliXCI7XG5pbXBvcnQgKiBhcyBsb2dzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtbG9nc1wiO1xuaW1wb3J0ICogYXMgcm91dGU1MyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLXJvdXRlNTNcIjtcbmltcG9ydCAqIGFzIHJvdXRlNTNUYXJnZXRzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3Mtcm91dGU1My10YXJnZXRzXCI7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1pYW1cIjtcbmltcG9ydCAqIGFzIGFjbSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWNlcnRpZmljYXRlbWFuYWdlclwiO1xuaW1wb3J0ICogYXMgY29nbml0byBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWNvZ25pdG9cIjtcbmltcG9ydCAqIGFzIGFwaWcgZnJvbSBcImF3cy1jZGstbGliL2F3cy1hcGlnYXRld2F5XCI7XG5pbXBvcnQgKiBhcyBhcGlnVjFBY2Nlc3NMb2cgZnJvbSBcIi4vdXRpbC9hcGlHYXRld2F5VjFBY2Nlc3NMb2dcIjtcblxuaW1wb3J0IHsgQXBwIH0gZnJvbSBcIi4vQXBwXCI7XG5pbXBvcnQgeyBTdGFjayB9IGZyb20gXCIuL1N0YWNrXCI7XG5pbXBvcnQgeyBCdWNrZXQgfSBmcm9tIFwiLi9CdWNrZXRcIjtcbmltcG9ydCB7IER1cmF0aW9uLCB0b0Nka0R1cmF0aW9uIH0gZnJvbSBcIi4vdXRpbC9kdXJhdGlvblwiO1xuaW1wb3J0IHsgZ2V0RnVuY3Rpb25SZWYsIFNTVENvbnN0cnVjdCwgaXNDREtDb25zdHJ1Y3QgfSBmcm9tIFwiLi9Db25zdHJ1Y3RcIjtcbmltcG9ydCB7XG4gIEZ1bmN0aW9uIGFzIEZuLFxuICBGdW5jdGlvblByb3BzLFxuICBGdW5jdGlvbklubGluZURlZmluaXRpb24sXG4gIEZ1bmN0aW9uRGVmaW5pdGlvbixcbn0gZnJvbSBcIi4vRnVuY3Rpb25cIjtcbmltcG9ydCB7IFBlcm1pc3Npb25zIH0gZnJvbSBcIi4vdXRpbC9wZXJtaXNzaW9uXCI7XG5cbmNvbnN0IGFsbG93ZWRNZXRob2RzID0gW1xuICBcIkFOWVwiLFxuICBcIkdFVFwiLFxuICBcIlBVVFwiLFxuICBcIlBPU1RcIixcbiAgXCJIRUFEXCIsXG4gIFwiUEFUQ0hcIixcbiAgXCJERUxFVEVcIixcbiAgXCJPUFRJT05TXCIsXG5dO1xuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIEludGVyZmFjZXNcbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5leHBvcnQgaW50ZXJmYWNlIEFwaUdhdGV3YXlWMUFwaUFjY2Vzc0xvZ1Byb3BzXG4gIGV4dGVuZHMgYXBpZ1YxQWNjZXNzTG9nLkFjY2Vzc0xvZ1Byb3BzIHt9XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBpR2F0ZXdheVYxQXBpUHJvcHM8XG4gIEF1dGhvcml6ZXJzIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgQXBpR2F0ZXdheVYxQXBpQXV0aG9yaXplcj4gPSBSZWNvcmQ8XG4gICAgc3RyaW5nLFxuICAgIG5ldmVyXG4gID4sXG4gIEF1dGhvcml6ZXJLZXlzID0ga2V5b2YgQXV0aG9yaXplcnNcbj4ge1xuICBjZGs/OiB7XG4gICAgLyoqXG4gICAgICogT3ZlcnJpZGUgdGhlIGludGVybmFsbHkgY3JlYXRlZCByZXN0IGFwaVxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGBqc1xuICAgICAqXG4gICAgICogbmV3IEFwaUdhdGV3YXlWMUFwaShzdGFjaywgXCJBcGlcIiwge1xuICAgICAqICAgY2RrOiB7XG4gICAgICogICAgIHJlc3RBcGk6IHtcbiAgICAgKiAgICAgICBkZXNjcmlwdGlvbjogXCJNeSBhcGlcIlxuICAgICAqICAgICB9XG4gICAgICogICB9XG4gICAgICogfSk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgcmVzdEFwaT86IGFwaWcuSVJlc3RBcGkgfCBhcGlnLlJlc3RBcGlQcm9wcztcbiAgICAvKipcbiAgICAgKiBJZiB5b3UgYXJlIGltcG9ydGluZyBhbiBleGlzdGluZyBBUEkgR2F0ZXdheSBSRVNUIEFQSSBwcm9qZWN0LCB5b3UgY2FuIGltcG9ydCBleGlzdGluZyByb3V0ZSBwYXRocyBieSBwcm92aWRpbmcgYSBsaXN0IG9mIHBhdGhzIHdpdGggdGhlaXIgY29ycmVzcG9uZGluZyByZXNvdXJjZSBpZHMuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYGpzXG4gICAgICogaW1wb3J0IHsgUmVzdEFwaSB9IGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtYXBpZ2F0ZXdheVwiO1xuICAgICAqXG4gICAgICogbmV3IEFwaUdhdGV3YXlWMUFwaShzdGFjaywgXCJBcGlcIiwge1xuICAgICAqICAgY2RrOiB7XG4gICAgICogICAgIHJlc3RBcGk6IFJlc3RBcGkuZnJvbVJlc3RBcGlBdHRyaWJ1dGVzKHN0YWNrLCBcIkltcG9ydGVkQXBpXCIsIHtcbiAgICAgKiAgICAgICByZXN0QXBpSWQsXG4gICAgICogICAgICAgcm9vdFJlc291cmNlSWQsXG4gICAgICogICAgIH0pLFxuICAgICAqICAgICBpbXBvcnRlZFBhdGhzOiB7XG4gICAgICogICAgICAgXCIvbm90ZXNcIjogXCJzbHgyYm5cIixcbiAgICAgKiAgICAgICBcIi91c2Vyc1wiOiBcInV1OHhzM1wiLFxuICAgICAqICAgICB9LFxuICAgICAqICAgfVxuICAgICAqIH0pO1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQVBJIEdhdGV3YXkgUkVTVCBBUEkgaXMgc3RydWN0dXJlZCBpbiBhIHRyZWUgc3RydWN0dXJlOlxuICAgICAqIC0gRWFjaCBwYXRoIHBhcnQgaXMgYSBzZXBhcmF0ZSBBUEkgR2F0ZXdheSByZXNvdXJjZSBvYmplY3QuXG4gICAgICogLSBBbmQgYSBwYXRoIHBhcnQgaXMgYSBjaGlsZCByZXNvdXJjZSBvZiB0aGUgcHJlY2VkaW5nIHBhcnQuXG4gICAgICogU28gdGhlIHBhcnQgcGF0aCAvbm90ZXMsIGlzIGEgY2hpbGQgcmVzb3VyY2Ugb2YgdGhlIHJvb3QgcmVzb3VyY2UgLy4gQW5kIC9ub3Rlcy97bm90ZUlkfSBpcyBhIGNoaWxkIHJlc291cmNlIG9mIC9ub3Rlcy4gSWYgL25vdGVzIGhhcyBiZWVuIGNyZWF0ZWQgaW4gdGhlIGltcG9ydGVkIEFQSSwgeW91IGhhdmUgdG8gaW1wb3J0IGl0IGJlZm9yZSBjcmVhdGluZyB0aGUgL25vdGVzL3tub3RlSWR9IGNoaWxkIHJvdXRlLlxuICAgICAqL1xuICAgIGltcG9ydGVkUGF0aHM/OiB7IFtwYXRoOiBzdHJpbmddOiBzdHJpbmcgfTtcbiAgfTtcbiAgLyoqXG4gICAqIERlZmluZSB0aGUgcm91dGVzIGZvciB0aGUgQVBJLiBDYW4gYmUgYSBmdW5jdGlvbiwgcHJveHkgdG8gYW5vdGhlciBBUEksIG9yIHBvaW50IHRvIGFuIEFMQlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBgYGBqc1xuICAgKiBuZXcgQXBpR2F0ZXdheVYxQXBpKHN0YWNrLCBcIkFwaVwiLCB7XG4gICAqICAgXCJHRVQgL25vdGVzXCIgICAgICA6IFwic3JjL2xpc3QubWFpblwiLFxuICAgKiAgIFwiR0VUIC9ub3Rlcy97aWR9XCIgOiBcInNyYy9nZXQubWFpblwiLFxuICAgKiAgIFwiJGRlZmF1bHRcIjogXCJzcmMvZGVmYXVsdC5tYWluXCJcbiAgICogfSlcbiAgICogYGBgXG4gICAqL1xuICByb3V0ZXM/OiBSZWNvcmQ8c3RyaW5nLCBBcGlHYXRld2F5VjFBcGlSb3V0ZVByb3BzPEF1dGhvcml6ZXJLZXlzPj47XG4gIC8qKlxuICAgKiBDT1JTIHN1cHBvcnQgYXBwbGllZCB0byBhbGwgZW5kcG9pbnRzIGluIHRoaXMgQVBJXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIGBgYGpzXG4gICAqIG5ldyBBcGlHYXRld2F5VjFBcGkoc3RhY2ssIFwiQXBpXCIsIHtcbiAgICogICBjb3JzOiB7XG4gICAqICAgICBhbGxvd01ldGhvZHM6IFtcIkdFVFwiXSxcbiAgICogICB9LFxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqXG4gICAqL1xuICBjb3JzPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIEVuYWJsZSBDbG91ZFdhdGNoIGFjY2VzcyBsb2dzIGZvciB0aGlzIEFQSVxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqc1xuICAgKiBuZXcgQXBpR2F0ZXdheVYxQXBpKHN0YWNrLCBcIkFwaVwiLCB7XG4gICAqICAgYWNjZXNzTG9nOiB0cnVlXG4gICAqIH0pO1xuICAgKlxuICAgKiBgYGBcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEFwaUdhdGV3YXlWMUFwaShzdGFjaywgXCJBcGlcIiwge1xuICAgKiAgIGFjY2Vzc0xvZzoge1xuICAgKiAgICAgcmV0ZW50aW9uOiBcIm9uZV93ZWVrXCIsXG4gICAqICAgfSxcbiAgICogfSk7XG4gICAqIGBgYFxuICAgKi9cbiAgYWNjZXNzTG9nPzogYm9vbGVhbiB8IHN0cmluZyB8IEFwaUdhdGV3YXlWMUFwaUFjY2Vzc0xvZ1Byb3BzO1xuICAvKipcbiAgICogU3BlY2lmeSBhIGN1c3RvbSBkb21haW4gdG8gdXNlIGluIGFkZGl0aW9uIHRvIHRoZSBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBvbmUuIFNTVCBjdXJyZW50bHkgc3VwcG9ydHMgZG9tYWlucyB0aGF0IGFyZSBjb25maWd1cmVkIHVzaW5nIFtSb3V0ZSA1M10oaHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9yb3V0ZTUzLylcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEFwaUdhdGV3YXlWMUFwaShzdGFjaywgXCJBcGlcIiwge1xuICAgKiAgIGN1c3RvbURvbWFpbjogXCJhcGkuZXhhbXBsZS5jb21cIlxuICAgKiB9KVxuICAgKiBgYGBcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEFwaUdhdGV3YXlWMUFwaShzdGFjaywgXCJBcGlcIiwge1xuICAgKiAgIGN1c3RvbURvbWFpbjoge1xuICAgKiAgICAgZG9tYWluTmFtZTogXCJhcGkuZXhhbXBsZS5jb21cIixcbiAgICogICAgIGhvc3RlZFpvbmU6IFwiZG9tYWluLmNvbVwiLFxuICAgKiAgICAgcGF0aDogXCJ2MVwiXG4gICAqICAgfVxuICAgKiB9KVxuICAgKiBgYGBcbiAgICovXG4gIGN1c3RvbURvbWFpbj86IHN0cmluZyB8IEFwaUdhdGV3YXlWMUFwaUN1c3RvbURvbWFpblByb3BzO1xuICAvKipcbiAgICogRGVmaW5lIHRoZSBhdXRob3JpemVycyBmb3IgdGhlIEFQSS4gQ2FuIGJlIGEgdXNlciBwb29sLCBKV1QsIG9yIExhbWJkYSBhdXRob3JpemVycy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogbmV3IEFwaUdhdGV3YXlWMUFwaShzdGFjaywgXCJBcGlcIiwge1xuICAgKiAgIGF1dGhvcml6ZXJzOiB7XG4gICAqICAgICBNeUF1dGhvcml6ZXI6IHtcbiAgICogICAgICAgdHlwZTogXCJ1c2VyX3Bvb2xzXCIsXG4gICAqICAgICAgIHVzZXJQb29sSWRzOiBbdXNlclBvb2wudXNlclBvb2xJZF0sXG4gICAqICAgICB9LFxuICAgKiAgIH0sXG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICovXG4gIGF1dGhvcml6ZXJzPzogQXV0aG9yaXplcnM7XG4gIGRlZmF1bHRzPzoge1xuICAgIC8qKlxuICAgICAqIFRoZSBkZWZhdWx0IGZ1bmN0aW9uIHByb3BzIHRvIGJlIGFwcGxpZWQgdG8gYWxsIHRoZSBMYW1iZGEgZnVuY3Rpb25zIGluIHRoZSBBUEkuIFRoZSBgZW52aXJvbm1lbnRgLCBgcGVybWlzc2lvbnNgIGFuZCBgbGF5ZXJzYCBwcm9wZXJ0aWVzIHdpbGwgYmUgbWVyZ2VkIHdpdGggcGVyIHJvdXRlIGRlZmluaXRpb25zIGlmIHRoZXkgYXJlIGRlZmluZWQuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYGpzXG4gICAgICogbmV3IEFwaUdhdGV3YXlWMUFwaShzdGFjaywgXCJBcGlcIiwge1xuICAgICAqICAgZGVmYXVsdHM6IHtcbiAgICAgKiAgICAgZnVuY3Rpb246IHtcbiAgICAgKiAgICAgICB0aW1lb3V0OiAyMCxcbiAgICAgKiAgICAgICBlbnZpcm9ubWVudDogeyB0YWJsZU5hbWU6IHRhYmxlLnRhYmxlTmFtZSB9LFxuICAgICAqICAgICAgIHBlcm1pc3Npb25zOiBbdGFibGVdLFxuICAgICAqICAgICB9XG4gICAgICogICBlclxuICAgICAqIH0pO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGZ1bmN0aW9uPzogRnVuY3Rpb25Qcm9wcztcbiAgICAvKipcbiAgICAgKiBUaGUgYXV0aG9yaXplciBmb3IgYWxsIHRoZSByb3V0ZXMgaW4gdGhlIEFQSS5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBganNcbiAgICAgKiBuZXcgQXBpR2F0ZXdheVYxQXBpKHN0YWNrLCBcIkFwaVwiLCB7XG4gICAgICogICBkZWZhdWx0czoge1xuICAgICAqICAgICBhdXRob3JpemVyOiBcImlhbVwiLFxuICAgICAqICAgfVxuICAgICAqIH0pO1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGBqc1xuICAgICAqIG5ldyBBcGlHYXRld2F5VjFBcGkoc3RhY2ssIFwiQXBpXCIsIHtcbiAgICAgKiAgIGF1dGhvcml6ZXJzOiB7XG4gICAgICogICAgIEF1dGhvcml6ZXI6IHtcbiAgICAgKiAgICAgICB0eXBlOiBcInVzZXJfcG9vbHNcIixcbiAgICAgKiAgICAgICB1c2VyUG9vbElkczogW3VzZXJQb29sLnVzZXJQb29sSWRdLFxuICAgICAqICAgICB9LFxuICAgICAqICAgfSxcbiAgICAgKiAgIGRlZmF1bHRzOiB7XG4gICAgICogICAgIGF1dGhvcml6ZXI6IFwiQXV0aG9yaXplclwiLFxuICAgICAqICAgfVxuICAgICAqIH0pO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGF1dGhvcml6ZXI/OlxuICAgICAgfCBcIm5vbmVcIlxuICAgICAgfCBcImlhbVwiXG4gICAgICB8IChzdHJpbmcgZXh0ZW5kcyBBdXRob3JpemVyS2V5cyA/IG5ldmVyIDogQXV0aG9yaXplcktleXMpO1xuICAgIC8qKlxuICAgICAqIEFuIGFycmF5IG9mIHNjb3BlcyB0byBpbmNsdWRlIGluIHRoZSBhdXRob3JpemF0aW9uIHdoZW4gdXNpbmcgYHVzZXJfcG9vbGAgb3IgYGp3dGAgYXV0aG9yaXplcnMuIFRoZXNlIHdpbGwgYmUgbWVyZ2VkIHdpdGggdGhlIHNjb3BlcyBmcm9tIHRoZSBhdHRhY2hlZCBhdXRob3JpemVyLlxuICAgICAqIEBkZWZhdWx0IFtdXG4gICAgICovXG4gICAgYXV0aG9yaXphdGlvblNjb3Blcz86IHN0cmluZ1tdO1xuICB9O1xufVxuXG5leHBvcnQgdHlwZSBBcGlHYXRld2F5VjFBcGlSb3V0ZVByb3BzPEF1dGhvcml6ZXJLZXlzPiA9XG4gIHwgRnVuY3Rpb25JbmxpbmVEZWZpbml0aW9uXG4gIHwgQXBpR2F0ZXdheVYxQXBpRnVuY3Rpb25Sb3V0ZVByb3BzPEF1dGhvcml6ZXJLZXlzPjtcblxuLyoqXG4gKiBTcGVjaWZ5IGEgZnVuY3Rpb24gcm91dGUgaGFuZGxlciBhbmQgY29uZmlndXJlIGFkZGl0aW9uYWwgb3B0aW9uc1xuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqc1xuICogYXBpLmFkZFJvdXRlcyhwcm9wcy5zdGFjaywge1xuICogICBcIkdFVCAvbm90ZXMve2lkfVwiOiB7XG4gKiAgICAgdHlwZTogXCJmdW5jdGlvblwiLFxuICogICAgIGZ1bmN0aW9uOiBcInNyYy9nZXQubWFpblwiLFxuICogICAgIHBheWxvYWRGb3JtYXRWZXJzaW9uOiBcIjEuMFwiLFxuICogICB9XG4gKiB9KTtcbiAqIGBgYFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFwaUdhdGV3YXlWMUFwaUZ1bmN0aW9uUm91dGVQcm9wczxBdXRob3JpemVyS2V5cyA9IG5ldmVyPiB7XG4gIGZ1bmN0aW9uOiBGdW5jdGlvbkRlZmluaXRpb247XG4gIGF1dGhvcml6ZXI/OlxuICAgIHwgXCJub25lXCJcbiAgICB8IFwiaWFtXCJcbiAgICB8IChzdHJpbmcgZXh0ZW5kcyBBdXRob3JpemVyS2V5cyA/IG5ldmVyIDogQXV0aG9yaXplcktleXMpO1xuICBhdXRob3JpemF0aW9uU2NvcGVzPzogc3RyaW5nW107XG4gIGNkaz86IHtcbiAgICBtZXRob2Q/OiBPbWl0PFxuICAgICAgYXBpZy5NZXRob2RPcHRpb25zLFxuICAgICAgXCJhdXRob3JpemVyXCIgfCBcImF1dGhvcml6YXRpb25UeXBlXCIgfCBcImF1dGhvcml6YXRpb25TY29wZXNcIlxuICAgID47XG4gICAgaW50ZWdyYXRpb24/OiBhcGlnLkxhbWJkYUludGVncmF0aW9uT3B0aW9ucztcbiAgfTtcbn1cblxuZXhwb3J0IHR5cGUgQXBpR2F0ZXdheVYxQXBpQXV0aG9yaXplciA9XG4gIHwgQXBpR2F0ZXdheVYxQXBpVXNlclBvb2xzQXV0aG9yaXplclxuICB8IEFwaUdhdGV3YXlWMUFwaUxhbWJkYVRva2VuQXV0aG9yaXplclxuICB8IEFwaUdhdGV3YXlWMUFwaUxhbWJkYVJlcXVlc3RBdXRob3JpemVyO1xuXG5pbnRlcmZhY2UgQXBpR2F0ZXdheVYxQXBpQmFzZUF1dGhvcml6ZXIge1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGF1dGhvcml6ZXIuXG4gICAqL1xuICBuYW1lPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGFtb3VudCBvZiB0aW1lIHRoZSByZXN1bHRzIGFyZSBjYWNoZWQuXG4gICAqIEBkZWZhdWx0IE5vdCBjYWNoZWRcbiAgICovXG4gIHJlc3VsdHNDYWNoZVR0bD86IER1cmF0aW9uO1xufVxuXG4vKipcbiAqIFNwZWNpZnkgYSB1c2VyIHBvb2xzIGF1dGhvcml6ZXIgYW5kIGNvbmZpZ3VyZSBhZGRpdGlvbmFsIG9wdGlvbnMuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGpzXG4gKiBuZXcgQXBpR2F0ZXdheVYxQXBpKHN0YWNrLCBcIkFwaVwiLCB7XG4gKiAgIGF1dGhvcml6ZXJzOiB7XG4gKiAgICAgTXlBdXRob3JpemVyOiB7XG4gKiAgICAgICB0eXBlOiBcInVzZXJfcG9vbHNcIixcbiAqICAgICAgIHVzZXJQb29sSWRzOiBbdXNlclBvb2wudXNlclBvb2xJZF0sXG4gKiAgICAgfSxcbiAqICAgfSxcbiAqIH0pO1xuICogYGBgXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQXBpR2F0ZXdheVYxQXBpVXNlclBvb2xzQXV0aG9yaXplclxuICBleHRlbmRzIEFwaUdhdGV3YXlWMUFwaUJhc2VBdXRob3JpemVyIHtcbiAgLyoqXG4gICAqIFN0cmluZyBsaXRlcmFsIHRvIHNpZ25pZnkgdGhhdCB0aGUgYXV0aG9yaXplciBpcyB1c2VyIHBvb2wgYXV0aG9yaXplci5cbiAgICovXG4gIHR5cGU6IFwidXNlcl9wb29sc1wiO1xuICAvKipcbiAgICogVGhlIGlkcyBvZiB0aGUgdXNlciBwb29scyB0byB1c2UgZm9yIGF1dGhvcml6YXRpb24uXG4gICAqL1xuICB1c2VyUG9vbElkcz86IHN0cmluZ1tdO1xuICAvKipcbiAgICogVGhlIGlkZW50aXR5IHNvdXJjZSBmb3Igd2hpY2ggYXV0aG9yaXphdGlvbiBpcyByZXF1ZXN0ZWQuXG4gICAqL1xuICBpZGVudGl0eVNvdXJjZT86IHN0cmluZztcbiAgY2RrPzoge1xuICAgIC8qKlxuICAgICAqIFRoaXMgYWxsb3dzIHlvdSB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBzZXR0aW5ncyB0aGlzIGNvbnN0cnVjdCB1c2VzIGludGVybmFsbHkgdG8gY3JlYXRlIHRoZSBhdXRob3JpemVyLlxuICAgICAqL1xuICAgIGF1dGhvcml6ZXI6IGFwaWcuQ29nbml0b1VzZXJQb29sc0F1dGhvcml6ZXI7XG4gIH07XG59XG5cbi8qKlxuICogU3BlY2lmeSBhIExhbWJkYSBUT0tFTiBhdXRob3JpemVyIGFuZCBjb25maWd1cmUgYWRkaXRpb25hbCBvcHRpb25zLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqc1xuICogbmV3IEFwaUdhdGV3YXlWMUFwaShzdGFjaywgXCJBcGlcIiwge1xuICogICBhdXRob3JpemVyczoge1xuICogICAgIE15QXV0aG9yaXplcjoge1xuICogICAgICAgdHlwZTogXCJsYW1iZGFfdG9rZW5cIixcbiAqICAgICAgIGZ1bmN0aW9uOiBuZXcgRnVuY3Rpb24oc3RhY2ssIFwiQXV0aG9yaXplclwiLCB7XG4gKiAgICAgICAgIGhhbmRsZXI6IFwidGVzdC9sYW1iZGEuaGFuZGxlclwiXG4gKiAgICAgICB9KSxcbiAqICAgICAgIGlkZW50aXR5U291cmNlczogW2FwaWcuSWRlbnRpdHlTb3VyY2UuaGVhZGVyKFwiQXV0aG9yaXphdGlvblwiKV0sXG4gKiAgICAgfSxcbiAqICAgfSxcbiAqIH0pO1xuICogYGBgXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQXBpR2F0ZXdheVYxQXBpTGFtYmRhVG9rZW5BdXRob3JpemVyXG4gIGV4dGVuZHMgQXBpR2F0ZXdheVYxQXBpQmFzZUF1dGhvcml6ZXIge1xuICAvKipcbiAgICogU3RyaW5nIGxpdGVyYWwgdG8gc2lnbmlmeSB0aGF0IHRoZSBhdXRob3JpemVyIGlzIExhbWJkYSBUT0tFTiBhdXRob3JpemVyLlxuICAgKi9cbiAgdHlwZTogXCJsYW1iZGFfdG9rZW5cIjtcbiAgLyoqXG4gICAqIFVzZWQgdG8gY3JlYXRlIHRoZSBhdXRob3JpemVyIGZ1bmN0aW9uXG4gICAqL1xuICBmdW5jdGlvbj86IEZuO1xuICAvKipcbiAgICogVGhlIGlkZW50aXR5IHNvdXJjZSBmb3Igd2hpY2ggYXV0aG9yaXphdGlvbiBpcyByZXF1ZXN0ZWQuXG4gICAqL1xuICBpZGVudGl0eVNvdXJjZT86IHN0cmluZztcbiAgLyoqXG4gICAqIEFuIHJlZ2V4IHRvIGJlIG1hdGNoZWQgYWdhaW5zdCB0aGUgYXV0aG9yaXphdGlvbiB0b2tlbi5cbiAgICpcbiAgICogTm90ZSB0aGF0IHdoZW4gbWF0Y2hlZCwgdGhlIGF1dGhvcml6ZXIgbGFtYmRhIGlzIGludm9rZWQsIG90aGVyd2lzZSBhIDQwMSBVbmF1dGhvcml6ZWQgaXMgcmV0dXJuZWQgdG8gdGhlIGNsaWVudC5cbiAgICovXG4gIHZhbGlkYXRpb25SZWdleD86IHN0cmluZztcbiAgY2RrPzoge1xuICAgIC8qKlxuICAgICAqIEFuIElBTSByb2xlIGZvciBBUEkgR2F0ZXdheSB0byBhc3N1bWUgYmVmb3JlIGNhbGxpbmcgdGhlIExhbWJkYS1iYXNlZCBhdXRob3JpemVyLlxuICAgICAqL1xuICAgIGFzc3VtZVJvbGU/OiBpYW0uSVJvbGU7XG4gICAgLyoqXG4gICAgICogVGhpcyBhbGxvd3MgeW91IHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHNldHRpbmdzIHRoaXMgY29uc3RydWN0IHVzZXMgaW50ZXJuYWxseSB0byBjcmVhdGUgdGhlIGF1dGhvcml6ZXIuXG4gICAgICovXG4gICAgYXV0aG9yaXplcj86IGFwaWcuVG9rZW5BdXRob3JpemVyO1xuICB9O1xufVxuXG4vKipcbiAqIFNwZWNpZnkgYSBMYW1iZGEgUkVRVUVTVCBhdXRob3JpemVyIGFuZCBjb25maWd1cmUgYWRkaXRpb25hbCBvcHRpb25zLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqc1xuICogbmV3IEFwaUdhdGV3YXlWMUFwaShzdGFjaywgXCJBcGlcIiwge1xuICogICBhdXRob3JpemVyczoge1xuICogICAgIE15QXV0aG9yaXplcjoge1xuICogICAgICAgdHlwZTogXCJsYW1iZGFfcmVxdWVzdFwiLFxuICogICAgICAgZnVuY3Rpb246IG5ldyBGdW5jdGlvbihzdGFjaywgXCJBdXRob3JpemVyXCIsIHtcbiAqICAgICAgICAgaGFuZGxlcjogXCJ0ZXN0L2xhbWJkYS5oYW5kbGVyXCJcbiAqICAgICAgIH0pLFxuICogICAgICAgaWRlbnRpdHlTb3VyY2VzOiBbYXBpZy5JZGVudGl0eVNvdXJjZS5oZWFkZXIoXCJBdXRob3JpemF0aW9uXCIpXSxcbiAqICAgICB9LFxuICogICB9LFxuICogfSk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBcGlHYXRld2F5VjFBcGlMYW1iZGFSZXF1ZXN0QXV0aG9yaXplclxuICBleHRlbmRzIEFwaUdhdGV3YXlWMUFwaUJhc2VBdXRob3JpemVyIHtcbiAgLyoqXG4gICAqIFN0cmluZyBsaXRlcmFsIHRvIHNpZ25pZnkgdGhhdCB0aGUgYXV0aG9yaXplciBpcyBMYW1iZGEgUkVRVUVTVCBhdXRob3JpemVyLlxuICAgKi9cbiAgdHlwZTogXCJsYW1iZGFfcmVxdWVzdFwiO1xuICAvKipcbiAgICogVXNlZCB0byBjcmVhdGUgdGhlIGF1dGhvcml6ZXIgZnVuY3Rpb25cbiAgICovXG4gIGZ1bmN0aW9uPzogRm47XG4gIC8qKlxuICAgKiBUaGUgaWRlbnRpdHkgc291cmNlcyBmb3Igd2hpY2ggYXV0aG9yaXphdGlvbiBpcyByZXF1ZXN0ZWQuXG4gICAqL1xuICBpZGVudGl0eVNvdXJjZXM/OiBzdHJpbmdbXTtcbiAgY2RrPzoge1xuICAgIC8qKlxuICAgICAqIEFuIElBTSByb2xlIGZvciBBUEkgR2F0ZXdheSB0byBhc3N1bWUgYmVmb3JlIGNhbGxpbmcgdGhlIExhbWJkYS1iYXNlZCBhdXRob3JpemVyLlxuICAgICAqL1xuICAgIGFzc3VtZVJvbGU/OiBpYW0uSVJvbGU7XG4gICAgLyoqXG4gICAgICogVGhpcyBhbGxvd3MgeW91IHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHNldHRpbmdzIHRoaXMgY29uc3RydWN0IHVzZXMgaW50ZXJuYWxseSB0byBjcmVhdGUgdGhlIGF1dGhvcml6ZXIuXG4gICAgICovXG4gICAgYXV0aG9yaXplcj86IGFwaWcuVG9rZW5BdXRob3JpemVyO1xuICB9O1xufVxuXG4vKipcbiAqIFRoZSBjdXN0b21Eb21haW4gZm9yIHRoaXMgQVBJLiBTU1QgY3VycmVudGx5IHN1cHBvcnRzIGRvbWFpbnMgdGhhdCBhcmUgY29uZmlndXJlZCB1c2luZyBSb3V0ZSA1My4gSWYgeW91ciBkb21haW5zIGFyZSBob3N0ZWQgZWxzZXdoZXJlLCB5b3UgY2FuIFtmb2xsb3cgdGhpcyBndWlkZSB0byBtaWdyYXRlIHRoZW0gdG8gUm91dGUgNTNdKGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9Sb3V0ZTUzL2xhdGVzdC9EZXZlbG9wZXJHdWlkZS9NaWdyYXRpbmdETlMuaHRtbCkuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGpzXG4gKiBuZXcgQXBpR2F0ZXdheVYxQXBpKHN0YWNrLCBcIkFwaVwiLCB7XG4gKiAgIGN1c3RvbURvbWFpbjogXCJhcGkuZG9tYWluLmNvbVwiLFxuICogfSk7XG4gKiBgYGBcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBganNcbiAqIG5ldyBBcGlHYXRld2F5VjFBcGkoc3RhY2ssIFwiQXBpXCIsIHtcbiAqICAgY3VzdG9tRG9tYWluOiB7XG4gKiAgICAgZG9tYWluTmFtZTogXCJhcGkuZG9tYWluLmNvbVwiLFxuICogICAgIGhvc3RlZFpvbmU6IFwiZG9tYWluLmNvbVwiLFxuICogICAgIGVuZHBvaW50VHlwZTogRW5kcG9pbnRUeXBlLkVER0UsXG4gKiAgICAgcGF0aDogXCJ2MVwiLFxuICogICB9XG4gKiB9KTtcbiAqIGBgYFxuICpcbiAqIE5vdGUgdGhhdCwgU1NUIGF1dG9tYXRpY2FsbHkgY3JlYXRlcyBhIFJvdXRlIDUzIEEgcmVjb3JkIGluIHRoZSBob3N0ZWQgem9uZSB0byBwb2ludCB0aGUgY3VzdG9tIGRvbWFpbiB0byB0aGUgQVBJIEdhdGV3YXkgZG9tYWluLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFwaUdhdGV3YXlWMUFwaUN1c3RvbURvbWFpblByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBkb21haW4gdG8gYmUgYXNzaWduZWQgdG8gdGhlIEFQSSBlbmRwb2ludC5cbiAgICovXG4gIGRvbWFpbk5hbWU/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgaG9zdGVkIHpvbmUgaW4gUm91dGUgNTMgdGhhdCBjb250YWlucyB0aGUgZG9tYWluLlxuICAgKlxuICAgKiBCeSBkZWZhdWx0LCBTU1Qgd2lsbCBsb29rIGZvciBhIGhvc3RlZCB6b25lIGJ5IHN0cmlwcGluZyBvdXQgdGhlIGZpcnN0IHBhcnQgb2YgdGhlIGRvbWFpbk5hbWUgdGhhdCdzIHBhc3NlZCBpbi4gU28sIGlmIHlvdXIgZG9tYWluTmFtZSBpcyBgYXBpLmRvbWFpbi5jb21gLCBTU1Qgd2lsbCBkZWZhdWx0IHRoZSBob3N0ZWRab25lIHRvIGBkb21haW4uY29tYC5cbiAgICovXG4gIGhvc3RlZFpvbmU/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgYmFzZSBtYXBwaW5nIGZvciB0aGUgY3VzdG9tIGRvbWFpbi4gRm9yIGV4YW1wbGUsIGJ5IHNldHRpbmcgdGhlIGBkb21haW5OYW1lYCB0byBgYXBpLmRvbWFpbi5jb21gIGFuZCBgcGF0aGAgdG8gYHYxYCwgdGhlIGN1c3RvbSBkb21haW4gVVJMIGZvciB0aGUgQVBJIHdpbGwgYmVjb21lIGBodHRwczovL2FwaS5kb21haW4uY29tL3YxYC4gSWYgdGhlIHBhdGggaXMgbm90IHNldCwgdGhlIGN1c3RvbSBkb21haW4gVVJMIHdpbGwgYmUgYGh0dHBzOi8vYXBpLmRvbWFpbi5jb21gLlxuICAgKlxuICAgKiA6OjpjYXV0aW9uXG4gICAqIFlvdSBjYW5ub3QgY2hhbmdlIHRoZSBwYXRoIG9uY2UgaXQgaGFzIGJlZW4gc2V0LlxuICAgKiA6OjpcbiAgICpcbiAgICogTm90ZSwgaWYgdGhlIGBwYXRoYCB3YXMgbm90IGRlZmluZWQgaW5pdGlhbGx5LCBpdCBjYW5ub3QgYmUgZGVmaW5lZCBsYXRlci4gSWYgdGhlIGBwYXRoYCB3YXMgaW5pdGlhbGx5IGRlZmluZWQsIGl0IGNhbm5vdCBiZSBsYXRlciBjaGFuZ2VkIHRvIF91bmRlZmluZWRfLiBJbnN0ZWFkLCB5b3UnZCBuZWVkIHRvIHJlbW92ZSB0aGUgYGN1c3RvbURvbWFpbmAgb3B0aW9uIGZyb20gdGhlIGNvbnN0cnVjdCwgZGVwbG95IGl0LiBBbmQgdGhlbiBzZXQgaXQgdG8gdGhlIG5ldyBwYXRoIHZhbHVlLlxuICAgKi9cbiAgcGF0aD86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIGVuZHBvaW50IGZvciB0aGlzIERvbWFpbk5hbWUuXG4gICAqIEBkZWZhdWx0IGByZWdpb25hbGBcbiAgICovXG4gIGVuZHBvaW50VHlwZT86IExvd2VyY2FzZTxrZXlvZiB0eXBlb2YgYXBpZy5FbmRwb2ludFR5cGU+O1xuICBtdGxzPzoge1xuICAgIC8qKlxuICAgICAqIFRoZSBidWNrZXQgdGhhdCB0aGUgdHJ1c3Qgc3RvcmUgaXMgaG9zdGVkIGluLlxuICAgICAqL1xuICAgIGJ1Y2tldDogQnVja2V0O1xuICAgIC8qKlxuICAgICAqIFRoZSBrZXkgaW4gUzMgdG8gbG9vayBhdCBmb3IgdGhlIHRydXN0IHN0b3JlLlxuICAgICAqL1xuICAgIGtleTogc3RyaW5nO1xuICAgIC8qKlxuICAgICAqIFRoZSB2ZXJzaW9uIG9mIHRoZSBTMyBvYmplY3QgdGhhdCBjb250YWlucyB5b3VyIHRydXN0c3RvcmUuXG4gICAgICpcbiAgICAgKiBUbyBzcGVjaWZ5IGEgdmVyc2lvbiwgeW91IG11c3QgaGF2ZSB2ZXJzaW9uaW5nIGVuYWJsZWQgZm9yIHRoZSBTMyBidWNrZXQuXG4gICAgICovXG4gICAgdmVyc2lvbj86IHN0cmluZztcbiAgfTtcbiAgLyoqXG4gICAqIFRoZSBUcmFuc3BvcnQgTGF5ZXIgU2VjdXJpdHkgKFRMUykgdmVyc2lvbiArIGNpcGhlciBzdWl0ZSBmb3IgdGhpcyBkb21haW4gbmFtZS5cbiAgICogQGRlZmF1bHQgYFRMUyAxLjBgXG4gICAqL1xuICBzZWN1cml0eVBvbGljeT86IFwiVExTIDEuMFwiIHwgXCJUTFMgMS4yXCI7XG4gIGNkaz86IHtcbiAgICAvKipcbiAgICAgKiBJbXBvcnQgdGhlIHVuZGVybHlpbmcgQVBJIEdhdGV3YXkgY3VzdG9tIGRvbWFpbiBuYW1lcy5cbiAgICAgKi9cbiAgICBkb21haW5OYW1lPzogYXBpZy5JRG9tYWluTmFtZTtcbiAgICAvKipcbiAgICAgKiBJbXBvcnQgdGhlIHVuZGVybHlpbmcgUm91dGUgNTMgaG9zdGVkIHpvbmUuXG4gICAgICovXG4gICAgaG9zdGVkWm9uZT86IHJvdXRlNTMuSUhvc3RlZFpvbmU7XG4gICAgLyoqXG4gICAgICogSW1wb3J0IHRoZSB1bmRlcmx5aW5nIEFDTSBjZXJ0aWZpY2F0ZS5cbiAgICAgKi9cbiAgICBjZXJ0aWZpY2F0ZT86IGFjbS5JQ2VydGlmaWNhdGU7XG4gIH07XG59XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gQ29uc3RydWN0XG4vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuLyoqXG4gKlxuICogVGhlIGBBcGlHYXRld2F5VjFBcGlgIGNvbnN0cnVjdCBpcyBhIGhpZ2hlciBsZXZlbCBDREsgY29uc3RydWN0IHRoYXQgbWFrZXMgaXQgZWFzeSB0byBjcmVhdGUgYW4gQVBJIEdhdGV3YXkgUkVTVCBBUEkuIEl0IHByb3ZpZGVzIGEgc2ltcGxlIHdheSB0byBkZWZpbmUgdGhlIHJvdXRlcyBpbiB5b3VyIEFQSS4gQW5kIGFsbG93cyB5b3UgdG8gY29uZmlndXJlIHRoZSBzcGVjaWZpYyBMYW1iZGEgZnVuY3Rpb25zIGlmIG5lY2Vzc2FyeS4gSXQgYWxzbyBhbGxvd3MgeW91IHRvIGNvbmZpZ3VyZSBhdXRob3JpemF0aW9uIGFuZCBjdXN0b20gZG9tYWlucy4gU2VlIHRoZSBbZXhhbXBsZXNdKCNleGFtcGxlcykgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiA6Ojpub3RlXG4gKiBJZiB5b3UgYXJlIGNyZWF0aW5nIGEgbmV3IEFQSSwgdXNlIHRoZSBgQXBpYCBjb25zdHJ1Y3QgaW5zdGVhZC5cbiAqIDo6OlxuICpcbiAqIFRoZSBBcGkgY29uc3RydWN0IHVzZXMgW0FQSSBHYXRld2F5IFYyXShodHRwczovL2F3cy5hbWF6b24uY29tL2Jsb2dzL2NvbXB1dGUvYW5ub3VuY2luZy1odHRwLWFwaXMtZm9yLWFtYXpvbi1hcGktZ2F0ZXdheS8pLiBJdCdzIGJvdGggZmFzdGVyIGFuZCBjaGVhcGVyLiBIb3dldmVyLCBpZiB5b3UgbmVlZCBmZWF0dXJlcyBsaWtlIFVzYWdlIFBsYW5zIGFuZCBBUEkga2V5cywgdXNlIHRoZSBgQXBpR2F0ZXdheVYxQXBpYCBjb25zdHJ1Y3QgaW5zdGVhZC4gWW91IGNhbiBbY2hlY2sgb3V0IGEgZGV0YWlsZWQgY29tcGFyaXNvbiBoZXJlXShodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vYXBpZ2F0ZXdheS9sYXRlc3QvZGV2ZWxvcGVyZ3VpZGUvaHR0cC1hcGktdnMtcmVzdC5odG1sKS5cbiAqXG4gKiBAZXhhbXBsZVxuICogIyMjIE1pbmltYWwgY29uZmlnXG4gKlxuICogYGBganNcbiAqIGltcG9ydCB7IEFwaUdhdGV3YXlWMUFwaSB9IGZyb20gXCJAc2VydmVybGVzcy1zdGFjay9yZXNvdXJjZXNcIjtcbiAqXG4gKiBuZXcgQXBpR2F0ZXdheVYxQXBpKHN0YWNrLCBcIkFwaVwiLCB7XG4gKiAgIHJvdXRlczoge1xuICogICAgIFwiR0VUICAgIC9ub3Rlc1wiICAgICA6IFwic3JjL2xpc3QubWFpblwiLFxuICogICAgIFwiUE9TVCAgIC9ub3Rlc1wiICAgICA6IFwic3JjL2NyZWF0ZS5tYWluXCIsXG4gKiAgICAgXCJHRVQgICAgL25vdGVzL3tpZH1cIjogXCJzcmMvZ2V0Lm1haW5cIixcbiAqICAgICBcIlBVVCAgICAvbm90ZXMve2lkfVwiOiBcInNyYy91cGRhdGUubWFpblwiLFxuICogICAgIFwiREVMRVRFIC9ub3Rlcy97aWR9XCI6IFwic3JjL2RlbGV0ZS5tYWluXCIsXG4gKiAgIH0sXG4gKiB9KTtcbiAqIGBgYFxuICovXG5leHBvcnQgY2xhc3MgQXBpR2F0ZXdheVYxQXBpPFxuICAgIEF1dGhvcml6ZXJzIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgQXBpR2F0ZXdheVYxQXBpQXV0aG9yaXplcj4gPSBSZWNvcmQ8XG4gICAgICBzdHJpbmcsXG4gICAgICBuZXZlclxuICAgID5cbiAgPlxuICBleHRlbmRzIENvbnN0cnVjdFxuICBpbXBsZW1lbnRzIFNTVENvbnN0cnVjdFxue1xuICBwdWJsaWMgcmVhZG9ubHkgY2RrOiB7XG4gICAgLyoqXG4gICAgICogVGhlIGludGVybmFsbHkgY3JlYXRlZCByZXN0IEFQSVxuICAgICAqL1xuICAgIHJlc3RBcGk6IGFwaWcuUmVzdEFwaTtcbiAgICAvKipcbiAgICAgKiBUaGUgaW50ZXJuYWxseSBjcmVhdGVkIGxvZyBncm91cFxuICAgICAqL1xuICAgIGFjY2Vzc0xvZ0dyb3VwPzogbG9ncy5Mb2dHcm91cDtcbiAgICAvKipcbiAgICAgKiBUaGUgaW50ZXJuYWxseSBjcmVhdGVkIGRvbWFpbiBuYW1lXG4gICAgICovXG4gICAgZG9tYWluTmFtZT86IGFwaWcuRG9tYWluTmFtZTtcbiAgICAvKipcbiAgICAgKiBUaGUgaW50ZXJuYWxseSBjcmVhdGVkIGNlcnRpZmljYXRlXG4gICAgICovXG4gICAgY2VydGlmaWNhdGU/OiBhY20uQ2VydGlmaWNhdGUgfCBhY20uRG5zVmFsaWRhdGVkQ2VydGlmaWNhdGU7XG4gIH07XG4gIHByaXZhdGUgX2RlcGxveW1lbnQ/OiBhcGlnLkRlcGxveW1lbnQ7XG4gIHByaXZhdGUgX2N1c3RvbURvbWFpblVybD86IHN0cmluZztcbiAgcHJpdmF0ZSBpbXBvcnRlZFJlc291cmNlczogeyBbcGF0aDogc3RyaW5nXTogYXBpZy5JUmVzb3VyY2UgfTtcbiAgcHJpdmF0ZSBwcm9wczogQXBpR2F0ZXdheVYxQXBpUHJvcHM8QXV0aG9yaXplcnM+O1xuICBwcml2YXRlIGZ1bmN0aW9uczogeyBba2V5OiBzdHJpbmddOiBGbiB9O1xuICBwcml2YXRlIGF1dGhvcml6ZXJzRGF0YTogUmVjb3JkPHN0cmluZywgYXBpZy5JQXV0aG9yaXplcj47XG4gIHByaXZhdGUgcGVybWlzc2lvbnNBdHRhY2hlZEZvckFsbFJvdXRlczogUGVybWlzc2lvbnNbXTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIGlkOiBzdHJpbmcsXG4gICAgcHJvcHM/OiBBcGlHYXRld2F5VjFBcGlQcm9wczxBdXRob3JpemVycz5cbiAgKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIHRoaXMucHJvcHMgPSBwcm9wcyB8fCB7fTtcbiAgICB0aGlzLmNkayA9IHt9IGFzIGFueTtcbiAgICB0aGlzLmZ1bmN0aW9ucyA9IHt9O1xuICAgIHRoaXMuYXV0aG9yaXplcnNEYXRhID0ge307XG4gICAgdGhpcy5pbXBvcnRlZFJlc291cmNlcyA9IHt9O1xuICAgIHRoaXMucGVybWlzc2lvbnNBdHRhY2hlZEZvckFsbFJvdXRlcyA9IFtdO1xuXG4gICAgdGhpcy5jcmVhdGVSZXN0QXBpKCk7XG4gICAgdGhpcy5hZGRBdXRob3JpemVycyh0aGlzLnByb3BzLmF1dGhvcml6ZXJzIHx8ICh7fSBhcyBBdXRob3JpemVycykpO1xuICAgIHRoaXMuYWRkUm91dGVzKHRoaXMsIHRoaXMucHJvcHMucm91dGVzIHx8IHt9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgQVdTIGdlbmVyYXRlZCBVUkwgb2YgdGhlIEFwaS5cbiAgICovXG4gIHB1YmxpYyBnZXQgdXJsKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY2RrLnJlc3RBcGkudXJsO1xuICB9XG5cbiAgLyoqXG4gICAqIElmIGN1c3RvbSBkb21haW4gaXMgZW5hYmxlZCwgdGhpcyBpcyB0aGUgY3VzdG9tIGRvbWFpbiBVUkwgb2YgdGhlIEFwaS5cbiAgICpcbiAgICogOjo6bm90ZVxuICAgKiBJZiB5b3UgYXJlIHNldHRpbmcgdGhlIGJhc2UgbWFwcGluZyBmb3IgdGhlIGN1c3RvbSBkb21haW4sIHlvdSBuZWVkIHRvIGluY2x1ZGUgdGhlIHRyYWlsaW5nIHNsYXNoIHdoaWxlIHVzaW5nIHRoZSBjdXN0b20gZG9tYWluIFVSTC4gRm9yIGV4YW1wbGUsIGlmIHRoZSBbYGRvbWFpbk5hbWVgXSgjZG9tYWlubmFtZSkgaXMgc2V0IHRvIGBhcGkuZG9tYWluLmNvbWAgYW5kIHRoZSBbYHBhdGhgXSgjcGF0aCkgaXMgYHYxYCwgdGhlIGN1c3RvbSBkb21haW4gVVJMIG9mIHRoZSBBUEkgd2lsbCBiZSBgaHR0cHM6Ly9hcGkuZG9tYWluLmNvbS92MS9gLlxuICAgKiA6OjpcbiAgICovXG4gIHB1YmxpYyBnZXQgY3VzdG9tRG9tYWluVXJsKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbURvbWFpblVybDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgcm91dGVzIGZvciB0aGUgQXBpXG4gICAqL1xuICBwdWJsaWMgZ2V0IHJvdXRlcygpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuZnVuY3Rpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBpbnRlcm5hbGx5IGNyZWF0ZWQgQVBJIEdhdGV3YXkgUkVTVCBBUElcbiAgICovXG4gIHB1YmxpYyBnZXQgcmVzdEFwaUFybigpOiBzdHJpbmcge1xuICAgIGNvbnN0IHN0YWNrID0gU3RhY2sub2YodGhpcyk7XG4gICAgcmV0dXJuIGBhcm46JHtzdGFjay5wYXJ0aXRpb259OmFwaWdhdGV3YXk6JHtzdGFjay5yZWdpb259OjovcmVzdGFwaXMvJHt0aGlzLmNkay5yZXN0QXBpLnJlc3RBcGlJZH1gO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBpZCBvZiB0aGUgaW50ZXJuYWxseSBjcmVhdGVkIEFQSSBHYXRld2F5IFJFU1QgQVBJXG4gICAqL1xuICBwdWJsaWMgZ2V0IHJlc3RBcGlJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmNkay5yZXN0QXBpLnJlc3RBcGlJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIHJvdXRlcyB0byB0aGUgQXBpIGFmdGVyIGl0IGhhcyBiZWVuIGNyZWF0ZWQuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGpzXG4gICAqIGFwaS5hZGRSb3V0ZXMoc3RhY2ssIHtcbiAgICogICBcIkdFVCAgICAvbm90ZXMve2lkfVwiOiBcInNyYy9nZXQubWFpblwiLFxuICAgKiAgIFwiUFVUICAgIC9ub3Rlcy97aWR9XCI6IFwic3JjL3VwZGF0ZS5tYWluXCIsXG4gICAqICAgXCJERUxFVEUgL25vdGVzL3tpZH1cIjogXCJzcmMvZGVsZXRlLm1haW5cIixcbiAgICogfSk7XG4gICAqIGBgYFxuICAgKi9cbiAgcHVibGljIGFkZFJvdXRlcyhcbiAgICBzY29wZTogQ29uc3RydWN0LFxuICAgIHJvdXRlczogUmVjb3JkPHN0cmluZywgQXBpR2F0ZXdheVYxQXBpUm91dGVQcm9wczxrZXlvZiBBdXRob3JpemVycz4+XG4gICk6IHZvaWQge1xuICAgIE9iamVjdC5rZXlzKHJvdXRlcykuZm9yRWFjaCgocm91dGVLZXk6IHN0cmluZykgPT4ge1xuICAgICAgLy8gYWRkIHJvdXRlXG4gICAgICBjb25zdCBmbiA9IHRoaXMuYWRkUm91dGUoc2NvcGUsIHJvdXRlS2V5LCByb3V0ZXNbcm91dGVLZXldKTtcblxuICAgICAgLy8gYXR0YWNoZWQgZXhpc3RpbmcgcGVybWlzc2lvbnNcbiAgICAgIHRoaXMucGVybWlzc2lvbnNBdHRhY2hlZEZvckFsbFJvdXRlcy5mb3JFYWNoKChwZXJtaXNzaW9ucykgPT5cbiAgICAgICAgZm4uYXR0YWNoUGVybWlzc2lvbnMocGVybWlzc2lvbnMpXG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgaW5zdGFuY2Ugb2YgdGhlIGludGVybmFsbHkgY3JlYXRlZCBGdW5jdGlvbiwgZm9yIGEgZ2l2ZW4gcm91dGUga2V5IHdoZXJlIHRoZSBgcm91dGVLZXlgIGlzIHRoZSBrZXkgdXNlZCB0byBkZWZpbmUgYSByb3V0ZS4gRm9yIGV4YW1wbGUsIGBHRVQgL25vdGVzYC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogY29uc3QgYXBpID0gbmV3IEFwaUdhdGV3YXlWMUFwaShzdGFjaywgXCJBcGlcIiwge1xuICAgKiAgIHJvdXRlczoge1xuICAgKiAgICAgXCJHRVQgICAgL25vdGVzXCI6IFwic3JjL2xpc3QubWFpblwiLFxuICAgKiAgIH0sXG4gICAqIH0pO1xuICAgKlxuICAgKiBjb25zdCBsaXN0RnVuY3Rpb24gPSBhcGkuZ2V0RnVuY3Rpb24oXCJHRVQgL25vdGVzXCIpO1xuICAgKiBgYGBcbiAgICovXG4gIHB1YmxpYyBnZXRGdW5jdGlvbihyb3V0ZUtleTogc3RyaW5nKTogRm4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmZ1bmN0aW9uc1t0aGlzLm5vcm1hbGl6ZVJvdXRlS2V5KHJvdXRlS2V5KV07XG4gIH1cblxuICAvKipcbiAgICogQXR0YWNoZXMgdGhlIGdpdmVuIGxpc3Qgb2YgcGVybWlzc2lvbnMgdG8gYWxsIHRoZSByb3V0ZXMuIFRoaXMgYWxsb3dzIHRoZSBmdW5jdGlvbnMgdG8gYWNjZXNzIG90aGVyIEFXUyByZXNvdXJjZXMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIGBgYGpzXG4gICAqIGFwaS5hdHRhY2hQZXJtaXNzaW9ucyhbXCJzM1wiXSk7XG4gICAqIGBgYFxuICAgKi9cbiAgcHVibGljIGF0dGFjaFBlcm1pc3Npb25zKHBlcm1pc3Npb25zOiBQZXJtaXNzaW9ucyk6IHZvaWQge1xuICAgIE9iamVjdC52YWx1ZXModGhpcy5mdW5jdGlvbnMpLmZvckVhY2goKGZuKSA9PlxuICAgICAgZm4uYXR0YWNoUGVybWlzc2lvbnMocGVybWlzc2lvbnMpXG4gICAgKTtcbiAgICB0aGlzLnBlcm1pc3Npb25zQXR0YWNoZWRGb3JBbGxSb3V0ZXMucHVzaChwZXJtaXNzaW9ucyk7XG4gIH1cblxuICAvKipcbiAgICogQXR0YWNoZXMgdGhlIGdpdmVuIGxpc3Qgb2YgcGVybWlzc2lvbnMgdG8gYSBzcGVjaWZpYyByb3V0ZS4gVGhpcyBhbGxvd3MgdGhhdCBmdW5jdGlvbiB0byBhY2Nlc3Mgb3RoZXIgQVdTIHJlc291cmNlcy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBganNcbiAgICogY29uc3QgYXBpID0gbmV3IEFwaUdhdGV3YXlWMUFwaShzdGFjaywgXCJBcGlcIiwge1xuICAgKiAgIHJvdXRlczoge1xuICAgKiAgICAgXCJHRVQgL25vdGVzXCI6IFwic3JjL2xpc3QubWFpblwiLFxuICAgKiAgIH0sXG4gICAqIH0pO1xuICAgKlxuICAgKiBhcGkuYXR0YWNoUGVybWlzc2lvbnNUb1JvdXRlKFwiR0VUIC9ub3Rlc1wiLCBbXCJzM1wiXSk7XG4gICAqIGBgYFxuICAgKi9cbiAgcHVibGljIGF0dGFjaFBlcm1pc3Npb25zVG9Sb3V0ZShcbiAgICByb3V0ZUtleTogc3RyaW5nLFxuICAgIHBlcm1pc3Npb25zOiBQZXJtaXNzaW9uc1xuICApOiB2b2lkIHtcbiAgICBjb25zdCBmbiA9IHRoaXMuZ2V0RnVuY3Rpb24ocm91dGVLZXkpO1xuICAgIGlmICghZm4pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEZhaWxlZCB0byBhdHRhY2ggcGVybWlzc2lvbnMuIFJvdXRlIFwiJHtyb3V0ZUtleX1cIiBkb2VzIG5vdCBleGlzdC5gXG4gICAgICApO1xuICAgIH1cblxuICAgIGZuLmF0dGFjaFBlcm1pc3Npb25zKHBlcm1pc3Npb25zKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRDb25zdHJ1Y3RNZXRhZGF0YSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJBcGlHYXRld2F5VjFBcGlcIiBhcyBjb25zdCxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgY3VzdG9tRG9tYWluVXJsOiB0aGlzLl9jdXN0b21Eb21haW5VcmwsXG4gICAgICAgIHVybDogdGhpcy5jZGsucmVzdEFwaS51cmwsXG4gICAgICAgIHJlc3RBcGlJZDogdGhpcy5jZGsucmVzdEFwaS5yZXN0QXBpSWQsXG4gICAgICAgIHJvdXRlczogT2JqZWN0LmVudHJpZXModGhpcy5mdW5jdGlvbnMpLm1hcCgoW2tleSwgZGF0YV0pID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcm91dGU6IGtleSxcbiAgICAgICAgICAgIGZuOiBnZXRGdW5jdGlvblJlZihkYXRhKSxcbiAgICAgICAgICB9O1xuICAgICAgICB9KSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUmVzdEFwaSgpIHtcbiAgICBjb25zdCB7IGNkaywgY29ycywgYWNjZXNzTG9nLCBjdXN0b21Eb21haW4gfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgaWQgPSB0aGlzLm5vZGUuaWQ7XG4gICAgY29uc3QgYXBwID0gdGhpcy5ub2RlLnJvb3QgYXMgQXBwO1xuXG4gICAgaWYgKGlzQ0RLQ29uc3RydWN0KGNkaz8ucmVzdEFwaSkpIHtcbiAgICAgIGlmIChjb3JzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBDYW5ub3QgY29uZmlndXJlIHRoZSBcImNvcnNcIiB3aGVuIHRoZSBcInJlc3RBcGlcIiBpcyBpbXBvcnRlZGBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChhY2Nlc3NMb2cgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYENhbm5vdCBjb25maWd1cmUgdGhlIFwiYWNjZXNzTG9nXCIgd2hlbiB0aGUgXCJyZXN0QXBpXCIgaXMgaW1wb3J0ZWRgXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoY3VzdG9tRG9tYWluICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBDYW5ub3QgY29uZmlndXJlIHRoZSBcImN1c3RvbURvbWFpblwiIHdoZW4gdGhlIFwicmVzdEFwaVwiIGlzIGltcG9ydGVkYFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhpcy5jZGsucmVzdEFwaSA9IGNkaz8ucmVzdEFwaSBhcyBhcGlnLlJlc3RBcGk7XG5cbiAgICAgIC8vIENyZWF0ZSBhbiBBUEkgR2F0ZXdheSBkZXBsb3ltZW50IHJlc291cmNlIHRvIHRyaWdnZXIgYSBkZXBsb3ltZW50XG4gICAgICB0aGlzLl9kZXBsb3ltZW50ID0gbmV3IGFwaWcuRGVwbG95bWVudCh0aGlzLCBcIkRlcGxveW1lbnRcIiwge1xuICAgICAgICBhcGk6IHRoaXMuY2RrLnJlc3RBcGksXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNmbkRlcGxveW1lbnQgPSB0aGlzLl9kZXBsb3ltZW50Lm5vZGVcbiAgICAgICAgLmRlZmF1bHRDaGlsZCBhcyBhcGlnLkNmbkRlcGxveW1lbnQ7XG4gICAgICBjZm5EZXBsb3ltZW50LnN0YWdlTmFtZSA9IGFwcC5zdGFnZTtcblxuICAgICAgaWYgKGNkaz8uaW1wb3J0ZWRQYXRocykge1xuICAgICAgICB0aGlzLmltcG9ydFJlc291cmNlcyhjZGs/LmltcG9ydGVkUGF0aHMpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCByZXN0QXBpUHJvcHMgPSAoY2RrPy5yZXN0QXBpIHx8IHt9KSBhcyBhcGlnLlJlc3RBcGlQcm9wcztcblxuICAgICAgLy8gVmFsaWRhdGUgaW5wdXRcbiAgICAgIGlmIChjZGs/LmltcG9ydGVkUGF0aHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBpbXBvcnQgcm91dGUgcGF0aHMgd2hlbiBjcmVhdGluZyBhIG5ldyBBUEkuYCk7XG4gICAgICB9XG4gICAgICBpZiAoY3VzdG9tRG9tYWluICE9PSB1bmRlZmluZWQgJiYgcmVzdEFwaVByb3BzLmRvbWFpbk5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYFVzZSBlaXRoZXIgdGhlIFwiY3VzdG9tRG9tYWluXCIgb3IgdGhlIFwicmVzdEFwaS5kb21haW5OYW1lXCIgdG8gY29uZmlndXJlIHRoZSBBcGkgZG9tYWluLiBEbyBub3QgdXNlIGJvdGguYFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICBjb3JzICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgcmVzdEFwaVByb3BzLmRlZmF1bHRDb3JzUHJlZmxpZ2h0T3B0aW9ucyAhPT0gdW5kZWZpbmVkXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBVc2UgZWl0aGVyIHRoZSBcImNvcnNcIiBvciB0aGUgXCJyZXN0QXBpLmRlZmF1bHRDb3JzUHJlZmxpZ2h0T3B0aW9uc1wiIHRvIGNvbmZpZ3VyZSB0aGUgQXBpJ3MgQ09SUyBjb25maWcuIERvIG5vdCB1c2UgYm90aC5gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoXG4gICAgICAgIGFjY2Vzc0xvZyAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgIHJlc3RBcGlQcm9wcy5kZXBsb3lPcHRpb25zPy5hY2Nlc3NMb2dEZXN0aW5hdGlvbiAhPT0gdW5kZWZpbmVkXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBVc2UgZWl0aGVyIHRoZSBcImFjY2Vzc0xvZ1wiIG9yIHRoZSBcInJlc3RBcGkuZGVwbG95T3B0aW9ucy5hY2Nlc3NMb2dEZXN0aW5hdGlvblwiIHRvIGNvbmZpZ3VyZSB0aGUgQXBpJ3MgYWNjZXNzIGxvZy4gRG8gbm90IHVzZSBib3RoLmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgYWNjZXNzTG9nICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgcmVzdEFwaVByb3BzLmRlcGxveU9wdGlvbnM/LmFjY2Vzc0xvZ0Zvcm1hdCAhPT0gdW5kZWZpbmVkXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBVc2UgZWl0aGVyIHRoZSBcImFjY2Vzc0xvZ1wiIG9yIHRoZSBcInJlc3RBcGkuZGVwbG95T3B0aW9ucy5hY2Nlc3NMb2dGb3JtYXRcIiB0byBjb25maWd1cmUgdGhlIEFwaSdzIGFjY2VzcyBsb2cuIERvIG5vdCB1c2UgYm90aC5gXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN0YWdlTmFtZSA9XG4gICAgICAgIHJlc3RBcGlQcm9wcy5kZXBsb3lPcHRpb25zPy5zdGFnZU5hbWUgfHwgKHRoaXMubm9kZS5yb290IGFzIEFwcCkuc3RhZ2U7XG5cbiAgICAgIGNvbnN0IGFjY2Vzc0xvZ0RhdGEgPSBhcGlnVjFBY2Nlc3NMb2cuYnVpbGRBY2Nlc3NMb2dEYXRhKHRoaXMsIGFjY2Vzc0xvZyk7XG5cbiAgICAgIHRoaXMuY2RrLmFjY2Vzc0xvZ0dyb3VwID0gYWNjZXNzTG9nRGF0YT8ubG9nR3JvdXA7XG5cbiAgICAgIHRoaXMuY2RrLnJlc3RBcGkgPSBuZXcgYXBpZy5SZXN0QXBpKHRoaXMsIFwiQXBpXCIsIHtcbiAgICAgICAgcmVzdEFwaU5hbWU6IGFwcC5sb2dpY2FsUHJlZml4ZWROYW1lKGlkKSxcbiAgICAgICAgLi4ucmVzdEFwaVByb3BzLFxuICAgICAgICBkb21haW5OYW1lOiByZXN0QXBpUHJvcHMuZG9tYWluTmFtZSxcbiAgICAgICAgZGVmYXVsdENvcnNQcmVmbGlnaHRPcHRpb25zOlxuICAgICAgICAgIHJlc3RBcGlQcm9wcy5kZWZhdWx0Q29yc1ByZWZsaWdodE9wdGlvbnMgfHxcbiAgICAgICAgICB0aGlzLmJ1aWxkQ29yc0NvbmZpZyhjb3JzKSxcbiAgICAgICAgZGVwbG95T3B0aW9uczoge1xuICAgICAgICAgIC4uLihyZXN0QXBpUHJvcHMuZGVwbG95T3B0aW9ucyB8fCB7fSksXG4gICAgICAgICAgYWNjZXNzTG9nRGVzdGluYXRpb246XG4gICAgICAgICAgICByZXN0QXBpUHJvcHMuZGVwbG95T3B0aW9ucz8uYWNjZXNzTG9nRGVzdGluYXRpb24gfHxcbiAgICAgICAgICAgIGFjY2Vzc0xvZ0RhdGE/LmRlc3RpbmF0aW9uLFxuICAgICAgICAgIGFjY2Vzc0xvZ0Zvcm1hdDpcbiAgICAgICAgICAgIHJlc3RBcGlQcm9wcy5kZXBsb3lPcHRpb25zPy5hY2Nlc3NMb2dGb3JtYXQgfHxcbiAgICAgICAgICAgIGFjY2Vzc0xvZ0RhdGE/LmZvcm1hdCxcblxuICAgICAgICAgIC8vIGRlZmF1bHQgdG8gdGhlIG5hbWUgb2YgdGhlIHNhZ2VcbiAgICAgICAgICBzdGFnZU5hbWU6IHN0YWdlTmFtZSxcblxuICAgICAgICAgIC8vIGRlZmF1bHQgdG8gdHJ1ZVxuICAgICAgICAgIHRyYWNpbmdFbmFibGVkOlxuICAgICAgICAgICAgcmVzdEFwaVByb3BzLmRlcGxveU9wdGlvbnM/LnRyYWNpbmdFbmFibGVkID09PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgPyB0cnVlXG4gICAgICAgICAgICAgIDogcmVzdEFwaVByb3BzLmRlcGxveU9wdGlvbnM/LnRyYWNpbmdFbmFibGVkLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY3JlYXRlQ3VzdG9tRG9tYWluKGN1c3RvbURvbWFpbik7XG4gICAgICB0aGlzLmNyZWF0ZUdhdGV3YXlSZXNwb25zZUZvckNvcnMoY29ycyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBidWlsZENvcnNDb25maWcoY29ycz86IGJvb2xlYW4pOiBhcGlnLkNvcnNPcHRpb25zIHwgdW5kZWZpbmVkIHtcbiAgICAvLyBDYXNlOiBjb3JzIGlzIGZhbHNlXG4gICAgaWYgKGNvcnMgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8vIENhc2U6IGNvcnMgaXMgdHJ1ZSBvciB1bmRlZmluZWRcbiAgICByZXR1cm4ge1xuICAgICAgYWxsb3dPcmlnaW5zOiBhcGlnLkNvcnMuQUxMX09SSUdJTlMsXG4gICAgfSBhcyBhcGlnLkNvcnNPcHRpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVHYXRld2F5UmVzcG9uc2VGb3JDb3JzKGNvcnM/OiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKCFjb3JzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5jZGsucmVzdEFwaS5hZGRHYXRld2F5UmVzcG9uc2UoXCJHYXRld2F5UmVzcG9uc2VEZWZhdWx0NFhYXCIsIHtcbiAgICAgIHR5cGU6IGFwaWcuUmVzcG9uc2VUeXBlLkRFRkFVTFRfNFhYLFxuICAgICAgcmVzcG9uc2VIZWFkZXJzOiB7XG4gICAgICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCI6IFwiJyonXCIsXG4gICAgICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVyc1wiOiBcIicqJ1wiLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuY2RrLnJlc3RBcGkuYWRkR2F0ZXdheVJlc3BvbnNlKFwiR2F0ZXdheVJlc3BvbnNlRGVmYXVsdDVYWFwiLCB7XG4gICAgICB0eXBlOiBhcGlnLlJlc3BvbnNlVHlwZS5ERUZBVUxUXzVYWCxcbiAgICAgIHJlc3BvbnNlSGVhZGVyczoge1xuICAgICAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiOiBcIicqJ1wiLFxuICAgICAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnNcIjogXCInKidcIixcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUN1c3RvbURvbWFpbihcbiAgICBjdXN0b21Eb21haW4/OiBzdHJpbmcgfCBBcGlHYXRld2F5VjFBcGlDdXN0b21Eb21haW5Qcm9wc1xuICApOiB2b2lkIHtcbiAgICAvLyBDYXNlOiBjdXN0b21Eb21haW4gaXMgbm90IHNldFxuICAgIGlmIChjdXN0b21Eb21haW4gPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFRvIGJlIGltcGxlbWVudGVkOiB0byBhbGxvdyBtb3JlIGZsZXhpYmxlIHVzZSBjYXNlcywgU1NUIHNob3VsZCBzdXBwb3J0IDMgbW9yZSB1c2UgY2FzZXM6XG4gICAgLy8gIDEuIEFsbG93IHVzZXIgcGFzc2luZyBpbiBgaG9zdGVkWm9uZWAgb2JqZWN0LiBUaGUgdXNlIGNhc2UgaXMgd2hlbiB0aGVyZSBhcmUgbXVsdGlwbGVcbiAgICAvLyAgICAgSG9zdGVkWm9uZXMgd2l0aCB0aGUgc2FtZSBkb21haW4sIGJ1dCBvbmUgaXMgcHVibGljLCBhbmQgb25lIGlzIHByaXZhdGUuXG4gICAgLy8gIDIuIEFsbG93IHVzZXIgcGFzc2luZyBpbiBgY2VydGlmaWNhdGVgIG9iamVjdC4gVGhlIHVzZSBjYXNlIGlzIGZvciB1c2VyIHRvIGNyZWF0ZSB3aWxkY2FyZFxuICAgIC8vICAgICBjZXJ0aWZpY2F0ZSBvciB1c2luZyBhbiBpbXBvcnRlZCBjZXJ0aWZpY2F0ZS5cbiAgICAvLyAgMy4gQWxsb3cgdXNlciBwYXNzaW5nIGluIGBhcGlnRG9tYWluTmFtZWAgb2JqZWN0LiBUaGUgdXNlIGNhc2UgaXMgYSB1c2VyIGNyZWF0ZXMgbXVsdGlwbGUgQVBJXG4gICAgLy8gICAgIGVuZHBvaW50cywgYW5kIGlzIG1hcHBpbmcgdGhlbSB1bmRlciB0aGUgc2FtZSBjdXN0b20gZG9tYWluLiBgc3N0LkFwaWAgbmVlZHMgdG8gZXhwb3NlIHRoZVxuICAgIC8vICAgICBgYXBpZ0RvbWFpbk5hbWVgIGNvbnN0cnVjdCBjcmVhdGVkIGluIHRoZSBmaXJzdCBBcGksIGFuZCBsZXRzIHVzZXIgcGFzcyBpdCBpbiB3aGVuIGNyZWF0aW5nXG4gICAgLy8gICAgIHRoZSBzZWNvbmQgQXBpLlxuXG4gICAgbGV0IGRvbWFpbk5hbWUsXG4gICAgICBob3N0ZWRab25lLFxuICAgICAgaG9zdGVkWm9uZURvbWFpbixcbiAgICAgIGNlcnRpZmljYXRlLFxuICAgICAgYXBpZ0RvbWFpbk5hbWUsXG4gICAgICBiYXNlUGF0aCxcbiAgICAgIGVuZHBvaW50VHlwZSxcbiAgICAgIG10bHMsXG4gICAgICBzZWN1cml0eVBvbGljeTtcblxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIFBhcnNlIGlucHV0XG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAvLyBDYXNlOiBjdXN0b21Eb21haW4gaXMgYSBzdHJpbmdcbiAgICBpZiAodHlwZW9mIGN1c3RvbURvbWFpbiA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgLy8gdmFsaWRhdGU6IGN1c3RvbURvbWFpbiBpcyBhIFRPS0VOIHN0cmluZ1xuICAgICAgLy8gaWUuIGltcG9ydGVkIFNTTSB2YWx1ZTogc3NtLlN0cmluZ1BhcmFtZXRlci52YWx1ZUZvclN0cmluZ1BhcmFtZXRlcigpXG4gICAgICBpZiAoY2RrLlRva2VuLmlzVW5yZXNvbHZlZChjdXN0b21Eb21haW4pKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgWW91IGFsc28gbmVlZCB0byBzcGVjaWZ5IHRoZSBcImhvc3RlZFpvbmVcIiBpZiB0aGUgXCJkb21haW5OYW1lXCIgaXMgcGFzc2VkIGluIGFzIGEgcmVmZXJlbmNlLmBcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgZG9tYWluTmFtZSA9IGN1c3RvbURvbWFpbjtcbiAgICAgIHRoaXMuYXNzZXJ0RG9tYWluTmFtZUlzTG93ZXJDYXNlKGRvbWFpbk5hbWUpO1xuICAgICAgaG9zdGVkWm9uZURvbWFpbiA9IGN1c3RvbURvbWFpbi5zcGxpdChcIi5cIikuc2xpY2UoMSkuam9pbihcIi5cIik7XG4gICAgfVxuXG4gICAgLy8gQ2FzZTogY3VzdG9tRG9tYWluLmRvbWFpbk5hbWUgaXMgYSBzdHJpbmdcbiAgICBlbHNlIGlmIChjdXN0b21Eb21haW4uZG9tYWluTmFtZSkge1xuICAgICAgZG9tYWluTmFtZSA9IGN1c3RvbURvbWFpbi5kb21haW5OYW1lO1xuXG4gICAgICAvLyBwYXJzZSBjdXN0b21Eb21haW4uZG9tYWluTmFtZVxuICAgICAgaWYgKGNkay5Ub2tlbi5pc1VucmVzb2x2ZWQoY3VzdG9tRG9tYWluLmRvbWFpbk5hbWUpKSB7XG4gICAgICAgIC8vIElmIGN1c3RvbURvbWFpbiBpcyBhIFRPS0VOIHN0cmluZywgXCJob3N0ZWRab25lXCIgaGFzIHRvIGJlIHBhc3NlZCBpbi4gVGhpc1xuICAgICAgICAvLyBpcyBiZWNhdXNlIFwiaG9zdGVkWm9uZVwiIGNhbm5vdCBiZSBwYXJzZWQgZnJvbSBhIFRPS0VOIHZhbHVlLlxuICAgICAgICBpZiAoIWN1c3RvbURvbWFpbi5ob3N0ZWRab25lKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYFlvdSBhbHNvIG5lZWQgdG8gc3BlY2lmeSB0aGUgXCJob3N0ZWRab25lXCIgaWYgdGhlIFwiZG9tYWluTmFtZVwiIGlzIHBhc3NlZCBpbiBhcyBhIHJlZmVyZW5jZS5gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBkb21haW5OYW1lID0gY3VzdG9tRG9tYWluLmRvbWFpbk5hbWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkb21haW5OYW1lID0gY3VzdG9tRG9tYWluLmRvbWFpbk5hbWU7XG4gICAgICAgIHRoaXMuYXNzZXJ0RG9tYWluTmFtZUlzTG93ZXJDYXNlKGRvbWFpbk5hbWUpO1xuICAgICAgfVxuXG4gICAgICAvLyBwYXJzZSBjdXN0b21Eb21haW4uaG9zdGVkWm9uZVxuICAgICAgaWYgKCFjdXN0b21Eb21haW4uaG9zdGVkWm9uZSkge1xuICAgICAgICBob3N0ZWRab25lRG9tYWluID0gZG9tYWluTmFtZS5zcGxpdChcIi5cIikuc2xpY2UoMSkuam9pbihcIi5cIik7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjdXN0b21Eb21haW4uaG9zdGVkWm9uZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBob3N0ZWRab25lRG9tYWluID0gY3VzdG9tRG9tYWluLmhvc3RlZFpvbmU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBob3N0ZWRab25lID0gY3VzdG9tRG9tYWluLmhvc3RlZFpvbmU7XG4gICAgICB9XG5cbiAgICAgIGNlcnRpZmljYXRlID0gY3VzdG9tRG9tYWluLmNkaz8uY2VydGlmaWNhdGU7XG4gICAgICBiYXNlUGF0aCA9IGN1c3RvbURvbWFpbi5wYXRoO1xuICAgICAgZW5kcG9pbnRUeXBlID0gY3VzdG9tRG9tYWluLmVuZHBvaW50VHlwZTtcbiAgICAgIG10bHMgPSBjdXN0b21Eb21haW4ubXRscztcbiAgICAgIHNlY3VyaXR5UG9saWN5ID0gY3VzdG9tRG9tYWluLnNlY3VyaXR5UG9saWN5O1xuICAgIH1cblxuICAgIC8vIENhc2U6IGN1c3RvbURvbWFpbi5kb21haW5OYW1lIGlzIGEgY29uc3RydWN0XG4gICAgZWxzZSBpZiAoY3VzdG9tRG9tYWluLmNkaz8uZG9tYWluTmFtZSkge1xuICAgICAgYXBpZ0RvbWFpbk5hbWUgPSBjdXN0b21Eb21haW4uY2RrLmRvbWFpbk5hbWU7XG5cbiAgICAgIC8vIGN1c3RvbURvbWFpbi5kb21haW5OYW1lIGlzIGltcG9ydGVkXG4gICAgICBpZiAoXG4gICAgICAgIGFwaWdEb21haW5OYW1lICYmXG4gICAgICAgIChjdXN0b21Eb21haW4uaG9zdGVkWm9uZSB8fCBjdXN0b21Eb21haW4uY2RrPy5ob3N0ZWRab25lKVxuICAgICAgKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgQ2Fubm90IGNvbmZpZ3VyZSB0aGUgXCJob3N0ZWRab25lXCIgd2hlbiB0aGUgXCJkb21haW5OYW1lXCIgaXMgYSBjb25zdHJ1Y3RgXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoYXBpZ0RvbWFpbk5hbWUgJiYgY3VzdG9tRG9tYWluLmNkaz8uY2VydGlmaWNhdGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBDYW5ub3QgY29uZmlndXJlIHRoZSBcImNlcnRpZmljYXRlXCIgd2hlbiB0aGUgXCJkb21haW5OYW1lXCIgaXMgYSBjb25zdHJ1Y3RgXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoYXBpZ0RvbWFpbk5hbWUgJiYgY3VzdG9tRG9tYWluLmVuZHBvaW50VHlwZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYENhbm5vdCBjb25maWd1cmUgdGhlIFwiZW5kcG9pbnRUeXBlXCIgd2hlbiB0aGUgXCJkb21haW5OYW1lXCIgaXMgYSBjb25zdHJ1Y3RgXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoYXBpZ0RvbWFpbk5hbWUgJiYgY3VzdG9tRG9tYWluLm10bHMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBDYW5ub3QgY29uZmlndXJlIHRoZSBcIm10bHNcIiB3aGVuIHRoZSBcImRvbWFpbk5hbWVcIiBpcyBhIGNvbnN0cnVjdGBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChhcGlnRG9tYWluTmFtZSAmJiBjdXN0b21Eb21haW4uc2VjdXJpdHlQb2xpY3kpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBDYW5ub3QgY29uZmlndXJlIHRoZSBcInNlY3VyaXR5UG9saWN5XCIgd2hlbiB0aGUgXCJkb21haW5OYW1lXCIgaXMgYSBjb25zdHJ1Y3RgXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGJhc2VQYXRoID0gY3VzdG9tRG9tYWluLnBhdGg7XG4gICAgfVxuXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gRmluZCBob3N0ZWQgem9uZVxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIGlmICghYXBpZ0RvbWFpbk5hbWUgJiYgIWhvc3RlZFpvbmUpIHtcbiAgICAgIC8vIExvb2sgdXAgaG9zdGVkIHpvbmVcbiAgICAgIGlmICghaG9zdGVkWm9uZSAmJiBob3N0ZWRab25lRG9tYWluKSB7XG4gICAgICAgIGhvc3RlZFpvbmUgPSByb3V0ZTUzLkhvc3RlZFpvbmUuZnJvbUxvb2t1cCh0aGlzLCBcIkhvc3RlZFpvbmVcIiwge1xuICAgICAgICAgIGRvbWFpbk5hbWU6IGhvc3RlZFpvbmVEb21haW4sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIENyZWF0ZSBjZXJ0aWZpY2F0ZVxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIGlmICghYXBpZ0RvbWFpbk5hbWUgJiYgIWNlcnRpZmljYXRlKSB7XG4gICAgICBpZiAoZW5kcG9pbnRUeXBlID09PSBcImVkZ2VcIikge1xuICAgICAgICBjZXJ0aWZpY2F0ZSA9IG5ldyBhY20uRG5zVmFsaWRhdGVkQ2VydGlmaWNhdGUoXG4gICAgICAgICAgdGhpcyxcbiAgICAgICAgICBcIkNyb3NzUmVnaW9uQ2VydGlmaWNhdGVcIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICBkb21haW5OYW1lOiBkb21haW5OYW1lIGFzIHN0cmluZyxcbiAgICAgICAgICAgIGhvc3RlZFpvbmU6IGhvc3RlZFpvbmUgYXMgcm91dGU1My5JSG9zdGVkWm9uZSxcbiAgICAgICAgICAgIHJlZ2lvbjogXCJ1cy1lYXN0LTFcIixcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjZXJ0aWZpY2F0ZSA9IG5ldyBhY20uQ2VydGlmaWNhdGUodGhpcywgXCJDZXJ0aWZpY2F0ZVwiLCB7XG4gICAgICAgICAgZG9tYWluTmFtZTogZG9tYWluTmFtZSBhcyBzdHJpbmcsXG4gICAgICAgICAgdmFsaWRhdGlvbjogYWNtLkNlcnRpZmljYXRlVmFsaWRhdGlvbi5mcm9tRG5zKGhvc3RlZFpvbmUpLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2RrLmNlcnRpZmljYXRlID0gY2VydGlmaWNhdGU7XG4gICAgfVxuXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gQ3JlYXRlIEFQSSBHYXRld2F5IGRvbWFpbiBuYW1lXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgaWYgKCFhcGlnRG9tYWluTmFtZSAmJiBkb21haW5OYW1lKSB7XG4gICAgICAvLyBDcmVhdGUgY3VzdG9tIGRvbWFpbiBpbiBBUEkgR2F0ZXdheVxuICAgICAgYXBpZ0RvbWFpbk5hbWUgPSBuZXcgYXBpZy5Eb21haW5OYW1lKHRoaXMsIFwiRG9tYWluTmFtZVwiLCB7XG4gICAgICAgIGRvbWFpbk5hbWUsXG4gICAgICAgIGNlcnRpZmljYXRlOiBjZXJ0aWZpY2F0ZSBhcyBhY20uSUNlcnRpZmljYXRlLFxuICAgICAgICBlbmRwb2ludFR5cGU6XG4gICAgICAgICAgZW5kcG9pbnRUeXBlICYmXG4gICAgICAgICAgYXBpZy5FbmRwb2ludFR5cGVbXG4gICAgICAgICAgICBlbmRwb2ludFR5cGUudG9Mb2NhbGVVcHBlckNhc2UoKSBhcyBrZXlvZiB0eXBlb2YgYXBpZy5FbmRwb2ludFR5cGVcbiAgICAgICAgICBdLFxuICAgICAgICBtdGxzOiBtdGxzICYmIHtcbiAgICAgICAgICAuLi5tdGxzLFxuICAgICAgICAgIGJ1Y2tldDogbXRscy5idWNrZXQuY2RrLmJ1Y2tldCxcbiAgICAgICAgfSxcbiAgICAgICAgc2VjdXJpdHlQb2xpY3k6XG4gICAgICAgICAgc2VjdXJpdHlQb2xpY3kgPT09IFwiVExTIDEuMFwiXG4gICAgICAgICAgICA/IGFwaWcuU2VjdXJpdHlQb2xpY3kuVExTXzFfMFxuICAgICAgICAgICAgOiBzZWN1cml0eVBvbGljeSA9PT0gXCJUTFMgMS4yXCJcbiAgICAgICAgICAgID8gYXBpZy5TZWN1cml0eVBvbGljeS5UTFNfMV8yXG4gICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jZGsuZG9tYWluTmFtZSA9IGFwaWdEb21haW5OYW1lO1xuXG4gICAgICAvLyBDcmVhdGUgRE5TIHJlY29yZFxuICAgICAgdGhpcy5jcmVhdGVBUmVjb3JkcyhcbiAgICAgICAgaG9zdGVkWm9uZSBhcyByb3V0ZTUzLklIb3N0ZWRab25lLFxuICAgICAgICBkb21haW5OYW1lLFxuICAgICAgICBhcGlnRG9tYWluTmFtZVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBDcmVhdGUgYmFzZSBtYXBwaW5nXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgaWYgKGFwaWdEb21haW5OYW1lKSB7XG4gICAgICBuZXcgYXBpZy5CYXNlUGF0aE1hcHBpbmcodGhpcywgXCJCYXNlUGF0aFwiLCB7XG4gICAgICAgIGRvbWFpbk5hbWU6IGFwaWdEb21haW5OYW1lLFxuICAgICAgICByZXN0QXBpOiB0aGlzLmNkay5yZXN0QXBpLFxuICAgICAgICBiYXNlUGF0aCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE5vdGU6IFdlIG9ubHkga25vdyB0aGUgZnVsbCBjdXN0b20gZG9tYWluIGlmIGRvbWFpbk5hbWUgaXMgYSBzdHJpbmcuXG4gICAgLy8gICAgICAgX2N1c3RvbURvbWFpblVybCB3aWxsIGJlIHVuZGVmaW5lZCBpZiBhcGlnRG9tYWluTmFtZSBpcyBpbXBvcnRlZC5cbiAgICBpZiAoZG9tYWluTmFtZSAmJiAhY2RrLlRva2VuLmlzVW5yZXNvbHZlZChkb21haW5OYW1lKSkge1xuICAgICAgdGhpcy5fY3VzdG9tRG9tYWluVXJsID0gYmFzZVBhdGhcbiAgICAgICAgPyBgaHR0cHM6Ly8ke2RvbWFpbk5hbWV9LyR7YmFzZVBhdGh9L2BcbiAgICAgICAgOiBgaHR0cHM6Ly8ke2RvbWFpbk5hbWV9YDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUFSZWNvcmRzKFxuICAgIGhvc3RlZFpvbmU6IHJvdXRlNTMuSUhvc3RlZFpvbmUsXG4gICAgZG9tYWluTmFtZTogc3RyaW5nLFxuICAgIGFwaWdEb21haW46IGFwaWcuSURvbWFpbk5hbWVcbiAgKSB7XG4gICAgLy8gY3JlYXRlIEROUyByZWNvcmRcbiAgICBjb25zdCByZWNvcmRQcm9wcyA9IHtcbiAgICAgIHJlY29yZE5hbWU6IGRvbWFpbk5hbWUsXG4gICAgICB6b25lOiBob3N0ZWRab25lIGFzIHJvdXRlNTMuSUhvc3RlZFpvbmUsXG4gICAgICB0YXJnZXQ6IHJvdXRlNTMuUmVjb3JkVGFyZ2V0LmZyb21BbGlhcyhcbiAgICAgICAgbmV3IHJvdXRlNTNUYXJnZXRzLkFwaUdhdGV3YXlEb21haW4oYXBpZ0RvbWFpbilcbiAgICAgICksXG4gICAgfTtcbiAgICBjb25zdCByZWNvcmRzID0gW1xuICAgICAgbmV3IHJvdXRlNTMuQVJlY29yZCh0aGlzLCBcIkFsaWFzUmVjb3JkXCIsIHJlY29yZFByb3BzKSxcbiAgICAgIG5ldyByb3V0ZTUzLkFhYWFSZWNvcmQodGhpcywgXCJBbGlhc1JlY29yZEFBQUFcIiwgcmVjb3JkUHJvcHMpLFxuICAgIF07XG4gICAgLy8gbm90ZTogSWYgZG9tYWluTmFtZSBpcyBhIFRPS0VOIHN0cmluZyBpZS4gJHtUT0tFTi4ufSwgdGhlIHJvdXRlNTMuQVJlY29yZFxuICAgIC8vICAgICAgIGNvbnN0cnVjdCB3aWxsIGFwcGVuZCBcIi4ke2hvc3RlZFpvbmVOYW1lfVwiIHRvIHRoZSBlbmQgb2YgdGhlIGRvbWFpbi5cbiAgICAvLyAgICAgICBUaGlzIGlzIGJlY2F1c2UgdGhlIGNvbnN0cnVjdCB0cmllcyB0byBjaGVjayBpZiB0aGUgcmVjb3JkIG5hbWVcbiAgICAvLyAgICAgICBlbmRzIHdpdGggdGhlIGRvbWFpbiBuYW1lLiBJZiBub3QsIGl0IHdpbGwgYXBwZW5kIHRoZSBkb21haW4gbmFtZS5cbiAgICAvLyAgICAgICBTbywgd2UgbmVlZCByZW1vdmUgdGhpcyBiZWhhdmlvci5cbiAgICBpZiAoY2RrLlRva2VuLmlzVW5yZXNvbHZlZChkb21haW5OYW1lKSkge1xuICAgICAgcmVjb3Jkcy5mb3JFYWNoKChyZWNvcmQpID0+IHtcbiAgICAgICAgY29uc3QgY2ZuUmVjb3JkID0gcmVjb3JkLm5vZGUuZGVmYXVsdENoaWxkIGFzIHJvdXRlNTMuQ2ZuUmVjb3JkU2V0O1xuICAgICAgICBjZm5SZWNvcmQubmFtZSA9IGRvbWFpbk5hbWU7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGltcG9ydFJlc291cmNlcyhyZXNvdXJjZXM6IHsgW3BhdGg6IHN0cmluZ106IHN0cmluZyB9KTogdm9pZCB7XG4gICAgT2JqZWN0LmtleXMocmVzb3VyY2VzKS5mb3JFYWNoKChwYXRoKSA9PiB7XG4gICAgICBjb25zdCByZXNvdXJjZSA9IGFwaWcuUmVzb3VyY2UuZnJvbVJlc291cmNlQXR0cmlidXRlcyhcbiAgICAgICAgdGhpcyxcbiAgICAgICAgYFJlc291cmNlXyR7cGF0aH1gLFxuICAgICAgICB7XG4gICAgICAgICAgcGF0aCxcbiAgICAgICAgICByZXNvdXJjZUlkOiByZXNvdXJjZXNbcGF0aF0sXG4gICAgICAgICAgcmVzdEFwaTogdGhpcy5jZGsucmVzdEFwaSxcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuaW1wb3J0ZWRSZXNvdXJjZXNbcGF0aF0gPSByZXNvdXJjZTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UmVzb3VyY2VGb3JQYXRoKHBhdGg6IHN0cmluZyk6IGFwaWcuSVJlc291cmNlIHtcbiAgICAvLyBMb29rdXAgZXhhY3QgbWF0Y2ggaW1wb3J0ZWQgcmVzb3VyY2VcbiAgICBpZiAodGhpcy5pbXBvcnRlZFJlc291cmNlc1twYXRoXSkge1xuICAgICAgcmV0dXJuIHRoaXMuaW1wb3J0ZWRSZXNvdXJjZXNbcGF0aF07XG4gICAgfVxuXG4gICAgLy8gTG9va3VwIHBhcmVudHMgbWF0Y2hpbmcgaW1wb3J0ZWQgcmVzb3VyY2UgZmlyc3RcbiAgICBjb25zdCBwYXJ0cyA9IHBhdGguc3BsaXQoXCIvXCIpO1xuICAgIGZvciAobGV0IGkgPSBwYXJ0cy5sZW5ndGg7IGkgPj0gMTsgaS0tKSB7XG4gICAgICBjb25zdCBwYXJ0aWFsUGF0aCA9IHBhcnRzLnNsaWNlKDAsIGkpLmpvaW4oXCIvXCIpO1xuICAgICAgaWYgKHRoaXMuaW1wb3J0ZWRSZXNvdXJjZXNbcGFydGlhbFBhdGhdKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmltcG9ydGVkUmVzb3VyY2VzW3BhcnRpYWxQYXRoXS5yZXNvdXJjZUZvclBhdGgoXG4gICAgICAgICAgcGFydHMuc2xpY2UoaSkuam9pbihcIi9cIilcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBOb3QgY2hpbGQgb2YgaW1wb3J0ZWQgcmVzb3VyY2VzLCBjcmVhdGUgb2ZmIHRoZSByb290XG4gICAgcmV0dXJuIHRoaXMuY2RrLnJlc3RBcGkucm9vdC5yZXNvdXJjZUZvclBhdGgocGF0aCk7XG4gIH1cblxuICBwcml2YXRlIGFkZEF1dGhvcml6ZXJzKGF1dGhvcml6ZXJzOiBBdXRob3JpemVycykge1xuICAgIE9iamVjdC5lbnRyaWVzKGF1dGhvcml6ZXJzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgIGlmIChrZXkgPT09IFwibm9uZVwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IG5hbWUgYW4gYXV0aG9yaXplciBcIm5vbmVcImApO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT09IFwiaWFtXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgbmFtZSBhbiBhdXRob3JpemVyIFwiaWFtXCJgKTtcbiAgICAgIH0gZWxzZSBpZiAodmFsdWUudHlwZSA9PT0gXCJ1c2VyX3Bvb2xzXCIpIHtcbiAgICAgICAgaWYgKHZhbHVlLmNkaz8uYXV0aG9yaXplcikge1xuICAgICAgICAgIHRoaXMuYXV0aG9yaXplcnNEYXRhW2tleV0gPSB2YWx1ZS5jZGsuYXV0aG9yaXplcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoIXZhbHVlLnVzZXJQb29sSWRzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgXCJ1c2VyUG9vbElkc1wiIGZvciBcIiR7a2V5fVwiIGF1dGhvcml6ZXJgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgdXNlclBvb2xzID0gdmFsdWUudXNlclBvb2xJZHMubWFwKCh1c2VyUG9vbElkKSA9PlxuICAgICAgICAgICAgY29nbml0by5Vc2VyUG9vbC5mcm9tVXNlclBvb2xJZChcbiAgICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgICAgYCR7a2V5fS1JbXBvcnRlZFVzZXJQb29sYCxcbiAgICAgICAgICAgICAgdXNlclBvb2xJZFxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgICAgdGhpcy5hdXRob3JpemVyc0RhdGFba2V5XSA9IG5ldyBhcGlnLkNvZ25pdG9Vc2VyUG9vbHNBdXRob3JpemVyKFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgY29nbml0b1VzZXJQb29sczogdXNlclBvb2xzLFxuICAgICAgICAgICAgICBhdXRob3JpemVyTmFtZTogdmFsdWUubmFtZSxcbiAgICAgICAgICAgICAgaWRlbnRpdHlTb3VyY2U6IHZhbHVlLmlkZW50aXR5U291cmNlLFxuICAgICAgICAgICAgICByZXN1bHRzQ2FjaGVUdGw6IHZhbHVlLnJlc3VsdHNDYWNoZVR0bFxuICAgICAgICAgICAgICAgID8gdG9DZGtEdXJhdGlvbih2YWx1ZS5yZXN1bHRzQ2FjaGVUdGwpXG4gICAgICAgICAgICAgICAgOiBjZGsuRHVyYXRpb24uc2Vjb25kcygwKSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlLnR5cGUgPT09IFwibGFtYmRhX3Rva2VuXCIpIHtcbiAgICAgICAgaWYgKHZhbHVlLmNkaz8uYXV0aG9yaXplcikge1xuICAgICAgICAgIHRoaXMuYXV0aG9yaXplcnNEYXRhW2tleV0gPSB2YWx1ZS5jZGsuYXV0aG9yaXplcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoIXZhbHVlLmZ1bmN0aW9uKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgXCJmdW5jdGlvblwiIGZvciBcIiR7a2V5fVwiIGF1dGhvcml6ZXJgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5hdXRob3JpemVyc0RhdGFba2V5XSA9IG5ldyBhcGlnLlRva2VuQXV0aG9yaXplcih0aGlzLCBrZXksIHtcbiAgICAgICAgICAgIGhhbmRsZXI6IHZhbHVlLmZ1bmN0aW9uLFxuICAgICAgICAgICAgYXV0aG9yaXplck5hbWU6IHZhbHVlLm5hbWUsXG4gICAgICAgICAgICBpZGVudGl0eVNvdXJjZTogdmFsdWUuaWRlbnRpdHlTb3VyY2UsXG4gICAgICAgICAgICB2YWxpZGF0aW9uUmVnZXg6IHZhbHVlLnZhbGlkYXRpb25SZWdleCxcbiAgICAgICAgICAgIGFzc3VtZVJvbGU6IHZhbHVlLmNkaz8uYXNzdW1lUm9sZSxcbiAgICAgICAgICAgIHJlc3VsdHNDYWNoZVR0bDogdmFsdWUucmVzdWx0c0NhY2hlVHRsXG4gICAgICAgICAgICAgID8gdG9DZGtEdXJhdGlvbih2YWx1ZS5yZXN1bHRzQ2FjaGVUdGwpXG4gICAgICAgICAgICAgIDogY2RrLkR1cmF0aW9uLnNlY29uZHMoMCksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodmFsdWUudHlwZSA9PT0gXCJsYW1iZGFfcmVxdWVzdFwiKSB7XG4gICAgICAgIGlmICh2YWx1ZS5jZGs/LmF1dGhvcml6ZXIpIHtcbiAgICAgICAgICB0aGlzLmF1dGhvcml6ZXJzRGF0YVtrZXldID0gdmFsdWUuY2RrLmF1dGhvcml6ZXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKCF2YWx1ZS5mdW5jdGlvbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIFwiZnVuY3Rpb25cIiBmb3IgXCIke2tleX1cIiBhdXRob3JpemVyYCk7XG4gICAgICAgICAgfSBlbHNlIGlmICghdmFsdWUuaWRlbnRpdHlTb3VyY2VzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIGBNaXNzaW5nIFwiaWRlbnRpdHlTb3VyY2VzXCIgZm9yIFwiJHtrZXl9XCIgYXV0aG9yaXplcmBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuYXV0aG9yaXplcnNEYXRhW2tleV0gPSBuZXcgYXBpZy5SZXF1ZXN0QXV0aG9yaXplcih0aGlzLCBrZXksIHtcbiAgICAgICAgICAgIGhhbmRsZXI6IHZhbHVlLmZ1bmN0aW9uLFxuICAgICAgICAgICAgYXV0aG9yaXplck5hbWU6IHZhbHVlLm5hbWUsXG4gICAgICAgICAgICBpZGVudGl0eVNvdXJjZXM6IHZhbHVlLmlkZW50aXR5U291cmNlcyxcbiAgICAgICAgICAgIGFzc3VtZVJvbGU6IHZhbHVlLmNkaz8uYXNzdW1lUm9sZSxcbiAgICAgICAgICAgIHJlc3VsdHNDYWNoZVR0bDogdmFsdWUucmVzdWx0c0NhY2hlVHRsXG4gICAgICAgICAgICAgID8gdG9DZGtEdXJhdGlvbih2YWx1ZS5yZXN1bHRzQ2FjaGVUdGwpXG4gICAgICAgICAgICAgIDogY2RrLkR1cmF0aW9uLnNlY29uZHMoMCksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYWRkUm91dGUoXG4gICAgc2NvcGU6IENvbnN0cnVjdCxcbiAgICByb3V0ZUtleTogc3RyaW5nLFxuICAgIHJvdXRlVmFsdWU6IEFwaUdhdGV3YXlWMUFwaVJvdXRlUHJvcHM8a2V5b2YgQXV0aG9yaXplcnM+XG4gICk6IEZuIHtcbiAgICAvLyBOb3JtYWxpemUgcm91dGVLZXlcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgcm91dGVLZXkgPSB0aGlzLm5vcm1hbGl6ZVJvdXRlS2V5KHJvdXRlS2V5KTtcbiAgICBpZiAodGhpcy5mdW5jdGlvbnNbcm91dGVLZXldKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEEgcm91dGUgYWxyZWFkeSBleGlzdHMgZm9yIFwiJHtyb3V0ZUtleX1cImApO1xuICAgIH1cblxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBHZXQgcGF0aCBhbmQgbWV0aG9kXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIGNvbnN0IHJvdXRlS2V5UGFydHMgPSByb3V0ZUtleS5zcGxpdChcIiBcIik7XG4gICAgaWYgKHJvdXRlS2V5UGFydHMubGVuZ3RoICE9PSAyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgcm91dGUgJHtyb3V0ZUtleX1gKTtcbiAgICB9XG4gICAgY29uc3QgbWV0aG9kU3RyID0gcm91dGVLZXlQYXJ0c1swXS50b1VwcGVyQ2FzZSgpO1xuICAgIGNvbnN0IHBhdGggPSByb3V0ZUtleVBhcnRzWzFdO1xuICAgIGNvbnN0IG1ldGhvZCA9IGFsbG93ZWRNZXRob2RzLmZpbmQoKHBlcikgPT4gcGVyID09PSBtZXRob2RTdHIpO1xuICAgIGlmICghbWV0aG9kKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbWV0aG9kIGRlZmluZWQgZm9yIFwiJHtyb3V0ZUtleX1cImApO1xuICAgIH1cbiAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBwYXRoIGRlZmluZWQgZm9yIFwiJHtyb3V0ZUtleX1cImApO1xuICAgIH1cblxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBDcmVhdGUgUmVzb3VyY2VzXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIGxldCByZXNvdXJjZTtcbiAgICBpZiAocGF0aC5lbmRzV2l0aChcIi97cHJveHkrfVwiKSkge1xuICAgICAgY29uc3QgcGFyZW50UmVzb3VyY2UgPSB0aGlzLmdldFJlc291cmNlRm9yUGF0aChcbiAgICAgICAgcGF0aC5zcGxpdChcIi9cIikuc2xpY2UoMCwgLTEpLmpvaW4oXCIvXCIpXG4gICAgICApO1xuICAgICAgcmVzb3VyY2UgPSBwYXJlbnRSZXNvdXJjZS5hZGRQcm94eSh7IGFueU1ldGhvZDogZmFsc2UgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc291cmNlID0gdGhpcy5nZXRSZXNvdXJjZUZvclBhdGgocGF0aCk7XG4gICAgfVxuXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIENyZWF0ZSBNZXRob2RcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgY29uc3Qgcm91dGVQcm9wcyA9IEZuLmlzSW5saW5lRGVmaW5pdGlvbihyb3V0ZVZhbHVlKVxuICAgICAgPyAoeyBmdW5jdGlvbjogcm91dGVWYWx1ZSB9IGFzIEFwaUdhdGV3YXlWMUFwaUZ1bmN0aW9uUm91dGVQcm9wczxcbiAgICAgICAgICBrZXlvZiBBdXRob3JpemVyc1xuICAgICAgICA+KVxuICAgICAgOiAocm91dGVWYWx1ZSBhcyBBcGlHYXRld2F5VjFBcGlGdW5jdGlvblJvdXRlUHJvcHM8a2V5b2YgQXV0aG9yaXplcnM+KTtcbiAgICBjb25zdCBsYW1iZGEgPSBGbi5mcm9tRGVmaW5pdGlvbihcbiAgICAgIHNjb3BlLFxuICAgICAgYExhbWJkYV8ke21ldGhvZFN0cn1fJHtwYXRofWAsXG4gICAgICByb3V0ZVByb3BzLmZ1bmN0aW9uLFxuICAgICAgdGhpcy5wcm9wcy5kZWZhdWx0cz8uZnVuY3Rpb24sXG4gICAgICBgVGhlIFwiZGVmYXVsdHMuZnVuY3Rpb25cIiBjYW5ub3QgYmUgYXBwbGllZCBpZiBhbiBpbnN0YW5jZSBvZiBhIEZ1bmN0aW9uIGNvbnN0cnVjdCBpcyBwYXNzZWQgaW4uIE1ha2Ugc3VyZSB0byBkZWZpbmUgYWxsIHRoZSByb3V0ZXMgdXNpbmcgRnVuY3Rpb25Qcm9wcywgc28gdGhlIEFwaUdhdGV3YXlWMUFwaSBjb25zdHJ1Y3QgY2FuIGFwcGx5IHRoZSBcImRlZmF1bHRzLmZ1bmN0aW9uXCIgdG8gdGhlbS5gXG4gICAgKTtcbiAgICBjb25zdCBpbnRlZ3JhdGlvbiA9IG5ldyBhcGlnLkxhbWJkYUludGVncmF0aW9uKFxuICAgICAgbGFtYmRhLFxuICAgICAgcm91dGVQcm9wcy5jZGs/LmludGVncmF0aW9uXG4gICAgKTtcbiAgICBjb25zdCBtZXRob2RPcHRpb25zID0gdGhpcy5idWlsZFJvdXRlTWV0aG9kT3B0aW9ucyhyb3V0ZVByb3BzKTtcbiAgICBjb25zdCBhcGlnTWV0aG9kID0gcmVzb3VyY2UuYWRkTWV0aG9kKG1ldGhvZCwgaW50ZWdyYXRpb24sIG1ldGhvZE9wdGlvbnMpO1xuXG4gICAgLy8gQWRkIGFuIGVudmlyb25tZW50IHZhcmlhYmxlIHRvIGRldGVybWluZSBpZiB0aGUgZnVuY3Rpb24gaXMgYW4gQXBpIHJvdXRlLlxuICAgIC8vIElmIGl0IGlzLCB3aGVuIFwic3N0IHN0YXJ0XCIgaXMgbm90IGNvbm5lY3RlZCwgd2Ugd2FudCB0byByZXR1cm4gYW4gNTAwXG4gICAgLy8gc3RhdHVzIGNvZGUgYW5kIGEgZGVzY3JpcHRpdmUgZXJyb3IgbWVzc2FnZS5cbiAgICBjb25zdCByb290ID0gc2NvcGUubm9kZS5yb290IGFzIEFwcDtcbiAgICBpZiAocm9vdC5sb2NhbCkge1xuICAgICAgbGFtYmRhLmFkZEVudmlyb25tZW50KFwiU1NUX0RFQlVHX0lTX0FQSV9ST1VURVwiLCBcIjFcIiwge1xuICAgICAgICByZW1vdmVJbkVkZ2U6IHRydWUsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gSGFuZGxlIG1hbnVhbGx5IGNyZWF0ZWQgRGVwbG95bWVudCByZXNvdXJjZSAoaWUuIGltcG9ydGVkIFJFU1QgQVBJKVxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICBpZiAodGhpcy5fZGVwbG95bWVudCkge1xuICAgICAgdGhpcy5fZGVwbG95bWVudC5hZGRUb0xvZ2ljYWxJZCh7IHJvdXRlOiB7IHJvdXRlS2V5LCByb3V0ZVZhbHVlIH0gfSk7XG4gICAgICB0aGlzLl9kZXBsb3ltZW50Lm5vZGUuYWRkRGVwZW5kZW5jeShhcGlnTWV0aG9kKTtcbiAgICB9XG5cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gU3RvcmUgZnVuY3Rpb25cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgdGhpcy5mdW5jdGlvbnNbcm91dGVLZXldID0gbGFtYmRhO1xuXG4gICAgcmV0dXJuIGxhbWJkYTtcbiAgfVxuXG4gIHByaXZhdGUgYnVpbGRSb3V0ZU1ldGhvZE9wdGlvbnMoXG4gICAgcm91dGVQcm9wczogQXBpR2F0ZXdheVYxQXBpRnVuY3Rpb25Sb3V0ZVByb3BzPGtleW9mIEF1dGhvcml6ZXJzPlxuICApOiBhcGlnLk1ldGhvZE9wdGlvbnMge1xuICAgIGNvbnN0IGF1dGhvcml6ZXJLZXkgPVxuICAgICAgcm91dGVQcm9wcy5hdXRob3JpemVyIHx8IHRoaXMucHJvcHMuZGVmYXVsdHM/LmF1dGhvcml6ZXIgfHwgXCJub25lXCI7XG4gICAgaWYgKGF1dGhvcml6ZXJLZXkgPT09IFwibm9uZVwiKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhdXRob3JpemF0aW9uVHlwZTogYXBpZy5BdXRob3JpemF0aW9uVHlwZS5OT05FLFxuICAgICAgICAuLi5yb3V0ZVByb3BzLmNkaz8ubWV0aG9kLFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKGF1dGhvcml6ZXJLZXkgPT09IFwiaWFtXCIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGF1dGhvcml6YXRpb25UeXBlOiBhcGlnLkF1dGhvcml6YXRpb25UeXBlLklBTSxcbiAgICAgICAgLi4ucm91dGVQcm9wcy5jZGs/Lm1ldGhvZCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnByb3BzLmF1dGhvcml6ZXJzIHx8ICF0aGlzLnByb3BzLmF1dGhvcml6ZXJzW2F1dGhvcml6ZXJLZXldKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBmaW5kIGF1dGhvcml6ZXIgXCIke2F1dGhvcml6ZXJLZXl9XCJgKTtcbiAgICB9XG5cbiAgICBjb25zdCBhdXRob3JpemVyID0gdGhpcy5hdXRob3JpemVyc0RhdGFbYXV0aG9yaXplcktleSBhcyBzdHJpbmddO1xuICAgIGNvbnN0IGF1dGhvcml6YXRpb25UeXBlID0gdGhpcy5wcm9wcy5hdXRob3JpemVyc1thdXRob3JpemVyS2V5XS50eXBlO1xuICAgIGlmIChhdXRob3JpemF0aW9uVHlwZSA9PT0gXCJ1c2VyX3Bvb2xzXCIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGF1dGhvcml6YXRpb25UeXBlOiBhcGlnLkF1dGhvcml6YXRpb25UeXBlLkNPR05JVE8sXG4gICAgICAgIGF1dGhvcml6ZXIsXG4gICAgICAgIGF1dGhvcml6YXRpb25TY29wZXM6XG4gICAgICAgICAgcm91dGVQcm9wcy5hdXRob3JpemF0aW9uU2NvcGVzIHx8XG4gICAgICAgICAgdGhpcy5wcm9wcy5kZWZhdWx0cz8uYXV0aG9yaXphdGlvblNjb3BlcyxcbiAgICAgICAgLi4ucm91dGVQcm9wcy5jZGs/Lm1ldGhvZCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGF1dGhvcml6YXRpb25UeXBlOiBhcGlnLkF1dGhvcml6YXRpb25UeXBlLkNVU1RPTSxcbiAgICAgIGF1dGhvcml6ZXIsXG4gICAgICAuLi5yb3V0ZVByb3BzLmNkaz8ubWV0aG9kLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIG5vcm1hbGl6ZVJvdXRlS2V5KHJvdXRlS2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiByb3V0ZUtleS5zcGxpdCgvXFxzKy8pLmpvaW4oXCIgXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3NlcnREb21haW5OYW1lSXNMb3dlckNhc2UoZG9tYWluTmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKGRvbWFpbk5hbWUgIT09IGRvbWFpbk5hbWUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgZG9tYWluIG5hbWUgbmVlZHMgdG8gYmUgaW4gbG93ZXJjYXNlYCk7XG4gICAgfVxuICB9XG59XG4iXX0=